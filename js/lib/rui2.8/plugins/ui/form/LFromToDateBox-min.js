/*
 * @(#) LFromToDateBox-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.namespace("Rui.ui.form"),Rui.ui.form.LFromToDateBox=function(t){t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.fromtodateBox.defaultProperties")),Rui.platform.isMobile&&(t.picker=!1),Rui.ui.form.LFromToDateBox.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LFromToDateBox,Rui.ui.form.LField,{otype:"Rui.ui.form.LFromToDateBox",CSS_BASE:"L-fromtodatebox",valueFormat:"%Y-%m-%d",separator:"~",listPosition:"auto",dateBoxWidth:90,separatorWidth:15,iconWidth:20,iconMarginLeft:1,picker:!0,fromPlaceholder:null,toPlaceholder:null,editable:!0,selectOnPicker:!0,initDefaultConfig:function(){Rui.ui.form.LField.superclass.initDefaultConfig.call(this),this.cfg.addProperty("editable",{handler:this._setEditable,value:this.editable,validator:Rui.isBoolean})},createTemplate:function(t){var e=Rui.get(t);return e.addClass(this.CSS_BASE),e.addClass("L-fixed"),e.addClass("L-form-field"),e},doRender:function(t){this.createTemplate(this.el);var e=document.createElement("input");e.type="hidden",e.name=this.name||this.id,e.id=Rui.useFixedId()?Rui.id(this.el,"LFromToDateBox-hidden-"+this.id):Rui.id(),e.instance=this,e.className="L-instance L-hidden-field",this.el.appendChild(e),this.hiddenInputEl=Rui.get(e),this.hiddenInputEl.addClass("L-hidden-field");var i=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div");i.id=Rui.useFixedId()?Rui.id(this.el,"LFromToDateBox-startbox-"+this.id):Rui.id(),a.id=Rui.useFixedId()?Rui.id(this.el,"LFromToDateBox-endbox-"+this.id):Rui.id(),s.id=Rui.useFixedId()?Rui.id(this.el,"LFromToDateBox-wave-"+this.id):Rui.id();var o=Rui.get(i),l=Rui.get(a),n=Rui.get(s);n.addClass("L-date-separator"),n.html("~"),this.el.appendChild(o),this.el.appendChild(n),this.el.appendChild(l);var d=n.getWidth(),r=this.el.getBorderWidth("lr");this.width>2*this.dateBoxWidth+d+r&&(this.dateBoxWidth=(this.width-r-d)/2),this.startDateBox=new Rui.ui.form.LDateBox({applyTo:o.id,dateType:"string",name:this.id+"StartDate",valueFormat:"%Y%m%d",placeholder:this.fromPlaceholder,defaultValue:this.startDate,width:this.dateBoxWidth}),this.endDateBox=new Rui.ui.form.LDateBox({applyTo:l.id,dateType:"string",name:this.id+"EndDate",valueFormat:"%Y%m%d",placeholder:this.toPlaceholder,defaultValue:this.endDate,width:this.dateBoxWidth}),this.startDateBox.el.addClass("startDateBox"),this.endDateBox.el.addClass("endDateBox")},afterRender:function(t){Rui.ui.form.LFromToDateBox.superclass.afterRender.call(this,t),this.startDateBox.on("changed",this.onStartDateChanged,this,!0,{system:!0}),this.startDateBox.on("specialkey",this.onFireKey,this,!0),this.startDateBox.on("focus",this.onCheckFocus,this,!0),this.startDateBox.on("blur",this.deferOnBlur,this,!0),this.endDateBox.on("changed",this.onEndDateChanged,this,!0,{system:!0}),this.endDateBox.on("specialkey",this.onFireKey,this,!0),this.endDateBox.on("focus",this.onCheckFocus,this,!0),this.endDateBox.on("blur",this.deferOnBlur,this,!0),this.doRenderCalendar(),this.calendar&&this.calendar.on("select",this.onCalendarSelect,this,!0,{system:!0}),this.startDateBox.pickerOff(),this.endDateBox.pickerOff(),this.startDateBox.onIconClick=Rui.util.LFunction.createDelegate(this.onIconClick,this),this.endDateBox.onIconClick=Rui.util.LFunction.createDelegate(this.onIconClick,this),this.startDateBox.pickerOn(),this.endDateBox.pickerOn(),this.initFocus()},doRenderCalendar:function(){var t=this.calendarConfig||{width:390};t.draggable=!1,t.id=Rui.useFixedId()?Rui.id(this.el,"LFromToDateBox-"+this.id):Rui.id(),this.calendar=new Rui.ui.calendar.LFromToCalendar(t),this.calendar.setHeader(Rui.getMessageManager().get("$.ext.msg020")),this.calendar.render(document.body),this.calendar.hide(),this.calendar.el.addClass("L-fromtodatebox-calendar")},initFocus:function(){var t=this.startDateBox.getDisplayEl(),e=this.endDateBox.getDisplayEl();t&&(t.on("focus",this.onCheckFocus,this,!0,{system:!0}),t.on("blur",this.deferOnBlur,this,!0,{system:!0})),e&&(e.on("focus",this.onCheckFocus,this,!0,{system:!0}),e.on("blur",this.deferOnBlur,this,!0,{system:!0}))},onStartDateChanged:function(t){this.validateValue()?this.doChanged():(Rui.util.LDom.toast(Rui.getMessageManager().get("$.ext.msg022"),this.el.dom),this.startDateBox.setValue(this.lastStartValue))},onEndDateChanged:function(t){this.validateValue()?this.doChanged():(Rui.util.LDom.toast(Rui.getMessageManager().get("$.ext.msg022"),this.el.dom),this.endDateBox.setValue(this.lastEndValue))},onCalendarSelect:function(t){t.start&&(this.setStartValue(t.start),this.selectStart=!0),t.end&&(this.setEndValue(t.end),this.selectEnd=!0),this.selectStart&&this.selectEnd&&(this.validateValue()&&this.calendar.hide(),!0===this.el.hasClass("L-binded")&&(this.selectStart=this.selectEnd=null))},onIconClick:function(t){this.showCalendar()},doChanged:function(){var t=this.getStartValue(),e=this.getEndValue(),i=this.getValue(),a=i.split(this.separator);a[0]=Rui.util.LFormat.stringToDate(t,{format:"%Y%m%d"}),a[1]=Rui.util.LFormat.stringToDate(e,{format:"%Y%m%d"}),a[0]=Rui.util.LFormat.dateToString(a[0],{format:this.valueFormat}),a[1]=Rui.util.LFormat.dateToString(a[1],{format:this.valueFormat}),i=a.join(this.separator),this.hiddenInputEl.setValue(i),this.fireEvent("changed",{target:this,startValue:t,endValue:e,value:i})},validateValue:function(){var t=this.startDateBox.getValue(),e=this.endDateBox.getValue();if(!t||!e)return!0;if("date"==this.startDateBox.dateType){if(e<t)return!1}else if(parseInt(t,10)>parseInt(e,10))return!1;return!0},showCalendar:function(){!0!==this.disabled&&(this.selectOnPicker&&this.setCalendarDates(),this.setCalendarXY(),this.calendar.show())},setCalendarDates:function(){var t=this.getStartValue(),e=this.getEndValue();t instanceof Date||(t=this.startDateBox.getDate(t)),e instanceof Date||(e=this.endDateBox.getDate(e)),t&&(this.calendar.clear(),this.calendar.select(t,e,!1))},setCalendarXY:function(){var t=this.calendar.el,e=t.getHeight()||0,i=this.el.getTop()+this.el.getHeight(),a=this.el.getLeft(),s=Rui.util.LDom.getViewport();("auto"!=this.listPosition||Rui.util.LDom.isVisibleSide(e+i))&&"up"!=this.listPosition||(i=this.el.getTop()-e),s.width<=a+t.getWidth()&&(a-=t.getWidth()/2),t.setTop(i),t.setLeft(a)},_setWidth:function(t,e,i){var a;e[0]<0||(Rui.ui.form.LFromToDateBox.superclass._setWidth.call(this,t,e,i),this.iconEl&&(a=(a=this.getContentWidth()-this.separatorWidth-(this.iconEl.getWidth()||this.iconWidth)-this.iconMarginLeft)%2==1?(a-1)/2:a/2,this.startDateBox.setWidth(a),this.endDateBox.setWidth(a)),Rui.ui.form.LFromToDateBox.superclass._setWidth.call(this,t,e,i))},_setEditable:function(t,e,i){Rui.ui.form.LFromToDateBox.superclass._setEditable.call(this,t,e,i),this.startDateBox.setEditable(e[0]),this.endDateBox.setEditable(e[0])},_setHeight:function(t,e,i){Rui.ui.form.LFromToDateBox.superclass._setHeight.call(this,t,e,i);var a=this.getContentHeight();this.startDateBox.setHeight(a),this.endDateBox.setHeight(a)},_setDisabled:function(t,e,i){!1===e[0]?(this.disabled=!1,this.el.removeClass("L-disabled"),this.startDateBox.enable(),this.endDateBox.enable(),this.setEditable(void 0===this.latestEditable?this.editable:this.latestEditable),this.fireEvent("enable")):(this.disabled=!0,this.el.addClass("L-disabled"),this.latestEditable=this.editable,this.setEditable(!1),this.startDateBox.disable(),this.endDateBox.disable(),this.fireEvent("disable"))},deferOnBlur:function(t){var e;this.calendar.calContainerEl&&this.calendar.calContainerEl.isAncestor(t.target)&&("a"==(e=Rui.get(t.target)).dom.tagName.toLowerCase()&&e.hasClass("selector")&&(this.calendar.fromCalendarEl&&this.calendar.fromCalendarEl.isAncestor(t.target)?this.calendar.fromCalendar.doSelectCell(t,this.calendar.fromCalendar):this.calendar.toCalendarEl&&this.calendar.toCalendarEl.isAncestor(t.target)&&this.calendar.toCalendar.doSelectCell(t,this.calendar.toCalendar))),Rui.util.LFunction.defer(this.checkBlur,10,this,[t])},checkBlur:function(t){var e;1!=t.deferCancelBubble&&!0===this.isFocus&&(e=t.target,this.el.isAncestor(e)||this.startDateBox.el.isAncestor(e)||this.endDateBox.el.isAncestor(e)||this.calendar.el&&this.calendar.el.isAncestor(e)?t.deferCancelBubble=!0:Rui.ui.form.LFromToDateBox.superclass.checkBlur.call(this,t))},setValue:function(t){var e;t&&(this.hiddenInputEl.setValue(t),e=t.split(this.separator),this.setStartValue(Rui.util.LFormat.stringToDate(e[0],{format:this.valueFormat})),this.setEndValue(Rui.util.LFormat.stringToDate(e[1],{format:this.valueFormat})))},setStartValue:function(t){t!=this.lastStartValue&&(this.lastStartValue=this.startDateBox.getValue(),this.startDateBox.setValue(t))},setEndValue:function(t){t!=this.lastEndValue&&(this.lastEndValue=this.endDateBox.getValue(),this.endDateBox.setValue(t))},getStartValue:function(){return this.startDateBox.getValue()},getEndValue:function(){return this.endDateBox.getValue()},getValue:function(){return this.hiddenInputEl.getValue()},setEditable:function(t){this.cfg.setProperty("editable",!0!==this.disabled&&t)},focus:function(){this.startDateBox.focus()},blur:function(){this.startDateBox.blur(),this.endDateBox.blur()},destroy:function(){this.startDateBox.destroy(),this.endDateBox.destroy(),Rui.ui.form.LFromToDateBox.superclass.destroy.call(this)},toString:function(){return(this.otype||"Rui.ui.form.LFromToDateBox")+" "+this.id}});