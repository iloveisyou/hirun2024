/*
 * @(#) LMultiCombo-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.ui.form.LMultiCombo=function(t){(t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.multicombo.defaultProperties"))).useEmptyText=!1,Rui.ui.form.LMultiCombo.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LMultiCombo,Rui.ui.form.LCombo,{otype:"Rui.ui.form.LMultiCombo",useEmptyText:!1,forceSelection:!1,separator:",",doRender:function(){Rui.ui.form.LMultiCombo.superclass.doRender.call(this),this.el.addClass("L-multi-combo")},afterRender:function(t){Rui.ui.form.LMultiCombo.superclass.afterRender.call(this,t),this.dataSet.on("marked",this.onMarked,this,!0),this.dataSet.on("allMarked",this.onAllMarked,this,!0)},createOptionDiv:function(){Rui.ui.form.LMultiCombo.superclass.createOptionDiv.call(this),this.optionDivEl.addClass("L-multi-combo")},createItem:function(t){var e=t.record,i=e.dataSet,a=e.get(this.displayField),a=Rui.isEmpty(a)?"":a,s="",s=this.listRenderer?this.listRenderer(e):'<div class="L-selection"></div><div class="L-display-field">'+a+"</div>",o=-1<t.row&&i.isMarked(t.row),n=Rui.createElements('<div class="L-list L-row-'+e.id+(o?" L-marked":"")+'">'+s+"</div>").getAt(0),r=this.optionDivEl;return Rui.useAccessibility()&&n.setAttribute("role","option"),n.hover(function(){this.addClass("active")},function(){r.select(".active").removeClass("active")}),n},doDataChangedDataSet:function(){if(!0===this.autoComplete||this.isFocus){if(this.removeAllItem(),!0===this.useEmptyText&&this.createEmptyText(),this.optionDivEl){for(var t,e=Rui.data.LRecord.STATE_DELETE,i=this.dataSet,a=0,s=i.getCount();a<s;a++){e!=i.getState(a)&&(t=this.createItem({record:i.getAt(a),row:a}),this.appendOption(t.dom))}this._itemRendered=!0}this.autoComplete&&this.optionAutoHeight()}},onOptionMouseDown:function(t){Rui.get(t.target);var e,i=this.findRowIndex(t.target);-1<i&&(e=this.dataSet.isMarked(i),this.dataSet.setMark(i,!e)),this.getDisplayEl().focus()},onMarked:function(t){var e;this.optionDivEl&&((e=this.findRowElById(t.record.id))&&(t.isSelect?e.addClass("L-marked"):e.removeClass("L-marked")),this.updateValues())},onAllMarked:function(t){var e=this.optionDivEl.select(".L-list");t.isSelect?e.addClass("L-marked"):e.removeClass("L-marked")},onKeypress:function(t){var e,i,a;Rui.ui.form.LMultiCombo.superclass.onKeypress.call(this,t),(t.which||t.keyCode)===Rui.util.LKey.KEY.SPACE&&this.optionDivEl&&(e=this.dataSet,0<(i=this.optionDivEl.select(".active")).length&&(-1<(a=this.findRowIndex(i.getAt(0).dom))&&e.setMark(a,!e.isMarked(a))))},doChangedItem:function(t){},onRowPosChangedDataSet:function(t){this.doRowPosChangedDataSet(t.row,!1)},doChangedDisplayValue:function(t){},updateValues:function(){var t=this.dataSet,e=[],i=[];if(0<t.getMarkedCount())for(var a,s=0,o=t.getCount();s<o;s++){t.isMarked(s)&&(a=t.getAt(s),e.push(a.get(this.valueField)),i.push(a.get(this.displayField)))}this.hiddenInputEl.setValue(e.join(this.separator)),this.getDisplayEl().setValue(i.join(this.separator)),this._ignoreEvent||this.doChanged()},setSelectedIndex:function(t){},comboRenderer:function(t,e,i,a,s){if(Rui.isEmpty(t))return"";var o=void 0,o=this.dataMap[t],n=t.split(this.separator);return Rui.isUndefined(o)&&this.autoMapping&&(o=this.dataSet.isFiltered()?this.getDisplayValueByValue(this.dataSet.snapshot,n):this.getDisplayValueByValue(this.dataSet.data,n)),Rui.isUndefined(o)&&(o=this.rendererField?i.get(this.rendererField):t),Rui.isUndefined(o)&&(o=this.dataMap[t]?this.dataMap[t]:o),this.dataMap[t]=o},initUpdateEvent:function(){var e;this.gridPanel&&!0!==this.isInitUpdateEvent&&this.rendererField&&(e=this.gridPanel.getView().getDataSet(),this.on("changed",function(t){e.setNameValue(e.getRow(),this.rendererField,this.getDisplayValue())},this,!0),this.isInitUpdateEvent=!0)},findValueByDisplayValue:function(t){for(var e="",i=t.split(this.separator),a=0,s=i.length;a<s;a++){var o=i[a]?Rui.util.LString.trim(i[a]):i[a],n=this.dataSet.findRow(this.displayField,o);-1<n&&(e+=this.dataSet.getAt(n).get(this.valueField)+this.separator)}return 0<e.length&&(e=e.substring(0,e.length-1)),e},getDisplayValueByValue:function(t,e){for(var i="",a=0,s=e.length;a<s;a++)for(var o=0,n=t.length;o<n;o++){var r=t.getAt(o);if(r.get(this.valueField)===e[a]){i=i+r.get(this.displayField)+this.separator;break}}return 0<i.length&&(i=i.substring(0,i.length-1)),i},setValue:function(t,e){if(t=t||"",this.hiddenInputEl&&this.hiddenInputEl.dom.value!==t){t=Rui.util.LString.trim(t+"");var i=this.dataSet;if(!(this.bindMDataSet&&-1<this.bindMDataSet.getRow()&&!0!==i.isLoad)){this._ignoreEvent=!!e;var a=[],s={};if(0<t.length)for(var o=0,n=(a=t.split(this.separator)).length;o<n;o++)s[a[o]]=!0;if(i){if(a.length===i.getCount())i.setMarkAll(!0);else if(0===a.length)0!==i.getMarkedCount()&&i.setMarkAll(!1);else for(o=0,n=i.getCount();o<n;o++){var r=i.getNameValue(o,this.valueField);i.setMark(o,!0===s[r])}this.updateValues()}this._ignoreEvent=!1}}},setDataSet:function(t){this.dataSet.unOn("marked",this.onMarked,this,!0),this.dataSet.unOn("allMarked",this.onAllMarked,this,!0),Rui.ui.form.LMultiCombo.superclass.setDataSet.call(this,t),this.dataSet.on("marked",this.onMarked,this,!0),this.dataSet.on("allMarked",this.onAllMarked,this,!0)}});