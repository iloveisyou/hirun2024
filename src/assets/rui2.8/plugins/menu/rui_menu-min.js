/*
 * @(#) rui_menu-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.namespace("Rui.ui.menu"),function(){var i,u,l,d,c,s,f="DIV",g="hd",p="bd",_="ft",L="LI",S="mousedown",v=Rui.browser.ie?"focusin":"focus",m="position",C="dynamic",n="visible",E=Rui.util.LDom,y=Rui.util.LEvent;function r(e){var t,i,s,n,r,o=y.getTarget(e),a=function e(t){var i,s;if(t&&t.tagName)switch(t.tagName.toUpperCase()){case f:i=t.parentNode,s=(E.hasClass(t,g)||E.hasClass(t,p)||E.hasClass(t,_))&&i&&i.tagName&&i.tagName.toUpperCase()==f?i:t;break;case L:s=t;break;default:(i=t.parentNode)&&(s=e(i))}return s}(o);if(a)if((i=a.tagName.toUpperCase())==L)(s=a.id)&&d[s]&&(r=(n=d[s]).parent);else{if(i!=f)return;a.id&&(r=u[a.id])}if(r)t=c[e.type],n&&!n.cfg.getProperty("disabled")&&("blurEvent"==t?n.fireEvent("blur",{target:this}):"focusEvent"==t?n.fireEvent("focus",{target:this}):n[t].fire(e)),"blurEvent"==t?r.fireEvent("blur",{target:e,item:n}):"focusEvent"==t?r.fireEvent("focus",{target:e,item:n}):r[t].fire(e,n);else if(e.type==S)for(var h in l)Rui.hasOwnProperty(l,h)&&(!(r=l[h]).cfg.getProperty("clicktohide")||r instanceof Rui.ui.menu.LMenuBar||r.cfg.getProperty(m)!=C?(0<r.cfg.getProperty("showdelay")&&r._cancelShowDelay(),r.activeItem&&(r.activeItem.blur(),r.activeItem.cfg.setProperty("selected",!1),r.activeItem=null)):r.hide());else e.type==v&&0}function o(e){u[e.target.id]&&this.removeMenu(e.target)}function a(e){var t=e.item;t&&(s=t)}function h(e){s=null}function A(e){var t=e.target;if(t&&t.focus)try{t.focus()}catch(e){}}function R(e){var t=e.target;t===t.getRoot()&&t.cfg.getProperty(m)===C&&(t.on("hide",A,this,!0),t.focus())}function N(e,t){var i=t[0],s=this.id;i?l[s]=this:l[s]&&delete l[s]}function D(e,t){I(this)}function I(e){var t=e.id;t&&d[t]&&(s==e&&(s=null),delete d[t],e.destroyEvent.unOn(D))}function T(e,t){var i,s=t[0];s instanceof Rui.ui.menu.LMenuItem&&(i=s.id,d[i]||(d[i]=s).destroyEvent.on(D))}Rui.ui.menu.LMenuManager=(i=!1,u={},l={},d={},c={click:"clickEvent",mousedown:"mouseDownEvent",mouseup:"mouseUpEvent",mouseover:"mouseOverEvent",mouseout:"mouseOutEvent",keydown:"keyDownEvent",keyup:"keyUpEvent",keypress:"keyPressEvent",focus:"focusEvent",focusin:"focusEvent",blur:"blurEvent",focusout:"blurEvent"},s=null,{addMenu:function(e){var t;return e instanceof Rui.ui.menu.LMenu&&e.id&&!u[e.id]&&(u[e.id]=e,i||(t=document,y.on(t,"mouseover",r,this,!0),y.on(t,"mouseout",r,this,!0),y.on(t,S,r,this,!0),y.on(t,"mouseup",r,this,!0),y.on(t,"click",r,this,!0),y.on(t,"keydown",r,this,!0),y.on(t,"keyup",r,this,!0),y.on(t,"keypress",r,this,!0),y.onFocus(t,r,this,!0),y.onBlur(t,r,this,!0),i=!0),e.cfg.subscribeToConfigEvent(n,N),e.on("destroy",o,e,!0),e.itemAddedEvent.on(T,this,!0,{isCE:!0}),e.on("focus",a,this,!0),e.on("blur",h,this,!0),e.on("show",R,this,!0)),this},removeMenu:function(e){var t,i,s;if(e&&(t=e.id)in u&&u[t]==e){if((i=e.getItems())&&0<i.length)for(s=i.length-1;I(i[s]),s--;);delete u[t],t in l&&l[t]==e&&delete l[t],e.cfg&&e.cfg.unsubscribeFromConfigEvent(n,N),e.unOn("destroy",o,e),e.itemAddedEvent.unOn(T,this),e.unOn("focus",a,this),e.unOn("blur",h,this)}return this},hideVisible:function(){var e;for(var t in l)Rui.hasOwnProperty(l,t)&&((e=l[t])instanceof Rui.ui.menu.LMenuBar||e.cfg.getProperty(m)!=C||e.hide());return this},getVisible:function(){return l},getMenus:function(){return u},getMenu:function(e){var t;return e in u&&(t=u[e]),t},getMenuItem:function(e){var t;return e in d&&(t=d[e]),t},getMenuItemGroup:function(e){var t,i,s,n,r,o=E.get(e);if(o&&o.tagName&&"UL"==o.tagName.toUpperCase()&&(i=o.firstChild)){for(t=[];(n=i.id)&&(s=this.getMenuItem(n))&&(t[t.length]=s),i=i.nextSibling;);0<t.length&&(r=t)}return r},getFocusedMenuItem:function(){return s},getFocusedMenu:function(){var e;return s&&(e=s.parent.getRoot()),e},toString:function(){return"LMenuManager"}})}(),Rui.namespace("Rui.ui.menu"),function(){var h="SELECT",N="y",d="first-of-type",S="disabled",v="selected",c="groupindex",m="submenu",C="visible",a="hidedelay",E="position",y="dynamic",f="static",i=y+","+f,D="maxheight",g="topscrollbar",p="bottomscrollbar",e=g+"_"+S,t=p+"_"+S,_="mousemove",L="showdelay",u="submenuhidedelay",A="iframe",l="constraintoviewport",I="preventcontextoverlap",R="submenualignment",T="autosubmenudisplay",b="clicktohide",P="container",O="scrollincrement",M="minscrollheight",U="classname",H="shadow",k="keepopen",w="context",F="mousedown",x="keydown",B="height",V="width",G="px",K="monitorresize",Y="display",j="block",W="absolute",z="L-menu-body-scrolled",X="mouseover",q="mouseout",o="itemAdded",s="L-menu-shadow",Q=s+"-visible";Rui.ui.menu.LMenu=function(e){var t=e||{};(t=Rui.applyIf(t,Rui.getConfig().getFirst("$.ext.menu.defaultProperties")))&&(this.parent=t.parent,this.lazyLoad=void 0===t.lazyLoad||t.lazyLoad,this.hideDelay=void 0===t.hideDelay?750:t.hideDelay,this.itemData=t.itemData||t.itemdata),t.dataSet&&t.fields&&(this.dataSet=t.dataSet,this.fields=t.fields,this.dataSet.on("load",this.onLoadDataSet,this,!0)),Rui.applyObject(this,t,!0),Rui.ui.menu.LMenu.superclass.constructor.call(this,t)};var $,J=Rui.util.LDom,Z=Rui.util.LEvent,ee=Rui.ui.LPanel,te=Rui.ui.menu.LMenu,n=Rui.ui.menu.LMenuManager,r=Rui.util.LCustomEvent,ie=Rui.browser,se=[["mouseOverEvent",X],["mouseOutEvent",q],["mouseDownEvent",F],["mouseUpEvent","mouseup"],["clickEvent","click"],["keyPressEvent","keypress"],["keyDownEvent",x],["keyUpEvent","keyup"],["itemAddedEvent",o],["itemRemovedEvent","itemRemoved"]],ne={key:C,value:!1,validator:Rui.isBoolean},re={key:l,value:!0,validator:Rui.isBoolean,supercedes:[A,"x",N,"xy"]},oe={key:I,value:!0,validator:Rui.isBoolean,supercedes:[l]},ae={key:E,value:y,validator:function(e){var t=!1;return Rui.isString(e)&&(t=-1!=i.indexOf(e.toLowerCase())),t},supercedes:[C,A]},he={key:R,value:["tl","tr"]},ue={key:T,value:!0,validator:Rui.isBoolean,suppressEvent:!0},le={key:L,value:250,validator:Rui.isNumber,suppressEvent:!0},de={key:a,value:0,validator:Rui.isNumber,suppressEvent:!0},ce={key:u,value:250,validator:Rui.isNumber,suppressEvent:!0},fe={key:b,value:!0,validator:Rui.isBoolean,suppressEvent:!0},ge=P,pe=!0,_e={key:O,value:1,validator:Rui.isNumber,supercedes:[D],suppressEvent:!0},Le={key:M,value:90,validator:Rui.isNumber,supercedes:[D],suppressEvent:!0},Se={key:D,value:0,validator:Rui.isNumber,supercedes:[A],suppressEvent:!0},ve={key:U,value:null,validator:Rui.isString,suppressEvent:!0},me={key:S,value:!1,validator:Rui.isBoolean,suppressEvent:!0},Ce={key:H,value:!0,validator:Rui.isBoolean,suppressEvent:!0,supercedes:[C]},Ee={key:k,value:!1,validator:Rui.isBoolean};Rui.extend(te,ee,{otype:"Rui.ui.menu.LMenu",CSS_CLASS_NAME:"L-ruimenu",ITEM_TYPE:null,GROUP_TITLE_TAG_NAME:"h6",OFF_SCREEN_POSITION:"-999em",_useHideDelay:!1,_bHandledMouseOverEvent:!1,_bHandledMouseOutEvent:!1,_aGroupTitleElements:null,_aItemGroups:null,_aListElements:null,_nCurrentMouseX:0,_bStopMouseEventHandlers:!1,_sClassName:null,lazyLoad:!1,itemData:null,activeItem:null,parent:null,srcElement:null,dataSet:null,fields:null,initDefaultConfig:function(){ee.superclass.initDefaultConfig.call(this),this._initConfig(),this.cfg.addProperty(ne.key,{handler:this.configVisible,value:ne.value,validator:ne.validator}),this.cfg.addProperty(re.key,{handler:this.configConstrainToViewport,value:re.value,validator:re.validator,supercedes:re.supercedes}),this.cfg.addProperty(oe.key,{value:oe.value,validator:oe.validator,supercedes:oe.supercedes}),this.cfg.addProperty(ae.key,{handler:this.configPosition,value:ae.value,validator:ae.validator,supercedes:ae.supercedes}),this.cfg.addProperty(he.key,{value:he.value,suppressEvent:he.suppressEvent}),this.cfg.addProperty(ue.key,{value:ue.value,validator:ue.validator,suppressEvent:ue.suppressEvent}),this.cfg.addProperty(le.key,{value:le.value,validator:le.validator,suppressEvent:le.suppressEvent}),this.cfg.addProperty(de.key,{handler:this.configHideDelay,value:de.value,validator:de.validator,suppressEvent:de.suppressEvent}),this.cfg.addProperty(ce.key,{value:ce.value,validator:ce.validator,suppressEvent:ce.suppressEvent}),this.cfg.addProperty(fe.key,{value:fe.value,validator:fe.validator,suppressEvent:fe.suppressEvent}),this.cfg.addProperty(ge,{handler:this.configContainer,value:document.body,suppressEvent:pe}),this.cfg.addProperty(_e.key,{value:_e.value,validator:_e.validator,supercedes:_e.supercedes,suppressEvent:_e.suppressEvent}),this.cfg.addProperty(Le.key,{value:Le.value,validator:Le.validator,supercedes:Le.supercedes,suppressEvent:Le.suppressEvent}),this.cfg.addProperty(Se.key,{handler:this.configMaxHeight,value:Se.value,validator:Se.validator,suppressEvent:Se.suppressEvent,supercedes:Se.supercedes}),this.cfg.addProperty(ve.key,{handler:this.configClassName,value:ve.value,validator:ve.validator,supercedes:ve.supercedes}),this.cfg.addProperty(me.key,{handler:this.configDisabled,value:me.value,validator:me.validator,suppressEvent:me.suppressEvent}),this.cfg.addProperty(Ce.key,{handler:this.configShadow,value:Ce.value,validator:Ce.validator}),this.cfg.addProperty(Ee.key,{value:Ee.value,validator:Ee.validator})},initComponent:function(e){Rui.ui.menu.LMenu.superclass.initComponent.call(this),this._aItemGroups=[],this._aListElements=[],this._aGroupTitleElements=[],this.ITEM_TYPE||(this.ITEM_TYPE=Rui.ui.menu.LMenuItem)},initEvents:function(){Rui.ui.menu.LMenu.superclass.initEvents.call(this);for(var e,t,i=se.length-1;e=se[i],(t=this.createEvent(e[1],{isCE:!0})).signature=r.LIST,this[e[0]]=t,i--;);this.on("init",this._onInit,this,!0),this.on("beforeRender",this._onBeforeRender,this,!0),this.renderEvent.on(this._onRender,this,!0),this.on("beforeShow",this._onBeforeShow,this,!0),this.on("hide",this._onHide,this,!0),this.on("show",this._onShow,this,!0),this.on("beforeHide",this._onBeforeHide,this,!0),this.mouseOverEvent.on(this._onMouseOver,this,!0,{isCE:!0}),this.mouseOutEvent.on(this._onMouseOut,this,!0,{isCE:!0}),this.clickEvent.on(this._onClick,this,!0,{isCE:!0}),this.keyDownEvent.on(this._onKeyDown,this,!0,{isCE:!0}),this.keyPressEvent.on(this._onKeyPress,this,!0,{isCE:!0}),this.on("blur",this._onBlur,this,!0),this.renderEvent.unOn(this.cfg.fireQueue,this.cfg),this.renderEvent.on(this.cfg.fireQueue,this.cfg,!0)},createContainer:function(e){return this.el=Rui.ui.menu.LMenu.superclass.createContainer.call(this),this.cfg.setProperty(ge,document.body),this.el},doRender:function(e){this.element&&(J.addClass(this.element,this.CSS_CLASS_NAME),(ie.gecko&&ie.gecko<1.9||ie.webkit)&&this.cfg.subscribeToConfigEvent(N,this._onYChange),Rui.useAccessibility()&&(this.element.setAttribute("role","menu"),this.element.setAttribute("aria-hidden","false")),n.addMenu(this))},render:function(e){this.fireEvent("beforeRender",{target:this}),Rui.ui.menu.LMenu.superclass.render.call(this,e)},afterRender:function(e){te.superclass.afterRender.call(this,e)},_initSubTree:function(){var e,t,i,s,n,r,o,a=this.srcElement;if(a){if("DIV"==(e=a.tagName&&a.tagName.toUpperCase())&&(s=this.body.firstChild)){t=0,i=this.GROUP_TITLE_TAG_NAME.toUpperCase();do{if(s&&s.tagName)switch(s.tagName.toUpperCase()){case i:this._aGroupTitleElements[t]=s;break;case"UL":this._aListElements[t]=s,this._aItemGroups[t]=[],t++}}while(s=s.nextSibling);this._aListElements[0]&&J.addClass(this._aListElements[0],d)}if(s=null,e)switch(e){case"DIV":if(0<(r=(n=this._aListElements).length)){o=r-1;do{if(s=n[o].firstChild)for(;s&&s.tagName&&"LI"==s.tagName.toUpperCase()&&this.addItem(new this.ITEM_TYPE(s,{parent:this}),o),s=s.nextSibling;);}while(o--)}break;case h:s=a.firstChild;do{if(s&&s.tagName)switch(s.tagName.toUpperCase()){case"OPTGROUP":case"OPTION":this.addItem(new this.ITEM_TYPE(s,{parent:this}))}}while(s=s.nextSibling)}}},_getFirstEnabledItem:function(){for(var e,t,i=this.getItems(),s=i.length,n=0;n<s;n++)if((e=i[n])&&!e.cfg.getProperty(S)&&"none"!=e.element.style.display){t=e;break}return t},_addItemToGroup:function(e,t,i){var s,n,r,o,a,h,u,l;return t instanceof this.ITEM_TYPE?(s=t).parent=this:Rui.isString(t)?s=new this.ITEM_TYPE(t,{parent:this}):Rui.isObject(t)&&(s=new(t.parent=this).ITEM_TYPE(t.text,t)),s&&(s.cfg.getProperty(v)&&(this.activeItem=s),n=Rui.isNumber(e)?e:0,r=(r=this._getItemGroup(n))||this._createItemGroup(n),Rui.isNumber(i)?(a=i>=r.length,r[i]?r.splice(i,0,s):r[i]=s,(o=r[i])&&(!a||o.element.parentNode&&11!=o.element.parentNode.nodeType?!(h=function e(t,i){return t[i]||e(t,i+1)}(r,i+1))||o.element.parentNode&&11!=o.element.parentNode.nodeType||this._aListElements[n].insertBefore(o.element,h.element):this._aListElements[n].appendChild(o.element),(o.parent=this)._subscribeToItemEvents(o),this._configureSubmenu(o),this._updateItemProperties(n),this.itemAddedEvent.fire(o),this.fireEvent("changeContent",{target:this}),l=o)):(r[u=r.length]=s,(o=r[u])&&(J.isAncestor(this._aListElements[n],o.element)||this._aListElements[n].appendChild(o.element),o.element.setAttribute(c,n),o.element.setAttribute("index",u),o.parent=this,o.index=u,o.groupIndex=n,this._subscribeToItemEvents(o),this._configureSubmenu(o),0===u&&J.addClass(o.element,d),this.itemAddedEvent.fire(o),this.fireEvent("changeContent",{target:this}),l=o))),l},_removeItemFromGroupByIndex:function(e,t){var i,s,n=Rui.isNumber(e)?e:0,r=this._getItemGroup(n);return r&&(i=r.splice(t,1)[0])&&(this._updateItemProperties(n),0===r.length&&(s=this._aListElements[n],this.body&&s&&this.body.removeChild(s),this._aItemGroups.splice(n,1),this._aListElements.splice(n,1),(s=this._aListElements[0])&&J.addClass(s,d)),this.itemRemovedEvent.fire(i),this.fireEvent("changeContent",{target:this})),i},_removeItemFromGroupByValue:function(e,t){var i,s,n,r,o=this._getItemGroup(e);if(o&&(s=-1,0<(i=o.length))){r=i-1;do{if(o[r]==t){s=r;break}}while(r--);-1<s&&(n=this._removeItemFromGroupByIndex(e,s))}return n},_updateItemProperties:function(e){var t,i,s,n=this._getItemGroup(e),r=n.length;if(0<r){for(s=r-1;(t=n[s])&&(i=t.element,t.index=s,t.groupIndex=e,i.setAttribute(c,e),i.setAttribute("index",s),J.removeClass(i,d)),s--;);i&&J.addClass(i,d)}},_createItemGroup:function(e){var t,i;return this._aItemGroups[e]||(this._aItemGroups[e]=[],t=document.createElement("ul"),this._aListElements[e]=t,i=this._aItemGroups[e]),i},_getItemGroup:function(e){var t,i=Rui.isNumber(e)?e:0,s=this._aItemGroups;return i in s&&(t=s[i]),t},_configureSubmenu:function(e){var t=e.cfg.getProperty(m);t&&(this.cfg.configChangedEvent.on(this._onParentMenuConfigChange,t,!0),this.renderEvent.on(this._onParentMenuRender,t,!0))},_subscribeToItemEvents:function(e){e.destroyEvent.on(this._onMenuItemDestroy,e,this,{isCE:!0}),e.cfg.configChangedEvent.on(this._onMenuItemConfigChange,e,this,{isCE:!0})},_onVisibleChange:function(e,t){t[0]?J.addClass(this.element,C):J.removeClass(this.element,C)},_cancelHideDelay:function(){var e=this.getRoot()._hideDelayTimer;e&&e.cancel()},_execHideDelay:function(){this._cancelHideDelay();var e=this.getRoot();e._hideDelayTimer=Rui.later(e.cfg.getProperty(a),this,function(){e.activeItem&&(e.hasFocus()&&e.activeItem.focus(),e.clearActiveItem()),e!=this||this instanceof Rui.ui.menu.LMenuBar||this.cfg.getProperty(E)!=y||this.hide()})},_cancelShowDelay:function(){var e=this.getRoot()._showDelayTimer;e&&e.cancel()},_execSubmenuHideDelay:function(e,t,i){e._submenuHideDelayTimer=Rui.later(50,this,function(){this._nCurrentMouseX>t+10?e._submenuHideDelayTimer=Rui.later(i,e,function(){this.hide()}):e.hide()})},_disableScrollHeader:function(){this._bHeaderDisabled||(J.addClass(this.header,e),this._bHeaderDisabled=!0)},_disableScrollFooter:function(){this._bFooterDisabled||(J.addClass(this.footer,t),this._bFooterDisabled=!0)},_enableScrollHeader:function(){this._bHeaderDisabled&&(J.removeClass(this.header,e),this._bHeaderDisabled=!1)},_enableScrollFooter:function(){this._bFooterDisabled&&(J.removeClass(this.footer,t),this._bFooterDisabled=!1)},_onMouseOver:function(e,t){var i,s,n,r,o,a=t[0],h=t[1],u=Z.getTarget(a),l=this.getRoot(),d=this._submenuHideDelayTimer;this._bStopMouseEventHandlers||(this._bHandledMouseOverEvent||u!=this.element&&!J.isAncestor(this.element,u)||(this._useHideDelay&&this._cancelHideDelay(),this._nCurrentMouseX=0,Z.on(this.element,_,this._onMouseMove,this,!0),h&&J.isAncestor(h.element,Z.getRelatedTarget(a))||this.clearActiveItem(),this.parent&&d&&(d.cancel(),this.parent.cfg.setProperty(v,!0),(i=this.parent.parent)._bHandledMouseOutEvent=!0,i._bHandledMouseOverEvent=!1),this._bHandledMouseOverEvent=!0,this._bHandledMouseOutEvent=!1),!h||h.handledMouseOverEvent||h.cfg.getProperty(S)||u!=h.element&&!J.isAncestor(h.element,u)||((s=0<this.cfg.getProperty(L))&&this._cancelShowDelay(),(n=this.activeItem)&&n.cfg.setProperty(v,!1),(r=h.cfg).setProperty(v,!0),(this.hasFocus()||l._hasFocus)&&(h.focus(),l._hasFocus=!1),this.cfg.getProperty(T)&&(o=r.getProperty(m))&&(s?l._showDelayTimer=Rui.later(l.cfg.getProperty(L),o,function(){this.parent.cfg.getProperty(v)&&this.show()}):o.show()),h.handledMouseOverEvent=!0,h.handledMouseOutEvent=!1))},_onMouseOut:function(e,t){var i,s,n,r=t[0],o=t[1],a=Z.getRelatedTarget(r),h=!1;this._bStopMouseEventHandlers||(o&&!o.cfg.getProperty(S)&&((i=o.cfg.getProperty(m))&&(a==i.element||J.isAncestor(i.element,a))&&(h=!0),o.handledMouseOutEvent||(a==o.element||J.isAncestor(o.element,a))&&!h||(h||(o.cfg.setProperty(v,!1),i&&(s=this.cfg.getProperty(u),n=this.cfg.getProperty(L),!(this instanceof Rui.ui.menu.LMenuBar)&&0<s&&s<=n?this._execSubmenuHideDelay(i,Z.getPageX(r),s):i.hide())),o.handledMouseOutEvent=!0,o.handledMouseOverEvent=!1)),this._bHandledMouseOutEvent||(a==this.element||J.isAncestor(this.element,a))&&!h||(this._useHideDelay&&this._execHideDelay(),Z.removeListener(this.element,_,this._onMouseMove),this._nCurrentMouseX=Z.getPageX(r),this._bHandledMouseOutEvent=!0,this._bHandledMouseOverEvent=!1))},_onMouseMove:function(e,t){this._bStopMouseEventHandlers||(this._nCurrentMouseX=Z.getPageX(e))},_onClick:function(e,t){function i(){ie.gecko&&"windows"==this.platform&&0<l.button||((r=this.getRoot())instanceof Rui.ui.menu.LMenuBar||r.cfg.getProperty(E)==f?r.clearActiveItem():r.hide())}var s,n,r,o,a,h,u,l=t[0],d=t[1],c=!1;d&&(d.cfg.getProperty(S)?(Z.preventDefault(l),i.call(this)):(s=d.cfg.getProperty(m),(a=d.cfg.getProperty("url"))&&(h=a.indexOf("#"),u=a.length,-1!=h&&(1<(u=(a=a.substr(h,u)).length)?(o=a.substr(1,u),(n=Rui.ui.menu.LMenuManager.getMenu(o))&&(c=this.getRoot()===n.getRoot())):1===u&&(c=!0))),c&&!d.cfg.getProperty("target")&&(Z.preventDefault(l),ie.webkit?d.focus():d.fireEvent("focus",{target:this})),s||this.cfg.getProperty(k)||i.call(this)))},_onKeyDown:function(e,t){var i,s,n,r,o,a,h,u,l,d,c,f,g,p=t[0],_=t[1];function L(){this._bStopMouseEventHandlers=!0,Rui.later(10,this,function(){this._bStopMouseEventHandlers=!1})}if(this._useHideDelay&&this._cancelHideDelay(),_&&!_.cfg.getProperty(S))switch(s=_.cfg,n=this.parent,p.keyCode){case 38:case 40:(o=38==p.keyCode?_.getPreviousEnabledSibling():_.getNextEnabledSibling())&&(this.clearActiveItem(),o.cfg.setProperty(v,!0),o.focus(),0<this.cfg.getProperty(D)&&(h=(a=this.body).scrollTop,u=a.offsetHeight,d=(l=this.getItems()).length-1,c=o.element.offsetTop,40==p.keyCode?(u+h<=c?a.scrollTop=c-u:c<=h&&(a.scrollTop=0),o==l[d]&&(a.scrollTop=o.element.offsetTop)):(c<=h?a.scrollTop=c-o.element.offsetHeight:h+u<=c&&(a.scrollTop=c),o==l[0]&&(a.scrollTop=0)),h=a.scrollTop,f=a.scrollHeight-a.offsetHeight,0===h?(this._disableScrollHeader(),this._enableScrollFooter()):h==f?(this._enableScrollHeader(),this._disableScrollFooter()):(this._enableScrollHeader(),this._enableScrollFooter()))),Z.preventDefault(p),L();break;case 39:(i=s.getProperty(m))?(s.getProperty(v)||s.setProperty(v,!0),i.show(),i.setInitialFocus(),i.setInitialSelection()):(r=this.getRoot())instanceof Rui.ui.menu.LMenuBar&&(o=r.activeItem.getNextEnabledSibling())&&(r.clearActiveItem(),o.cfg.setProperty(v,!0),(i=o.cfg.getProperty(m))?(i.show(),i.setInitialFocus()):o.focus()),Z.preventDefault(p),L();break;case 37:n&&((g=n.parent)instanceof Rui.ui.menu.LMenuBar?(o=g.activeItem.getPreviousEnabledSibling())&&(g.clearActiveItem(),o.cfg.setProperty(v,!0),(i=o.cfg.getProperty(m))?(i.show(),i.setInitialFocus()):o.focus()):(this.hide(),n.focus())),Z.preventDefault(p),L()}27==p.keyCode&&(this.cfg.getProperty(E)==y?(this.hide(),this.parent&&this.parent.focus()):this.activeItem&&((i=this.activeItem.cfg.getProperty(m))&&i.cfg.getProperty(C)?(i.hide(),this.activeItem.focus()):(this.activeItem.blur(),this.activeItem.cfg.setProperty(v,!1))),Z.preventDefault(p))},_onKeyPress:function(e,t){var i=t[0];40!=i.keyCode&&38!=i.keyCode||Z.preventDefault(i)},_onBlur:function(e,t){this._hasFocus&&(this._hasFocus=!1)},_onYChange:function(e,t){var i,s,n,r=this.parent;r&&0<(i=r.parent.body.scrollTop)&&(n=this.cfg.getProperty(N)-i,J.setY(this.element,n),(s=this.iframe)&&J.setY(s,n),this.cfg.setProperty(N,n,!0))},_onScrollTargetMouseOver:function(e,t){var i=this._bodyScrollTimer;i&&i.cancel(),this._cancelHideDelay();var s,n,r=Z.getTarget(e),o=this.body,a=this.cfg.getProperty(O);n=J.hasClass(r,"hd")?function(){var e=o.scrollTop;0<e?(o.scrollTop=e-a,this._enableScrollFooter()):(o.scrollTop=0,this._bodyScrollTimer.cancel(),this._disableScrollHeader())}:(s=o.scrollHeight-o.offsetHeight,function(){var e=o.scrollTop;e<s?(o.scrollTop=e+a,this._enableScrollHeader()):(o.scrollTop=s,this._bodyScrollTimer.cancel(),this._disableScrollFooter())}),this._bodyScrollTimer=Rui.later(10,this,n,null,!0)},_onScrollTargetMouseOut:function(e,t){var i=this._bodyScrollTimer;i&&i.cancel(),this._cancelHideDelay()},_onInit:function(e){this.cfg.subscribeToConfigEvent(C,this._onVisibleChange);var t=!this.parent,i=this.lazyLoad;this._insertBody(""),(t&&!i||t&&(this.cfg.getProperty(C)||this.cfg.getProperty(E)==f)||!t&&!i)&&0===this.getItemGroups().length?(this.srcElement&&this._initSubTree(),this.itemData&&this.addItems(this.itemData)):i&&this.cfg.fireQueue()},_onBeforeRender:function(e){var t,i,s=this.element,n=this._aListElements.length,r=!0,o=0;if(0<n)for(;(t=this._aListElements[o])&&(r&&(J.addClass(t,d),r=!1),J.isAncestor(s,t)||this.appendToBody(t),(i=this._aGroupTitleElements[o])&&(J.isAncestor(s,i)||t.parentNode.insertBefore(i,t),J.addClass(t,"hastitle"))),++o<n;);},_onRender:function(e,t){this.cfg.getProperty(E)==y&&(this.cfg.getProperty(C)||this.positionOffScreen())},_onBeforeShow:function(e){var t,i,s,n=this.cfg.getProperty(P);if(this.lazyLoad&&0===this.getItemGroups().length){if(this.srcElement&&this._initSubTree(),this.itemData)if(this.parent&&this.parent.parent&&this.parent.parent.srcElement&&this.parent.parent.srcElement.tagName.toUpperCase()==h)for(t=this.itemData.length,i=0;i<t;i++)this.itemData[i].tagName&&this.addItem(new this.ITEM_TYPE(this.itemData[i],{parent:this}));else this.addItems(this.itemData);(s=this.srcElement)?s.tagName.toUpperCase()==h?J.inDocument(s)?this.render(s.parentNode):this.render(n):this.render():this.parent?this.render(this.parent.element):this.render(n)}var r,o=this.parent;o||this.cfg.getProperty(E)!=y||this.cfg.refireEvent("xy"),o&&(r=o.parent.cfg.getProperty(R),this.cfg.setProperty(w,[o.element,r[0],r[1]]),this.align())},getConstrainedY:function(e){function n(){var e=d.cfg.getProperty(N)-v>h?h-_:h+s;return d.cfg.setProperty(N,e+v,!0),e}function r(){var e=d.cfg.getProperty(N)-v>h?h+s:h-p.offsetHeight;d.cfg.setProperty(N,e+v,!0)}function o(){d._setScrollHeight(this.cfg.getProperty(D))}var a,t,i,h,s,u,l,d=this,c=d.cfg.getProperty(w),f=d.cfg.getProperty(D),g=c&&{trbr:!0,tlbl:!0,bltl:!0,brtr:!0}[c[1]+c[2]],p=d.element,_=p.offsetHeight,L=ee.VIEWPORT_OFFSET,S=J.getViewportHeight(),v=J.getDocumentScrollTop(),m=d.cfg.getProperty(M)+L<S,C=!1,E=v+L,y=v+S-_-L,A=e,R=function(){var e,t,i=d.cfg.getProperty(N)-v>h?l-L:u-L,s=0<d.getItems().length;return i<_?(e=s?d.cfg.getProperty(M):_,a=e<i&&s?i:f,d._setScrollHeight(a),d.on("hide",o,this,!0),r(),i<e&&(C?n():(n(),C=!0,t=R()))):a&&a!==f&&(d._setScrollHeight(f),d.on("hide",o,this,!0),r()),t};return(e<E||y<e)&&(m?d.cfg.getProperty(I)&&g?(i=c[0],s=i.offsetHeight,h=J.getY(i)-v,l=S-((u=h)+s),R(),A=d.cfg.getProperty(N)):!(d instanceof Rui.ui.menu.LMenuBar)&&S<=_?(t=S-2*L)>d.cfg.getProperty(M)&&(d._setScrollHeight(t),d.on("hide",o,this,!0),r(),A=d.cfg.getProperty(N)):e<E?A=E:y<e&&(A=y):A=L+v),A},_onHide:function(e,t){this.cfg.getProperty(E)===y&&this.positionOffScreen()},_onShow:function(e,t){var i,s,n,r,o=this.parent;function a(e){var t;(e.type==F||e.type==x&&27==e.keyCode)&&((t=Z.getTarget(e))==i.element&&J.isAncestor(i.element,t)||(i.cfg.setProperty(T,!1),Z.removeListener(document,F,a),Z.removeListener(document,x,a)))}o&&(!(i=o.parent).cfg.getProperty(T)&&(i instanceof Rui.ui.menu.LMenuBar||i.cfg.getProperty(E)==f)&&(i.cfg.setProperty(T,!0),Z.on(document,F,a),Z.on(document,x,a)),this.cfg.getProperty("x")<i.cfg.getProperty("x")&&ie.gecko&&ie.gecko<1.9&&!this.cfg.getProperty(V)&&(n=(s=this.element).offsetWidth,s.style.width=n+G,r=n-(s.offsetWidth-n)+G,this.cfg.setProperty(V,r),this.on("hide",function(e,t,i){this.cfg.setProperty(V,"")},r,this,!0)))},show:function(e){var t;this.cfg.setProperty("visible",!0),Rui.useAccessibility()&&this.el.setAttribute("aria-hidden","false"),!0===e&&(t=Rui.util.LDom.getX(this.element),Rui.util.LDom.setX(this.element,0),new Rui.fx.LAnim({el:this.element.id,attributes:{left:{from:0,to:t}},duration:.2}).animate())},_onBeforeHide:function(e,t){var i,s,n=this.activeItem,r=this.getRoot();n&&((i=n.cfg).setProperty(v,!1),(s=i.getProperty(m))&&s.hide()),ie.msie&&this.cfg.getProperty(E)===y&&this.parent&&(r._hasFocus=this.hasFocus()),r==this&&r.blur()},_onParentMenuConfigChange:function(e,t,i){var s=t[0][0],n=t[0][1];switch(s){case A:case l:case a:case L:case u:case b:case"effect":case U:case O:case D:case M:case K:case H:case I:i.cfg.setProperty(s,n);break;case R:this.parent.parent instanceof Rui.ui.menu.LMenuBar||i.cfg.setProperty(s,n)}},_onParentMenuRender:function(e,t,i){var s,n=i.parent.parent,r=n.cfg,o={constraintoviewport:r.getProperty(l),xy:[0,0],clicktohide:r.getProperty(b),effect:r.getProperty("effect"),showdelay:r.getProperty(L),hidedelay:r.getProperty(a),submenuhidedelay:r.getProperty(u),classname:r.getProperty(U),scrollincrement:r.getProperty(O),maxheight:r.getProperty(D),minscrollheight:r.getProperty(M),iframe:r.getProperty(A),shadow:r.getProperty(H),preventcontextoverlap:r.getProperty(I),monitorresize:r.getProperty(K)};n instanceof Rui.ui.menu.LMenuBar||(o[R]=r.getProperty(R)),i.cfg.applyConfig(o),this.lazyLoad||(s=this.parent.element,this.element.parentNode==s?this.render():this.render(s))},_onMenuItemDestroy:function(e,t,i){this._removeItemFromGroupByValue(i.groupIndex,i)},_onMenuItemConfigChange:function(e,t,i){var s=t[0][0],n=t[0][1];switch(s){case v:!0===n&&(this.activeItem=i);break;case m:t[0][1]&&this._configureSubmenu(i)}},configVisible:function(e,t,i){var s,n;this.cfg.getProperty(E)==y?te.superclass.configVisible.call(this,e,t,i):(s=t[0],n=J.getStyle(this.element,Y),J.removeClass(this.element,"L-hidden"),s?n!=j&&(this.fireEvent("beforeShow",{target:this}),J.setStyle(this.element,Y,j),Rui.useAccessibility()&&this.element.setAttribute("aria-hidden","false"),this.fireEvent("show",{target:this})):n==j&&(this.fireEvent("beforeHide",{target:this}),J.setStyle(this.element,Y,"none"),Rui.useAccessibility()&&this.element.setAttribute("aria-hidden","true"),this.fireEvent("hide",{target:this})))},configPosition:function(e,t,i){var s,n=this.element,r=t[0]==f?f:W,o=this.cfg;J.setStyle(n,E,r),r==f?(J.setStyle(n,Y,j),o.setProperty(C,!0),Rui.useAccessibility()&&n.setAttribute("aria-hidden","false")):(J.addClass(n,"L-hidden"),Rui.useAccessibility()&&n.setAttribute("aria-hidden","true")),r==W&&((s=o.getProperty("zindex"))&&0!==s||o.setProperty("zindex",1))},configIframe:function(e,t,i){this.cfg.getProperty(E)==y&&te.superclass.configIframe.call(this,e,t,i)},configHideDelay:function(e,t,i){var s=t[0];this._useHideDelay=0<s},configContainer:function(e,t,i){var s=t[0];Rui.isString(s)&&this.cfg.setProperty(P,J.get(s),!0)},_clearSetWidthFlag:function(){this._widthSetForScroll=!1,this.cfg.unsubscribeFromConfigEvent(V,this._clearSetWidthFlag)},_setScrollHeight:function(e){var t,i,s,n,r,o,a,h,u,l,d=e,c=!1,f=!1;if(0<this.getItems().length){if(t=this.element,i=this.body,s=this.header,n=this.footer,r=this._onScrollTargetMouseOver,o=this._onScrollTargetMouseOut,a=this.cfg.getProperty(M),0<d&&d<a&&(d=a),J.setStyle(i,B,""),J.removeClass(i,z),i.scrollTop=0,f=ie.gecko&&ie.gecko<1.9||ie.msie,0<d&&f&&!this.cfg.getProperty(V)&&(u=t.offsetWidth,t.style.width=u+G,l=u-(t.offsetWidth-u)+G,this.cfg.unsubscribeFromConfigEvent(V,this._clearSetWidthFlag),this.cfg.setProperty(V,l),this._widthSetForScroll=!0,this.cfg.subscribeToConfigEvent(V,this._clearSetWidthFlag)),0<d&&!s&&!n&&(this.setHeader("&#32;"),this.setFooter("&#32;"),s=this.header,n=this.footer,J.addClass(s,g),J.addClass(n,p),t.insertBefore(s,i),t.appendChild(n)),h=d,s&&n&&(h-=s.offsetHeight+n.offsetHeight),0<h&&i.offsetHeight>d)J.addClass(i,z),J.setStyle(i,B,h+G),this._hasScrollEventHandlers||(Z.on(s,X,r,this,!0),Z.on(s,q,o,this,!0),Z.on(n,X,r,this,!0),Z.on(n,q,o,this,!0),this._hasScrollEventHandlers=!0),this._disableScrollHeader(),this._enableScrollFooter(),c=!0;else if(s&&n){this._widthSetForScroll&&(this._widthSetForScroll=!1,this.cfg.unsubscribeFromConfigEvent(V,this._clearSetWidthFlag),this.cfg.setProperty(V,"")),this._enableScrollHeader(),this._enableScrollFooter(),this._hasScrollEventHandlers&&(Z.removeListener(s,X,r),Z.removeListener(s,q,o),Z.removeListener(n,X,r),Z.removeListener(n,q,o),this._hasScrollEventHandlers=!1);try{t.removeChild(s),t.removeChild(n)}catch(e){}this.header=null,c=!(this.footer=null)}c&&(this.cfg.refireEvent(A),this.cfg.refireEvent(H))}},_setMaxHeight:function(e,t,i){this._setScrollHeight(i),this.renderEvent.unOn(this._setMaxHeight)},configMaxHeight:function(e,t,i){var s=t[0];this.lazyLoad&&!this.body&&0<s?this.renderEvent.on(this._setMaxHeight,s,this,!0):this._setScrollHeight(s)},configClassName:function(e,t,i){var s=t[0];this._sClassName&&J.removeClass(this.element,this._sClassName),J.addClass(this.element,s),this._sClassName=s},_onItemAdded:function(e,t){var i=t[0];i&&i.cfg.setProperty(S,!0)},configDisabled:function(e,t,i){var s,n,r=t[0],o=this.getItems();if(Rui.isArray(o)){if(0<(s=o.length))for(n=s-1;o[n].cfg.setProperty(S,r),n--;);r?(this.clearActiveItem(!0),J.addClass(this.element,S),this.itemAddedEvent.on(this._onItemAdded,this,!0,{isCE:!0})):(J.removeClass(this.element,S),this.itemAddedEvent.unOn(this._onItemAdded,this))}},configShadow:function(e,t,i){function s(){var e=this.element,t=this._shadow;t&&e&&(t.style.width&&t.style.height&&(t.style.width="",t.style.height=""),t.style.width=e.offsetWidth+6+G,t.style.height=e.offsetHeight+1+G)}function n(){this.element.appendChild(this._shadow)}function r(){J.addClass(this._shadow,Q)}function o(){J.removeClass(this._shadow,Q)}function a(){var e,t=this._shadow;t||(e=this.element,$||(($=document.createElement("div")).className="L-menu-shadow L-menu-shadow-visible"),t=$.cloneNode(!1),e.appendChild(t),this._shadow=t,this.on("beforeShow",r,this,!0),this.on("beforeHide",o,this,!0),ie.msie&&(Rui.later(0,this,function(){s.call(this),this.syncIframe()}),this.cfg.subscribeToConfigEvent(V,s),this.cfg.subscribeToConfigEvent(B,s),this.cfg.subscribeToConfigEvent(D,s),this.on("changeContent",s,this,!0),ee.textResizeEvent.on(s,this,!0,{isCE:!0}),this.on("destroy",function(){ee.textResizeEvent.unOn(s,this)},this,!0)),this.cfg.subscribeToConfigEvent(D,n))}t[0]&&this.cfg.getProperty(E)==y&&(this.cfg.getProperty(C)?this._shadow?(n.call(this),ie.msie&&s.call(this)):a.call(this):this.on("beforeShow",function(){this._shadow?(n.call(this),ie.msie&&s.call(this)):a.call(this)},this,!0))},positionOffScreen:function(){var e=this.iframe,t=this.element,i=this.OFF_SCREEN_POSITION;e&&(t.style.top="",t.style.left="",e.style.top=i,e.style.left=i)},getRoot:function(){var e,t=this.parent,i=t&&(e=t.parent)?e.getRoot():this;return i},toString:function(){var e="LMenu",t=this.id;return t&&(e+=" "+t),e},setItemGroupTitle:function(e,t){var i,s,n,r;if(Rui.isString(e)&&0<e.length){for(i=Rui.isNumber(t)?t:0,(s=this._aGroupTitleElements[i])?Rui.get(s).html(e):(s=document.createElement(this.GROUP_TITLE_TAG_NAME),Rui.get(s).html(e),this._aGroupTitleElements[i]=s),n=this._aGroupTitleElements.length-1;this._aGroupTitleElements[n]&&(J.removeClass(this._aGroupTitleElements[n],d),r=n),n--;);null!==r&&J.addClass(this._aGroupTitleElements[r],d),this.fireEvent("changeContent",{target:this})}return this},addItem:function(e,t){return this._addItemToGroup(t,e)},addItems:function(e,t){var i,s,n,r;if(Rui.isArray(e))for(i=e.length,s=[],r=0;r<i;r++)(n=e[r])&&(Rui.isArray(n)?s[s.length]=this.addItems(n,r):s[s.length]=this._addItemToGroup(t,n))},onLoadDataSet:function(){this.addItemsByDataSet(),this.render()},addItemsByDataSet:function(e){var t,i=null;return this.dataSet&&this.dataSet&&(t=Rui.util.LJson.decode(this._getItemsByDataSet()),i=this.addItems(t,e)),i},_getItemsByDataSet:function(){for(var e=this._getChildRecords(this.fields.rootValue),t=e[1],i=e[0],s="",n="[",r="",o="",a="",h="",u="",l="",d=0;d<i.length;d++)r="["==n?"":",",s=""==(s=this._addChildItems(i[d].get(this.fields.id),0))?"":",submenu:"+s,t?(o=i[d].get(this.fields.order),l=0==d?(u="[",o==(a=i[d+1].get(this.fields.order))?"":"]"):i.length==d+1?(u=o==(h=i[d-1].get(this.fields.order))?"":"[","]"):(h=i[d-1].get(this.fields.order),o==(a=i[d+1].get(this.fields.order))&&o==h?u="":o==h&&o!=a?(u="","]"):o!=h&&o==a?(u="[",""):(u="[","]")),n+=r+u+'{text:"'+i[d].get(this.fields.text)+'",onclick:{fn:'+this.fields.onclick+',obj:"'+i[d].id+'"}',n+=s+"}"+l):(n+=r+'{text:"'+i[d].get(this.fields.text)+'",onclick:{fn:'+this.fields.onclick+',obj:"'+i[d].id+'"}',n+=s+"}");return n+="]"},_addChildItems:function(e,t){t+=1;var i=this._getChildRecords(e),s=i[1],n=i[0],r="",o="",a="",h="",u="",l="",d="",c="";if(0!=n.length){o='{id:"'+e+'",itemdata:[';for(var f=0;f<n.length;f++)a=0==f?"":",",r=""==(r=this._addChildItems(n[f].get(this.fields.id),t))?"":",submenu:"+r,s?(h=n[f].get(this.fields.order),c=0==f?(d="[",h==(u=n[f+1].get(this.fields.order))?"":"]"):n.length==f+1?(d=h==(l=n[f-1].get(this.fields.order))?"":"[","]"):(l=n[f-1].get(this.fields.order),h==(u=n[f+1].get(this.fields.order))&&h==l?d="":h==l&&h!=u?(d="","]"):h!=l&&h==u?(d="[",""):(d="[","]")),o+=a+d+'{text:"'+n[f].get(this.fields.text)+'",onclick:{fn:'+this.fields.onclick+',obj:"'+n[f].id+'"}',o+=r+"}"+c):(o+=a+'{text:"'+n[f].get(this.fields.text)+'",onclick:{fn:'+this.fields.onclick+',obj:"'+n[f].id+'"}',o+=r+"}");o+="]}"}return o},_getChildRecords:function(e){for(var t=new Array,i=this.dataSet.getCount(),s=null,n=0;n<i;n++)(s=this.dataSet.getAt(n)).get(this.fields.parentId)==e&&t.push(s);var r,o=!1;return this.fields.order&&(o=(r=this._getSortedRecords(t))[0],t=r[1]),[t,o]},_getSortedRecords:function(e){for(var t,i=new Array,s=0;s<e.length;s++)t=e[s].get(this.fields.order),i.push((t||1e10)+"."+s.toString());i.sort(function(e,t){return e-t});for(var n=new Array,r=-1,o=!1,a=-1,h=-1,u=null,s=0;s<i.length;s++)u=i[s].split("."),r=parseInt(u[1],10),h=parseInt(u[0],10),o=o||h==a,n.push(e[r]),a=h;return[o,n]},insertItem:function(e,t,i){return this._addItemToGroup(i,e,t)},removeItem:function(e,t){var i,s;return Rui.isUndefined(e)||(e instanceof Rui.ui.menu.LMenuItem?i=this._removeItemFromGroupByValue(t,e):Rui.isNumber(e)&&(i=this._removeItemFromGroupByIndex(t,e)),i&&(i.destroy(),s=i)),s},getItems:function(){var e,t=this._aItemGroups;return Rui.isArray(t)&&(e=1==t.length?t[0]:Array.prototype.concat.apply([],t)),e},getItemGroups:function(){return this._aItemGroups},getItem:function(e,t){var i,s;return Rui.isNumber(e)&&(i=this._getItemGroup(t))&&(s=i[e]),s},getSubmenus:function(){var e,t,i,s,n=this.getItems(),r=n.length;if(0<r)for(e=[],s=0;s<r;s++)(i=n[s])&&(t=i.cfg.getProperty(m))&&(e[e.length]=t);return e},clearContent:function(){var e,t,i,s=this.getItems(),n=s.length,r=this.element,o=this.body,a=this.header,h=this.footer;if(0<n)for(i=n-1;(e=s[i])&&((t=e.cfg.getProperty(m))&&(this.cfg.configChangedEvent.unOn(this._onParentMenuConfigChange,t),this.renderEvent.unOn(this._onParentMenuRender,t)),this.removeItem(e,e.groupIndex)),i--;);return a&&(Z.purgeElement(a),r.removeChild(a)),h&&(Z.purgeElement(h),r.removeChild(h)),o&&(Z.purgeElement(o),Rui.get(o).html("")),this.activeItem=null,this._aItemGroups=[],this._aListElements=[],this._aGroupTitleElements=[],this.cfg.setProperty(V,null),this},destroy:function(){return this.clearContent(),this._aItemGroups=null,this._aListElements=null,this._aGroupTitleElements=null,te.superclass.destroy.call(this),this},setInitialFocus:function(){var e=this._getFirstEnabledItem();return e&&e.focus(),this},setInitialSelection:function(){var e=this._getFirstEnabledItem();return e&&e.cfg.setProperty(v,!0),this},clearActiveItem:function(e){0<this.cfg.getProperty(L)&&this._cancelShowDelay();var t,i,s=this.activeItem;return s&&(t=s.cfg,e&&(s.blur(),this.getRoot()._hasFocus=!0),t.setProperty(v,!1),(i=t.getProperty(m))&&i.hide(),this.activeItem=null),this},focus:function(){return this.hasFocus()||this.setInitialFocus(),this},blur:function(){var e;return this.hasFocus()&&(e=n.getFocusedMenuItem())&&e.blur(),this},hasFocus:function(){return n.getFocusedMenu()==this.getRoot()},disable:function(){return this.cfg.setProperty(S,!0),this},enable:function(){return this.cfg.setProperty(S,!1),this},on:function(e,t,i,s,n){e instanceof String&&void 0!==s?te.superclass.on.apply(this,arguments):this._on.apply(this,arguments)},_on:function(){function e(e,t,i){var s=this.cfg.getProperty(m);s&&s._on.apply(s,i)}te.superclass.on.apply(this,arguments),te.superclass.on.call(this,o,function(e,t,i){var s=t[0].cfg.getProperty(m);s&&s._on.apply(s,i)},arguments);var t,i,s,n,r=this.getItems();if(r&&0<(t=r.length))for(n=t-1;(s=(i=r[n]).cfg.getProperty(m))?s._on.apply(s,arguments):i.cfg.subscribeToConfigEvent(m,e,arguments),n--;);}})}(),function(){Rui.ui.menu.LMenuItem=function(e,t){e&&(t&&(this.parent=t.parent,this.value=t.value,this.id=t.id),this.init(e,t))};function t(e,t){var i=$[e];i||($[e]={},i=$[e]);var s=i[t];return s||(s=e+"-"+t,i[t]=s),s}function h(e){d.addClass(this.element,t(this.CSS_CLASS_NAME,e)),d.addClass(this._oAnchor,t(this.CSS_LABEL_CLASS_NAME,e)),Rui.useAccessibility()&&(this.element.setAttribute("aria-"+e,"true"),this._oAnchor.setAttribute("aria-"+e,"true"))}function u(e){d.removeClass(this.element,t(this.CSS_CLASS_NAME,e)),d.removeClass(this._oAnchor,t(this.CSS_LABEL_CLASS_NAME,e)),Rui.useAccessibility()&&(this.element.setAttribute("aria-"+e,"false"),this._oAnchor.setAttribute("aria-"+e,"false"))}var d=Rui.util.LDom,e=Rui.ui.LPanel,c=Rui.ui.menu.LMenu,i=Rui.ui.menu.LMenuItem,f=Rui.util.LCustomEvent,l=Rui.browser,g="text",p="helptext",_="url",L="target",S="emphasis",v="strongemphasis",m="checked",C="submenu",E="disabled",y="selected",A="hassubmenu",a="checked-disabled",R="hassubmenu-disabled",N="hassubmenu-selected",D="checked-selected",s="onclick",I="href",T="none",o="visible",n="click",b="show",P=[["mouseOverEvent","mouseover"],["mouseOutEvent","mouseout"],["mouseDownEvent","mousedown"],["mouseUpEvent","mouseup"],["clickEvent",n],["keyPressEvent","keypress"],["keyDownEvent","keydown"],["keyUpEvent","keyup"],["focusEvent","focus"],["blurEvent","blur"],["destroyEvent","destroy"]],r={key:g,value:"",validator:Rui.isString,suppressEvent:!0},O={key:p,supercedes:[g],suppressEvent:!0},M=_,U="#",H=!0,k=L,w=!0,F={key:S,value:!1,validator:Rui.isBoolean,suppressEvent:!0,supercedes:[g]},x={key:v,value:!1,validator:Rui.isBoolean,suppressEvent:!0,supercedes:[g]},B={key:m,value:!1,validator:Rui.isBoolean,suppressEvent:!0,supercedes:[E,y]},V={key:C,suppressEvent:!0,supercedes:[E,y]},G={key:E,value:!1,validator:Rui.isBoolean,suppressEvent:!0,supercedes:[g,y]},K={key:y,value:!1,validator:Rui.isBoolean,suppressEvent:!0},Y=s,j=!0,W={key:"classname",value:null,validator:Rui.isString,suppressEvent:!0},z="keylistener",X=null,q=!0,Q=null,$={};i.prototype={CSS_CLASS_NAME:"L-ruimenuitem",CSS_LABEL_CLASS_NAME:"L-ruimenuitemlabel",SUBMENU_TYPE:null,_oAnchor:null,_oSubmenu:null,_oOnclickAttributeValue:null,_sClassName:null,constructor:i,index:null,groupIndex:null,parent:null,element:null,srcElement:null,value:null,browser:e.prototype.browser,id:null,init:function(e,t){this.SUBMENU_TYPE||(this.SUBMENU_TYPE=c),this.cfg=new Rui.ui.LConfig(this),this.initDefaultConfig();var i,s,n,r,o,a,h,u=this.cfg,l="#";if(Rui.isString(e))this._createRootNodeStructure(),u.queueProperty(g,e);else if(e&&e.tagName)switch(e.tagName.toUpperCase()){case"OPTION":this._createRootNodeStructure(),u.queueProperty(g,e.text),u.queueProperty(E,e.disabled),this.value=e.value,this.srcElement=e;break;case"OPTGROUP":this._createRootNodeStructure(),u.queueProperty(g,e.label),u.queueProperty(E,e.disabled),this.srcElement=e,this._initSubTree();break;case"LI":(n=d.getFirstChild(e))&&(l=n.getAttribute(I,2),r=n.getAttribute(L),o=n.innerHTML),this.srcElement=e,this.element=e,this._oAnchor=n,u.setProperty(g,o,!0),u.setProperty(_,l,!0),u.setProperty(L,r,!0),this._initSubTree()}if(this.element){for((a=(this.srcElement||this.element).id)||(a=this.id||d.generateId(),this.element.id=a),this.id=a,d.addClass(this.element,this.CSS_CLASS_NAME),d.addClass(this._oAnchor,this.CSS_LABEL_CLASS_NAME),Rui.useAccessibility()&&this.element.setAttribute("role","menuitem"),h=P.length-1;s=P[h],(i=this.createEvent(s[1],{isCE:!0})).signature=f.LIST,this[s[0]]=i,h--;);t&&u.applyConfig(t),u.fireQueue()}},_createRootNodeStructure:function(){var e,t;Q||((Q=document.createElement("li")).innerHTML='<a href="#"></a>'),(e=Q.cloneNode(!0)).className=this.CSS_CLASS_NAME,(t=e.firstChild).className=this.CSS_LABEL_CLASS_NAME,this.element=e,this._oAnchor=t},_initSubTree:function(){var e,t,i,s,n,r=this.srcElement,o=this.cfg;if(0<r.childNodes.length)if(this.parent.lazyLoad&&this.parent.srcElement&&"SELECT"==this.parent.srcElement.tagName.toUpperCase())o.setProperty(C,{id:d.generateId(),itemdata:r.childNodes});else{e=r.firstChild,t=[];do{if(e&&e.tagName)switch(e.tagName.toUpperCase()){case"DIV":o.setProperty(C,e);break;case"OPTION":t[t.length]=e}}while(e=e.nextSibling);if(0<(i=t.length))for(s=new this.SUBMENU_TYPE({id:d.generateId()}),o.setProperty(C,s),n=0;n<i;n++)s.addItem(new s.ITEM_TYPE(t[n]))}},configText:function(e,t,i){var s=t[0],n=this.cfg,r=this._oAnchor,o=n.getProperty(p),a="",h="",u="";s&&(o&&(a='<em class="helptext">'+o+"</em>"),n.getProperty(S)&&(h="<em>",u="</em>"),n.getProperty(v)&&(h="<strong>",u="</strong>"),Rui.get(r).html(h+s+u+a))},configHelpText:function(e,t,i){this.cfg.refireEvent(g)},configURL:function(e,t,i){var s=(s=t[0])||"#",n=this._oAnchor;l.opera&&n.removeAttribute(I),n.setAttribute(I,s)},configTarget:function(e,t,i){var s=t[0],n=this._oAnchor;s&&0<s.length?n.setAttribute(L,s):n.removeAttribute(L)},configEmphasis:function(e,t,i){var s=t[0],n=this.cfg;s&&n.getProperty(v)&&n.setProperty(v,!1),n.refireEvent(g)},configStrongEmphasis:function(e,t,i){var s=t[0],n=this.cfg;s&&n.getProperty(S)&&n.setProperty(S,!1),n.refireEvent(g)},configChecked:function(e,t,i){var s=t[0],n=this.cfg;s?h.call(this,m):u.call(this,m),n.refireEvent(g),n.getProperty(E)&&n.refireEvent(E),n.getProperty(y)&&n.refireEvent(y)},configDisabled:function(e,t,i){var s=t[0],n=this.cfg,r=n.getProperty(C),o=n.getProperty(m);s?(n.getProperty(y)&&n.setProperty(y,!1),h.call(this,E),r&&h.call(this,R),o&&h.call(this,a)):(u.call(this,E),r&&u.call(this,R),o&&u.call(this,a))},configSelected:function(e,t,i){var s=this.cfg,n=this._oAnchor,r=t[0],o=s.getProperty(m),a=s.getProperty(C);l.opera&&n.blur(),r&&!s.getProperty(E)?(h.call(this,y),a&&h.call(this,N),o&&h.call(this,D)):(u.call(this,y),a&&u.call(this,N),o&&u.call(this,D)),this.hasFocus()&&l.opera&&n.focus()},_onSubmenuBeforeHide:function(e,t){var i=this.parent;i.hasFocus()&&i.parent.on("beforeHide",function(){i._oAnchor.blur()},this,!0)},configSubmenu:function(e,t,i){var s,n,r=t[0],o=this.cfg,a=this.parent&&this.parent.lazyLoad;r?(r instanceof c?((s=r).parent=this,s.lazyLoad=a):(s=Rui.isObject(r)&&r.id&&!r.nodeType?((n=r).lazyload=a,n.parent=this,n.id=r.id,n.applyTo=r.id,new this.SUBMENU_TYPE(n)):new this.SUBMENU_TYPE({applyTo:r,lazyload:a,parent:this}),o.setProperty(C,s,!0)),s&&(s.cfg.setProperty("preventcontextoverlap",!0),h.call(this,A),"#"===o.getProperty(_)&&o.setProperty(_,"#"+s.id),this._oSubmenu=s,l.opera&&s.on("beforeHide",this._onSubmenuBeforeHide,this,!0))):(u.call(this,A),this._oSubmenu&&this._oSubmenu.destroy()),o.getProperty(E)&&o.refireEvent(E),o.getProperty(y)&&o.refireEvent(y)},configOnClick:function(e,t,i){var s=t[0];this._oOnclickAttributeValue&&this._oOnclickAttributeValue!=s&&(this.clickEvent.unOn(this._oOnclickAttributeValue.fn,this._oOnclickAttributeValue.obj),this._oOnclickAttributeValue=null),!this._oOnclickAttributeValue&&Rui.isObject(s)&&Rui.isFunction(s.fn)&&(this.clickEvent.on(s.fn,"obj"in s?s.obj:this,"scope"in s?s.scope:null,{isCE:!0}),this._oOnclickAttributeValue=s)},configClassName:function(e,t,i){var s=t[0];this._sClassName&&d.removeClass(this.element,this._sClassName),d.addClass(this.element,s),this._sClassName=s},_dispatchClickEvent:function(){var e,t;this.cfg.getProperty(E)||(e=d.getFirstChild(this.element),l.msie?e.fireEvent(s):(l.gecko&&1.9<=l.gecko||l.opera||l.webkit?(t=document.createEvent("HTMLEvents")).initEvent(n,!0,!0):(t=document.createEvent("MouseEvents")).initMouseEvent(n,!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t)))},_createKeyListener:function(e,t,i){var s=this,n=s.parent,r=new Rui.util.LKeyListener(n.element.ownerDocument,i,{fn:s._dispatchClickEvent,scope:s,correctScope:!0});n.cfg.getProperty(o)&&r.enable(),n.on(b,r.enable,null,r),n.on("hide",r.disable,null,r),s._keyListener=r,n.unOn(b,s._createKeyListener,i)},configKeyListener:function(e,t){var i=t[0],s=this,n=s.parent;s._keyData&&(n.unOn(b,s._createKeyListener,s._keyData),s._keyData=null),s._keyListener&&(n.unOn(b,s._keyListener.enable),n.unOn("hide",s._keyListener.disable),s._keyListener.disable(),s._keyListener=null),i&&(s._keyData=i,n.on(b,s._createKeyListener,i,s))},initDefaultConfig:function(){var e=this.cfg;e.addProperty(r.key,{handler:this.configText,value:r.value,validator:r.validator,suppressEvent:r.suppressEvent}),e.addProperty(O.key,{handler:this.configHelpText,supercedes:O.supercedes,suppressEvent:O.suppressEvent}),e.addProperty(M,{handler:this.configURL,value:U,suppressEvent:H}),e.addProperty(k,{handler:this.configTarget,suppressEvent:w}),e.addProperty(F.key,{handler:this.configEmphasis,value:F.value,validator:F.validator,suppressEvent:F.suppressEvent,supercedes:F.supercedes}),e.addProperty(x.key,{handler:this.configStrongEmphasis,value:x.value,validator:x.validator,suppressEvent:x.suppressEvent,supercedes:x.supercedes}),e.addProperty(B.key,{handler:this.configChecked,value:B.value,validator:B.validator,suppressEvent:B.suppressEvent,supercedes:B.supercedes}),e.addProperty(G.key,{handler:this.configDisabled,value:G.value,validator:G.validator,suppressEvent:G.suppressEvent}),e.addProperty(K.key,{handler:this.configSelected,value:K.value,validator:K.validator,suppressEvent:K.suppressEvent}),e.addProperty(V.key,{handler:this.configSubmenu,supercedes:V.supercedes,suppressEvent:V.suppressEvent}),e.addProperty(Y,{handler:this.configOnClick,suppressEvent:j}),e.addProperty(W.key,{handler:this.configClassName,value:W.value,validator:W.validator,suppressEvent:W.suppressEvent}),e.addProperty(z,{handler:this.configKeyListener,value:X,suppressEvent:q})},getNextEnabledSibling:function(){var e,t,i,s,n;function r(e,t){return e[t]||r(e,t+1)}return this.parent instanceof c&&(e=this.groupIndex,t=this.parent.getItemGroups(),n=(i=this.index<t[e].length-1?r(t[e],this.index+1):(s=r(t,e<t.length-1?e+1:0),r(s,0))).cfg.getProperty(E)||i.element.style.display==T?i.getNextEnabledSibling():i),n},getPreviousEnabledSibling:function(){var e,t,i,s,n;function r(e,t){return e[t]||r(e,t-1)}function o(e,t){return e[t]?t:o(e,t+1)}return this.parent instanceof c&&(e=this.groupIndex,t=this.parent.getItemGroups(),n=(i=this.index>o(t[e],0)?r(t[e],this.index-1):(s=r(t,e>o(t,0)?e-1:t.length-1),r(s,s.length-1))).cfg.getProperty(E)||i.element.style.display==T?i.getPreviousEnabledSibling():i),n},focus:function(){var e=this.parent,t=this._oAnchor,i=e.activeItem;return!this.cfg.getProperty(E)&&e&&e.cfg.getProperty(o)&&this.element.style.display!=T&&Rui.later(0,this,function(){try{l.msie&&!document.hasFocus()||(i&&i.blurEvent.fire(),t.focus(),this.focusEvent.fire())}catch(e){}}),this},blur:function(){var e=this.parent;return!this.cfg.getProperty(E)&&e&&e.cfg.getProperty(o)&&Rui.later(0,this,function(){try{this._oAnchor.blur(),this.blurEvent.fire()}catch(e){}},0),this},hasFocus:function(){return Rui.ui.menu.LMenuManager.getFocusedMenuItem()==this},hasSubmenu:function(){return!!this._oSubmenu},getRootMenu:function(){for(var e=this.parent,t=null;e;)e=(t=e).parent;return t},destroy:function(){var e,t,i,s=this.element;if(s){for((e=this.cfg.getProperty(C))&&e.destroy(),(t=s.parentNode)&&(t.removeChild(s),this.destroyEvent.fire()),i=P.length-1;this[P[i][0]].unOnAll(),i--;);this.cfg.configChangedEvent.unOnAll()}return this},toString:function(){var e="LMenuItem",t=this.id;return t&&(e+=" "+t),e},setText:function(e){return this.cfg.setProperty(g,e),this},getText:function(){return this.cfg.getProperty(g),this},setURL:function(e){return this.cfg.setProperty(_,e),this},getURL:function(){return this.cfg.getProperty(_),this},setTarget:function(e){return this.cfg.setProperty(L,e),this},getTarget:function(){return this.cfg.getProperty(L),this},check:function(){return this.cfg.setProperty(m,!0),this},unCheck:function(){return this.cfg.setProperty(m,!1),this},disable:function(){return this.cfg.setProperty(E,!0),this},enable:function(){return this.cfg.setProperty(E,!1),this},select:function(){return this.cfg.setProperty(y,!0),this},unSelect:function(){return this.cfg.setProperty(y,!1),this}},Rui.applyPrototype(i,Rui.util.LEventProvider)}(),function(){var i="dynamic,static",c="disabled",f="selected",s="autosubmenudisplay",g="submenu",p="visible",_="submenutoggleregion";Rui.ui.menu.LMenuBar=function(e){e=e||{},Rui.ui.menu.LMenuBar.superclass.constructor.call(this,e)};var L=Rui.util.LEvent,S=Rui.ui.menu.LMenuBar,t={key:"position",value:"static",validator:function(e){var t=!1;return Rui.isString(e)&&(t=-1!=i.indexOf(e.toLowerCase())),t},supercedes:[p]},n={key:"submenualignment",value:["tl","bl"]},r={key:s,value:!1,validator:Rui.isBoolean,suppressEvent:!0},o={key:_,value:!1,validator:Rui.isBoolean};Rui.extend(S,Rui.ui.menu.LMenu,{otype:"Rui.ui.menu.LMenuBar",initDefaultConfig:function(){S.superclass.initDefaultConfig.call(this);var e=this.cfg;e.addProperty(t.key,{handler:this.configPosition,value:t.value,validator:t.validator,supercedes:t.supercedes}),e.addProperty(n.key,{value:n.value,suppressEvent:n.suppressEvent}),e.addProperty(r.key,{value:r.value,validator:r.validator,suppressEvent:r.suppressEvent}),e.addProperty(o.key,{value:o.value,validator:o.validator,handler:this.configSubmenuToggle})},initComponent:function(e){S.superclass.initComponent.call(this,e)},initEvents:function(){S.superclass.initEvents.call(this),this.ITEM_TYPE||(this.ITEM_TYPE=Rui.ui.menu.LMenuBarItem)},createContainer:function(){return S.superclass.createContainer.call(this)},afterRender:function(e){S.superclass.afterRender.call(this,e)},CSS_CLASS_NAME:"L-ruimenubar",SUBMENU_TOGGLE_REGION_WIDTH:20,_onKeyDown:function(e,t,i){var s,n,r,o=t[0],a=t[1];if(a&&!a.cfg.getProperty(c))switch(n=a.cfg,o.keyCode){case 37:case 39:a!=this.activeItem||n.getProperty(f)?(r=37==o.keyCode?a.getPreviousEnabledSibling():a.getNextEnabledSibling())&&(this.clearActiveItem(),r.cfg.setProperty(f,!0),Rui.useAccessibility()&&r.setAttribute("aria-selected","true"),(s=r.cfg.getProperty(g))?(s.show(),s.setInitialFocus()):r.focus()):(n.setProperty(f,!0),Rui.useAccessibility()&&n.setAttribute("aria-selected","true")),L.preventDefault(o);break;case 40:this.activeItem!=a&&(this.clearActiveItem(),n.setProperty(f,!0),Rui.useAccessibility()&&n.setAttribute("aria-selected","true"),a.focus()),(s=n.getProperty(g))&&(s.cfg.getProperty(p)?s.setInitialSelection():s.show(),s.setInitialFocus()),L.preventDefault(o)}27==o.keyCode&&this.activeItem&&((s=this.activeItem.cfg.getProperty(g))&&s.cfg.getProperty(p)?(s.hide(),this.activeItem.focus()):(this.activeItem.cfg.setProperty(f,!1),Rui.useAccessibility()&&n.setAttribute("aria-selected","false"),this.activeItem.blur()),L.preventDefault(o))},_onClick:function(e,t,i){S.superclass._onClick.call(this,e,t,i);function s(){h.cfg.getProperty(p)?h.hide():h.show()}var n,r,o,a,h,u,l=t[1],d=!0;return l&&!l.cfg.getProperty(c)&&(r=t[0],o=this.activeItem,a=this.cfg,o&&o!=l&&this.clearActiveItem(),l.cfg.setProperty(f,!0),Rui.useAccessibility()&&oItemCfg.setAttribute("aria-selected","true"),(h=l.cfg.getProperty(g))&&(n=l.element,u=Rui.util.LDom.getX(n)+(n.offsetWidth-this.SUBMENU_TOGGLE_REGION_WIDTH),a.getProperty(_)?L.getPageX(r)>u&&(s(),L.preventDefault(r),d=!1):s())),d},configSubmenuToggle:function(e,t){t[0]&&this.cfg.setProperty(s,!1)},toString:function(){var e="LMenuBar",t=this.id;return t&&(e+=" "+t),e}})}(),Rui.ui.menu.LMenuBarItem=function(e,t){Rui.ui.menu.LMenuBarItem.superclass.constructor.call(this,e,t)},Rui.extend(Rui.ui.menu.LMenuBarItem,Rui.ui.menu.LMenuItem,{init:function(e,t){this.SUBMENU_TYPE||(this.SUBMENU_TYPE=Rui.ui.menu.LMenu),Rui.ui.menu.LMenuBarItem.superclass.init.call(this,e);var i=this.cfg;t&&i.applyConfig(t,!0),i.fireQueue()},CSS_CLASS_NAME:"L-ruimenubaritem",CSS_LABEL_CLASS_NAME:"L-ruimenubaritemlabel",toString:function(){var e="LMenuBarItem";return this.cfg&&this.cfg.getProperty("text")&&(e+=": "+this.cfg.getProperty("text")),e}}),Rui.namespace("Rui.ui.menu"),function(){var s="mousedown";Rui.ui.menu.LContextMenu=function(e){e=e||{},Rui.ui.menu.LContextMenu.superclass.constructor.call(this,e),Rui.applyObject(this,e,!0)};var n=Rui.util.LEvent,r=Rui.browser,i=Rui.ui.menu.LContextMenu;function o(e,t,i){this.cfg.setProperty("xy",i)}EVENT_TYPES={TRIGGER_CONTEXT_MENU:"triggerContextMenu",CONTEXT_MENU:r.opera?s:"contextmenu",CLICK:"click"},TRIGGER_CONFIG={key:"trigger",suppressEvent:!0},Rui.extend(Rui.ui.menu.LContextMenu,Rui.ui.menu.LMenu,{otype:"Rui.ui.menu.LContextMenu",_oTrigger:null,_bCancelled:!1,_defaultContextMenu:!0,contextEventTarget:null,initDefaultConfig:function(){Rui.ui.menu.LContextMenu.superclass.initDefaultConfig.call(this),this.cfg.addProperty(TRIGGER_CONFIG.key,{handler:this.configTrigger,suppressEvent:TRIGGER_CONFIG.suppressEvent})},initEvents:function(){Rui.ui.menu.LContextMenu.superclass.initEvents.call(this),this.createEvent("triggerContextMenu"),this._on("show",function(e){0==this._defaultContextMenu&&this.hide()},this,!0)},cancel:function(e){return 0==(e=!!Rui.isUndefined(e)||e)||(this._bCancelled=!0),this._defaultContextMenu=!1,this},_removeEventHandlers:function(){var e=this._oTrigger;e&&(n.removeListener(e,EVENT_TYPES.CONTEXT_MENU,this._onTriggerContextMenu),r.opera&&n.removeListener(e,EVENT_TYPES.CLICK,this._onTriggerClick))},_onTriggerClick:function(e,t){e.ctrlKey&&n.stopEvent(e)},_onTriggerContextMenu:function(e,t){var i;this._defaultContextMenu=!0,e.type==s&&!e.ctrlKey||(this.contextEventTarget=n.getTarget(e),this.fireEvent("triggerContextMenu",{target:e}),this._bCancelled||(n.stopEvent(e),Rui.ui.menu.LMenuManager.hideVisible(),i=n.getXY(e),Rui.util.LDom.inDocument(this.element)?this.cfg.setProperty("xy",i):this.on("beforeShow",o,i,!0),this.cfg.setProperty("zindex",99999),this.show()),this._bCancelled=!1)},_onHide:function(e,t){i.superclass._onHide.call(this,e,t),this.cfg.setProperty("zindex",1)},toString:function(){var e="LContextMenu",t=this.id;return t&&(e+=" "+t),e},destroy:function(){return this._removeEventHandlers(),i.superclass.destroy.call(this),this},configTrigger:function(e,t,i){var s=t[0];s?(this._oTrigger&&this._removeEventHandlers(),this._oTrigger=s,n.on(s,EVENT_TYPES.CONTEXT_MENU,this._onTriggerContextMenu,this,!0),r.opera&&n.on(s,EVENT_TYPES.CLICK,this._onTriggerClick,this,!0)):this._removeEventHandlers()}})}(),Rui.ui.LUnorderedList||(Rui.ui.LUnorderedList=function(e){e=e||{},e=Rui.applyIf(e,Rui.getConfig().getFirst("$.ext.unorderedList.defaultProperties")),Rui.platform.isMobile&&(e.useAnimation=!1),this.createEvent("nodeClick"),this.createEvent("dynamicLoadChild"),this.createEvent("focusChanged"),this.createEvent("collapse"),this.createEvent("expand"),this.renderDataEvent=this.createEvent("renderData",{isCE:!0}),this.createEvent("syncDataSet"),Rui.ui.LUnorderedList.superclass.constructor.call(this,e)},Rui.extend(Rui.ui.LUnorderedList,Rui.ui.LUIComponent,{otype:"Rui.ui.LUnorderedList",dataSet:null,renderer:null,endDepth:null,currentFocus:null,lastFocusId:void 0,focusLastest:!0,prevFocusNode:null,childDataSet:null,hasChildValue:1,defaultOpenDepth:-1,defaultOpenTopIndex:-1,onlyOneTopOpen:!1,useTooltip:!1,ulData:[],lastNodeInfos:void 0,useAnimation:!1,animDuration:.3,syncDataSet:!0,liWidth:null,container:null,autoMark:!0,contextMenu:null,useTempId:!1,DATASET_EVENT_LOCK:{ADD:!1,UPDATE:!1,REMOVE:!1,ROW_POS_CHANGED:!1,ROW_SELECT_MARK:!1},accessibilityELRole:null,NODE_CONSTRUCTOR:"Rui.ui.LUnorderedListNode",CSS_BASE:"L-ul",CLASS_UL_FIRST:"L-ul-first",CLASS_UL_DEPTH:"L-ul-depth",CLASS_UL_HAS_CHILD_CLOSE_MID:"L-ul-has-child-close-mid",CLASS_UL_HAS_CHILD_CLOSE_LAST:"L-ul-has-child-close-last",CLASS_UL_HAS_CHILD_OPEN_MID:"L-ul-has-child-open-mid",CLASS_UL_HAS_CHILD_OPEN_LAST:"L-ul-has-child-open-last",CLASS_UL_HAS_NO_CHILD_MID:"L-ul-has-no-child-mid",CLASS_UL_HAS_NO_CHILD_LAST:"L-ul-has-no-child-last",CLASS_UL_NODE:"L-ul-node",CLASS_UL_LI:"L-ul-li",CLASS_UL_LI_DEPTH:"L-ul-li-depth",CLASS_UL_LI_INDEX:"L-ul-li-index",CLASS_UL_LI_DIV_DEPTH:"L-ul-li-div-depth",CLASS_UL_LI_LINE:"L-ul-li-line",CLASS_UL_LI_SELECTED:"L-ul-li-selected",CLASS_UL_FOCUS_TOP_NODE:"L-ul-focus-top-node",CLASS_UL_FOCUS_PARENT_NODE:"L-ul-focus-parent-node",CLASS_UL_FOCUS_NODE:"L-ul-focus-node",CLASS_UL_MARKED_NODE:"L-ul-marked-node",_setSyncDataSet:function(e,t,i){var s=t[0];this.dataSet.unOn("beforeLoad",this.doBeforeLoad,this),this.dataSet.unOn("load",this.onLoadDataSet,this),this.dataSet.unOn("add",this.onAddData,this),this.dataSet.unOn("dataChanged",this.onChangeData,this),this.dataSet.unOn("update",this.onUpdateData,this),this.dataSet.unOn("remove",this.onRemoveData,this),this.dataSet.unOn("undo",this.onUndoData,this),this.dataSet.unOn("rowPosChanged",this.onRowPosChangedData,this),this.dataSet.unOn("marked",this.onMarked,this),!0===s&&(this.dataSet.on("beforeLoad",this.doBeforeLoad,this,!0,{system:!0}),this.dataSet.on("load",this.onLoadDataSet,this,!0,{system:!0}),this.dataSet.on("add",this.onAddData,this,!0,{system:!0}),this.dataSet.on("dataChanged",this.onChangeData,this,!0,{system:!0}),this.dataSet.on("update",this.onUpdateData,this,!0,{system:!0}),this.dataSet.on("remove",this.onRemoveData,this,!0,{system:!0}),this.dataSet.on("undo",this.onUndoData,this,!0,{system:!0}),this.dataSet.on("rowPosChanged",this.onRowPosChangedData,this,!0,{system:!0}),this.dataSet.on("marked",this.onMarked,this,!0,{system:!0})),this.syncDataSet=s,this.fireEvent("syncDataSet",{target:this,isSync:s})},setSyncDataSet:function(e){this.cfg.setProperty("syncDataSet",e),e&&this.doRenderData()},NODE_STATE:{HAS_CHILD:0,HAS_NO_CHILD:1,MID:2,LAST:3,OPEN:4,CLOSE:5,MARK:6,UNMARK:7,FOCUS:8,UNFOCUS:9,FOCUS_TOP:10,FOCUS_PARENT:11,UNFOCUS_PARENT:12},initEvents:function(){Rui.ui.LUnorderedList.superclass.initEvents.call(this),this._setSyncDataSet("syncDataSet",[this.syncDataSet]),null!=this.childDataSet&&this.childDataSet.on("load",this.onLoadChildDataSet,this,!0,{system:!0}),this.on("expand",this.onExpand,this,!0),this.contextMenu&&this.contextMenu.on("triggerContextMenu",this.onTriggerContextMenu,this,!0),this.on("dynamicLoadChild",this.onDynamicLoadChild,this,!0)},initDefaultConfig:function(){Rui.ui.LUnorderedList.superclass.initDefaultConfig.call(this),this.cfg.addProperty("syncDataSet",{handler:this._setSyncDataSet,value:this.syncDataSet,validator:Rui.isBoolean})},createTemplate:function(){var e=this.templates||{};e.master||(e.master=new Rui.LTemplate('<ul class="{cssUlFirst} {cssUlDepth}" {accRole}>{li}</ul>')),e.li||(e.li=new Rui.LTemplate('<li class="{cssUlLiIndex} {cssUlLiDepth} {cssUlLiOthers}" style="{style}" {accRole}>','<div class="{cssUlNode} {cssUlLiDivDepth} {cssNodeState} {cssUlNodeId} {cssMark}"'+(this.useTooltip?'title="{content}"':"")+">{content}</div>","{childUl}","</li>")),this.templates=e},getUlHtml:function(e,t,i){var s=this.templates||{},n="";if(null===this.endDepth||t<=this.endDepth){var r=(i=i||this.getChildNodeInfos(e))?i.length:0;if(t=Rui.isEmpty(t)?0:t+1,0<r){for(var o="",a=0;a<r;a++)o+=this.getLiHtml(i[a],t,r-1==a,a);var h=this.getAccessibilityUlRole(t),n=s.master.apply({cssUlFirst:0==t?this.CLASS_UL_FIRST:"",cssUlDepth:this.CLASS_UL_DEPTH+"-"+t,accRole:Rui.useAccessibility()&&h?'role="'+h+'"':"",li:o})}}return n},getLiHtml:function(e,t,i,s){var n;t=Rui.isEmpty(t)?0:t,Rui.isEmpty(s)&&(n=n||this.getChildNodeInfos(this.fields.rootValue),s=Rui.isEmpty(s)?n.length:s);var r,o=this.templates||{},a=this.getRecordByNodeInfo(e),h=e.hasChild,u=this.getNodeStateClass(h,i),l=this.defaultOpenDepth>=t&&!0!==i?this.CLASS_UL_LI_LINE:"",d=this.isMarked(a),c=d?" "+this.CLASS_UL_MARKED_NODE:"",f=(this.defaultOpenDepth>=t&&!0!==i&&this.CLASS_UL_LI_SELECTED,this.liWidth?"width:"+this.liWidth+"px;":""),g=cssUlLiOthers="";if(!0!==a.dataSet.remainRemoved&&a.state===Rui.data.LRecord.STATE_DELETE)return"";this.defaultOpenDepth>=t&&(r=this.getChildNodeInfos(a.get(this.fields.id)),g+=this.getUlHtml(a.get(this.fields.id),t,r,i),u=h?i?this.CLASS_UL_HAS_CHILD_OPEN_LAST:this.CLASS_UL_HAS_CHILD_OPEN_MID:this.CLASS_UL_HAS_NO_CHILD_LAST),cssUlLiOthers=i?this.CLASS_UL_LI+"-last":0==s?this.CLASS_UL_LI+"-first":"",a.state!=Rui.data.LRecord.STATE_NORMAL&&(cssUlLiOthers+=" L-node-state-"+this.getState(a));var p=this.getAccessibilityLiRole(),_=this.getContent(a,u,d);return o.li.apply({cssUlLiIndex:this.CLASS_UL_LI_INDEX+"-"+(void 0!==s?s:""),cssUlLiDepth:this.CLASS_UL_LI_DEPTH+"-"+t+(l?" "+l:""),cssUlLiOthers:cssUlLiOthers,style:f,cssUlNode:this.CLASS_UL_NODE,cssUlLiDivDepth:this.CLASS_UL_LI_DIV_DEPTH+"-"+t,cssNodeState:u,cssUlNodeId:this.CLASS_UL_NODE+"-"+a.id,cssMark:c,accRole:Rui.useAccessibility()&&p?'role="'+p+'"':"",content:_,title:_,childUl:g})},getAccessibilityUlRole:function(e){return null},getAccessibilityLiRole:function(){return null},getNodeStateClass:function(e,t){return e?t?this.CLASS_UL_HAS_CHILD_CLOSE_LAST:this.CLASS_UL_HAS_CHILD_CLOSE_MID:t?this.CLASS_UL_HAS_NO_CHILD_LAST:this.CLASS_UL_HAS_NO_CHILD_MID},getContent:function(e,t,i){return this.getLabel(e,t)},getLabel:function(e,t){var i=(i=e.get(this.fields.label))||"&nbsp;";return i=this.renderer?this.renderer(i,e,t):i},isMarked:function(e){return this.dataSet.isMarked(this.dataSet.indexOfKey(e.id))},getChildNodeInfos:function(e,t,i,s){var n;return void 0!==e&&0==(n=!s&&this.lastNodeInfos&&this.lastNodeInfos.parentId===e?this.lastNodeInfos.nodeInfos:[]).length&&(n=i?this.getChildNodeInfosByDom(i,s):this.getChildNodeInfosByDataSet(e,t),this.lastNodeInfos={parentId:e,nodeInfos:n}),n},getChildNodeInfosByDataSet:function(e,t){var i=new Array;e===this.fields.rootValue&&(this.ulData=[],i=this.ulData);var s=this.getChildRecords(e,t);!0===this.fields.setRootFirstChild&&!this.rootChanged&&e===this.fields.rootValue&&0<s.length&&(this.rootChanged=!0,this.tempRootValue=s[0].get(this.fields.id),s=this.getChildRecords(this.tempRootValue));for(var n=0;n<s.length;n++)i.push(this.getNodeInfoByRecord(s[n]));return i},getRootValue:function(){return!0===this.fields.setRootFirstChild?this.tempRootValue:this.fields.rootValue},getChildRecords:function(e,t){var i=new Array;if(void 0!==e){t=t||this.dataSet,e=void 0===e?this.fields.rootValue:e;for(var s=t.getCount(),n=null,r=0;r<s;r++)(n=t.getAt(r)).get(this.fields.parentId)===e&&i.push(n);i=this.fields.order?this.getSortedRecords(i):i}return i},getSortedRecords:function(e){for(var t,i=new Array,s=0;s<e.length;s++)t=e[s].get(this.fields.order),i.push((t||1e10)+"."+s.toString());i.sort(function(e,t){return e-t});for(var n=new Array,r=-1,o=-1,a=null,s=0;s<i.length;s++)a=i[s].split("."),r=parseInt(a[1]),o=parseInt(a[0]),n.push(e[r]),prev=o;return n},getChildNodeInfosByDom:function(e,t){var i=this.getNodeInfo(e);return i.children=i.hasChild&&0==i.children.length||t?this.findChildNodeInfos(i,e[0],t):i.children,t&&(i.hasChild=0<i.children.length&&this.hasChildValue),i.children},getNodeInfo:function(e){var t=!0,i=this.ulData;if(t=!!e)for(var s=e.length-1;0<=s;s--){if(nodeInfo=this.findNodeInfo(i,e[s]),!nodeInfo){t=!1;break}i=nodeInfo.children}return!!t&&nodeInfo},findNodeInfo:function(e,t){return e=0==e.length?this.getNodeInfos(this.getUL(t)):e,this.checkHasNode(e,t)},getNodeInfos:function(e){for(var t=new Array,i=e.childNodes.length,s=0;s<i;s++)t.push(this.getNodeInfoByDom(e.childNodes[s].firstChild,s));return 0<t.length&&t},findChildNodeInfos:function(e,t,i){var s,n=[],r=this.getChildUL(t);return r&&!i?n=this.getNodeInfos(r):(s=this.getRecordByNodeInfo(e))&&(n=this.getChildNodeInfosByDataSet(s.get(this.fields.id))),n},checkHasNode:function(e,t){var i=null;if(e)for(var s=this.getRecordId(t),n=0;n<e.length;n++)if(e[n].id==s){i=e[n];break}return i||!1},checkHasChild:function(e){var t=0;if(this.fields.hasChild)t=e.get(this.fields.hasChild);else{var i=e.get(this.fields.id);if(void 0!==i)for(var s=this.dataSet.getCount(),n=0;n<s;n++)if(this.dataSet.getAt(n).get(this.fields.parentId)===i){t=this.hasChildValue;break}}return t},checkHasChildByDom:function(e){return!!this.getChildUL(e)||this.checkHasChild(this.dataSet.get(this.getRecordId(e)))},getNodeInfoByRecord:function(e){return{id:e.id,hasChild:this.checkHasChild(e),order:e.get(this.fields.order),children:[]}},getNodeInfoByDom:function(e,t){return{id:this.getRecordId(e),hasChild:this.checkHasChildByDom(e),order:t,children:[]}},getRecordByNodeInfo:function(e){return this.dataSet.get(e.id)},htmlToDom:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]},markChilds:function(e,t){if(this.autoMark)for(var i=this.getChildRecords(t.get(this.fields.id)),s=0;s<i.length;s++)i[s].treeType="child",this.markData(this.dataSet.indexOfKey(i[s].id),e);this.onRecordMarking=!1},markParents:function(e,t){if(this.autoMark&&t){var i=t.getParentNode();if(i){if(i.getRecord().treeType="parent",!i.isMarked()&&!e)return;if(!e)return void this.markData(this.dataSet.indexOfKey(i.getRecord().id),e);for(var s=0,n=i.getChildNodes(),r=n.length/2,o=n.length-1;r<=o;o--){if(!i.unorderList.findNode(n[o].id).isMarked())return;s++}for(o=0;o<r;o++){if(!i.unorderList.findNode(n[o].id).isMarked())return;s++}n.length==s&&this.markData(this.dataSet.indexOfKey(i.getRecord().id),e)}}},markData:function(e,t,i){var s;e<0||e>this.dataSet.getCount()||this.dataSet.isMarked(e)!=t&&(!i&&0==this.dataSet.isMarkable(e)||(s=this.dataSet.getAt(e),t?this.dataSet.selectedData.has(s.id)||this.dataSet.selectedData.add(s.id,s):this.dataSet.selectedData.remove(s.id),!0!==this.dataSet.isBatch&&this.onMark(e,t,s)))},doRender:function(e){this.createTemplate(),this.el.addClass(this.CSS_BASE),this.el.addClass("L-fixed"),Rui.util.LEvent.removeListener(this.el.dom,"mousedown",this.onCheckFocus),Rui.util.LEvent.addListener(this.el.dom,"mousedown",this.onCheckFocus,this,!0),Rui.useAccessibility()&&this.accessibilityELRole&&this.el.setAttribute("role",this.accessibilityELRole),this.doRenderData(),this.container=e,this._rendered=!0},afterRender:function(e){Rui.ui.LUnorderedList.superclass.afterRender.call(this,e),this.el.unOn("click",this.onNodeClick,this),this.el.on("click",this.onNodeClick,this,!0),this.unOn("dynamicLoadChild",this.onDynamicLoadChild,this,!0),this.on("dynamicLoadChild",this.onDynamicLoadChild,this,!0)},initDefaultFocus:function(){!this.lastFocusId&&-1<this.defaultOpenTopIndex?this.openFirstDepthNode(this.defaultOpenTopIndex):this.setFocusLastest()||this.refocusNode(this.dataSet.getRow())},doRenderData:function(){var e;this.el&&(this.prevFocusNode=void 0,this.currentFocus=void 0,this.lastNodeInfos=void 0,this.rootChanged=!1,this.el.html(this.getUlHtml(this.fields.rootValue)),(e=this.el.select("li.L-ul-li-depth-0"))&&e.length&&e.getAt(0).setAttribute("tabindex","0"),this.initDefaultFocus(),this.renderDataEvent.fire())},onNodeClick:function(e){var t=this.findNodeByDom(e.target);t&&!1!==this.fireEvent("nodeClick",{target:this,node:t,dom:e.target})&&(t!==this.currentFocus&&this.dataSet.setRow(t.getRow()),this.toggleChild(t))},toggleChild:function(e){e.toggleChild()},focusNode:function(e){if(!this.isPossibleNodeRecord(this.dataSet.getAt(e)))return!1;if(this.currentFocus&&this.currentFocus.getRow()===e)return!1;var t=!(t=0<=e&&this.findNode(this.dataSet.getAt(e).id))&&-1<e?this.buildNodes(e):t;return this.currentFocus&&this.currentFocus.unfocus(),this.prevFocusNode=this.currentFocus,this.currentFocus=t,this.lastFocusId=this.currentFocus?this.currentFocus.getIdValue():void 0,this.currentFocus&&(this.currentFocus.focus(),this.el.moveScroll(this.currentFocus.el,!1,!0)),this.fireEvent("focusChanged",{target:this,oldNode:this.prevFocusNode,newNode:this.currentFocus}),this.currentFocus},refocusNode:function(e,t){t=1==t,this.dataSet.getRow()==e?this.focusNode(e):this.dataSet.setRow(e,{ignoreCanRowPosChangeEvent:t})},isPossibleNodeRecord:function(e){return void 0!==e&&void 0!==e.get(this.fields.parentId)},getLastLi:function(e){return!!(e.childNodes&&0<e.childNodes.length)&&e.childNodes[e.childNodes.length-1]},getLi:function(e,t){return t<e.childNodes.length&&e.childNodes[t]},getUL:function(e){return e.parentNode.parentNode},getChildUL:function(e){var t=Rui.util.LDom.getNextSibling(e);return!(!t||1!=t.nodeType||"ul"!=t.tagName.toLowerCase())&&t},findNode:function(e,t,i){if(!i&&!this.isPossibleNodeRecord(this.dataSet.get(e)))return!1;var s=t?Rui.get(t):this.el,n=s.select("div."+this.CLASS_UL_NODE+"-"+e,!0);return!!((s=n.getAt(0))&&0<n.length)&&this.getNodeObject(s.dom)},buildNodes:function(e){var t=!1;if(-1<e&&this.isPossibleNodeRecord(this.dataSet.getAt(e)))for(var i=this.getParentRecords(e),s=this.el,n=i.length-1;0<=n&&((t=this.findNode(i[n].id,s))&&0!==n);n--)t.expand(),s=t.getChildUL();return t},findNodeByDom:function(e){var t=Rui.util.LDom.findParent(e,"div."+this.CLASS_UL_NODE,10);return this.getNodeObject(t)},getFirstDepthNode:function(e){var t=this.getRootUL();return!!t&&this.getNodeObject(this.getLi(t.dom,e))},openFirstDepthNode:function(e){var t;-1<e&&((t=this.getFirstDepthNode(e))&&(this.dataSet.setRow(t.getRow()),null!=this.currentFocus&&this.currentFocus.expand()))},getNode:function(e){return this.findNode(e.id)},getNodeById:function(e){var t=this.dataSet.findRow(this.fields.id,e);if(t<0)return null;var i=this.dataSet.getAt(t);return this.getNode(i)},getNodeObject:function(e){if(e){var t=this.getRecordId(e);return this.currentFocus&&this.currentFocus.getRecordId()==t?this.currentFocus:this.createNodeObject(e)}return null},createNodeObject:function(e){return new Rui.ui.LUnorderedListNode({unorderList:this,useAnimation:this.useAnimation,dom:e})},createNode:function(e){return e=Rui.applyIf(e||{},{unorderList:this,nodeConstructor:this.NODE_CONSTRUCTOR}),new eval(e.nodeConstructor+".prototype.constructor")(e)},getFocusNode:function(){return this.currentFocus},getFocusLastest:function(){return this.getFocusNode()},getRootUL:function(){var e=this.el.select("."+this.CLASS_UL_FIRST,!0);return 0<e.length&&e.getAt(0)},getParentRecord:function(e){if(!this.isPossibleNodeRecord(e))return!1;var t=this.dataSet.findRow(this.fields.id,e.get(this.fields.parentId));return-1<t&&this.dataSet.getAt(t)},getParentRecords:function(e){var t=new Array;if(-1<e){var i=this.dataSet.getAt(e);t.push(i);for(var s=0;s<1e3&&i.get(this.fields.parentId)!==this.fields.rootValue&&(i=this.getParentRecord(i));s++)t.push(i)}return t},getParentId:function(e){return this.dataSet.get(this.getRecordId(e)).get(this.fields.id)},getRecordId:function(e){return e="li"==e.tagName.toLowerCase()?e.firstChild:e,Rui.util.LDom.findStringInClassName(e,this.CLASS_UL_NODE+"-")},getNodeLabel:function(e){return(e=e||this.currentFocus)?this.dataSet.get(e.getRecordId()).get(this.fields.label):""},setFocusLastest:function(){return!(!this.focusLastest||void 0===this.lastFocusId||!this.dataSet)&&this.setFocusById(this.lastFocusId)},setFocusById:function(e){if(void 0!==e){var t=this.dataSet.findRow(this.fields.id,e);return t!==this.dataSet.getRow()&&(this.dataSet.setRow(t),!0)}},setRootValue:function(e){this.fields.rootValue=e,this.doRenderData()},doBeforeLoad:function(e){this.showLoadingMessage()},onLoadDataSet:function(e){this.doRenderData(),this.hideLoadingMessage()},showLoadingMessage:function(){this.el&&this.el.mask()},hideLoadingMessage:function(){this.el&&this.el.unmask()},onMarked:function(e){var t=!this.onRecordMarking&&this.findNode(e.record.id);this.checkCount=0,t?e.isSelect?(e.record.treeType="child",t.mark(),e.record.treeType="parent",t.mark()):(e.record.treeType="child",t.unmark(),e.record.treeType="parent",t.unmark()):(this.onRecordMarking=!0,this.markChilds(e.isSelect,e.record),this.markParents(e.isSelect,this.findNode(e.record.id)))},onMark:function(e,t,i){var s=!this.onRecordMarking&&this.findNode(i.id);s?t?s.mark():s.unmark():(this.onRecordMarking=!0,this.markChilds(t,i),this.markParents(t,this.findNode(i.id)))},onExpand:function(e){var t=e.node;t&&t.getParentId()==e.target.getIdValue()&&this.el.moveScroll(t.el,!1,!0)},setDataSet:function(e){this.setSyncDataSet(!1),this.dataSet=e,this.setSyncDataSet(!0)},getAllChildRecords:function(e,t,i){if(i=i||new Array,void 0!==e)for(var s=(t=t||this.dataSet).getCount(),n=null,r=0;r<s;r++)(n=t.getAt(r)).get(this.fields.parentId)===e&&(i.push(n),this.getAllChildRecords(n.get(this.fields.id),t,i));return i},getAllChildRecordsClone:function(e,t,i){return this.getCloneRecords(this.getAllChildRecords(e,t),i)},getCloneRecords:function(e,t){for(var i,s=new Array,n=0;n<e.length;n++)i=e[n].clone(),t&&this.initIdValue(i,{ignoreEvent:!0}),s.push(i);return s},onTriggerContextMenu:function(e){var t=this.findNodeByDom(this.contextMenu.contextEventTarget);t?this.refocusNode(t.getRow()):this.contextMenu.cancel(!1)},onDynamicLoadChild:function(e){},setNodeLabel:function(e,t){(t=t||this.currentFocus)&&this.dataSet.get(t.getRecordId()).set(this.fields.label,e)},initIdValue:function(e,t){var i=void 0;if(this.useTempId){var s=e.findField(this.fields.id),n=new Date,r=parseInt(Rui.util.LString.simpleReplace(e.id,"r",""),10);switch(s.type){case"number":i=n.getTime()+r;break;case"date":i=Rui.util.LDate.add(n,Rui.util.LDate.MILLISECOND,r);break;case"string":i=""+n.getTime()+r}}return e.set(this.fields.id,i,t),i},addTopNode:function(e,t){return this.addChildNode(e,!0,t)},addChildNode:function(e,t,i){var s,n=!0!==t&&this.currentFocus?this.currentFocus.getIdValue():this.getRootValue();return void 0!==n?(void 0===i&&(this.DATASET_EVENT_LOCK.ADD=!0,this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!0,i=this.dataSet.newRecord(),this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!1,this.DATASET_EVENT_LOCK.ADD=!1),s=this.dataSet.getAt(i),this.DATASET_EVENT_LOCK.UPDATE=!0,this.initIdValue(s),s.set(this.fields.label,e),this.DATASET_EVENT_LOCK.UPDATE=!1,s.set(this.fields.parentId,n),this.refocusNode(i)):alert("부모의 id가 없음.  신규 추가한 node에 id가 있어야 자식을 추가할 수 있음. \r\ntempId를 사용하려면 config.useTempId:true로 설정.  \r\n이 경우 create된 record는 id 또는 parentId가 temp값이므로 DB업데이트시 주의요망"),i},addChildNodeHtml:function(e,t,i){var s,n=[this.getNodeInfoByRecord(e)];i=i||this.currentFocus,!t&&i?i.open(!0):((s=this.getRootUL())?(this.getNodeObject(this.getLastLi(s.dom)).changeStateTo(this.NODE_STATE.MID),s.appendChild(this.htmlToDom(this.getLiHtml(n[0],null,!0)))):this.el.html(this.getUlHtml(void 0,null,n)),this.ulData.push(n[0]))},concatArray:function(e,t){for(var i=0;i<t.length;i++)e.push(t[i])},redrawParent:function(e,t,i){var s;i=1==i,void 0!==e&&(e!==this.getRootValue()?(s=this.dataSet.findRow(this.fields.id,e),this.focusNode(s),this.currentFocus&&this.currentFocus.open(!0),void 0===t?this.dataSet.setRow(s,{ignoreCanRowPosChangeEvent:i}):this.refocusNode(t,i)):this.doRenderData())},deleteRecord:function(e,t,i){var s=new Array;i||s.push(e),this.concatArray(s,this.getAllChildRecords(e.get(this.fields.id)));var n=t?this.getCloneRecords(s):void 0;this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!0;for(var r=s.length-1;-1<r;r--)this.DATASET_EVENT_LOCK.REMOVE=!0,this.dataSet.removeAt(this.dataSet.indexOfKey(s[r].id)),this.DATASET_EVENT_LOCK.REMOVE=!1;return this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!1,n},deleteNode:function(e,t,i,s){if(e=e||this.currentFocus){var n,r,o,a=e.getRecord();return a&&(s=a.get(this.fields.parentId),n=this.deleteRecord(a,t,i)),s!==this.getRootValue()?this.redrawParent(s,void 0,!0):(o=(r=(r=e.getPreviousLi())||e.getNextLi())?this.getNodeObject(r):null,this.removeNodeDom(e),o&&this.dataSet.setRow(o.getRow(),{ignoreCanRowPosChangeEvent:!0})),n}},cutNode:function(e){e=e||this.currentFocus,this.deletedRecords=e?this.deleteNode(e,!0):null},copyNode:function(e,t){t=t||this.currentFocus,this.copiedRecordId=t?t.getRecordId():null,this.copyWithChilds=!(null==e||null==e||!this.useTempId)&&e},pasteNode:function(e){if(e=e||this.currentFocus)if(this.copiedRecordId){var t=this.dataSet.get(this.copiedRecordId),i=this.getMaxOrder(e.getIdValue());if(this.copyWithChilds){var s=new Array;s.push(t.clone()),this.concatArray(s,this.getAllChildRecordsClone(t.get(this.fields.id)),!0),this.DATASET_EVENT_LOCK.ADD=!0;for(var n=0;n<s.length;n++)s[n].setState(Rui.data.LRecord.STATE_INSERT),this.dataSet.add(s[n]),this.initIdValue(s[0],{ignoreEvent:!0}),s[0].set(this.fields.parentId,e.getIdValue(),{ignoreEvent:!0}),this.fields.order&&s[0].set(this.fields.order,i+1,{ignoreEvent:!0});this.DATASET_EVENT_LOCK.ADD=!1}else{var r=t.clone();this.DATASET_EVENT_LOCK.ADD=!0,r.setState(Rui.data.LRecord.STATE_INSERT),this.dataSet.add(r),this.initIdValue(r,{ignoreEvent:!0}),r.set(this.fields.parentId,e.getIdValue(),{ignoreEvent:!0}),this.fields.hasChild&&r.set(this.fields.hasChild,null,{ignoreEvent:!0}),this.fields.order&&r.set(this.fields.order,i+1,{ignoreEvent:!0}),this.DATASET_EVENT_LOCK.ADD=!1}e.open(!0)}else if(this.deletedRecords){this.DATASET_EVENT_LOCK.ADD=!0;for(n=0;n<this.deletedRecords.length;n++)this.deletedRecords[n].setState(Rui.data.LRecord.STATE_INSERT),this.dataSet.add(this.deletedRecords[n]),this.deletedRecords[0].set(this.fields.parentId,e.getIdValue(),{ignoreEvent:!0});this.DATASET_EVENT_LOCK.ADD=!1,e.open(!0)}this.copiedRecordId=null,this.copyWithChilds=null,this.deletedRecords=null},getMaxOrder:function(e){var t=-1;if(this.fields.order)for(var i,s=this.dataSet.getCount(),n=0;n<s;n++)(i=this.dataSet.getAt(n)).get(this.fields.parentId)===e&&(t=t<i.get(this.fields.order)?i.get(this.fields.order):t);return t},removeNodeDom:function(e){var t,i,s,n,r;(e=e||this.currentFocus)&&(1==(i=(t=Rui.get(e.getUL())).select("> li").length)?(0<e.getDepth()&&this.getNodeObject(e.getParentLi()).changeStateTo(this.NODE_STATE.HAS_NO_CHILD),s=t.dom,e===this.currentFocus&&delete this.currentFocus,delete e,delete t,Rui.util.LDom.removeNode(s)):1<i&&(!e.isLast()||(n=this.getNodeObject(e.getPreviousLi()))&&n.changeStateTo(this.NODE_STATE.LAST),r=e.getLi(),e===this.currentFocus&&delete this.currentFocus,delete e,Rui.util.LDom.removeNode(r)))},onAddData:function(e){var t,i;!0!==this.DATASET_EVENT_LOCK.ADD&&(this.isPossibleNodeRecord(e.record)?e.record.get(this.fields.parentId)===this.getRootValue()?this.addChildNodeHtml(e.record,!0):!(t=this.getParentRecord(e.record))||(i=this.findNode(t.id))&&i.open(!0):this.addTopNode(e.record.get(this.fields.label),e.row))},onChangeData:function(e){this.doRenderData()},onUpdateData:function(e){var t,i,s,n;!0!==this.DATASET_EVENT_LOCK.UPDATE&&(t=this.findNode(e.record.id),i=this.dataSet.getRow(),e.colId==this.fields.parentId?(t&&this.removeNodeDom(t),e.value===this.getRootValue()?this.addChildNodeHtml(e.record,!0):(n=(s=this.getParentRecord(e.record))?this.findNode(s.id):void 0,this.addChildNodeHtml(e.record,!1,n)),e.row===i&&this.focusNode(i)):t&&e.colId==this.fields.label?t.syncLabel():this.fields.order&&e.colId==this.fields.order?this.redrawParent(e.record.get(this.fields.parentId),e.row):t&&e.colId==this.fields.id&&e.row===i&&(this.lastFocusId=e.value))},onRemoveData:function(e){var t;!0!==this.DATASET_EVENT_LOCK.REMOVE&&((t=this.findNode(e.record.id,void 0,!0))?this.deleteNode(t,!1,!0,e.record.get(this.fields.parentId)):this.deleteRecord(e.record,!1,!0))},onUndoData:function(e){this.doRenderData()},clearDataSet:function(){this.doRenderData()},onRowPosChangedData:function(e){!0!==this.DATASET_EVENT_LOCK.ROW_POS_CHANGED&&this.focusNode(e.row)},onLoadChildDataSet:function(e){var t,i,s,n=new Array,r=new Array,o=!1;if(this.currentFocus){if(this.autoMark&&(o=this.dataSet.isMarked(this.dataSet.indexOfKey(this.currentFocus.getRecordId()))),0<(n=this.getChildRecords(this.currentFocus.getIdValue(),this.childDataSet)).length){for(this.DATASET_EVENT_LOCK.ADD=!0,s=0;s<n.length;s++)t=n[s].clone(),i=this.dataSet.add(t),this.autoMark&&o&&this.dataSet.setMark(i,!0),r.push(this.getNodeInfoByRecord(t));this.DATASET_EVENT_LOCK.ADD=!1}this.currentFocus.renderChild(r)}},isRendered:function(){return!0===this._rendered},getState:function(e){switch(e.state){case Rui.data.LRecord.STATE_INSERT:return"I";case Rui.data.LRecord.STATE_UPDATE:return"U";case Rui.data.LRecord.STATE_DELETE:return"D"}return""},destroy:function(){this.prevFocusNode=null,this.currentFocus=null,this.childDataSet=null,this.dataSet=null,Rui.ui.LUnorderedList.superclass.destroy.call(this)}})),Rui.ui.LUnorderedListNode||(Rui.ui.LUnorderedListNode=function(e){Rui.applyObject(this,e),this.init()},Rui.ui.LUnorderedListNode.prototype={el:null,otype:"Rui.ui.LUnorderedListNode",recordId:null,idValue:null,depth:null,dom:null,isLeaf:null,unorderList:null,NODE_STATE:null,useAnimation:!1,useCollapseAllSibling:!1,childULHeight:0,init:function(){this.dom="li"==this.dom.tagName.toLowerCase()?this.dom.firstChild:this.dom,this.el=Rui.get(this.dom),this.NODE_STATE=this.unorderList.NODE_STATE,this.recordId=this.unorderList.getRecordId(this.dom);var e=Rui.util.LDom.findStringInClassName(this.dom,this.unorderList.CLASS_UL_LI_DIV_DEPTH+"-");this.depth="null"!=e&&parseInt(e),this.initIsLeaf()},initIsLeaf:function(){var e=!0,t=this.unorderList.dataSet.get(this.recordId);if(t)if(this.unorderList.fields.hasChild){var i=t.get(this.unorderList.fields.hasChild);null!=this.unorderList.hasChildValue&&(i=i==this.unorderList.hasChildValue),e=!i}else for(var s=t.get(this.unorderList.fields.id),n=this.unorderList.dataSet.getCount(),r=0;r<n;r++)if(this.unorderList.dataSet.getAt(r).get(this.unorderList.fields.parentId)===s){e=!1;break}this.isLeaf=e},getRecordId:function(){return this.recordId},getParentId:function(){var e=this.getRecord();return e?e.get(this.unorderList.fields.parentId):void 0},getParentNode:function(){if(0<this.getDepth()){var e=this.getParentDom();if(e)return this.unorderList.createNodeObject(e)}return!1},getIdValue:function(){var e=this.getRecord();return this.idValue=e?e.get(this.unorderList.fields.id):void 0,this.idValue},getRecord:function(){return this.unorderList.dataSet.get(this.getRecordId())},getRow:function(){return this.unorderList.dataSet.indexOfKey(this.getRecordId())},getDepth:function(){return this.depth},hasChild:function(){return!this.isLeaf},isFocus:function(){return this.checkNodeState(this.NODE_STATE.FOCUS)},focus:function(){this.changeStateTo(this.NODE_STATE.FOCUS),this.isTop()&&this.changeStateTo(this.NODE_STATE.FOCUS_TOP)},unfocus:function(){this.changeStateTo(this.NODE_STATE.UNFOCUS)},isMarked:function(){return this.checkNodeState(this.NODE_STATE.MARK)},mark:function(){this.changeStateTo(this.NODE_STATE.MARK),"child"==this.getRecord().treeType?this.unorderList.markChilds(!0,this.getRecord()):"parent"==this.getRecord().treeType&&this.unorderList.markParents(!0,this)},unmark:function(){this.changeStateTo(this.NODE_STATE.UNMARK),"child"==this.getRecord().treeType?this.unorderList.markChilds(!1,this.getRecord()):"parent"==this.getRecord().treeType&&this.unorderList.markParents(!1,this)},isLast:function(){return this.checkNodeState(this.NODE_STATE.last)},isTop:function(){return 0==this.depth},isExpand:function(){return this.checkNodeState(this.NODE_STATE.OPEN)},isCollaps:function(){return this.checkNodeState(this.NODE_STATE.CLOSE)},open:function(e){var t=new Array;e&&this.removeChildUL(void 0,e),t=this.unorderList.getChildNodeInfos(this.getIdValue(),null,this.getParentDoms(),e),e||0!=t.length?this.renderChild(t,e):this.unorderList.fireEvent("dynamicLoadChild",{target:this.unorderList,node:this,parentId:this.getIdValue()}),(this.useCollapseAllSibling||0===this.getDepth()&&!0===this.unorderList.onlyOneTopOpen)&&this.collapseAllSibling()},renderChild:function(e,t){0<e.length?(this.addChildNodes(e,t),this.changeStateTo(this.NODE_STATE.OPEN)):this.changeStateTo(this.NODE_STATE.HAS_NO_CHILD)},close:function(){this.changeStateTo(this.NODE_STATE.CLOSE),this.removeChildUL()},syncLabel:function(){this.el.html(this.unorderList.getContent(this.getRecord()))},toggleChild:function(){this.isExpand()?this.close():this.isCollaps()&&this.open()},expand:function(){this.isCollaps()&&this.open()},collapse:function(){this.isExpand()&&this.close()},collapseAllSibling:function(){for(var e=this.getUL(),t=0;t<e.childNodes.length;t++)e.childNodes[t].firstChild!==this.dom&&this.unorderList.getNodeObject(e.childNodes[t]).collapse()},getOrder:function(){return this.unorderList.fields.order?this.getRecord().get(this.unorderList.fields.order):null},getChildUL:function(e){return this.unorderList.getChildUL(e||this.dom)},getChildULHeight:function(){return this.childULHeight},removeChildUL:function(e,t){var i,s,n,r=this.getChildUL(e);r&&(i=this.getLi(),t||!this.useAnimation||!0!==this.useAnimation&&!0!==this.useAnimation.collapse?(i.style.overflow="hidden",i.removeChild(r),this.unorderList.fireEvent("collapse",{target:this,node:this.unorderList.currentFocus}),i.style.overflow=""):(i.style.overflow="hidden",s=new Rui.fx.LAnim({el:r,attributes:{height:{to:1}},duration:this.unorderList.animDuration}),n=this,s.on("complete",function(){i.removeChild(r),n.unorderList.fireEvent("collapse",{target:n,node:n.unorderList.currentFocus}),i.style.overflow=""}),s.animate()))},getUL:function(e){return this.unorderList.getUL(e||this.dom)},getIndex:function(){for(var e=this.getUL(),t=this.getLi(),i=-1,s=0;s<e.childNodes.length;s++)if(t===e.childNodes[s]){i=s;break}return i},getLi:function(e){return(e=e||this.dom).parentNode},getParentLi:function(e){var t=(e=e||this.dom).parentNode.parentNode.parentNode;return t=t&&t.tagName&&"li"==t.tagName.toLowerCase()?t:null},getPreviousLi:function(e){e=e||this.dom;var t=this.getLi(e);return Rui.util.LDom.getPreviousSibling(t)},getNextLi:function(e){e=e||this.dom;var t=this.getLi(e);return Rui.util.LDom.getNextSibling(t)},getNextDom:function(e){e=e||this.dom;var t=this.getNextLi(e),i=null;return t&&(i=(i=t.firstChild)&&i.tagName&&"div"==i.tagName.toLowerCase()?i:null),i},getPreviousDom:function(e){e=e||this.dom;var t=this.getPreviousLi(e),i=null;return t&&(i=(i=t.firstChild)&&i.tagName&&"div"==i.tagName.toLowerCase()?i:null),i},getLastChildDom:function(){var e=this.getChildUL();return e?e.lastChild.firstChild:null},getParentDom:function(e){e=e||this.dom;var t=this.getParentLi(e),i=null;return t&&(i=(i=t.firstChild)&&i.tagName&&"div"==i.tagName.toLowerCase()?i:null),i},getParentDoms:function(e){var t=new Array,i=this.dom;!0!==e&&t.push(i);for(var s=0;s<100&&(i=this.getParentDom(i));s++)t.push(i);return t},addChildNodes:function(e,t){var i,s,n,r,o;e&&0<e.length&&(this.changeStateTo(this.NODE_STATE.HAS_CHILD),this.isLeaf=!1,i=this.unorderList.htmlToDom(this.unorderList.getUlHtml(null,this.depth,e)),s=Rui.get(i),t&&this.isExpand()||s.setStyle("display","none"),this.el.parent().appendChild(i),n=s.getDimensions(),this.childULHeight=n.height,t&&this.isExpand()||(!this.useAnimation||!0!==this.useAnimation&&!0!==this.useAnimation.expand?(s.setStyle("display",""),s.setStyle("overflow","hidden"),s.setStyle("height","auto"),this.unorderList.fireEvent("expand",{target:this,node:this.unorderList.currentFocus}),s.setStyle("overflow","")):(s.setStyle("height","1px"),s.setStyle("display",""),s.setStyle("overflow","hidden"),(r=new Rui.fx.LAnim({el:i,attributes:{height:{from:1,to:n.height}}})).duration=this.unorderList.animDuration,r.animate(),o=this,r.on("complete",function(){s.setStyle("height","auto"),o.unorderList.fireEvent("expand",{target:o,node:o.unorderList.currentFocus}),s.setStyle("overflow","")}))))},getChildNodes:function(){var e=[];return this.unorderList&&(e=this.unorderList.getChildRecords(this.getIdValue(),this.childDataSet)),e},checkNodeState:function(e){switch(e){case this.NODE_STATE.HAS_CHILD:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID);case this.NODE_STATE.HAS_NO_CHILD:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST);case this.NODE_STATE.MID:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID);case this.NODE_STATE.LAST:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST);case this.NODE_STATE.OPEN:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST);case this.NODE_STATE.CLOSE:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID);case this.NODE_STATE.MARK:return this.el.hasClass(this.unorderList.CLASS_UL_MARKED_NODE);case this.NODE_STATE.UNMARK:return!this.el.hasClass(this.unorderList.CLASS_UL_MARKED_NODE);case this.NODE_STATE.FOCUS:return this.el.hasClass(this.unorderList.CLASS_UL_FOCUS_NODE);case this.NODE_STATE.UNFOCUS:return!this.el.hasClass(this.unorderList.CLASS_UL_FOCUS_NODE);default:return!1}},changeStateTo:function(e){switch(e){case this.NODE_STATE.HAS_CHILD:this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID)?(this.el.replaceClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID),Rui.get(this.getLi()).addClass(this.unorderList.CLASS_UL_LI_LINE)):this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST);break;case this.NODE_STATE.HAS_NO_CHILD:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID,this.unorderList.CLASS_UL_HAS_NO_CHILD_MID):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST,this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID,this.unorderList.CLASS_UL_HAS_NO_CHILD_MID):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST,this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST),Rui.get(this.getLi()).removeClass(this.unorderList.CLASS_UL_LI_LINE);break;case this.NODE_STATE.MID:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST,this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)?(this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID),Rui.get(this.getLi()).addClass(this.unorderList.CLASS_UL_LI_LINE)):this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST,this.unorderList.CLASS_UL_HAS_NO_CHILD_MID);break;case this.NODE_STATE.LAST:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID,this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST):this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID,this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST),Rui.get(this.getLi()).removeClass(this.unorderList.CLASS_UL_LI_LINE);break;case this.NODE_STATE.OPEN:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)?(this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID),Rui.get(this.getLi()).addClass(this.unorderList.CLASS_UL_LI_LINE)):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST);break;case this.NODE_STATE.CLOSE:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID,this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST,this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST),Rui.get(this.getLi()).removeClass(this.unorderList.CLASS_UL_LI_LINE);break;case this.NODE_STATE.MARK:this.el.addClass(this.unorderList.CLASS_UL_MARKED_NODE);break;case this.NODE_STATE.UNMARK:this.el.removeClass(this.unorderList.CLASS_UL_MARKED_NODE);break;case this.NODE_STATE.FOCUS:this.el.addClass(this.unorderList.CLASS_UL_FOCUS_NODE),(t=this.getParentNode())&&t.changeStateTo(this.NODE_STATE.FOCUS_PARENT);break;case this.NODE_STATE.UNFOCUS:this.el.removeClass(this.unorderList.CLASS_UL_FOCUS_NODE),(t=this.getParentNode())&&t.changeStateTo(this.NODE_STATE.UNFOCUS_PARENT);break;case this.NODE_STATE.FOCUS_PARENT:var t;this.el.addClass(this.unorderList.CLASS_UL_FOCUS_PARENT_NODE),(t=this.getParentNode())&&t.changeStateTo(this.NODE_STATE.FOCUS_PARENT);break;case this.NODE_STATE.UNFOCUS_PARENT:this.el.removeClass(this.unorderList.CLASS_UL_FOCUS_PARENT_NODE),t&&t.changeStateTo(this.NODE_STATE.UNFOCUS_PARENT);break;case this.NODE_STATE.FOCUS_TOP:for(var i=this.getUL(),s=0,n=i.childNodes.length;s<n;s++)i.childNodes[s].firstChild!==this.dom&&this.unorderList.getNodeObject(i.childNodes[s]).el.removeClass(this.unorderList.CLASS_UL_FOCUS_TOP_NODE);this.el.addClass(this.unorderList.CLASS_UL_FOCUS_TOP_NODE)}}}),Rui.namespace("Rui.ui.menu"),Rui.ui.menu.LSlideMenu=function(e){var t=e||{};(t=Rui.applyIf(t,Rui.getConfig().getFirst("$.ext.slideMenu.defaultProperties"))).onlyOneTopOpen=void 0!==t.onlyOneTopOpen?t.onlyOneTopOpen:t.onlyOneActiveMenuMode,t.defaultOpenTopIndex=void 0!==t.defaultOpenTopIndex?t.defaultOpenTopIndex:t.defaultShowIndex,Rui.ui.menu.LSlideMenu.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.menu.LSlideMenu,Rui.ui.LUnorderedList,{otype:"Rui.ui.menu.LSlideMenu",CSS_BASE:"L-ul L-ul-slidemenu",accessibilityELRole:"menubar",getAccessibilityUlRole:function(e){return 0==e?"menubar":"menu"},getAccessibilityLiRole:function(){return"menuitem"},createNodeObject:function(e){return new Rui.ui.menu.LSlideMenuNode({useAnimation:this.useAnimation,unorderList:this,dom:e})}}),Rui.ui.menu.LSlideMenuNode=function(e){Rui.ui.menu.LSlideMenuNode.superclass.constructor.call(this,e)},Rui.extend(Rui.ui.menu.LSlideMenuNode,Rui.ui.LUnorderedListNode,{otype:"Rui.ui.menu.LSlideMenuNode"}),Rui.namespace("Rui.ui.menu"),Rui.ui.menu.LTabMenu=function(e){e=e||{},e=Rui.applyIf(e,Rui.getConfig().getFirst("$.ext.tabMenu.defaultProperties")),Rui.platform.isMobile&&(e.expandOnOver=!1),Rui.ui.menu.LTabMenu.superclass.constructor.call(this,e),this.createEvent("nodeOver"),this.createEvent("nodeOut"),this.createEvent("nodeLazyCollapsed")},Rui.extend(Rui.ui.menu.LTabMenu,Rui.ui.LUnorderedList,{otype:"Rui.ui.menu.LTabMenu",expandOnOver:!1,accessibilityELRole:"menubar",CSS_BASE:"L-ul L-ul-tabmenu",CLASS_UL_TABMENU_CONTENT:"L-ul-tabmenu-content",createNodeObject:function(e){return new Rui.ui.menu.LTabMenuNode({unorderList:this,dom:e,useAnimation:this.useAnimation,useCollapseAllSibling:!0})},getContent:function(e,t,i){return'<div class="'+this.CLASS_UL_TABMENU_CONTENT+'">'+this.getLabel(e,t)+"</div>"},toggleChild:function(e){e.expand()},afterRender:function(e){Rui.ui.menu.LTabMenu.superclass.afterRender.call(this,e),!0===this.expandOnOver&&(this.el.unOn("mouseover",this.onMouseOver,this),this.el.on("mouseover",this.onMouseOver,this,!0))},getAccessibilityUlRole:function(e){return 0==e?"menubar":"menu"},getAccessibilityLiRole:function(){return"menuitem"},onMouseOver:function(e){var t=this.findNodeByDom(e.target);t&&(t!==this.currentFocus&&this.dataSet.setRow(t.getRow()),Rui.get(t.dom).addClass("L-hover"),this.fireEvent("nodeOver",{target:this,node:t,dom:e.target}),this._beforeNode&&this._beforeNode.getDepth()==t.getDepth()&&this._beforeNode.collapse(),t.isExpand()||t.expand(),0==(this._beforeNode=t).getDepth()&&(this.currentZeroNode=t),!this.isFocus&&this.expandOnOver&&this.onCheckFocus.call(this,e))},onNodeClick:function(e){var t=this.findNodeByDom(e.target);t&&!1!==this.fireEvent("nodeClick",{target:this,node:t,dom:e.target})&&(t===this.currentFocus&&!0!==this.expandOnOver?t.isExpand()?(this.dataSet.setRow(t.getRow()),t.collapse()):t.expand():this.currentFocus&&0<this.currentFocus.depth&&this.currentFocus.getParentNode().dom==t.dom?t.isExpand()&&(this.dataSet.setRow(t.getRow()),t.collapse()):(this.dataSet.setRow(t.getRow()),t.expand()))},onBlur:function(e){var t=this.getFocusNode();if(t)if(0==t.depth)t.collapse();else for(;;)if((t=t.getParentNode())&&0==t.depth){this.dataSet.setRow(t.getRow()),t.collapse();break}Rui.ui.LUnorderedList.superclass.onBlur.call(this,e)}}),Rui.ui.menu.LTabMenuNode=function(e){Rui.ui.menu.LTabMenuNode.superclass.constructor.call(this,e)},Rui.extend(Rui.ui.menu.LTabMenuNode,Rui.ui.LUnorderedListNode,{otype:"Rui.ui.menu.LTabMenuNode"});