/*
 * @(#) rui_tree-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.ui.LUnorderedList||(Rui.ui.LUnorderedList=function(t){t=t||{},t=Rui.applyIf(t,Rui.getConfig().getFirst("$.ext.unorderedList.defaultProperties")),Rui.platform.isMobile&&(t.useAnimation=!1),this.createEvent("nodeClick"),this.createEvent("dynamicLoadChild"),this.createEvent("focusChanged"),this.createEvent("collapse"),this.createEvent("expand"),this.renderDataEvent=this.createEvent("renderData",{isCE:!0}),this.createEvent("syncDataSet"),Rui.ui.LUnorderedList.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.LUnorderedList,Rui.ui.LUIComponent,{otype:"Rui.ui.LUnorderedList",dataSet:null,renderer:null,endDepth:null,currentFocus:null,lastFocusId:void 0,focusLastest:!0,prevFocusNode:null,childDataSet:null,hasChildValue:1,defaultOpenDepth:-1,defaultOpenTopIndex:-1,onlyOneTopOpen:!1,useTooltip:!1,ulData:[],lastNodeInfos:void 0,useAnimation:!1,animDuration:.3,syncDataSet:!0,liWidth:null,container:null,autoMark:!0,contextMenu:null,useTempId:!1,DATASET_EVENT_LOCK:{ADD:!1,UPDATE:!1,REMOVE:!1,ROW_POS_CHANGED:!1,ROW_SELECT_MARK:!1},accessibilityELRole:null,NODE_CONSTRUCTOR:"Rui.ui.LUnorderedListNode",CSS_BASE:"L-ul",CLASS_UL_FIRST:"L-ul-first",CLASS_UL_DEPTH:"L-ul-depth",CLASS_UL_HAS_CHILD_CLOSE_MID:"L-ul-has-child-close-mid",CLASS_UL_HAS_CHILD_CLOSE_LAST:"L-ul-has-child-close-last",CLASS_UL_HAS_CHILD_OPEN_MID:"L-ul-has-child-open-mid",CLASS_UL_HAS_CHILD_OPEN_LAST:"L-ul-has-child-open-last",CLASS_UL_HAS_NO_CHILD_MID:"L-ul-has-no-child-mid",CLASS_UL_HAS_NO_CHILD_LAST:"L-ul-has-no-child-last",CLASS_UL_NODE:"L-ul-node",CLASS_UL_LI:"L-ul-li",CLASS_UL_LI_DEPTH:"L-ul-li-depth",CLASS_UL_LI_INDEX:"L-ul-li-index",CLASS_UL_LI_DIV_DEPTH:"L-ul-li-div-depth",CLASS_UL_LI_LINE:"L-ul-li-line",CLASS_UL_LI_SELECTED:"L-ul-li-selected",CLASS_UL_FOCUS_TOP_NODE:"L-ul-focus-top-node",CLASS_UL_FOCUS_PARENT_NODE:"L-ul-focus-parent-node",CLASS_UL_FOCUS_NODE:"L-ul-focus-node",CLASS_UL_MARKED_NODE:"L-ul-marked-node",_setSyncDataSet:function(t,e,i){var s=e[0];this.dataSet.unOn("beforeLoad",this.doBeforeLoad,this),this.dataSet.unOn("load",this.onLoadDataSet,this),this.dataSet.unOn("add",this.onAddData,this),this.dataSet.unOn("dataChanged",this.onChangeData,this),this.dataSet.unOn("update",this.onUpdateData,this),this.dataSet.unOn("remove",this.onRemoveData,this),this.dataSet.unOn("undo",this.onUndoData,this),this.dataSet.unOn("rowPosChanged",this.onRowPosChangedData,this),this.dataSet.unOn("marked",this.onMarked,this),!0===s&&(this.dataSet.on("beforeLoad",this.doBeforeLoad,this,!0,{system:!0}),this.dataSet.on("load",this.onLoadDataSet,this,!0,{system:!0}),this.dataSet.on("add",this.onAddData,this,!0,{system:!0}),this.dataSet.on("dataChanged",this.onChangeData,this,!0,{system:!0}),this.dataSet.on("update",this.onUpdateData,this,!0,{system:!0}),this.dataSet.on("remove",this.onRemoveData,this,!0,{system:!0}),this.dataSet.on("undo",this.onUndoData,this,!0,{system:!0}),this.dataSet.on("rowPosChanged",this.onRowPosChangedData,this,!0,{system:!0}),this.dataSet.on("marked",this.onMarked,this,!0,{system:!0})),this.syncDataSet=s,this.fireEvent("syncDataSet",{target:this,isSync:s})},setSyncDataSet:function(t){this.cfg.setProperty("syncDataSet",t),t&&this.doRenderData()},NODE_STATE:{HAS_CHILD:0,HAS_NO_CHILD:1,MID:2,LAST:3,OPEN:4,CLOSE:5,MARK:6,UNMARK:7,FOCUS:8,UNFOCUS:9,FOCUS_TOP:10,FOCUS_PARENT:11,UNFOCUS_PARENT:12},initEvents:function(){Rui.ui.LUnorderedList.superclass.initEvents.call(this),this._setSyncDataSet("syncDataSet",[this.syncDataSet]),null!=this.childDataSet&&this.childDataSet.on("load",this.onLoadChildDataSet,this,!0,{system:!0}),this.on("expand",this.onExpand,this,!0),this.contextMenu&&this.contextMenu.on("triggerContextMenu",this.onTriggerContextMenu,this,!0),this.on("dynamicLoadChild",this.onDynamicLoadChild,this,!0)},initDefaultConfig:function(){Rui.ui.LUnorderedList.superclass.initDefaultConfig.call(this),this.cfg.addProperty("syncDataSet",{handler:this._setSyncDataSet,value:this.syncDataSet,validator:Rui.isBoolean})},createTemplate:function(){var t=this.templates||{};t.master||(t.master=new Rui.LTemplate('<ul class="{cssUlFirst} {cssUlDepth}" {accRole}>{li}</ul>')),t.li||(t.li=new Rui.LTemplate('<li class="{cssUlLiIndex} {cssUlLiDepth} {cssUlLiOthers}" style="{style}" {accRole}>','<div class="{cssUlNode} {cssUlLiDivDepth} {cssNodeState} {cssUlNodeId} {cssMark}"'+(this.useTooltip?'title="{content}"':"")+">{content}</div>","{childUl}","</li>")),this.templates=t},getUlHtml:function(t,e,i){var s=this.templates||{},r="";if(null===this.endDepth||e<=this.endDepth){var o=(i=i||this.getChildNodeInfos(t))?i.length:0;if(e=Rui.isEmpty(e)?0:e+1,0<o){for(var n="",d=0;d<o;d++)n+=this.getLiHtml(i[d],e,o-1==d,d);var h=this.getAccessibilityUlRole(e),r=s.master.apply({cssUlFirst:0==e?this.CLASS_UL_FIRST:"",cssUlDepth:this.CLASS_UL_DEPTH+"-"+e,accRole:Rui.useAccessibility()&&h?'role="'+h+'"':"",li:n})}}return r},getLiHtml:function(t,e,i,s){var r;e=Rui.isEmpty(e)?0:e,Rui.isEmpty(s)&&(r=r||this.getChildNodeInfos(this.fields.rootValue),s=Rui.isEmpty(s)?r.length:s);var o,n=this.templates||{},d=this.getRecordByNodeInfo(t),h=t.hasChild,a=this.getNodeStateClass(h,i),_=this.defaultOpenDepth>=e&&!0!==i?this.CLASS_UL_LI_LINE:"",L=this.isMarked(d),l=L?" "+this.CLASS_UL_MARKED_NODE:"",E=(this.defaultOpenDepth>=e&&!0!==i&&this.CLASS_UL_LI_SELECTED,this.liWidth?"width:"+this.liWidth+"px;":""),u=cssUlLiOthers="";if(!0!==d.dataSet.remainRemoved&&d.state===Rui.data.LRecord.STATE_DELETE)return"";this.defaultOpenDepth>=e&&(o=this.getChildNodeInfos(d.get(this.fields.id)),u+=this.getUlHtml(d.get(this.fields.id),e,o,i),a=h?i?this.CLASS_UL_HAS_CHILD_OPEN_LAST:this.CLASS_UL_HAS_CHILD_OPEN_MID:this.CLASS_UL_HAS_NO_CHILD_LAST),cssUlLiOthers=i?this.CLASS_UL_LI+"-last":0==s?this.CLASS_UL_LI+"-first":"",d.state!=Rui.data.LRecord.STATE_NORMAL&&(cssUlLiOthers+=" L-node-state-"+this.getState(d));var S=this.getAccessibilityLiRole(),c=this.getContent(d,a,L);return n.li.apply({cssUlLiIndex:this.CLASS_UL_LI_INDEX+"-"+(void 0!==s?s:""),cssUlLiDepth:this.CLASS_UL_LI_DEPTH+"-"+e+(_?" "+_:""),cssUlLiOthers:cssUlLiOthers,style:E,cssUlNode:this.CLASS_UL_NODE,cssUlLiDivDepth:this.CLASS_UL_LI_DIV_DEPTH+"-"+e,cssNodeState:a,cssUlNodeId:this.CLASS_UL_NODE+"-"+d.id,cssMark:l,accRole:Rui.useAccessibility()&&S?'role="'+S+'"':"",content:c,title:c,childUl:u})},getAccessibilityUlRole:function(t){return null},getAccessibilityLiRole:function(){return null},getNodeStateClass:function(t,e){return t?e?this.CLASS_UL_HAS_CHILD_CLOSE_LAST:this.CLASS_UL_HAS_CHILD_CLOSE_MID:e?this.CLASS_UL_HAS_NO_CHILD_LAST:this.CLASS_UL_HAS_NO_CHILD_MID},getContent:function(t,e,i){return this.getLabel(t,e)},getLabel:function(t,e){var i=(i=t.get(this.fields.label))||"&nbsp;";return i=this.renderer?this.renderer(i,t,e):i},isMarked:function(t){return this.dataSet.isMarked(this.dataSet.indexOfKey(t.id))},getChildNodeInfos:function(t,e,i,s){var r;return void 0!==t&&0==(r=!s&&this.lastNodeInfos&&this.lastNodeInfos.parentId===t?this.lastNodeInfos.nodeInfos:[]).length&&(r=i?this.getChildNodeInfosByDom(i,s):this.getChildNodeInfosByDataSet(t,e),this.lastNodeInfos={parentId:t,nodeInfos:r}),r},getChildNodeInfosByDataSet:function(t,e){var i=new Array;t===this.fields.rootValue&&(this.ulData=[],i=this.ulData);var s=this.getChildRecords(t,e);!0===this.fields.setRootFirstChild&&!this.rootChanged&&t===this.fields.rootValue&&0<s.length&&(this.rootChanged=!0,this.tempRootValue=s[0].get(this.fields.id),s=this.getChildRecords(this.tempRootValue));for(var r=0;r<s.length;r++)i.push(this.getNodeInfoByRecord(s[r]));return i},getRootValue:function(){return!0===this.fields.setRootFirstChild?this.tempRootValue:this.fields.rootValue},getChildRecords:function(t,e){var i=new Array;if(void 0!==t){e=e||this.dataSet,t=void 0===t?this.fields.rootValue:t;for(var s=e.getCount(),r=null,o=0;o<s;o++)(r=e.getAt(o)).get(this.fields.parentId)===t&&i.push(r);i=this.fields.order?this.getSortedRecords(i):i}return i},getSortedRecords:function(t){for(var e,i=new Array,s=0;s<t.length;s++)e=t[s].get(this.fields.order),i.push((e||1e10)+"."+s.toString());i.sort(function(t,e){return t-e});for(var r=new Array,o=-1,n=-1,d=null,s=0;s<i.length;s++)d=i[s].split("."),o=parseInt(d[1]),n=parseInt(d[0]),r.push(t[o]),prev=n;return r},getChildNodeInfosByDom:function(t,e){var i=this.getNodeInfo(t);return i.children=i.hasChild&&0==i.children.length||e?this.findChildNodeInfos(i,t[0],e):i.children,e&&(i.hasChild=0<i.children.length&&this.hasChildValue),i.children},getNodeInfo:function(t){var e=!0,i=this.ulData;if(e=!!t)for(var s=t.length-1;0<=s;s--){if(nodeInfo=this.findNodeInfo(i,t[s]),!nodeInfo){e=!1;break}i=nodeInfo.children}return!!e&&nodeInfo},findNodeInfo:function(t,e){return t=0==t.length?this.getNodeInfos(this.getUL(e)):t,this.checkHasNode(t,e)},getNodeInfos:function(t){for(var e=new Array,i=t.childNodes.length,s=0;s<i;s++)e.push(this.getNodeInfoByDom(t.childNodes[s].firstChild,s));return 0<e.length&&e},findChildNodeInfos:function(t,e,i){var s,r=[],o=this.getChildUL(e);return o&&!i?r=this.getNodeInfos(o):(s=this.getRecordByNodeInfo(t))&&(r=this.getChildNodeInfosByDataSet(s.get(this.fields.id))),r},checkHasNode:function(t,e){var i=null;if(t)for(var s=this.getRecordId(e),r=0;r<t.length;r++)if(t[r].id==s){i=t[r];break}return i||!1},checkHasChild:function(t){var e=0;if(this.fields.hasChild)e=t.get(this.fields.hasChild);else{var i=t.get(this.fields.id);if(void 0!==i)for(var s=this.dataSet.getCount(),r=0;r<s;r++)if(this.dataSet.getAt(r).get(this.fields.parentId)===i){e=this.hasChildValue;break}}return e},checkHasChildByDom:function(t){return!!this.getChildUL(t)||this.checkHasChild(this.dataSet.get(this.getRecordId(t)))},getNodeInfoByRecord:function(t){return{id:t.id,hasChild:this.checkHasChild(t),order:t.get(this.fields.order),children:[]}},getNodeInfoByDom:function(t,e){return{id:this.getRecordId(t),hasChild:this.checkHasChildByDom(t),order:e,children:[]}},getRecordByNodeInfo:function(t){return this.dataSet.get(t.id)},htmlToDom:function(t){var e=document.createElement("div");return e.innerHTML=t,e.childNodes[0]},markChilds:function(t,e){if(this.autoMark)for(var i=this.getChildRecords(e.get(this.fields.id)),s=0;s<i.length;s++)i[s].treeType="child",this.markData(this.dataSet.indexOfKey(i[s].id),t);this.onRecordMarking=!1},markParents:function(t,e){if(this.autoMark&&e){var i=e.getParentNode();if(i){if(i.getRecord().treeType="parent",!i.isMarked()&&!t)return;if(!t)return void this.markData(this.dataSet.indexOfKey(i.getRecord().id),t);for(var s=0,r=i.getChildNodes(),o=r.length/2,n=r.length-1;o<=n;n--){if(!i.unorderList.findNode(r[n].id).isMarked())return;s++}for(n=0;n<o;n++){if(!i.unorderList.findNode(r[n].id).isMarked())return;s++}r.length==s&&this.markData(this.dataSet.indexOfKey(i.getRecord().id),t)}}},markData:function(t,e,i){var s;t<0||t>this.dataSet.getCount()||this.dataSet.isMarked(t)!=e&&(!i&&0==this.dataSet.isMarkable(t)||(s=this.dataSet.getAt(t),e?this.dataSet.selectedData.has(s.id)||this.dataSet.selectedData.add(s.id,s):this.dataSet.selectedData.remove(s.id),!0!==this.dataSet.isBatch&&this.onMark(t,e,s)))},doRender:function(t){this.createTemplate(),this.el.addClass(this.CSS_BASE),this.el.addClass("L-fixed"),Rui.util.LEvent.removeListener(this.el.dom,"mousedown",this.onCheckFocus),Rui.util.LEvent.addListener(this.el.dom,"mousedown",this.onCheckFocus,this,!0),Rui.useAccessibility()&&this.accessibilityELRole&&this.el.setAttribute("role",this.accessibilityELRole),this.doRenderData(),this.container=t,this._rendered=!0},afterRender:function(t){Rui.ui.LUnorderedList.superclass.afterRender.call(this,t),this.el.unOn("click",this.onNodeClick,this),this.el.on("click",this.onNodeClick,this,!0),this.unOn("dynamicLoadChild",this.onDynamicLoadChild,this,!0),this.on("dynamicLoadChild",this.onDynamicLoadChild,this,!0)},initDefaultFocus:function(){!this.lastFocusId&&-1<this.defaultOpenTopIndex?this.openFirstDepthNode(this.defaultOpenTopIndex):this.setFocusLastest()||this.refocusNode(this.dataSet.getRow())},doRenderData:function(){var t;this.el&&(this.prevFocusNode=void 0,this.currentFocus=void 0,this.lastNodeInfos=void 0,this.rootChanged=!1,this.el.html(this.getUlHtml(this.fields.rootValue)),(t=this.el.select("li.L-ul-li-depth-0"))&&t.length&&t.getAt(0).setAttribute("tabindex","0"),this.initDefaultFocus(),this.renderDataEvent.fire())},onNodeClick:function(t){var e=this.findNodeByDom(t.target);e&&!1!==this.fireEvent("nodeClick",{target:this,node:e,dom:t.target})&&(e!==this.currentFocus&&this.dataSet.setRow(e.getRow()),this.toggleChild(e))},toggleChild:function(t){t.toggleChild()},focusNode:function(t){if(!this.isPossibleNodeRecord(this.dataSet.getAt(t)))return!1;if(this.currentFocus&&this.currentFocus.getRow()===t)return!1;var e=!(e=0<=t&&this.findNode(this.dataSet.getAt(t).id))&&-1<t?this.buildNodes(t):e;return this.currentFocus&&this.currentFocus.unfocus(),this.prevFocusNode=this.currentFocus,this.currentFocus=e,this.lastFocusId=this.currentFocus?this.currentFocus.getIdValue():void 0,this.currentFocus&&(this.currentFocus.focus(),this.el.moveScroll(this.currentFocus.el,!1,!0)),this.fireEvent("focusChanged",{target:this,oldNode:this.prevFocusNode,newNode:this.currentFocus}),this.currentFocus},refocusNode:function(t,e){e=1==e,this.dataSet.getRow()==t?this.focusNode(t):this.dataSet.setRow(t,{ignoreCanRowPosChangeEvent:e})},isPossibleNodeRecord:function(t){return void 0!==t&&void 0!==t.get(this.fields.parentId)},getLastLi:function(t){return!!(t.childNodes&&0<t.childNodes.length)&&t.childNodes[t.childNodes.length-1]},getLi:function(t,e){return e<t.childNodes.length&&t.childNodes[e]},getUL:function(t){return t.parentNode.parentNode},getChildUL:function(t){var e=Rui.util.LDom.getNextSibling(t);return!(!e||1!=e.nodeType||"ul"!=e.tagName.toLowerCase())&&e},findNode:function(t,e,i){if(!i&&!this.isPossibleNodeRecord(this.dataSet.get(t)))return!1;var s=e?Rui.get(e):this.el,r=s.select("div."+this.CLASS_UL_NODE+"-"+t,!0);return!!((s=r.getAt(0))&&0<r.length)&&this.getNodeObject(s.dom)},buildNodes:function(t){var e=!1;if(-1<t&&this.isPossibleNodeRecord(this.dataSet.getAt(t)))for(var i=this.getParentRecords(t),s=this.el,r=i.length-1;0<=r&&((e=this.findNode(i[r].id,s))&&0!==r);r--)e.expand(),s=e.getChildUL();return e},findNodeByDom:function(t){var e=Rui.util.LDom.findParent(t,"div."+this.CLASS_UL_NODE,10);return this.getNodeObject(e)},getFirstDepthNode:function(t){var e=this.getRootUL();return!!e&&this.getNodeObject(this.getLi(e.dom,t))},openFirstDepthNode:function(t){var e;-1<t&&((e=this.getFirstDepthNode(t))&&(this.dataSet.setRow(e.getRow()),null!=this.currentFocus&&this.currentFocus.expand()))},getNode:function(t){return this.findNode(t.id)},getNodeById:function(t){var e=this.dataSet.findRow(this.fields.id,t);if(e<0)return null;var i=this.dataSet.getAt(e);return this.getNode(i)},getNodeObject:function(t){if(t){var e=this.getRecordId(t);return this.currentFocus&&this.currentFocus.getRecordId()==e?this.currentFocus:this.createNodeObject(t)}return null},createNodeObject:function(t){return new Rui.ui.LUnorderedListNode({unorderList:this,useAnimation:this.useAnimation,dom:t})},createNode:function(t){return t=Rui.applyIf(t||{},{unorderList:this,nodeConstructor:this.NODE_CONSTRUCTOR}),new eval(t.nodeConstructor+".prototype.constructor")(t)},getFocusNode:function(){return this.currentFocus},getFocusLastest:function(){return this.getFocusNode()},getRootUL:function(){var t=this.el.select("."+this.CLASS_UL_FIRST,!0);return 0<t.length&&t.getAt(0)},getParentRecord:function(t){if(!this.isPossibleNodeRecord(t))return!1;var e=this.dataSet.findRow(this.fields.id,t.get(this.fields.parentId));return-1<e&&this.dataSet.getAt(e)},getParentRecords:function(t){var e=new Array;if(-1<t){var i=this.dataSet.getAt(t);e.push(i);for(var s=0;s<1e3&&i.get(this.fields.parentId)!==this.fields.rootValue&&(i=this.getParentRecord(i));s++)e.push(i)}return e},getParentId:function(t){return this.dataSet.get(this.getRecordId(t)).get(this.fields.id)},getRecordId:function(t){return t="li"==t.tagName.toLowerCase()?t.firstChild:t,Rui.util.LDom.findStringInClassName(t,this.CLASS_UL_NODE+"-")},getNodeLabel:function(t){return(t=t||this.currentFocus)?this.dataSet.get(t.getRecordId()).get(this.fields.label):""},setFocusLastest:function(){return!(!this.focusLastest||void 0===this.lastFocusId||!this.dataSet)&&this.setFocusById(this.lastFocusId)},setFocusById:function(t){if(void 0!==t){var e=this.dataSet.findRow(this.fields.id,t);return e!==this.dataSet.getRow()&&(this.dataSet.setRow(e),!0)}},setRootValue:function(t){this.fields.rootValue=t,this.doRenderData()},doBeforeLoad:function(t){this.showLoadingMessage()},onLoadDataSet:function(t){this.doRenderData(),this.hideLoadingMessage()},showLoadingMessage:function(){this.el&&this.el.mask()},hideLoadingMessage:function(){this.el&&this.el.unmask()},onMarked:function(t){var e=!this.onRecordMarking&&this.findNode(t.record.id);this.checkCount=0,e?t.isSelect?(t.record.treeType="child",e.mark(),t.record.treeType="parent",e.mark()):(t.record.treeType="child",e.unmark(),t.record.treeType="parent",e.unmark()):(this.onRecordMarking=!0,this.markChilds(t.isSelect,t.record),this.markParents(t.isSelect,this.findNode(t.record.id)))},onMark:function(t,e,i){var s=!this.onRecordMarking&&this.findNode(i.id);s?e?s.mark():s.unmark():(this.onRecordMarking=!0,this.markChilds(e,i),this.markParents(e,this.findNode(i.id)))},onExpand:function(t){var e=t.node;e&&e.getParentId()==t.target.getIdValue()&&this.el.moveScroll(e.el,!1,!0)},setDataSet:function(t){this.setSyncDataSet(!1),this.dataSet=t,this.setSyncDataSet(!0)},getAllChildRecords:function(t,e,i){if(i=i||new Array,void 0!==t)for(var s=(e=e||this.dataSet).getCount(),r=null,o=0;o<s;o++)(r=e.getAt(o)).get(this.fields.parentId)===t&&(i.push(r),this.getAllChildRecords(r.get(this.fields.id),e,i));return i},getAllChildRecordsClone:function(t,e,i){return this.getCloneRecords(this.getAllChildRecords(t,e),i)},getCloneRecords:function(t,e){for(var i,s=new Array,r=0;r<t.length;r++)i=t[r].clone(),e&&this.initIdValue(i,{ignoreEvent:!0}),s.push(i);return s},onTriggerContextMenu:function(t){var e=this.findNodeByDom(this.contextMenu.contextEventTarget);e?this.refocusNode(e.getRow()):this.contextMenu.cancel(!1)},onDynamicLoadChild:function(t){},setNodeLabel:function(t,e){(e=e||this.currentFocus)&&this.dataSet.get(e.getRecordId()).set(this.fields.label,t)},initIdValue:function(t,e){var i=void 0;if(this.useTempId){var s=t.findField(this.fields.id),r=new Date,o=parseInt(Rui.util.LString.simpleReplace(t.id,"r",""),10);switch(s.type){case"number":i=r.getTime()+o;break;case"date":i=Rui.util.LDate.add(r,Rui.util.LDate.MILLISECOND,o);break;case"string":i=""+r.getTime()+o}}return t.set(this.fields.id,i,e),i},addTopNode:function(t,e){return this.addChildNode(t,!0,e)},addChildNode:function(t,e,i){var s,r=!0!==e&&this.currentFocus?this.currentFocus.getIdValue():this.getRootValue();return void 0!==r?(void 0===i&&(this.DATASET_EVENT_LOCK.ADD=!0,this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!0,i=this.dataSet.newRecord(),this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!1,this.DATASET_EVENT_LOCK.ADD=!1),s=this.dataSet.getAt(i),this.DATASET_EVENT_LOCK.UPDATE=!0,this.initIdValue(s),s.set(this.fields.label,t),this.DATASET_EVENT_LOCK.UPDATE=!1,s.set(this.fields.parentId,r),this.refocusNode(i)):alert("부모의 id가 없음.  신규 추가한 node에 id가 있어야 자식을 추가할 수 있음. \r\ntempId를 사용하려면 config.useTempId:true로 설정.  \r\n이 경우 create된 record는 id 또는 parentId가 temp값이므로 DB업데이트시 주의요망"),i},addChildNodeHtml:function(t,e,i){var s,r=[this.getNodeInfoByRecord(t)];i=i||this.currentFocus,!e&&i?i.open(!0):((s=this.getRootUL())?(this.getNodeObject(this.getLastLi(s.dom)).changeStateTo(this.NODE_STATE.MID),s.appendChild(this.htmlToDom(this.getLiHtml(r[0],null,!0)))):this.el.html(this.getUlHtml(void 0,null,r)),this.ulData.push(r[0]))},concatArray:function(t,e){for(var i=0;i<e.length;i++)t.push(e[i])},redrawParent:function(t,e,i){var s;i=1==i,void 0!==t&&(t!==this.getRootValue()?(s=this.dataSet.findRow(this.fields.id,t),this.focusNode(s),this.currentFocus&&this.currentFocus.open(!0),void 0===e?this.dataSet.setRow(s,{ignoreCanRowPosChangeEvent:i}):this.refocusNode(e,i)):this.doRenderData())},deleteRecord:function(t,e,i){var s=new Array;i||s.push(t),this.concatArray(s,this.getAllChildRecords(t.get(this.fields.id)));var r=e?this.getCloneRecords(s):void 0;this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!0;for(var o=s.length-1;-1<o;o--)this.DATASET_EVENT_LOCK.REMOVE=!0,this.dataSet.removeAt(this.dataSet.indexOfKey(s[o].id)),this.DATASET_EVENT_LOCK.REMOVE=!1;return this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!1,r},deleteNode:function(t,e,i,s){if(t=t||this.currentFocus){var r,o,n,d=t.getRecord();return d&&(s=d.get(this.fields.parentId),r=this.deleteRecord(d,e,i)),s!==this.getRootValue()?this.redrawParent(s,void 0,!0):(n=(o=(o=t.getPreviousLi())||t.getNextLi())?this.getNodeObject(o):null,this.removeNodeDom(t),n&&this.dataSet.setRow(n.getRow(),{ignoreCanRowPosChangeEvent:!0})),r}},cutNode:function(t){t=t||this.currentFocus,this.deletedRecords=t?this.deleteNode(t,!0):null},copyNode:function(t,e){e=e||this.currentFocus,this.copiedRecordId=e?e.getRecordId():null,this.copyWithChilds=!(null==t||null==t||!this.useTempId)&&t},pasteNode:function(t){if(t=t||this.currentFocus)if(this.copiedRecordId){var e=this.dataSet.get(this.copiedRecordId),i=this.getMaxOrder(t.getIdValue());if(this.copyWithChilds){var s=new Array;s.push(e.clone()),this.concatArray(s,this.getAllChildRecordsClone(e.get(this.fields.id)),!0),this.DATASET_EVENT_LOCK.ADD=!0;for(var r=0;r<s.length;r++)s[r].setState(Rui.data.LRecord.STATE_INSERT),this.dataSet.add(s[r]),this.initIdValue(s[0],{ignoreEvent:!0}),s[0].set(this.fields.parentId,t.getIdValue(),{ignoreEvent:!0}),this.fields.order&&s[0].set(this.fields.order,i+1,{ignoreEvent:!0});this.DATASET_EVENT_LOCK.ADD=!1}else{var o=e.clone();this.DATASET_EVENT_LOCK.ADD=!0,o.setState(Rui.data.LRecord.STATE_INSERT),this.dataSet.add(o),this.initIdValue(o,{ignoreEvent:!0}),o.set(this.fields.parentId,t.getIdValue(),{ignoreEvent:!0}),this.fields.hasChild&&o.set(this.fields.hasChild,null,{ignoreEvent:!0}),this.fields.order&&o.set(this.fields.order,i+1,{ignoreEvent:!0}),this.DATASET_EVENT_LOCK.ADD=!1}t.open(!0)}else if(this.deletedRecords){this.DATASET_EVENT_LOCK.ADD=!0;for(r=0;r<this.deletedRecords.length;r++)this.deletedRecords[r].setState(Rui.data.LRecord.STATE_INSERT),this.dataSet.add(this.deletedRecords[r]),this.deletedRecords[0].set(this.fields.parentId,t.getIdValue(),{ignoreEvent:!0});this.DATASET_EVENT_LOCK.ADD=!1,t.open(!0)}this.copiedRecordId=null,this.copyWithChilds=null,this.deletedRecords=null},getMaxOrder:function(t){var e=-1;if(this.fields.order)for(var i,s=this.dataSet.getCount(),r=0;r<s;r++)(i=this.dataSet.getAt(r)).get(this.fields.parentId)===t&&(e=e<i.get(this.fields.order)?i.get(this.fields.order):e);return e},removeNodeDom:function(t){var e,i,s,r,o;(t=t||this.currentFocus)&&(1==(i=(e=Rui.get(t.getUL())).select("> li").length)?(0<t.getDepth()&&this.getNodeObject(t.getParentLi()).changeStateTo(this.NODE_STATE.HAS_NO_CHILD),s=e.dom,t===this.currentFocus&&delete this.currentFocus,delete t,delete e,Rui.util.LDom.removeNode(s)):1<i&&(!t.isLast()||(r=this.getNodeObject(t.getPreviousLi()))&&r.changeStateTo(this.NODE_STATE.LAST),o=t.getLi(),t===this.currentFocus&&delete this.currentFocus,delete t,Rui.util.LDom.removeNode(o)))},onAddData:function(t){var e,i;!0!==this.DATASET_EVENT_LOCK.ADD&&(this.isPossibleNodeRecord(t.record)?t.record.get(this.fields.parentId)===this.getRootValue()?this.addChildNodeHtml(t.record,!0):!(e=this.getParentRecord(t.record))||(i=this.findNode(e.id))&&i.open(!0):this.addTopNode(t.record.get(this.fields.label),t.row))},onChangeData:function(t){this.doRenderData()},onUpdateData:function(t){var e,i,s,r;!0!==this.DATASET_EVENT_LOCK.UPDATE&&(e=this.findNode(t.record.id),i=this.dataSet.getRow(),t.colId==this.fields.parentId?(e&&this.removeNodeDom(e),t.value===this.getRootValue()?this.addChildNodeHtml(t.record,!0):(r=(s=this.getParentRecord(t.record))?this.findNode(s.id):void 0,this.addChildNodeHtml(t.record,!1,r)),t.row===i&&this.focusNode(i)):e&&t.colId==this.fields.label?e.syncLabel():this.fields.order&&t.colId==this.fields.order?this.redrawParent(t.record.get(this.fields.parentId),t.row):e&&t.colId==this.fields.id&&t.row===i&&(this.lastFocusId=t.value))},onRemoveData:function(t){var e;!0!==this.DATASET_EVENT_LOCK.REMOVE&&((e=this.findNode(t.record.id,void 0,!0))?this.deleteNode(e,!1,!0,t.record.get(this.fields.parentId)):this.deleteRecord(t.record,!1,!0))},onUndoData:function(t){this.doRenderData()},clearDataSet:function(){this.doRenderData()},onRowPosChangedData:function(t){!0!==this.DATASET_EVENT_LOCK.ROW_POS_CHANGED&&this.focusNode(t.row)},onLoadChildDataSet:function(t){var e,i,s,r=new Array,o=new Array,n=!1;if(this.currentFocus){if(this.autoMark&&(n=this.dataSet.isMarked(this.dataSet.indexOfKey(this.currentFocus.getRecordId()))),0<(r=this.getChildRecords(this.currentFocus.getIdValue(),this.childDataSet)).length){for(this.DATASET_EVENT_LOCK.ADD=!0,s=0;s<r.length;s++)e=r[s].clone(),i=this.dataSet.add(e),this.autoMark&&n&&this.dataSet.setMark(i,!0),o.push(this.getNodeInfoByRecord(e));this.DATASET_EVENT_LOCK.ADD=!1}this.currentFocus.renderChild(o)}},isRendered:function(){return!0===this._rendered},getState:function(t){switch(t.state){case Rui.data.LRecord.STATE_INSERT:return"I";case Rui.data.LRecord.STATE_UPDATE:return"U";case Rui.data.LRecord.STATE_DELETE:return"D"}return""},destroy:function(){this.prevFocusNode=null,this.currentFocus=null,this.childDataSet=null,this.dataSet=null,Rui.ui.LUnorderedList.superclass.destroy.call(this)}})),Rui.ui.LUnorderedListNode||(Rui.ui.LUnorderedListNode=function(t){Rui.applyObject(this,t),this.init()},Rui.ui.LUnorderedListNode.prototype={el:null,otype:"Rui.ui.LUnorderedListNode",recordId:null,idValue:null,depth:null,dom:null,isLeaf:null,unorderList:null,NODE_STATE:null,useAnimation:!1,useCollapseAllSibling:!1,childULHeight:0,init:function(){this.dom="li"==this.dom.tagName.toLowerCase()?this.dom.firstChild:this.dom,this.el=Rui.get(this.dom),this.NODE_STATE=this.unorderList.NODE_STATE,this.recordId=this.unorderList.getRecordId(this.dom);var t=Rui.util.LDom.findStringInClassName(this.dom,this.unorderList.CLASS_UL_LI_DIV_DEPTH+"-");this.depth="null"!=t&&parseInt(t),this.initIsLeaf()},initIsLeaf:function(){var t=!0,e=this.unorderList.dataSet.get(this.recordId);if(e)if(this.unorderList.fields.hasChild){var i=e.get(this.unorderList.fields.hasChild);null!=this.unorderList.hasChildValue&&(i=i==this.unorderList.hasChildValue),t=!i}else for(var s=e.get(this.unorderList.fields.id),r=this.unorderList.dataSet.getCount(),o=0;o<r;o++)if(this.unorderList.dataSet.getAt(o).get(this.unorderList.fields.parentId)===s){t=!1;break}this.isLeaf=t},getRecordId:function(){return this.recordId},getParentId:function(){var t=this.getRecord();return t?t.get(this.unorderList.fields.parentId):void 0},getParentNode:function(){if(0<this.getDepth()){var t=this.getParentDom();if(t)return this.unorderList.createNodeObject(t)}return!1},getIdValue:function(){var t=this.getRecord();return this.idValue=t?t.get(this.unorderList.fields.id):void 0,this.idValue},getRecord:function(){return this.unorderList.dataSet.get(this.getRecordId())},getRow:function(){return this.unorderList.dataSet.indexOfKey(this.getRecordId())},getDepth:function(){return this.depth},hasChild:function(){return!this.isLeaf},isFocus:function(){return this.checkNodeState(this.NODE_STATE.FOCUS)},focus:function(){this.changeStateTo(this.NODE_STATE.FOCUS),this.isTop()&&this.changeStateTo(this.NODE_STATE.FOCUS_TOP)},unfocus:function(){this.changeStateTo(this.NODE_STATE.UNFOCUS)},isMarked:function(){return this.checkNodeState(this.NODE_STATE.MARK)},mark:function(){this.changeStateTo(this.NODE_STATE.MARK),"child"==this.getRecord().treeType?this.unorderList.markChilds(!0,this.getRecord()):"parent"==this.getRecord().treeType&&this.unorderList.markParents(!0,this)},unmark:function(){this.changeStateTo(this.NODE_STATE.UNMARK),"child"==this.getRecord().treeType?this.unorderList.markChilds(!1,this.getRecord()):"parent"==this.getRecord().treeType&&this.unorderList.markParents(!1,this)},isLast:function(){return this.checkNodeState(this.NODE_STATE.last)},isTop:function(){return 0==this.depth},isExpand:function(){return this.checkNodeState(this.NODE_STATE.OPEN)},isCollaps:function(){return this.checkNodeState(this.NODE_STATE.CLOSE)},open:function(t){var e=new Array;t&&this.removeChildUL(void 0,t),e=this.unorderList.getChildNodeInfos(this.getIdValue(),null,this.getParentDoms(),t),t||0!=e.length?this.renderChild(e,t):this.unorderList.fireEvent("dynamicLoadChild",{target:this.unorderList,node:this,parentId:this.getIdValue()}),(this.useCollapseAllSibling||0===this.getDepth()&&!0===this.unorderList.onlyOneTopOpen)&&this.collapseAllSibling()},renderChild:function(t,e){0<t.length?(this.addChildNodes(t,e),this.changeStateTo(this.NODE_STATE.OPEN)):this.changeStateTo(this.NODE_STATE.HAS_NO_CHILD)},close:function(){this.changeStateTo(this.NODE_STATE.CLOSE),this.removeChildUL()},syncLabel:function(){this.el.html(this.unorderList.getContent(this.getRecord()))},toggleChild:function(){this.isExpand()?this.close():this.isCollaps()&&this.open()},expand:function(){this.isCollaps()&&this.open()},collapse:function(){this.isExpand()&&this.close()},collapseAllSibling:function(){for(var t=this.getUL(),e=0;e<t.childNodes.length;e++)t.childNodes[e].firstChild!==this.dom&&this.unorderList.getNodeObject(t.childNodes[e]).collapse()},getOrder:function(){return this.unorderList.fields.order?this.getRecord().get(this.unorderList.fields.order):null},getChildUL:function(t){return this.unorderList.getChildUL(t||this.dom)},getChildULHeight:function(){return this.childULHeight},removeChildUL:function(t,e){var i,s,r,o=this.getChildUL(t);o&&(i=this.getLi(),e||!this.useAnimation||!0!==this.useAnimation&&!0!==this.useAnimation.collapse?(i.style.overflow="hidden",i.removeChild(o),this.unorderList.fireEvent("collapse",{target:this,node:this.unorderList.currentFocus}),i.style.overflow=""):(i.style.overflow="hidden",s=new Rui.fx.LAnim({el:o,attributes:{height:{to:1}},duration:this.unorderList.animDuration}),r=this,s.on("complete",function(){i.removeChild(o),r.unorderList.fireEvent("collapse",{target:r,node:r.unorderList.currentFocus}),i.style.overflow=""}),s.animate()))},getUL:function(t){return this.unorderList.getUL(t||this.dom)},getIndex:function(){for(var t=this.getUL(),e=this.getLi(),i=-1,s=0;s<t.childNodes.length;s++)if(e===t.childNodes[s]){i=s;break}return i},getLi:function(t){return(t=t||this.dom).parentNode},getParentLi:function(t){var e=(t=t||this.dom).parentNode.parentNode.parentNode;return e=e&&e.tagName&&"li"==e.tagName.toLowerCase()?e:null},getPreviousLi:function(t){t=t||this.dom;var e=this.getLi(t);return Rui.util.LDom.getPreviousSibling(e)},getNextLi:function(t){t=t||this.dom;var e=this.getLi(t);return Rui.util.LDom.getNextSibling(e)},getNextDom:function(t){t=t||this.dom;var e=this.getNextLi(t),i=null;return e&&(i=(i=e.firstChild)&&i.tagName&&"div"==i.tagName.toLowerCase()?i:null),i},getPreviousDom:function(t){t=t||this.dom;var e=this.getPreviousLi(t),i=null;return e&&(i=(i=e.firstChild)&&i.tagName&&"div"==i.tagName.toLowerCase()?i:null),i},getLastChildDom:function(){var t=this.getChildUL();return t?t.lastChild.firstChild:null},getParentDom:function(t){t=t||this.dom;var e=this.getParentLi(t),i=null;return e&&(i=(i=e.firstChild)&&i.tagName&&"div"==i.tagName.toLowerCase()?i:null),i},getParentDoms:function(t){var e=new Array,i=this.dom;!0!==t&&e.push(i);for(var s=0;s<100&&(i=this.getParentDom(i));s++)e.push(i);return e},addChildNodes:function(t,e){var i,s,r,o,n;t&&0<t.length&&(this.changeStateTo(this.NODE_STATE.HAS_CHILD),this.isLeaf=!1,i=this.unorderList.htmlToDom(this.unorderList.getUlHtml(null,this.depth,t)),s=Rui.get(i),e&&this.isExpand()||s.setStyle("display","none"),this.el.parent().appendChild(i),r=s.getDimensions(),this.childULHeight=r.height,e&&this.isExpand()||(!this.useAnimation||!0!==this.useAnimation&&!0!==this.useAnimation.expand?(s.setStyle("display",""),s.setStyle("overflow","hidden"),s.setStyle("height","auto"),this.unorderList.fireEvent("expand",{target:this,node:this.unorderList.currentFocus}),s.setStyle("overflow","")):(s.setStyle("height","1px"),s.setStyle("display",""),s.setStyle("overflow","hidden"),(o=new Rui.fx.LAnim({el:i,attributes:{height:{from:1,to:r.height}}})).duration=this.unorderList.animDuration,o.animate(),n=this,o.on("complete",function(){s.setStyle("height","auto"),n.unorderList.fireEvent("expand",{target:n,node:n.unorderList.currentFocus}),s.setStyle("overflow","")}))))},getChildNodes:function(){var t=[];return this.unorderList&&(t=this.unorderList.getChildRecords(this.getIdValue(),this.childDataSet)),t},checkNodeState:function(t){switch(t){case this.NODE_STATE.HAS_CHILD:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID);case this.NODE_STATE.HAS_NO_CHILD:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST);case this.NODE_STATE.MID:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID);case this.NODE_STATE.LAST:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST);case this.NODE_STATE.OPEN:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST);case this.NODE_STATE.CLOSE:return this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)||this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID);case this.NODE_STATE.MARK:return this.el.hasClass(this.unorderList.CLASS_UL_MARKED_NODE);case this.NODE_STATE.UNMARK:return!this.el.hasClass(this.unorderList.CLASS_UL_MARKED_NODE);case this.NODE_STATE.FOCUS:return this.el.hasClass(this.unorderList.CLASS_UL_FOCUS_NODE);case this.NODE_STATE.UNFOCUS:return!this.el.hasClass(this.unorderList.CLASS_UL_FOCUS_NODE);default:return!1}},changeStateTo:function(t){switch(t){case this.NODE_STATE.HAS_CHILD:this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID)?(this.el.replaceClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID),Rui.get(this.getLi()).addClass(this.unorderList.CLASS_UL_LI_LINE)):this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST);break;case this.NODE_STATE.HAS_NO_CHILD:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID,this.unorderList.CLASS_UL_HAS_NO_CHILD_MID):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST,this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID,this.unorderList.CLASS_UL_HAS_NO_CHILD_MID):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST,this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST),Rui.get(this.getLi()).removeClass(this.unorderList.CLASS_UL_LI_LINE);break;case this.NODE_STATE.MID:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST,this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)?(this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID),Rui.get(this.getLi()).addClass(this.unorderList.CLASS_UL_LI_LINE)):this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST,this.unorderList.CLASS_UL_HAS_NO_CHILD_MID);break;case this.NODE_STATE.LAST:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID,this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST):this.el.hasClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_NO_CHILD_MID,this.unorderList.CLASS_UL_HAS_NO_CHILD_LAST),Rui.get(this.getLi()).removeClass(this.unorderList.CLASS_UL_LI_LINE);break;case this.NODE_STATE.OPEN:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID)?(this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID),Rui.get(this.getLi()).addClass(this.unorderList.CLASS_UL_LI_LINE)):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST,this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST);break;case this.NODE_STATE.CLOSE:this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID)?this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_MID,this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_MID):this.el.hasClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST)&&this.el.replaceClass(this.unorderList.CLASS_UL_HAS_CHILD_OPEN_LAST,this.unorderList.CLASS_UL_HAS_CHILD_CLOSE_LAST),Rui.get(this.getLi()).removeClass(this.unorderList.CLASS_UL_LI_LINE);break;case this.NODE_STATE.MARK:this.el.addClass(this.unorderList.CLASS_UL_MARKED_NODE);break;case this.NODE_STATE.UNMARK:this.el.removeClass(this.unorderList.CLASS_UL_MARKED_NODE);break;case this.NODE_STATE.FOCUS:this.el.addClass(this.unorderList.CLASS_UL_FOCUS_NODE),(e=this.getParentNode())&&e.changeStateTo(this.NODE_STATE.FOCUS_PARENT);break;case this.NODE_STATE.UNFOCUS:this.el.removeClass(this.unorderList.CLASS_UL_FOCUS_NODE),(e=this.getParentNode())&&e.changeStateTo(this.NODE_STATE.UNFOCUS_PARENT);break;case this.NODE_STATE.FOCUS_PARENT:var e;this.el.addClass(this.unorderList.CLASS_UL_FOCUS_PARENT_NODE),(e=this.getParentNode())&&e.changeStateTo(this.NODE_STATE.FOCUS_PARENT);break;case this.NODE_STATE.UNFOCUS_PARENT:this.el.removeClass(this.unorderList.CLASS_UL_FOCUS_PARENT_NODE),e&&e.changeStateTo(this.NODE_STATE.UNFOCUS_PARENT);break;case this.NODE_STATE.FOCUS_TOP:for(var i=this.getUL(),s=0,r=i.childNodes.length;s<r;s++)i.childNodes[s].firstChild!==this.dom&&this.unorderList.getNodeObject(i.childNodes[s]).el.removeClass(this.unorderList.CLASS_UL_FOCUS_TOP_NODE);this.el.addClass(this.unorderList.CLASS_UL_FOCUS_TOP_NODE)}}}),Rui.namespace("Rui.ui.tree"),Rui.ui.tree.LTreeView=function(t,e){e=t||e||{},"string"==typeof t&&(e.id=t,e.applyTo=t),e=Rui.applyIf(e,Rui.getConfig().getFirst("$.ext.treeView.defaultProperties")),Rui.ui.tree.LTreeView.superclass.constructor.call(this,e),this.createEvent("nodeImageClick"),this.createEvent("labelClick"),this.createEvent("checkboxClick")},Rui.extend(Rui.ui.tree.LTreeView,Rui.ui.LUnorderedList,{otype:"Rui.ui.tree.LTreeView",toggleByLabel:!1,nodeType:"text",showFolder:!0,CSS_BASE:"L-ul L-ul-treeview",CLASS_UL_TREEVIEW_NODE_TABLE:"L-ul-treeview-node-table",CLASS_UL_TREEVIEW_NODE_TABLE_CELL:"L-ul-treeview-node-table-cell",CLASS_UL_TREEVIEW_NODE_TABLE_CELL_FOLDER:"L-ul-treeview-node-table-cell-folder",CLASS_UL_TREEVIEW_NODE_TABLE_CELL_FOLDER_NO_CHILD:"L-ul-treeview-node-table-cell-folder-no-child",CLASS_UL_TREEVIEW_NODE_TABLE_CELL_FOLDER_HIDDEN:"L-ul-treeview-node-table-cell-folder-hidden",CLASS_UL_TREEVIEW_NODE_TABLE_CELL_CHECKBOX:"L-ul-treeview-node-table-cell-checkbox",CLASS_UL_TREEVIEW_NODE_TABLE_CELL_CHECKBOX_HIDDEN:"L-ul-treeview-node-table-cell-checkbox-hidden",CLASS_UL_TREEVIEW_NODE_TABLE_CELL_CONTENT:"L-ul-treeview-node-table-cell-content",CLASS_UL_TREEVIEW_NODE_IMAGE:"L-ul-treeview-node-image",CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID:"L-ul-treeview-node-image-close-mid",CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST:"L-ul-treeview-node-image-close-last",CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID:"L-ul-treeview-node-image-open-mid",CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST:"L-ul-treeview-node-image-open-last",CLASS_UL_TREEVIEW_NODE_IMAGE_MID:"L-ul-treeview-node-image-mid",CLASS_UL_TREEVIEW_NODE_IMAGE_LAST:"L-ul-treeview-node-image-last",CLASS_UL_TREEVIEW_NODE_FOLDER:"L-ul-treeview-node-folder",CLASS_UL_TREEVIEW_NODE_FOLDER_OPEN:"L-ul-treeview-node-folder-open",CLASS_UL_TREEVIEW_NODE_FOLDER_CLOSE:"L-ul-treeview-node-folder-close",CLASS_UL_TREEVIEW_NODE_CHECKBOX:"L-ul-treeview-node-checkbox",CLASS_UL_TREEVIEW_NODE_CHECKBOX_CHECKED:"L-ul-treeview-node-checkbox-checked",CLASS_UL_TREEVIEW_NODE_CHECKBOX_UNCHECKED:"L-ul-treeview-node-checkbox-unchecked",CLASS_UL_TREEVIEW_NODE_CONTENT:"L-ul-treeview-node-content",CLASS_UL_TREEVIEW_NODE_LABEL:"L-ul-treeview-node-label",accessibilityELRole:"tree",createTemplate:function(){Rui.ui.tree.LTreeView.superclass.createTemplate.call(this);var t=this.templates||{};t.td=new Rui.LTemplate('<td class="{clsTd}"><div class="{clsDiv}">&nbsp;</div></td>'),t.table=new Rui.LTemplate('<table cellspacing="0" cellpadding="0" border="0" class="'+this.CLASS_UL_TREEVIEW_NODE_TABLE+'">',"<tbody>","<tr>",'<td class="'+this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL+'">','<div class="'+this.CLASS_UL_TREEVIEW_NODE_IMAGE+' {nodeImageClass}">&nbsp;</div>',"</td>","{folderTd}","{checkboxTd}",'<td class="'+this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL+" "+this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL_CONTENT+'">','<div class="'+this.CLASS_UL_TREEVIEW_NODE_CONTENT+'">','<a class="'+this.CLASS_UL_TREEVIEW_NODE_LABEL+'">{label}</a>',"</div>","</td>","</tr>","</tbody>","</table>"),this.templates=t},getAccessibilityUlRole:function(t){return 0==t?"tree":"group"},getAccessibilityLiRole:function(){return"treeitem"},getContent:function(t,e,i){var s=this.getLabel(t,e),r="",o="",n=!0;switch(e){case this.CLASS_UL_HAS_CHILD_CLOSE_MID:r=this.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID,o=this.CLASS_UL_TREEVIEW_NODE_FOLDER_CLOSE;break;case this.CLASS_UL_HAS_CHILD_CLOSE_LAST:r=this.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST,o=this.CLASS_UL_TREEVIEW_NODE_FOLDER_CLOSE;break;case this.CLASS_UL_HAS_CHILD_OPEN_MID:r=this.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID,o=this.CLASS_UL_TREEVIEW_NODE_FOLDER_OPEN;break;case this.CLASS_UL_HAS_CHILD_OPEN_LAST:r=this.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST,o=this.CLASS_UL_TREEVIEW_NODE_FOLDER_OPEN;break;case this.CLASS_UL_HAS_NO_CHILD_MID:r=this.CLASS_UL_TREEVIEW_NODE_IMAGE_MID,n=!1;break;case this.CLASS_UL_HAS_NO_CHILD_LAST:r=this.CLASS_UL_TREEVIEW_NODE_IMAGE_LAST,n=!1}var d,h=this.templates||{},a=[this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL],_=[this.CLASS_UL_TREEVIEW_NODE_FOLDER];a.push(!0!==this.showFolder?this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL_FOLDER_HIDDEN:!0===n?this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL_FOLDER:this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL_FOLDER_NO_CHILD),_.push(o),d=h.td.apply({clsTd:a.join(" "),clsDiv:_.join(" ")});var L,l,a=[this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL],_=[];return"checkbox"==this.nodeType.toLowerCase()?(l=t.dataSet.indexOfKey(t.id),t.dataSet.isMarkable(l)||a.push(this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL_CHECKBOX+"-disabled"),a.push(this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL_CHECKBOX),_.push(i?this.CLASS_UL_TREEVIEW_NODE_CHECKBOX_CHECKED:this.CLASS_UL_TREEVIEW_NODE_CHECKBOX_UNCHECKED)):a.push(this.CLASS_UL_TREEVIEW_NODE_TABLE_CELL_CHECKBOX_HIDDEN),L=h.td.apply({clsTd:a.join(" "),clsDiv:_.join(" ")}),s=h.table.apply({folderTd:d,checkboxTd:L,nodeImageClass:r,label:s})},onNodeClick:function(t){var e,i,s,r,o,n=this.findNodeByDom(t.target);n&&(e=!1,i="",s=t.target.className,n!==this.currentFocus&&(r=this.dataSet.indexOfKey(n.getRecordId()),this.dataSet.setRow(r)),-1<s.indexOf(this.CLASS_UL_TREEVIEW_NODE_IMAGE)&&(e=!0,this.fireEvent("nodeImageClick",{target:this,node:this.currentFocus,dom:t.target}),i="nodeImageClick"),"text"!=this.nodeType&&-1<s.indexOf(this.CLASS_UL_TREEVIEW_NODE_CHECKBOX)&&(o=!1,-1<s.indexOf(this.CLASS_UL_TREEVIEW_NODE_CHECKBOX_UNCHECKED)&&(o=!0),this.dataSet.setMark(this.dataSet.indexOfKey(n.getRecordId()),o),this.fireEvent("checkboxClick",{target:this,node:this.currentFocus,checked:this.currentFocus.isMarked(),dom:t.target}),i="checkboxClick"),Rui.util.LDom.findParent(t.target,"a."+this.CLASS_UL_TREEVIEW_NODE_LABEL,10)&&(e=!1!==this.toggleByLabel,this.fireEvent("labelClick",{target:this,node:this.currentFocus,dom:t.target}),i="labelClick"),this.fireEvent("nodeClick",{target:this,node:this.currentFocus,nodeEventType:i,dom:t.target}),e&&n.toggleChild())},onNodeMouseover:function(t){var e=this.findNodeByDom(t.target);e&&this.fireEvent("nodeMouseover",{target:this,node:e})},onNodeMouseout:function(t){var e=this.findNodeByDom(t.target);e&&this.fireEvent("nodeMouseout",{target:this,node:e})},openDepthNode:function(t){var e=Rui.getMessageManager(),i=this.dataSet.getCount();Rui.browser.msie678&&1e3<=i&&0==confirm(e.get("$.ext.msg017",[i]))||(this.defaultOpenDepth=t,this.render(this.container))},createNodeObject:function(t){return new Rui.ui.tree.LTreeViewNode({unorderList:this,useAnimation:this.useAnimation,dom:t})},destroy:function(){Rui.ui.tree.LTreeView.superclass.destroy.call(this)}}),Rui.ui.tree.LTreeViewNode=function(t){Rui.ui.tree.LTreeViewNode.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.tree.LTreeViewNode,Rui.ui.LUnorderedListNode,{otype:"Rui.ui.tree.LTreeViewNode",partType:{nodeImage:0,folder:1,cehckbox:2,content:3,label:4},syncLabel:function(){this.getPartEl(this.partType.label).html(this.unorderList.getLabel(this.getRecord()))},getPartEl:function(t,e){var i=(e=e||this.dom).firstChild.rows[0].cells;switch(t){case this.partType.nodeImage:return Rui.get(i[0].firstChild);case this.partType.folder:return Rui.get(i[1].firstChild);case this.partType.checkbox:return Rui.get(i[2].firstChild);case this.partType.content:return Rui.get(i[3].firstChild);case this.partType.label:return Rui.get(i[3].firstChild.firstChild);default:return null}},changeStateTo:function(t){Rui.ui.tree.LTreeViewNode.superclass.changeStateTo.call(this,t);var e=this.getPartEl(this.partType.nodeImage),i=this.getPartEl(this.partType.folder),s=Rui.get(i.dom.parentNode);switch(t){case this.NODE_STATE.HAS_CHILD:e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_MID)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_MID,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_LAST)&&e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_LAST,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST),this.unorderList.showFolder&&(i.removeClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_FOLDER_CLOSE),i.addClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_FOLDER_OPEN),s.removeClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_TABLE_CELL_FOLDER_HIDDEN));break;case this.NODE_STATE.HAS_NO_CHILD:e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_MID):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_LAST):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_MID):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST)&&e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_LAST),this.unorderList.showFolder&&(i.removeClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_FOLDER_CLOSE),i.removeClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_FOLDER_OPEN),s.addClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_TABLE_CELL_FOLDER_HIDDEN));break;case this.NODE_STATE.MID:e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_LAST)&&e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_LAST,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_MID);break;case this.NODE_STATE.LAST:e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_MID)&&e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_MID,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_LAST);break;case this.NODE_STATE.OPEN:e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST)&&e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST),i.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_FOLDER_CLOSE,this.unorderList.CLASS_UL_TREEVIEW_NODE_FOLDER_OPEN);break;case this.NODE_STATE.CLOSE:e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID)?e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_MID,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_MID):e.hasClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST)&&e.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_OPEN_LAST,this.unorderList.CLASS_UL_TREEVIEW_NODE_IMAGE_CLOSE_LAST),i.replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_FOLDER_OPEN,this.unorderList.CLASS_UL_TREEVIEW_NODE_FOLDER_CLOSE);break;case this.NODE_STATE.MARK:this.getPartEl(this.partType.checkbox).replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_CHECKBOX_UNCHECKED,this.unorderList.CLASS_UL_TREEVIEW_NODE_CHECKBOX_CHECKED);break;case this.NODE_STATE.UNMARK:this.getPartEl(this.partType.checkbox).replaceClass(this.unorderList.CLASS_UL_TREEVIEW_NODE_CHECKBOX_CHECKED,this.unorderList.CLASS_UL_TREEVIEW_NODE_CHECKBOX_UNCHECKED);break;case this.NODE_STATE.FOCUS:case this.NODE_STATE.UNFOCUS:}}});