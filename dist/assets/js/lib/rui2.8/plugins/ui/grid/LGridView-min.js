/*
 * @(#) LGridView-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
!function(){Rui.ui.grid.LGridView=function(e){Rui.ui.grid.LGridView.superclass.constructor.call(this,e)};var c=Rui.util.LDom;Rui.extend(Rui.ui.grid.LGridView,Rui.ui.grid.LBufferGridView,{isVirtualScroll:!1,fitContentHeight:!1,doRender:function(e){Rui.ui.grid.LGridView.superclass.doRender.call(this,e),this.scrollerEl.setStyle("overflow","auto"),this.el.addClass("L-grid-view"),Rui.util.LEvent.addListener(this.scrollerEl.dom,"scroll",this.onScroll,this,!0)},doRenderData:function(e){Rui.ui.grid.LGridView.superclass.doRenderData.call(this,e),this.columnModel.freezeColumnId&&(this.updateRowHeight(),this.updateFirstLiStyle())},updateRowHeight:function(){var e=this.getLastLiEl(!0);this.headerHeight=e.getHeight(!0)+this.headerEl.getBorderWidth("tb");var t=this.getFirstLiEl();t.setStyle("top",this.headerHeight+"px");var i=this.getLastLiEl();if(t&&0<t.dom.childNodes.length&&i&&0<i.dom.childNodes.length)for(var l=t.dom.childNodes[0].rows,o=i.dom.childNodes[0].rows,r=0;r<o.length;r++){var s=Rui.get(l[r]);if(!s)return;var d=Rui.get(o[r]);if(d.hasClass(this.CLASS_GRIDVIEW_BODY_EMPTY))return;var n=s.getHeight(),a=d.getHeight();n<a?s.setHeight(a):a<n&&d.setHeight(n)}},getRenderRange:function(e){var t=this.getDataCount(),i=0<t?{start:0,end:t-1,visibleStart:0,visibleEnd:t-1,rowCount:t,afterRows:{}}:null;this.renderRange=i;try{return i}finally{i=null}},showEmptyDataMessage:function(){var e=this.getLastLiEl().dom.firstChild,t=null!=this.emptyDataMessageCode?this.emptyDataMessageCode:"$.base.msg115",i=Rui.getMessageManager().get(t),l='<tr class="'+Rui.ui.grid.LBufferGridView.CLASS_GRIDVIEW_BODY_EMPTY+'"><td colspan="'+this.columnModel.getColumnCount(!0)+'">'+i+"</td></tr>",o=Rui.createElements(l).getAt(0).dom,r=e.insertRow(0);c.replaceChild(o,r),o=r=null},getGrowedCount:function(){return 0},redoRender:function(e){Rui.ui.grid.LGridView.superclass.redoRender.call(this,e)},_redoRender:function(e){Rui.ui.grid.LGridView.superclass._redoRender.call(this,e),this.scrollerEl.setStyle("overflow","auto"),Rui.util.LEvent.addListener(this.scrollerEl.dom,"scroll",this.onScroll,this,!0),this.columnModel.freezeColumnId&&(this.updateRowHeight(),this.updateFirstLiStyle())},redoRenderData:function(e){e&&e.renderCheckFirst&&Rui.ui.grid.LGridView.superclass.redoRenderData.call(this,e)},_redoRenderData:function(e){try{if(this.delayEditorRender=this.delayEditorRender||0,!this.isDelayEditorRender){if(new Date-this.modifiedDate<5e3)for(var t=0,i=this.columnModel.getColumnCount(!0);this.delayEditorRender<300&&t<i;t++){var l=this.columnModel.getColumnAt(t,!0);if(l.editor&&l.editor.dataSet&&!0!==l.editor.dataSet.isLoad)return}this.isDelayEditorRender=!0}this.delayRRD&&this.delayRRD.cancel(),this.delayRRD=null,this.doRenderData()}catch(e){Rui.log("error : "+e.message)}},onWidthResize:function(e){},makeScroll:function(e){},getRenderedRow:function(e){return e},getScrollerEl:function(){return this.scrollerEl},updateColumnWidth:function(e,t,i){var l=i-t,o=this.columnModel.getTotalWidth(!0),r=o;if(i=this.adjustColumnWidth(i),this.updateHeaderWidth(e,l,r,o,i),this.bodyEl.setWidth(o),!this.updateEmptyWidth(o)&&0<this.dataSet.getCount()){var s=this.columnModel,d=s.getFirstColumnsWidth(!0),n=s.getLastColumnsWidth(!0),a=null,h=this.getFirstLiEl(),u=this.getLastLiEl();-1<this.columnModel.freezeIndex&&(a=h.dom.childNodes[0].rows);for(var c,g=u.dom.childNodes[0].rows,m=null,R=0;R<g.length;R++){a&&a[R]&&((c=Rui.get(a[R])).hasClass("L-grid-row")&&(c.setWidth(d),e<=this.columnModel.freezeIndex&&(this.getRowCellDom(c.dom,R,e).style.width=i+"px"))),(m=Rui.get(g[R])).setWidth(n),m.hasClass("L-grid-row")&&e>this.columnModel.freezeIndex&&(this.getRowCellDom(m.dom,R,e).style.width=i+"px")}var f=Rui.get(h.dom.firstChild),w=Rui.get(u.dom.firstChild);f.setWidth(d),w.setWidth(n),w.setStyle("margin-left",d+"px")}},updateHeaderWidth:function(e,t,i,l,o){var r=this.columnModel,s=r.getColumnAt(e,!0),d=1;-1<r.freezeIndex&&(d=e<=r.freezeIndex?0:1);var n,a,h,u,c=(0===d?this.getFirstLiEl(!0):this.getLastLiEl(!0)).select("table").getAt(0),g=r.getColumnCount(!0),m=c.select(".L-grid-cell-"+s.id).getAt(0);r.isMultiheader()&&this.updateHeaderInnerWidth(e,c.dom,m,s,t,g),m.dom.style.width=o+"px",this.headerOffsetEl.setWidth(i),-1<r.freezeIndex?(n=r.getFirstColumnsWidth(!0),a=r.getLastColumnsWidth(!0),h=Rui.get(this.getFirstLiEl(!0).dom.firstChild),u=Rui.get(this.getLastLiEl(!0).dom.firstChild),h.setWidth(n),u.setWidth(a),u.setStyle("margin-left",n+"px")):c.setWidth(l)},updateHeaderInnerWidth:function(e,t,i,l,o,r){var s=this.columnModel;-1<s.freezeIndex&&(e=e<=s.freezeIndex?e:e-s.freezeIndex-1);for(var d=this.getTableSpanInfo(t,r),n=d.length,a=new Array,h=0;h<n-1;h++)for(var u=e+1;u--;)if(1<=d[h][u].colSpan){a.push(d[h][u].cellIndex);break}for(var c,g=[],h=0;h<a.length;h++){var m=Rui.get(t.rows[h].cells[a[h]]);g.push({el:m,width:m.getWidth()+o,calPad:!(m.getWidth()<=m.getWidth()-10)})}for(h=0;h<g.length;h++)c=g[h].width,g[h].el.setWidth(c<=0?1:c)},getTableSpanInfo:function(e,t){for(var i,l=new Array,o=e.rows.length,r=0;r<o;r++){i=new Array;for(var s=0;s<t;s++)i.push({cellIndex:-1,rowSpan:1,colSpan:1,fieldName:""});l.push(i)}for(var d,n,a=1,r=0;r<o;r++){row=e.rows[r],n=row.cells.length;for(s=d=0;s<t;s++)if(0!=l[r][s].colSpan){1==a&&d<n&&(cell=row.cells[d],l[r][s]={cellIndex:cell.cellIndex,rowSpan:cell.rowSpan,colSpan:cell.colSpan,fieldName:cell.id},d++),1<a?(--a,l[r][s].colSpan=1<a?-1:-2):(a=cell.colSpan,l[r][s]={cellIndex:cell.cellIndex,rowSpan:cell.rowSpan,colSpan:a,fieldName:cell.id});for(var h=1;h<cell.rowSpan&&r+h<=o-1;h++)l[r+h][s].rowSpan=0,l[r+h][s].colSpan=0}}return l},onColumnResize:function(e){this.gridPanel.onColumnResize(e);var t=this.columnModel.getIndex(e.target,!0);this.updateColumnWidth(t,e.oldWidth,e.newWidth),this.syncHeaderScroll()},doAddData:function(e){this.hideEmptyDataMessage();var t,i,l,o,r,s,d,n,a=e.row,h=e.record,u=e.target;this.columnModel;h.dataSet.getCount()<50?this.redoRenderData({resetScroll:!1,renderCheckFirst:!0}):(t=this.getRenderRow(a,h,u),-1<this.columnModel.freezeIndex&&(i=this.getRenderRow(a,h,u,!0),l=this.getFirstLiEl().dom.firstChild,o=Rui.createElements(i).getAt(0).dom,0<u.getCount()&&l.rows.length?0===a&&!this.getRowDom(a)||(d=l.insertRow(a),c.replaceChild(o,d),d=null):(d=l.insertRow(),c.replaceChild(o,d),d=null),o=null),r=this.getLastLiEl().dom.firstChild,s=Rui.createElements(t).getAt(0).dom,0<u.getCount()&&r.rows.length?0===a&&!this.getRowDom(a)||(d=r.insertRow(a),c.replaceChild(s,d),d=null):(d=r.insertRow(),c.replaceChild(s,d),d=null),s=null,this.updateRenderRows(a),-1<(n=u.getRow())&&this.gridPanel.getSelectionModel().selectRow(n),this.focusRow(a,0))},doCellUpdateData:function(e){var t=e.row,i=e.col,l=e.colId,o=e.record;if(this.getColumnModel().isMerged())this.redoRenderData({resetScroll:!1,renderCheckFirst:!0});else{0<=(i=this.columnModel.getIndexById(l,!0))&&this.doRenderCell(t,i,o);for(var r,s=this.cellMergeInfoSet,d=0,n=this.columnModel.getColumnCount(!0);d<n;d++){!0===this.columnModel.getColumnAt(d,!0).renderRow&&(r=s?s[t][d]:void 0,this.doRenderCell(t,d,o,r))}}},doRemoveData:function(e){if(e.remainRemoved)return!1;var t,i=e.row,l=e.record;e.target;if(!(l.dataSet.getCount()<50)){-1<this.columnModel.freezeIndex&&(t=this.getRowDom(e.row,0),c.removeNode(t));var o=this.getRowDom(i,1);return c.removeNode(o),this.updateRenderRows(i),this.doEmptyDataMessage(),!0}this.redoRenderData({resetScroll:!1,renderCheckFirst:!0})},doUndoData:function(e){var t,i,l=e.beforeState,o=e.row;l==Rui.data.LRecord.STATE_INSERT?(-1<this.columnModel.freezeIndex&&(t=this.getRowDom(e.row,0),c.removeNode(t)),i=this.getRowDom(o,1),c.removeNode(i),this.updateRenderRows(o),this.doEmptyDataMessage()):l==Rui.data.LRecord.STATE_UPDATE&&(this.onRowUpdateData(e),this.updateRenderRows(o),this.doEmptyDataMessage())},syncFocusRow:function(e,t){try{var i=this.getCellDom(e,t);this.moveXScroll(i,t);var l=this.getCellXY(i);0!=l.x&&this.focusEl.setX(l.x),0!=l.y&&this.focusEl.setY(l.y)}catch(e){}},moveYScroll:function(e){var t,i,l,o,r;e<0||(t=this.getRowDom(e))&&(i=this.scrollerEl.dom.scrollTop,l=t.offsetTop,o=t.offsetHeight,r=this.scrollerEl.getHeight(!0),r-=this.scrollerEl.getWidth(!0)<this.bodyEl.getWidth()?17:0,l<i?this.scrollerEl.dom.scrollTop=l:i+r<=l?this.scrollerEl.dom.scrollTop=i+(l-(i+r))+o:i+r<l+o&&(this.scrollerEl.dom.scrollTop=o-(r-l)))},moveXScroll:function(e,t){var i=this.getScrollerEl(),l=Rui.get(e),o=i.getVisibleScrollXY(l,!0,!0,this.marginLeft,!!this.scroller);o&&!Rui.isEmpty(o.left)&&0<=o.left&&(i.dom.scrollLeft=0<t?o.left:0),i=l=null,this.syncHeaderScroll()},onScroll:function(e){this.headerEl.dom.scrollLeft=this.scrollerEl.dom.scrollLeft,this.columnModel.freezeColumnId&&this.updateFirstLiStyle(),this.gridPanel.stopEditor(!0)},updateFirstLiStyle:function(){var e=this.getFirstLiEl(),t=20<Math.abs(this.scrollerEl.dom.scrollWidth-this.scrollerEl.dom.offsetWidth)?Rui.ui.LScroller.SCROLLBAR_SIZE:0;e.setStyle("top",-(this.scrollerEl.dom.scrollTop-this.headerHeight)+"px"),e.setHeight(this.scrollerEl.getHeight()+this.scrollerEl.dom.scrollTop-t)},showRow:function(e){var t,i=this.dataSet.getAt(e);i&&(i.setAttribute("_showRowDom",!0),(t=this.getRowDom(e))&&Rui.get(t).show())},hideRow:function(e){var t,i=this.dataSet.getAt(e);i&&(i.setAttribute("_showRowDom",hide),(t=this.getRowDom(e))&&Rui.get(t).hide())},isShowRow:function(e){var t=this.dataSet.getAt(e);return!!t&&!1!==t.getAttribute("_showRowDom")},toggleShowRow:function(e){this.isShowRow(e)?this.hideRow(e):this.showRow(e)},createFormValues:function(){this.hiddenFormEl||(this.hiddenFormEl=Rui.createElements('<div class="L-hidden-forms"></div>').getAt(0),this.el.appendChild(this.hiddenFormEl),this.templates.hiddenFormInput=new Rui.LTemplate('<input type="hidden" name="{name}" value="{value}">'));for(var e="",t=this.dataSet.getFields(),i=this.dataSet.getModifiedRecords(),l=0,o=i.length;l<o;l++){var r=i.getAt(l);e+=this.templates.hiddenFormInput.apply({name:"rid",value:r.id}),e+=this.templates.hiddenFormInput.apply({name:"state",value:r.state});for(var s=0,d=t.length;s<d;s++){var n=t[s],a=r.get(n.id),h=this.dataSet.writeFieldFormater[n.type];h&&(a=h(a)),null==a&&(a=""),e+=this.templates.hiddenFormInput.apply({name:n.id,value:a})}}e&&this.hiddenFormEl.html(e)},clearFormValues:function(){this.hiddenFormEl&&this.hiddenFormEl.html("")}})}();