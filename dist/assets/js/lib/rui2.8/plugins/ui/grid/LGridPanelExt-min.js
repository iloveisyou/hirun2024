/*
 * @(#) LGridPanelExt-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
!function(){var h=Rui.util.LXml;void 0!==Rui.ui.grid.LEditButtonColumn&&(Rui.applyIf(Rui.ui.grid.LEditButtonColumn.prototype,{isCustomRender:!1}),Rui.applyObject(Rui.ui.grid.LEditButtonColumn.prototype,{buttonRenderer:function(e){return function(e,t,i,l,o){return t.editable=!0,e=Rui.isEmpty(e)?"&nbsp;":e,this.isCustomRender?"<div><div>"+e+"</div></div>":'<div style="position:relative"><div class="L-popup-button">'+e+'</div><span class="L-popup-button-icon L-ignore-event" style="position:absolute">&nbsp;</span></div>'}}})),Rui.applyIf(Rui.ui.grid.LColumnModel.prototype,{showStaticColumn:!1,getBasicColumnInfo:function(){var e=!(this.columnList=[]);this.freezeIndex=-1,this.freezeColumnId=this.gridView.columnModel.freezeColumnId;for(var t={},i=this.gridView.columnModel.columns,l=0,o=0,n=i.length;l<n;l++){var d=null;Rui.isEmpty(i[l])||("number"==(d=i[l]instanceof Rui.ui.grid.LColumn?i[l]:new Rui.ui.grid.LColumn(i[l])).type&&null==d.defaultValue&&(d.defaultValue=0),d.renderer&&Rui.ui.grid.LColumnModel.rendererMapper[d.renderer]&&(d.renderer=Rui.ui.grid.LColumnModel.rendererMapper[d.renderer]),this.freezeColumnId==d.id&&(this.freezeIndex=o),!0!==d.hidden&&o++,(t[d.id]=d).groupId&&t[d.groupId]&&t[d.groupId].setColumnType("group"),d.setColumnModel(this),d.sortable||(d.sortable=this.defaultSortable),d.width||(d.width=this.defaultWidth),this.columnList.push(d),!0!==d.hidden&&this.showColumnList.push(d),this.columnMap[d.getId()]=d,this.columnIndex[d]=l,d.field&&(this.columnField[d.field]=d),e||!d.vMerge&&!d.hMerge||(e=!0))}return delete t,this.merged=e,this.columnList},createExcelColumnModel:function(e){var t,i,l;e=e||!1,i=(t=this.isMultiheader()?this.getMultiheaderAllColumns():this.columnList).length;for(var o=[],n=0;n<i;n++)l=t[n],0==e&&(l instanceof Rui.ui.grid.LSelectionColumn||l instanceof Rui.ui.grid.LStateColumn||l instanceof Rui.ui.grid.LNumberColumn)||(Rui.ui.grid.LEditButtonColumn&&l instanceof Rui.ui.grid.LEditButtonColumn&&(l.isCustomRender=!0),o.push(l.clone()));return!Rui.isUndefined(this.groupMerge)&&this.groupMerge?new Rui.ui.grid.LColumnModel({groupMerge:this.groupMerge,columns:o,gridView:this.gridView}):new Rui.ui.grid.LColumnModel({columns:o,gridView:this.gridView})}}),Rui.ui.grid.LColumnModel.prototype.oldSetCellConfig||(Rui.ui.grid.LColumnModel.prototype.oldSetCellConfig=Rui.ui.grid.LColumnModel.prototype.setCellConfig,Rui.ui.grid.LColumnModel.prototype.setCellConfig=function(e,t,i,l){!0!==this.isExcel&&this.oldSetCellConfig.call(this,e,t,i,l)}),Rui.ui.grid.LBufferGridView.prototype.oldGetRenderDummyCell||(Rui.ui.grid.LBufferGridView.prototype.oldGetRenderDummyCell=Rui.ui.grid.LBufferGridView.prototype.getRenderDummyCell,Rui.ui.grid.LBufferGridView.prototype.getRenderDummyCell=function(e){return!0!==this.isExcel?this.oldGetRenderDummyCell.call(this,e):""}),Rui.applyObject(Rui.ui.grid.LBufferGridView.prototype,{isTotalRow:!1,getVisibleRowCount:function(e,t){if(this.isTotalRow)return this.visibleRowCount=this.dataSet.getCount(),this.visibleRowCount;var i=this._getVisibleRowCount(t);return i<1?0:!0===e?Math.floor(i):Math.ceil(i)},createTemplateForExcel:function(){var e=this.templates||{};e.master||(e.master=new Rui.LTemplate('<div class="L-grid-header" style="{hstyle}">','<div class="L-grid-header-offset" style="{ostyle}">{header}</div>','<div class="L-grid-header-tool L-hide-display">▼</div>',"</div>",'<div class="L-grid-scroller" style="{sstyle}">','<div class="L-grid-body L-grid-col-line" style="{bstyle}"></div><a class="L-grid-focus" tabIndex="-1" style="position:absolute;"></a>',"</div>",'<div class="L-grid-resize-proxy">&#160;</div>','<div class="L-grid-dd-proxy"><div>&#160;</div></div>','<div class="L-grid-dd-target">&#160;</div>')),e.header||(e.header=new Rui.LTemplate("{hrow2}")),e.hrow||(e.hrow=new Rui.LTemplate("<tr>{hcells}</tr>")),e.hcell||(e.hcell=new Rui.LTemplate('<td style="background-color:#C0C0C0;" colspan="{colSpan}" rowSpan="{rowSpan}">','<div  style="{istyle}">','<a><div style="text-align:center;">{value}</div></a>',"</div>","</td>")),e.hcellLabel||(e.hcellLabel=new Rui.LTemplate('<td colspan="{colSpan}" rowSpan="{rowSpan}">','<div  style="{istyle}">','<a><div style="text-align:center;">{value}</div></a>',"</div>","</td>")),e.body||(e.body=new Rui.LTemplate('<table border="1" cellspacing="0" cellpadding="0" style="{tstyle2}">{rows2}</table>')),e.row||(e.row=new Rui.LTemplate("<tr>{rowBody}</tr>")),e.rowBody||(e.rowBody=new Rui.LTemplate("{cells}")),e.cell||(e.cell=new Rui.LTemplate('<td style="{style}" colspan="{colspan}" rowspan="{rowspan}">','{bcell}<div style="{istyle}">{value}</div>',"</td>")),this.templates=e}}),Rui.applyIf(Rui.ui.grid.LGridPanel.prototype,{showExcelDialog:!0,saveExcel:function(e,p){var h=this.getView();h.showLoadingMessage(),p=p||{};var t=new Rui.LTemplate('<style type="text/css"> ',"table { margin:0; padding:0; border-top: 1px solid black; border-left: 1px solid black; border-width: thin; } ","</style>");p.showStaticColumn=Rui.isUndefined(p.showStaticColumn)?p.showStaticColumn:!!this.columnModel.multiheaderHtml,p=Rui.applyIf(p,{columnModel:this.columnModel.createExcelColumnModel(p.showStaticColumn),styles:t.apply(),url:Rui.getConfig().getFirst("$.ext.grid.excelDownLoadUrl")}),Rui.isEmpty(e)&&(e=(new Date).format("%Y%m%d")+".xls");function i(e,n){p.excelType=e;var t="";if(!Rui.isUndefined(p.columnModel.gridView)){var i=p.columnModel.gridView.plugins;if(i)for(var l=0,o=i.length;l<o;l++)i[l].useExcel=!0,i[l].initPlugin(i[l].gridView),i[l].getRenderTotal&&(t=i[l].getRenderTotal()||{}),i[l].useExcel=!1,i[l].initPlugin(i[l].gridView),i[l].updatePlugin({})}p.columnModel.isExcel=!0;var d=new Rui.ui.grid.LSelectionModel,r=new Rui.ui.grid.LGridPanel({id:"excel_"+Rui.id(),columnModel:p.columnModel,selectionModel:d,height:1e3,isExcel:!0,view:new Rui.ui.grid.LGridView({dataSet:this.dataSet,selectionModel:d,columnModel:p.columnModel,hiddenColumnRender:!0,makeDummyCell:!1,isTotalRow:!0,isExcel:!0,excelSummary:t}),dataSet:this.dataSet});d.init(r),p.columnModel.bindEvent(r);var u=r.getView();u.gridPanel=r;var a=u.templates||{};a.master=new Rui.LTemplate('<table border="1" cellspacing="0" cellpadding="0" >',"{header}","{body}","</table>"),a.header=new Rui.LTemplate("{hrow2}"),a.hcell=new Rui.LTemplate('<td class="L-grid-header-cell L-grid-cell L-grid-cell-{id} {first_last} {hidden} {sortable} {css}" style="{style};background-color:#C0C0C0;" colspan="{colSpan}" rowSpan="{rowSpan}">','<div class="L-grid-header-inner L-grid-header-{id}" style="{istyle}">','<a class="L-grid-header-btn" >{value}</a>',"</div>","</td>"),a.hcellLabel=new Rui.LTemplate('<td style="background-color:#C0C0C0;" colspan="{colSpan}" rowSpan="{rowSpan}">','<div style="text-align:center;">',"{value}","</div>","</td>"),a.body=new Rui.LTemplate("{rows2}"),u.templates=a;var s=new Rui.LTemplate('<form name="LExcelDataForm" method="post" action="{url}" >','<div id="L-hidden-grid"></div>','<input type="text" id="LFileName" name="LFileName">','<input type="text" id="LExcelType" name="LExcelType" value="{excelType}">','<textarea id="LExcelData" name="LExcelData" rows="20" cols="80"></textarea>',"</div>").apply({url:p.url,excelType:"html"!=p.excelType?r.excelType||"xml":"html"});Rui.ui.grid.LGridPanel.excelFrame||((c=document.createElement("iframe")).style.width="100%",c.style.height="300px",c.id="L-excel-container",c.style.display="none",document.body.appendChild(c),c.src="about:blank",Rui.ui.grid.LGridPanel.excelFrame=c);var c=Rui.ui.grid.LGridPanel.excelFrame,m=this,g=setInterval(function(){var e,t,i,l,o=c.contentWindow.document.body?c.contentWindow.document.body:c.contentWindow.document.documentElement;o&&(clearInterval(g),o.innerHTML=s,c.contentWindow.document,e=c.contentWindow.document,m.resetEditButtonColumn(p),t=e.getElementById("LExcelData"),i=e.getElementById("LFileName"),l="","xml"==p.excelType?(l=m.getXmlForExcel(u,p),t.value=l):"json"==p.excelType?(l=m.getJsonForExcel(u,p),t.value=l):(l=m.getHtmlForExcel(u,p),t.value=p.styles+" "+l),i.value=n,r.destroy(),e.LExcelDataForm.submit(),t.value="",i.value="",h.hideLoadingMessage(),p.columnModel.bindEvent(m))},500)}var l=Rui.getMessageManager(),o="<p>"+l.get("$.base.msg131",[this.dataSet.getCount().format({thousandsSeparator:","})])+"<p/>";o+="<p>※ "+l.get("$.base.msg132")+"<p/>";Rui.browser.msie;5e3<this.dataSet.getCount()&&(o+="<p>"+l.get("$.base.msg133")+"<p/>");var n=this;this.showExcelDialog&&!this.excelDialog?(this.excelDialog=new Rui.ui.LDialog({id:Rui.id(),width:300,visible:!1,postmethod:"none",defaultCss:"L-excel-dialog",header:l.get("$.base.msg001"),body:o,buttons:[{text:l.get("$.base.msg134"),handler:function(){i.call(n,"html",this.fileName||e),this.submit()},isDefault:!0},{text:l.get("$.base.msg135"),handler:function(){i.call(n,n.excelType,this.fileName||e),this.submit()}},{text:l.get("$.base.msg124"),handler:function(){this.cancel()}}]}),this.excelDialog.render(document.body),this.excelDialog.fileName=e,this.excelDialog.on("hide",function(){h.hideLoadingMessage()})):this.showExcelDialog&&(this.excelDialog.fileName=e,this.excelDialog.setBody(o)),this.showExcelDialog?this.excelDialog.show():i.call(this,n.excelType,e)},resetEditButtonColumn:function(e){for(var t=0,i=e.columnModel.columns.length;t<i;t++)Rui.ui.grid.LEditButtonColumn&&null!=e.columnModel.columns[t].editor&&e.columnModel.columns[t].editor instanceof Rui.ui.grid.LEditButtonColumn?e.columnModel.columns[t].editor.isCustomRender=!1:Rui.ui.grid.LEditButtonColumn&&e.columnModel.columns[t]instanceof Rui.ui.grid.LEditButtonColumn&&(e.columnModel.columns[t].isCustomRender=!1)},getHtmlForExcel:function(e,t){e.createTemplateForExcel();var i=e.getRenderHeader(),l=e.getRenderBody();l+=e.excelSummary;var o=e.columnModel.getTotalWidth(!0),n=o+e.scrollBarWidth;return e.templates.master.apply({header:i,body:l,ostyle:"width:"+n+"px",bstyle:"width:"+o+"px"})},getXmlForExcel:function(e,t){for(var i=e.columnModel,l=e.dataSet,o=i.getColumnCount(!0),n=h.createDocument("table"),d=n.firstChild,r=h.createChild(d,"row"),u=0;u<o;u++){var a=i.getColumnAt(u,!0),s=h.createChild(r,a.id);h.createTextValue(s,a.label)}for(var c=0,m=l.getCount();c<m;c++)if(!t.markedOnly||l.isMarked(c)){r=h.createChild(d,"row");for(u=0;u<o;u++){var a=i.getColumnAt(u,!0),s=h.createChild(r,a.id),g=l.getAt(c),p=e.getRenderCellValue({css:[]},g,a,c,u);null==p&&(p=""),!0===i.skipTags&&p&&"string"==typeof p&&(p=Rui.util.LString.skipTags(p)),h.createTextValue(s,p?p+"":"")}}return h.serialize(n)},getJsonForExcel:function(e,t){for(var i=e.columnModel,l=e.dataSet,o=i.getBasicColumnModel(),n=i.getColumnCount(!0),d={metaData:{fields:[]},records:[]},r=0,u=n;r<u;r++){var a=i.getColumnAt(r,!0),s={};s.id=a.id,s.field=a.getField(),s.label=a.getLabel(),s.width=a.getWidth(),s.align=a.align,s.type=a.field?l.getFieldById(a.field).type:"string",s.columnType=a.columnType,s.groupId=a.groupId,a.groupId&&(s.groupLabel=o.getColumnById(a.groupId).label),d.metaData.fields.push(s)}if(i.multiheaderInfos&&0<i.multiheaderInfos.length){for(var c={colCount:i.multiheaderInfos[0].colCount,colInfos:i.multiheaderInfos[0].colInfos,rowCount:i.multiheaderInfos[0].rowCount,columns:[]},r=0,u=i.multiheaderInfos[0].columns.length;r<u;r++)c.columns.push({id:i.multiheaderInfos[0].columns[r].id,groupId:i.multiheaderInfos[0].columns[r].groupId,label:i.multiheaderInfos[0].columns[r].label});c.dataColumns=[];for(r=0,u=i.multiheaderInfos[0].dataColumns.length;r<u;r++)c.dataColumns.push({id:i.multiheaderInfos[0].dataColumns[r].id,groupId:i.multiheaderInfos[0].dataColumns[r].groupId,label:i.multiheaderInfos[0].dataColumns[r].label});d.metaData.multiheaderInfos=c}for(var m=[],g=0,u=l.getCount();g<u;g++)if(!t.markedOnly||l.isMarked(g)){for(var p=[],r=0;r<n;r++){var a=i.getColumnAt(r,!0),h=l.getAt(g),y=e.getRenderCellValue({css:[]},h,a,g,r);null==y&&(y=""),!0===i.skipTags&&y&&"string"==typeof y&&(y=Rui.util.LString.skipTags(y)),p.push(y)}m.push(p)}return d.records=m,Rui.util.LJson.encode(d)}})}();