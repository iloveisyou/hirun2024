/*
 * @(#) LPager-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.ui.LPager=function(e){var t=e||{};(t=Rui.applyIf(t,Rui.getConfig().getFirst("$.ext.pager.defaultProperties"))).gridPanel&&(t.gridView=t.gridPanel.getView(),t.dataSet=t.gridView.getDataSet()),Rui.applyObject(this,t,!0),this.createEvent("beforeChange"),this.createEvent("changed"),Rui.ui.LPager.superclass.constructor.call(this)},Rui.extend(Rui.ui.LPager,Rui.ui.LUIComponent,{otype:"Rui.ui.LPager",pageNumber:1,pageSize:10,pageGroupSize:10,useDivider:!1,totalCount:0,pageCount:0,pageGroupCount:0,startPageNumber:1,pageGroupNumber:1,itemRenderer:null,itemDividerText:"",firstPageText:"",prevPageGroupText:"",prevPageText:"&nbsp",nextPageText:"&nbsp",nextPageGroupText:"",lastPageText:"",width:null,height:24,dataSet:null,showPageCount:!1,pageNumberFieldName:"pageNumber",pageSizeFieldName:"pageSize",viewPageStartRowIndexFieldName:"startRowIndex",sortFieldName:"sortField",sortDirFieldName:"sortDir",sortQueryFieldName:"sortQuery",gridView:null,gridPanel:null,addingGridFooter:!0,loadDataSetByPager:!1,isFirstLoading:!0,disableDbClick:!0,disableDbClickInterval:500,pagerNumberRe:new RegExp("L-pager-number-([^\\s]+)",""),CLASS_PAGER:"L-pager",CLASS_PAGER_WRAP:"L-pager-wrap",CLASS_PAGER_SELECTED:"L-pager-selected",CLASS_PAGER_FIRST:"L-pager-first",CLASS_PAGER_FIRST_WRAP:"L-pager-first-wrap",CLASS_PAGER_PREV_GROUP:"L-pager-prev-group",CLASS_PAGER_PREV_GROUP_WRAP:"L-pager-prev-group-wrap",CLASS_PAGER_PREV_WRAP:"L-pager-prev-wrap",CLASS_PAGER_PREV:"L-pager-prev",CLASS_PAGER_NEXT:"L-pager-next",CLASS_PAGER_NEXT_WRAP:"L-pager-next-wrap",CLASS_PAGER_NEXT_GROUP:"L-pager-next-group",CLASS_PAGER_NEXT_GROUP_WRAP:"L-pager-next-group-wrap",CLASS_PAGER_LAST:"L-pager-last",CLASS_PAGER_LAST_WRAP:"L-pager-last-wrap",CLASS_PAGER_ITEMS:"L-pager-items",CLASS_PAGER_ITEMS_WRAP:"L-pager-items-wrap",CLASS_PAGER_ITEM:"L-pager-item",CLASS_PAGER_ITEM_WRAP:"L-pager-item-wrap",CLASS_PAGER_ITEM_DIVIDER:"L-pager-item-divider",CLASS_PAGER_ITEM_DIVIDER_WRAP:"L-pager-item-divider-wrap",CLASS_HIDE_VISIBILITY:"L-hide-visibility",computePage:function(e){null!=this.dataSet&&this.setTotalCount(this.dataSet.getTotalCount(),!1),this.pageNumber=e||this.pageNumber||1,this.pageCount=Math.floor(this.totalCount/this.pageSize)+1,this.totalCount%this.pageSize==0&&1<this.pageCount&&(this.pageCount=this.pageCount-1);var t=0;this.pageNumber%this.pageGroupSize==0&&(t=-1),this.startPageNumber=(Math.floor(this.pageNumber/this.pageGroupSize)+t)*this.pageGroupSize+1,this.pageGroupNumber=Math.floor(this.pageNumber/this.pageGroupSize)+1+t,this.pageGroupCount=Math.ceil(this.pageCount/this.pageGroupSize)},createTemplate:function(){var e=this.templates||{};e.master||(e.master=new Rui.LTemplate('<table border="0" cellpadding="0" cellspacing="0" class="'+this.CLASS_PAGER_WRAP+'">','<td align="center" class="'+this.CLASS_PAGER_FIRST_WRAP+'"><div class="'+this.CLASS_PAGER_FIRST+'">{firstPage}</div></td>','<td align="center" class="'+this.CLASS_PAGER_PREV_GROUP_WRAP+'"><div class="'+this.CLASS_PAGER_PREV_GROUP+'">{prevPageGroup}</div></td>',this.prevPageText?'<td align="center" class="'+this.CLASS_PAGER_PREV_WRAP+'"><div class="'+this.CLASS_PAGER_PREV+'">{prevPage}</div></td>':"",'<td align="center" class="'+this.CLASS_PAGER_ITEMS_WRAP+'"><div class="'+this.CLASS_PAGER_ITEMS+'">{items}</div></td>',this.nextPageText?'<td align="center" class="'+this.CLASS_PAGER_NEXT_WRAP+'"><div class="'+this.CLASS_PAGER_NEXT+'">{nextPage}</div></td>':"",'<td align="center" class="'+this.CLASS_PAGER_NEXT_GROUP_WRAP+'"><div class="'+this.CLASS_PAGER_NEXT_GROUP+'">{nextPageGroup}</div></td>','<td align="center" class="'+this.CLASS_PAGER_LAST_WRAP+'"><div class="'+this.CLASS_PAGER_LAST+'">{lastPage}</div></td>',"</table>")),e.items||(e.items=new Rui.LTemplate('<table border="0" cellspacing="0" cellpadding="0" class="'+this.CLASS_PAGER_ITEMS_WRAP+'"><tr>{items}</tr></table>')),e.itemDivider||(e.itemDivider=new Rui.LTemplate('<td align="center" class="'+this.CLASS_PAGER_ITEM_DIVIDER_WRAP+'"><div class="'+this.CLASS_PAGER_ITEM_DIVIDER+'">{divider}</div></td>')),e.item||(e.item=new Rui.LTemplate('<td align="center" class="'+this.CLASS_PAGER_ITEM_WRAP+' L-pager-number-{pageNumber}"><div class="'+this.CLASS_PAGER_ITEM+' {selected}"><a>{item}</a></div></td>')),this.templates=e},renderMaster:function(){this.el.html((this.templates||{}).master.apply({firstPage:this.firstPageText,prevPageGroup:this.prevPageGroupText,prevPage:this.prevPageText,items:"",nextPage:this.nextPageText,nextPageGroup:this.nextPageGroupText,lastPage:this.lastPageText})),this.el.addClass(this.CLASS_PAGER),this.el.addClass("L-fixed"),this.width&&this.el.setWidth(this.width)},renderItems:function(){for(var e=0,t="",i=0;i<this.pageGroupSize&&((e=i+this.startPageNumber)<=this.pageCount&&0<e);i++)e==this.pageNumber?(t+=this.getRenderItem(e,this.CLASS_PAGER_SELECTED),selected=!0):t+=this.getRenderItem(e),this.useDivider&&i<this.pageGroupSize-1&&e<this.pageCount&&(t+=this.getRenderItemDivider());this.itemsEl.html((this.templates||{}).items.apply({items:t})),this.selectedItemEl=this.itemsEl.select("div."+this.CLASS_PAGER_SELECTED,!0),this.initDisplay()},getRenderItemDivider:function(){return(this.templates||{}).itemDivider.apply({divider:this.itemDividerText})},getRenderItem:function(e,t){t=t||"";var i=e;return null!=this.itemRenderer&&(i=this.itemRenderer(e)),(this.templates||{}).item.apply({pageNumber:e,selected:t,item:i})},render:function(e){return this.gridView&&this.addingGridFooter&&(e=document.createElement("div")),this.createContainer(e),this.doRender(e),e&&this.appendTo(e),this.gridView&&(this.gridView.pagerMode=this.mode,(this.gridView.pager=this).gridView.pagerMode&&this.el.addClass("L-mode-"+this.gridView.pagerMode),this.gridView&&this.addingGridFooter&&(this.gridPanel.setFooter(e),this.gridPanel.unOn("widthResize",this.onWidthResize,this),this.gridPanel.on("widthResize",this.onWidthResize,this,!0))),this.renderEvent.fire(),this._rendered=!0,this.afterRender(e),this.el.dom},doRender:function(e){this.createTemplate(),this.initGridView(),this.initDataSet(!1),this.computePage(),this.renderMaster(),this.firstPageEl=this.el.select("div."+this.CLASS_PAGER_FIRST,!0),this.prevPageGroupEl=this.el.select("div."+this.CLASS_PAGER_PREV_GROUP,!0),this.prevPageEl=this.el.select("div."+this.CLASS_PAGER_PREV,!0),this.nextPageEl=this.el.select("div."+this.CLASS_PAGER_NEXT,!0),this.nextPageGroupEl=this.el.select("div."+this.CLASS_PAGER_NEXT_GROUP,!0),this.lastPageEl=this.el.select("div."+this.CLASS_PAGER_LAST,!0),this.itemsEl=this.getItemsEl(),this.renderItems(),this.firstPageEl.on("click",this.onFirstPage,this,!0),this.prevPageGroupEl.on("click",this.onPrevGroup,this,!0),this.prevPageText&&this.prevPageEl.on("click",this.onPrevPage,this,!0),this.nextPageText&&this.nextPageEl.on("click",this.onNextPage,this,!0),this.nextPageGroupEl.on("click",this.onNextGroup,this,!0),this.lastPageEl.on("click",this.onLastPage,this,!0),this.itemsEl.on("click",this.onItemsElClick,this,!0)},updateWidth:function(){this.el.setWidth(Rui.get(this.gridPanel.footer).getWidth())},onWidthResize:function(e){this.updateWidth()},goPage:function(e,t){return this.pageNumber!=e&&this.setPageNumber(e,t)},timerGoPage:function(t){this.pagerTask||(this.pagerTask=Rui.later(50,this,function(){var e=this.gridView.scroller.getStartRow();e++,this.getPageNumber()===e?this.cancelTimer():!1===this.goPage(e)&&this.gridView.scroller.setScrollTop(t.beforeScrollTop,!0)}))},isTimer:function(){return!!this.pagerTask},cancelTimer:function(){this.pagerTask&&(this.pagerTask.cancel(),delete this.pagerTask)},onFirstPage:function(e){this.moveFirstPage()},moveFirstPage:function(e){this._setPageNumber(1,e)},onPrevGroup:function(e){this.movePrevGroup()},movePrevGroup:function(){1!=this.startPageNumber&&this._setPageNumber(this.startPageNumber-1)},onPrevPage:function(e){this.movePrevPage()},movePrevPage:function(){1!=this.pageNumber&&this._setPageNumber(this.pageNumber-1)},onNextPage:function(e){this.moveNextPage()},moveNextPage:function(){this.pageNumber!=this.pageCount&&this._setPageNumber(this.pageNumber+1)},onNextGroup:function(e){this.moveNextGroup()},moveNextGroup:function(){var e;this.pageGroupNumber!=this.pageGroupCount&&(e=this.pageGroupNumber*this.pageGroupSize+1,this._setPageNumber(e))},onLastPage:function(e){this.moveLastPage()},moveLastPage:function(){this.pageNumber!=this.pageCount&&this._setPageNumber(this.pageCount)},onItemsElClick:function(e){var t,i=e.target,s=Rui.util.LDom.findParent(i,"td."+this.CLASS_PAGER_ITEM_WRAP,5);s&&(!s.className||(t=s.className.match(this.pagerNumberRe))&&t[1]&&this._setPageNumber(parseInt(t[1],10)))},_setPageNumber:function(e,t){this.gridView&&"scroll"==this.gridView.pagerMode?this.gridView.scroller.go(0<e?e-1:0):this.setPageNumber(e,t)},getItemsEl:function(){return this.el.select("div."+this.CLASS_PAGER_ITEMS,!0)},initSelectedItemEl:function(){this.selectedItemEl.removeClass(this.CLASS_PAGER_SELECTED),this.selectedItemEl=this.itemsEl.select("div."+this.CLASS_PAGER_ITEM).getAt(this.pageNumber-this.startPageNumber),this.selectedItemEl.addClass(this.CLASS_PAGER_SELECTED)},setPage:function(e){this.setPageNumber(e.pageNumber,!1),this.setPageSize(e.pageSize,!1),this.setPageGroupSize(e.pageGroupSize,!1),this.setTotalCount(e.totalCount,!1),this.renderItems()},getPageNumber:function(){return this.pageNumber},setPageNumber:function(e,t){if(this.pageNumber!=e){if(!1===this.fireEvent("beforeChange",{pageNumber:e}))return this.cancelTimer(),!1;var i=this.pageGroupNumber;if(this.pageNumber=e,this.computePage(),i==this.pageGroupNumber&&this.loadDataSetByPager)this.initSelectedItemEl();else if(this.renderItems(),this.disableDbClick){if(0==this.disableDbClick)return;this.onItemsElDisable();var s=this;this._timeout=setTimeout(function(){s.onItemsElEnable()},this.disableDbClickInterval)}return this.initVisible(),!Rui.isEmpty(t)&&1!=t||null==this.dataSet?this.fireEvent("changed",{pageNumber:this.pageNumber}):this.reloadDataSet(),!0}},onSortField:function(e){0<this.dataSet.getTotalCount()&&this.reloadDataSet()},reloadDataSet:function(){var e;null!=this.dataSet&&(this.loadDataSetByPager=!0,e=Rui.util.LObject.clone(this.dataSet.lastOptions.params),this.dataSet.lastOptions.params=Rui.merge(this.dataSet.lastOptions.params,this.getParams()),this.dataSet.load(this.dataSet.lastOptions),this.dataSet.lastOptions.params=Rui.util.LObject.clone(e))},getParams:function(e){var t,i={};return e=null==e||null==e?this.pageNumber:e,i[this.pageNumberFieldName]=e,i[this.viewPageStartRowIndexFieldName]=e*this.pageSize-(this.pageSize-1),i[this.pageSizeFieldName]=this.pageSize,null==this.gridView||(t=this.gridView.getLastSortInfo()).field&&(i[this.sortFieldName]=t.field||"",i[this.sortDirFieldName]=t.dir||"",i[this.sortQueryFieldName]="order by "+Rui.util.LString.camelToHungarian(t.field)+" "+t.dir,this.applyParamsFn&&(i=this.applyParamsFn(t,i))),i},initDisplay:function(){var e;this.initVisible(),this.showPageCount&&(e=1<this.pageCount?"pages":"page",this.lastPageEl.html(this.pageCount+e),this.firstPageEl.html("1page"))},initVisible:function(){this.firstPageEl.removeClass(this.CLASS_HIDE_VISIBILITY),this.prevPageGroupEl.removeClass(this.CLASS_HIDE_VISIBILITY),this.prevPageEl.removeClass(this.CLASS_HIDE_VISIBILITY),this.nextPageEl.removeClass(this.CLASS_HIDE_VISIBILITY),this.nextPageGroupEl.removeClass(this.CLASS_HIDE_VISIBILITY),this.lastPageEl.removeClass(this.CLASS_HIDE_VISIBILITY),1==this.pageCount?(this.firstPageEl.addClass(this.CLASS_HIDE_VISIBILITY),this.prevPageGroupEl.addClass(this.CLASS_HIDE_VISIBILITY),this.prevPageEl.addClass(this.CLASS_HIDE_VISIBILITY),this.nextPageEl.addClass(this.CLASS_HIDE_VISIBILITY),this.nextPageGroupEl.addClass(this.CLASS_HIDE_VISIBILITY),this.lastPageEl.addClass(this.CLASS_HIDE_VISIBILITY)):(1==this.pageNumber&&(this.firstPageEl.addClass(this.CLASS_HIDE_VISIBILITY),this.prevPageGroupEl.addClass(this.CLASS_HIDE_VISIBILITY),this.prevPageEl.addClass(this.CLASS_HIDE_VISIBILITY)),this.pageNumber==this.pageCount&&this.nextPageEl.addClass(this.CLASS_HIDE_VISIBILITY),1==this.pageGroupNumber&&(this.firstPageEl.addClass(this.CLASS_HIDE_VISIBILITY),this.prevPageGroupEl.addClass(this.CLASS_HIDE_VISIBILITY)),this.pageGroupNumber==this.pageGroupCount&&(this.nextPageGroupEl.addClass(this.CLASS_HIDE_VISIBILITY),this.lastPageEl.addClass(this.CLASS_HIDE_VISIBILITY)))},setPageSize:function(e,t){t=null==t||t,this.pageSize!=e&&(this.pageSize=e,t&&this.rerender())},setPageGroupSize:function(e,t){t=null==t||t,this.pageGroupSize!=e&&(this.pageGroupSize=e,t&&this.rerender())},setTotalCount:function(e,t){t=null==t||t,this.totalCount!=e&&(this.totalCount=e,t&&this.rerender())},onLoadDataSet:function(){this.rerender(!0),this.isFirstLoading=!1},onDataChanged:function(){this.rerender(!0)},rerender:function(e){this.computePage(),this.renderItems(),e&&!this.isFirstLoading&&(this.loadDataSetByPager?this.loadDataSetByPager=!1:this.moveFirstPage(!1)),this.fireEvent("changed",{pageNumber:this.pageNumber})},initDataSet:function(e){e=null==e||e,null!=this.dataSet&&(this.dataSet.unOn("load",this.onLoadDataSet,this),this.dataSet.on("load",this.onLoadDataSet,this,!0),this.dataSet.unOn("dataChanged",this.onDataChanged,this),this.dataSet.on("dataChanged",this.onDataChanged,this,!0),e&&this.rerender())},initGridView:function(){null!=this.gridView&&(this.gridView.isRemoteSort=!0,this.gridView.unOn("sortField",this.onSortField,this),this.gridView.on("sortField",this.onSortField,this,!0))},setDataSet:function(e){null!=e&&(this.dataSet=e,this.initDataSet())},onItemsElEnable:function(){for(var e=this.el.select(".L-pager-wrap"),t=0;t<e.length;t++)e.getAt(t).removeClass("L-pager-disable")},onItemsElDisable:function(){for(var e=this.el.select(".L-pager-wrap"),t=0;t<e.length;t++)e.getAt(t).addClass("L-pager-disable")}});