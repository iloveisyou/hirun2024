/*
 * @(#) rui_form-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.namespace("Rui.ui"),Rui.ui.LUIComponent=function(e){e=e||{},Rui.isDebugCR&&Rui.log("otype : "+this.otype+"\r\nconfig : "+Rui.dump(e),"create",this.otype||"LUIComponent"),this._events=this._events||{},this.initConfig=e,Rui.ui.LUIComponent.superclass.constructor.call(this),Rui.applyObject(this,e,!0),this.createEvent("disable"),this.createEvent("enable"),this.createEvent("show"),this.createEvent("hide"),this.createEvent("focus"),this.createEvent("blur"),this.renderEvent=this.createEvent("render",{isCE:!0}),this.createEvent("destroy"),this.createEvent("resize"),this.createEvent("move"),this.init(e),this.applyTo?(this.applyToMarkup(this.applyTo),delete this.applyTo):this.renderTo&&(this.render(this.renderTo),delete this.renderTo)},Rui.extend(Rui.ui.LUIComponent,Rui.util.LEventProvider,{otype:"Rui.ui.LUIComponent",disabled:!1,defaultClass:null,checkContainBlur:!0,init:function(e){this.initDefaultConfig(),e&&this.cfg.applyConfig(e,!0),this.initComponent(e),this.initEvents(),Rui.ui.LConfig.alreadySubscribed(this.renderEvent,this.cfg.fireQueue,this.cfg)||this.renderEvent.on(this.cfg.fireQueue,this.cfg,!0)},initDefaultConfig:function(){this.cfg=new Rui.ui.LConfig(this),this.cfg.addProperty("width",{handler:this._setWidth,value:this.width,validator:Rui.isNumber}),this.cfg.addProperty("height",{handler:this._setHeight,value:this.height,validator:Rui.isNumber}),this.cfg.addProperty("left",{handler:this._setLeft,validator:Rui.isNumber}),this.cfg.addProperty("top",{handler:this._setTop,validator:Rui.isNumber}),this.cfg.addProperty("disabled",{handler:this._setDisabled,value:!1,validator:Rui.isBoolean})},initComponent:function(e){},initEvents:function(){},applyToMarkup:function(e){if(this.el=Rui.get(e),!this.el)throw new Error(" Can't find the dom object while calling applyToMarkup method. : "+e);this.id||(this.id=this.el.id),this.render(this.el.dom.parentNode)},renderAt:function(e){this.applyToMarkup(e)},render:function(e){if(this.el||e||(e=document.body),e)this.createContainer(e),this.appendTo(e),this.doRender(e);else if(!Rui.util.LDom.inDocument(this.el.dom))return!1;if(this.dom=this.el.dom,this.defaultClass&&this.el.addClass(this.defaultClass),this._rendered=!0,this.renderEvent.fire(),this.plugins)for(var t=0,i=this.plugins.length;t<i;t++)this.plugins[t].initPlugin(this);this.afterRender(e)},createContainer:function(e){var t;return this.el||((t=this.createElement().cloneNode(!1)).id=Rui.useFixedId()?Rui.id(this.el,"LUIComp-"+(this.id||this.name||e.id)):Rui.id(),this.el=Rui.get(t),this.id=this.id||this.el.id),this.el},createElement:function(){return document.createElement("div")},appendTo:function(e){"string"==typeof e&&(e=document.getElementById(e)),e&&this.el&&this.el.dom&&(e=e.dom||e)!=this.el.dom.parentNode&&this._addToParent(e,this.el.dom)},_addToParent:function(e,t){e===document.body&&e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},doRender:function(e){},initPlugin:function(){if(this.plugins)for(var e=0,t=this.plugins.length;e<t;e++)this.plugins[e].initPlugin(this)},afterRender:function(e){this.el&&(this.checkContainBlur?(this.el.on("focus",this.onCheckFocus,this,!0,{system:!0}),this.el.on("blur",this.deferOnBlur,this,!0,{system:!0})):(this.el.on("focus",this.onFocus,this,!0,{system:!0}),this.el.on("blur",this.onBlur,this,!0,{system:!0})))},onCheckFocus:function(e){this.isFocus||(this.onFocus.call(this,e),1==this.checkContainBlur&&(Rui.util.LEvent.addListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur,this,!0),this.isFocus=!0))},reOnDeferOnBlur:function(){Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),Rui.util.LEvent.addListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur,this,!0)},deferOnBlur:function(e){Rui.util.LFunction.defer(this.checkBlur,10,this,[e])},checkBlur:function(e){if(1!=e.deferCancelBubble&&!0===this.isFocus){var t=e.target;if(this.el.isAncestor(t))e.deferCancelBubble=!0;else{if(!1===this.onCanBlur(e))return;Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.onBlur.call(this,e),this.isFocus=null}}},onCanBlur:function(e){},onFocus:function(e){!0!==this.isFocus&&(this.isFocus=!0,this.fireEvent("focus",e))},onBlur:function(e){this.isFocus=null,this.fireEvent("blur",e)},setVisibilityMode:function(e){this.el.setVisibilityMode(e)},_setDisabled:function(e,t,i){!1===t[0]?(this.disabled=!1,this.el&&this.el.removeClass("L-disabled"),this.fireEvent("enable")):(this.disabled=!0,this.el&&this.el.addClass("L-disabled"),this.fireEvent("disable"))},_setWidth:function(e,t,i){var s=t[0];s<0||(this.el&&this.el.setWidth(s),this.width=s)},_setHeight:function(e,t,i){var s=t[0];s<0||(this.el&&this.el.setHeight(s),this.height=s)},_setLeft:function(e,t,i){var s=t[0];this.el.setLeft(s)},_setTop:function(e,t,i){var s=t[0];this.el.setTop(s)},enable:function(){this.cfg.setProperty("disabled",!1)},disable:function(){this.cfg.setProperty("disabled",!0)},isDisable:function(){return this.cfg.getProperty("disabled")},isShow:function(){return this.el.isShow()},show:function(e){this.el.show(e),this.fireEvent("show")},hide:function(e){this.el.hide(e),this.fireEvent("hide")},focus:function(){this.el.focus()},blur:function(){this.el.blur()},getHeight:function(e){return this.el?this.el.getHeight(e):this.height},setHeight:function(e){this.cfg.setProperty("height",e)},getWidth:function(e){return this.el?this.el.getWidth(e):this.width},setWidth:function(e){this.cfg.setProperty("width",e)},getLeft:function(){return this.el.getLeft()},setLeft:function(e){this.cfg.setProperty("left",e)},getTop:function(){return this.el.getTop()},setTop:function(e){this.cfg.setProperty("top",e)},parent:function(e,t){return this.el.parent(e,t)},select:function(e,t){return this.el.select(e,t)},query:function(e,t){return this.el.query(e,t)},filter:function(e){return this.el.query(e)},getContainer:function(){return this.el},updateView:function(){this.enableMaskEl=null},availableHeight:function(e,t){this.el.availableHeight(e,t)},isRender:function(){return this._rendered},isRendered:function(){return this._rendered},destroy:function(){if(this.fireEvent("destroy"),this.plugins)for(var e=0,t=this.plugins.length;e<t;e++)this.plugins[e].destroy(this);this.renderEvent&&(this.renderEvent.unOnAll(),this.renderEvent=null),this.unOnAll(),this.el&&(this.el.unOnAll(),this.el.remove(),this.el=null),this.deferOnBlur&&Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.cfg&&(this.cfg.destroy(),this.cfg=null)},toString:function(){return this.otype+" "+(this.id||"Unknown")}}),function(){Rui.ui.LConfig=function(e){e&&this.init(e)};var i=Rui.util.LCustomEvent,n=Rui.ui.LConfig;n.prototype={owner:null,queueInProgress:!1,config:null,initialConfig:null,eventQueue:null,configChangedEvent:null,init:function(e){this.owner=e,this.configChangedEvent=this.createEvent("configChanged",{isCE:!0}),this.configChangedEvent.signature=i.LIST,this.queueInProgress=!1,this.config={},this.initialConfig={},this.eventQueue=[]},checkBoolean:function(e){return"boolean"==typeof e},checkNumber:function(e){return!isNaN(e)},fireEvent:function(e,t){var i=this.config[e];i&&i.event&&i.event.fire(t)},addProperty:function(e,t){e=e.toLowerCase(),(this.config[e]=t).event=this.createEvent(e,{scope:this.owner,isCE:!0}),t.event.signature=i.LIST,t.key=e,t.handler&&t.event.on(t.handler,this.owner),this.setProperty(e,t.value,!0),t.suppressEvent||this.queueProperty(e,t.value)},getConfig:function(){var e,t,i={},s=this.config;for(e in s)Rui.hasOwnProperty(s,e)&&(t=s[e])&&t.event&&(i[e]=t.value);return i},getProperty:function(e){var t=this.config[e.toLowerCase()];return t&&t.event?t.value:void 0},resetProperty:function(e){e=e.toLowerCase();var t=this.config[e];return!(!t||!t.event)&&(this.initialConfig[e]&&!Rui.isUndefined(this.initialConfig[e])?(this.setProperty(e,this.initialConfig[e]),!0):void 0)},setProperty:function(e,t,i){var s;return e=e.toLowerCase(),this.queueInProgress&&!i?(this.queueProperty(e,t),!0):!(!(s=this.config[e])||!s.event)&&(!(s.validator&&!s.validator(t))&&(s.oldValue=s.value,s.value=t,i||(this.fireEvent(e,t),this.configChangedEvent.fire([e,t])),!0))},queueProperty:function(e,t){e=e.toLowerCase();var i,s,a,n,l,r,o,h,u,d,c,E,f,g=this.config[e],p=!1;if(g&&g.event){if(!Rui.isUndefined(t)&&g.validator&&!g.validator(t))return!1;for(Rui.isUndefined(t)?t=g.value:g.value=t,p=!1,i=this.eventQueue.length,c=0;c<i;c++)if((s=this.eventQueue[c])&&(a=s[0],n=s[1],a==e)){this.eventQueue[c]=null,this.eventQueue.push([e,Rui.isUndefined(t)?n:t]),p=!0;break}if(p||Rui.isUndefined(t)||this.eventQueue.push([e,t]),g.supercedes)for(l=g.supercedes.length,E=0;E<l;E++)for(r=g.supercedes[E],o=this.eventQueue.length,f=0;f<o;f++)if((h=this.eventQueue[f])&&(u=h[0],d=h[1],u==r.toLowerCase())){this.eventQueue.push([u,d]),this.eventQueue[f]=null;break}return!0}return!1},refireEvent:function(e){e=e.toLowerCase();var t=this.config[e];t&&t.event&&!Rui.isUndefined(t.value)&&(this.queueInProgress?this.queueProperty(e):this.fireEvent(e,t.value))},applyConfig:function(e,t){var i,s;if(t){for(i in s={},e)Rui.hasOwnProperty(e,i)&&(s[i.toLowerCase()]=e[i]);this.initialConfig=s}for(i in e)Rui.hasOwnProperty(e,i)&&this.queueProperty(i,e[i])},fireQueue:function(){var e,t,i,s;for(this.queueInProgress=!0,e=0;e<this.eventQueue.length;e++)(t=this.eventQueue[e])&&(i=t[0],s=t[1],this.config[i].value=s,this.eventQueue[e]=null,this.fireEvent(i,s));this.queueInProgress=!1,this.eventQueue=[]},subscribeToConfigEvent:function(e,t,i,s){var a=this.config[e.toLowerCase()];return!(!a||!a.event)&&(n.alreadySubscribed(a.event,t,i)||a.event.on(t,i,s),!0)},unsubscribeFromConfigEvent:function(e,t,i){var s=this.config[e.toLowerCase()];return!(!s||!s.event)&&s.event.unOn(t,i)},toString:function(){var e="Config";return this.owner&&(e+=" ["+this.owner.toString()+"]"),e},destroy:function(){var e,t,i=this.config;for(e in i)Rui.hasOwnProperty(i,e)&&((t=i[e]).event.unOnAll(),t.event=null);this.configChangedEvent.unOnAll(),this.configChangedEvent=null,this.owner=null,this.config=null,this.initialConfig=null,this.eventQueue=null}},n.alreadySubscribed=function(e,t,i){var s,a,n=e.subscribers.length;if(0<n){a=n-1;do{if((s=e.subscribers[a])&&s.obj==i&&s.fn==t)return!0}while(a--)}return!1},Rui.applyPrototype(n,Rui.util.LEventProvider)}(),Rui.namespace("Rui.ui.form"),Rui.ui.form.LField=function(e){Rui.ui.form.LField.superclass.constructor.call(this,e),this.createEvent("changed"),this.createEvent("valid"),this.createEvent("invalid"),this.createEvent("specialkey")},Rui.extend(Rui.ui.form.LField,Rui.ui.LUIComponent,{otype:"Rui.ui.form.LField",fieldObject:!0,name:null,borderSize:1,checkContainBlur:!1,initDefaultConfig:function(){Rui.ui.form.LField.superclass.initDefaultConfig.call(this),this.cfg.addProperty("editable",{handler:this._setEditable,value:this.editable,validator:Rui.isBoolean}),this.cfg.addProperty("defaultValue",{handler:this._setDefaultValue,value:this.value})},getContentWidth:function(){var e=this.el.getWidth(!0);return e<1?this.width-2*this.borderSize:e},getContentHeight:function(){var e=this.el.getHeight(!0);return e<1?this.height-2*this.borderSize:e},setValue:function(e){this.el.setValue(e)},getValue:function(){return this.el.getValue()},valid:function(){return this.el.valid(),this.fireEvent("valid"),this},invalid:function(e){return this.el.invalid(e),this.fireEvent("invalid",e),this},setName:function(e){this.name=e},getName:function(){return this.name},setEditable:function(e){this.cfg.setProperty("editable",!0!==this.disabled&&e)},_setEditable:function(e,t,i){this.editable=!!t[0]},_setDefaultValue:function(e,t,i){this.setValue(t[0])},onFireKey:function(e){Rui.util.LEvent.isSpecialKey(e)&&this.fireEvent("specialkey",e)},toString:function(){return(this.otype||"Rui.ui.form.LField ")+" "+this.id}}),Rui.namespace("Rui.ui.form"),function(){var Dom=Rui.util.LDom,KL=Rui.util.LKey,ST=Rui.util.LString,Ev=Rui.util.LEvent;Rui.ui.form.LTextBox=function(e){e=Rui.applyIf(e||{},Rui.getConfig().getFirst("$.ext.textBox.defaultProperties"));var t=Rui.getConfig().getFirst("$.ext.textBox.dataSet");t&&!e.displayField&&t.displayField&&(e.displayField=t.displayField),this.overflowCSS=Rui.browser.opera?"overflow":"overflowY",this.useDataSet=!0===e.autoComplete||this.useDataSet,!0===this.useDataSet&&e.dataSet&&(this.dataSet=e.dataSet,this.initDataSet(),this.isLoad=!0),this.mask=e.mask||this.mask||null,this.mask&&this.initMask(),Rui.ui.form.LTextBox.superclass.constructor.call(this,e),this.mask&&this.initMaskEvent(),Rui.mobile.ios&&(this.mask=null),!0===this.useDataSet&&Rui.isEmpty(this.dataSet)&&Rui.isEmpty(e.dataSet)&&this.createDataSet(),!0===this.useDataSet&&(this.dataSet&&this.initDataSet(),e.url&&this.dataSet.load({url:e.url,params:e.params}))},Rui.ui.form.LTextBox.ROW_RE=new RegExp("L-row-r([^\\s]+)",""),Rui.extend(Rui.ui.form.LTextBox,Rui.ui.form.LField,{otype:"Rui.ui.form.LTextBox",CSS_BASE:"L-textbox",CSS_PLACEHOLDER:"L-placeholder",displayField:"text",type:"text",editable:!0,width:100,height:-1,defaultValue:"",listWidth:-1,dataSetClassName:"Rui.data.LJsonDataSet",filterMode:"local",localDelayTime:30,remoteDelayTime:250,filterUrl:"",useDataSet:!1,autoComplete:!1,selectedIndex:!1,firstChangedEvent:!0,dataSet:null,marginTop:0,marginLeft:0,includeChars:null,inputType:null,currFocus:!1,imeMode:"auto",emptyText:"Choose a state",useEmptyText:!1,emptyValue:"",mask:null,maskValue:!1,definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},maskPlaceholder:"_",placeholder:null,invalidBlur:!1,filterFn:null,optionDivEl:null,expandCount:0,stringFromChatCode:!1,listRenderer:null,dataSetId:null,listPosition:"auto",rowRe:new RegExp("L-row-r([^\\s]+)",""),ignoreEvent:!0,initEvents:function(){Rui.ui.form.LTextBox.superclass.initEvents.call(this),this.createEvent("keydown"),this.createEvent("keyup"),this.createEvent("keypress"),this.createEvent("cut"),this.createEvent("copy"),this.createEvent("paste"),this.createEvent("expand"),this.createEvent("collapse")},initDefaultConfig:function(){Rui.ui.form.LTextBox.superclass.initDefaultConfig.call(this),this.cfg.addProperty("listWidth",{handler:this._setListWidth,value:this.listWidth,validator:Rui.isNumber}),this.cfg.addProperty("useEmptyText",{handler:this._setAddEmptyText,value:this.useEmptyText,validator:Rui.isBoolean})},createContainer:function(e){if(this.el){this.oldDom=this.el.dom,"INPUT"==this.el.dom.tagName&&(this.id=this.id||this.el.id,this.name=this.name||this.oldDom.name,this.el.parent(),this.el=Rui.get(this.createElement().cloneNode(!1)),this.el.dom.id=this.id,Dom.replaceChild(this.el.dom,this.oldDom),this.el.appendChild(this.oldDom),Dom.removeNode(this.oldDom)),this.attrs=this.attrs||{};var t=this.oldDom.attributes;if(void 0!==t)if(Rui.browser.msie67)for(var i=0,s=t.length;i<s;i++){var a=t[i].value;a&&"null"!==a&&""!==a&&(this.attrs[t[i].name]=Rui.util.LObject.parseObject(a))}else for(i=0,s=t.length;i<s;i++)this.attrs[t[i].name]=t[i].value;delete this.attrs.id,delete this.oldDom}Rui.ui.form.LTextBox.superclass.createContainer.call(this,e)},doRender:function(){this.createTemplate(this.el),(this.inputEl.dom.instance=this).inputEl.addClass("L-instance"),Rui.useAccessibility()&&this.el.setAttribute("role","textbox")},createTemplate:function(e){var t=Rui.get(e);t.addClass(this.CSS_BASE),t.addClass("L-fixed"),t.addClass("L-form-field");var i="";for(var s in this.attrs)i+=" "+s+'="'+this.attrs[s]+'"';var a="";this.autoComplete&&(a=' autocomplete="off"');var n=Rui.createElements('<input type="'+this.type+'" '+i+a+">").getAt(0).dom;return n.id=Rui.useFixedId()?Rui.id(this.el,"LTextBox-"+this.id):Rui.id(),n.name=this.name||n.name||this.id,t.appendChild(n),this.inputEl=Rui.get(n),this.inputEl.addClass("L-display-field"),t},afterRender:function(e){Rui.ui.form.LTextBox.superclass.afterRender.call(this,e);var t=this.getDisplayEl();t.on("click",function(e){1!=this.editable&&this.expand()},this,!0),null!=this.inputType&&t.on("keydown",this.onFilterKey,this,!0),this.inputType!=ST.PATTERN_TYPE_KOREAN&&(null!=this.includeChars&&(this.imeMode="disabled"),null!=this.inputType&&(this.imeMode="disabled")),"auto"!==this.imeMode&&t.setStyle("ime-mode",this.imeMode),!0===this.useDataSet&&!0===this.autoComplete&&t.on("keyup",this.onKeyAutoComplete,this,!0),Rui.browser.webkit||Rui.browser.msie||Rui.browser.chrome?t.on("keydown",this.onSpecialkeyEvent,this,!0):t.on("keypress",this.onSpecialkeyEvent,this,!0),t.on("keydown",this.onKeydown,this,!0),t.on("keyup",this.onKeyup,this,!0),t.on("keypress",this.onKeypress,this,!0);var i=Rui.browser.msie||Rui.browser.chrome||Rui.browser.safari&&3==Rui.browser.version?"keydown":"keypress";t.on(i,this.onFireKey,this,!0),this.createOptionDiv(),this.optionDivEl&&(!0===this.useDataSet&&Rui.isEmpty(this.dataSet)?this.createDataSet():this.doLoadDataSet()),this.initFocus(),"text"!=this.type&&this.initType(),this.focusDefaultValue(),this.setPlaceholder()},createDataSet:function(){this.dataSet||(this.dataSet=new(eval(this.dataSetClassName))({id:this.dataSetId||this.id+"DataSet",fields:[{id:this.displayField}],focusFirstRow:!1}))},initType:function(){"url"==this.type?(this.placeholder="http://",this.inputEl.on("focus",function(){""==this.inputEl.getValue()&&this.inputEl.setValue(this.placeholder)},this,!0)):"email"==this.type&&(this.placeholder=Rui.getMessageManager().get("$.base.msg111"))},initDataSet:function(){this.doSyncDataSet()},doSyncDataSet:function(){!0!==this.isBindEvent&&(this.dataSet.on("beforeLoad",this.onBeforeLoadDataSet,this,!0,{system:!0}),this.dataSet.on("load",this.onLoadDataSet,this,!0,{system:!0}),this.dataSet.on("dataChanged",this.onDataChangedDataSet,this,!0,{system:!0}),this.dataSet.on("rowPosChanged",this.onRowPosChangedDataSet,this,!0,{system:!0}),this.dataSet.on("add",this.onAddData,this,!0,{system:!0}),this.dataSet.on("update",this.onUpdateData,this,!0,{system:!0}),this.dataSet.on("remove",this.onRemoveData,this,!0,{system:!0}),this.dataSet.on("undo",this.onUndoData,this,!0,{system:!0}),this.isBindEvent=!0)},doUnSyncDataSet:function(){this.dataSet.unOn("beforeLoad",this.onBeforeLoadDataSet,this),this.dataSet.unOn("load",this.onLoadDataSet,this),this.dataSet.unOn("dataChanged",this.onDataChangedDataSet,this),this.dataSet.unOn("rowPosChanged",this.onRowPosChangedDataSet,this),this.dataSet.unOn("add",this.onAddData,this),this.dataSet.unOn("update",this.onUpdateData,this),this.dataSet.unOn("remove",this.onRemoveData,this),this.dataSet.unOn("undo",this.onUndoData,this),this.isBindEvent=!1},initFocus:function(){var e=this.getDisplayEl();e&&(e.on("focus",this.onCheckFocus,this,!0),e.on("blur",this.checkBlur,this,!0))},setPlaceholder:function(){var e,t;this.placeholder&&(e=this.getDisplayEl(),Rui.browser.msie6789?(t=e.getValue(),this.isFocus&&!0===this.editable?(this.placeholder&&t===this.placeholder&&e.setValue(""),e.removeClass(this.CSS_PLACEHOLDER)):!t||t.length<1||t===this.placeholder?(e.setValue(this.placeholder),e.addClass(this.CSS_PLACEHOLDER)):this.placeholder!==t&&e.removeClass(this.CSS_PLACEHOLDER)):this.getDisplayEl().dom.placeholder=this.placeholder)},onFilterKey:function(e){if(null!=this.inputType){var t=KL.KEY;if(e.keyCode==t.SPACE||!Ev.isSpecialKey(e)&&e.keyCode!=t.BACK_SPACE&&e.keyCode!=t.DELETE){var i=e.charCode||e.which||e.keyCode;if(229!=i||this.inputType!=ST.PATTERN_TYPE_STRING&&this.inputType!=ST.PATTERN_TYPE_NUMSTRING){var s=!1===this.stringFromChatCode?this.fromCharCode(i):String.fromCharCode(i),a=this.inputType;if(null==this.includeChars)if(this.inputType==ST.PATTERN_TYPE_KOREAN){if(!ST.isHangul(s))return void Ev.preventDefault(e)}else if(!a.test(s))return void Ev.preventDefault(e);this.ctrlKeypress}else Ev.preventDefault(e)}}},fromCharCode:function(e){96<=e&&e<=105&&(e-=48);var t=String.fromCharCode(e);switch(e){case 105:break;case 106:t="*";break;case 107:t="+";break;case 109:t="-";break;case 110:case 190:t=".";break;case 111:t="/";break;case 188:t=",";break;case 191:t="/"}return t},onFocus:function(e){Rui.ui.form.LTextBox.superclass.onFocus.call(this,e),this.lastValue=this.getValue(),this.lastDisplayValue=this.getDisplayValue(),this.setPlaceholder(),this.currFocus=!0,this.doFocus(e)},doFocus:function(e){},setSelectionRange:function(e,t){this.currFocus&&Dom.setSelectionRange(this.getDisplayEl().dom,e,t)},checkBlur:function(e){if(this.isFocus&&(!this.gridPanel||1!=e.deferCancelBubble)){var t=e.target;if((!this.iconEl||this.iconEl.dom!=t)&&this.el.dom!==t){var i=!1;if(Rui.isUndefined(this.optionDivEl)?this.el.isAncestor(t)||(i=!0):0==this.el.isAncestor(t)&&(this.optionDivEl&&(this.optionDivEl.dom===t||this.optionDivEl.isAncestor(t))||(i=!0)),0==this.checkContainBlur||1==i){if(!1===this.onCanBlur(e))return void this.setValue(this.lastValue||"",!0);Ev.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.onBlur.call(this,e)}else e.deferCancelBubble=!0}}},onCanBlur:function(e){var t=this.getDisplayEl().getValue();return!(t=this.getNormalValue(t))||this.lastDisplayValue==t||0!=this.validateValue(t)||(!0!==this.invalidBlur||(this.setValue(this.lastValue,!0),this.setDisplayValue(this.lastDisplayValue)),!1)},onBlur:function(e){this.isFocus&&(this.isFocus=null,this.isExpand()&&this.collapse(),0==Rui.isUndefined(this.lastDisplayValue)&&this.lastDisplayValue!=this.getDisplayValue()&&this.doChangedDisplayValue(this.getDisplayValue()),Rui.ui.form.LTextBox.superclass.onBlur.call(this,e),this.setPlaceholder())},doChangedDisplayValue:function(e){this.setValue(e)},_setWidth:function(e,t,i){t[0]<0||(Rui.ui.form.LTextBox.superclass._setWidth.call(this,e,t,i),this.getDisplayEl().setWidth(this.getContentWidth()),this.optionDivEl&&this.setListWidth(t[0]))},_setHeight:function(e,t,i){t[0]<0||(Rui.ui.form.LTextBox.superclass._setHeight.call(this,e,t,i),this.getDisplayEl().setHeight(this.getContentHeight()+(Rui.browser.msie67?-2:0)),Rui.browser.msie&&-1<t[0]&&this.getDisplayEl().setStyle("line-height",t[0]+"px"))},_setListWidth:function(e,t,i){var s;this.optionDivEl&&(s=this.el.getWidth()||this.width,0<this.listWidth&&(s=Math.max(this.listWidth,s)),this.optionDivEl.setWidth(s))},setListWidth:function(e){this.cfg.setProperty("listWidth",e)},getListWidth:function(){return this.cfg.getProperty("listWidth")},_setAddEmptyText:function(e,t,i){this.optionDivEl&&(1==t[0]&&0==this.hasEmptyText()?this.createEmptyText():this.removeEmptyText())},setAddEmptyText:function(e){this.cfg.setProperty("useEmptyText",e)},getAddEmptyText:function(){return this.cfg.getProperty("useEmptyText")},setHeight:function(e){this.cfg.setProperty("height",e)},getHeight:function(){return this.cfg.getProperty("height")},_setDisabled:function(e,t,i){this.disabled=!!t[0],this.el&&(!1===this.disabled?(this.el.removeClass("L-disabled"),this.getDisplayEl().dom.disabled=!1,this.getDisplayEl().dom.readOnly=void 0===this.latestEditable?!this.editable:!this.latestEditable):(this.el.addClass("L-disabled"),this.getDisplayEl().dom.disabled=!0,this.getDisplayEl().dom.readOnly=!0)),this.fireEvent(this.disabled?"disable":"enable")},setEditable:function(e){this.cfg.setProperty("editable",!0!==this.disabled&&e)},_setEditable:function(e,t,i){Rui.ui.form.LTextBox.superclass._setEditable.call(this,e,t,i),this.latestEditable=this.editable,this.getDisplayEl().dom.readOnly=!this.editable},getDisplayEl:function(){return this.inputEl||this.el},focus:function(){this.getDisplayEl().focus()},blur:function(){var e;this.checkContainBlur?(Ev.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),e={type:"mousedown",target:document.body},this.onBlur.call(this,e)):this.getDisplayEl().blur()},isValid:function(){return this.getDisplayEl().isValid()},onKeyup:function(e){var t=KL.KEY;if(e.keyCode==t.DOWN||e.keyCode==t.UP||e.keyCode==t.TAB)return this.onFocus(),void this.fireEvent("keydown",e);if(null!=this.inputType){if(null!=this.inputType&&this.inputType!=Rui.util.LString.PATTERN_TYPE_KOREAN){var i=this.getValue();if(null!=i){var s=(i+"").replace(/[\ㄱ-ㅎ가-힣]/g,"");if(s!=i)return this.setValue(s),Ev.stopEvent(e),void(e.returnValue=!1)}}(e.shiftKey||e.altKey||e.ctrlKey)&&(this.specialKeypress=!1,this.ctrlKeypress=!1),this.fireEvent("keyup",e)}else this.fireEvent("keyup",e)},onKeydown:function(e){if(null!=this.inputType){var t=KL.KEY;if(e.keyCode!=t.SPACE&&e.keyCode!=t.SHIFT&&(Ev.isSpecialKey(e)||e.keyCode==t.BACK_SPACE||e.keyCode==t.DELETE))return;if(229==(e.charCode||e.which||e.keyCode)&&this.inputType!=ST.PATTERN_TYPE_KOREAN)return void Ev.preventDefault(e)}this.fireEvent("keydown",e)},onKeypress:function(e){if(null!=this.inputType){var t=e.charCode||e.which||e.keyCode;if(8!=t&&39!=t&&45!=t&&46!=t&&(!this.ctrlKeypress||97!=t&&99!=t&&118!=t&&120!=t)){var i=String.fromCharCode(t),s=this.inputType;if(null!=this.includeChars&&new RegExp("["+this.includeChars+"]","i").exec(i))this.fireEvent("keypress",e);else{if(this.inputType==ST.PATTERN_TYPE_KOREAN){if(!ST.isHangul(i))return void Ev.preventDefault(e)}else if(!s.test(i))return void Ev.preventDefault(e);this.fireEvent("keypress",e)}}}else this.fireEvent("keypress",e)},onSpecialkeyEvent:function(e){if(!0===this.checkContainBlur&&e.keyCode==KL.KEY.TAB){if(0==this.onCanBlur(e)){this.focus();try{Ev.stopEvent(e)}catch(e){}return!1}Ev.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.onBlur.call(this,e),this.isFocus=null}this.optionDivEl&&this.doKeyMove(e),e.ctrlKey&&"X"==String.fromCharCode(e.keyCode)?this.fireEvent("cut",e):e.ctrlKey&&"C"==String.fromCharCode(e.keyCode)?this.fireEvent("copy",e):e.ctrlKey&&"V"==String.fromCharCode(e.keyCode)&&(this.lastValue=null,this.fireEvent("paste",e))},onKeyAutoComplete:function(e){!0===this.useDataSet&&!0===this.autoComplete&&this.doKeyInput(e)},doKeyMove:function(e){var t=KL.KEY;switch(e.keyCode){case t.ENTER:var i=this.getActive();null!=i&&this.doChangedItem(i.dom),this.collapse();break;case t.DOWN:this.expand(),this.nextActive(),Ev.stopEvent(e);break;case t.UP:this.expand(),this.prevActive(),Ev.stopEvent(e);break;case t.PAGE_DOWN:this.pageDown(e);break;case t.PAGE_UP:this.pageUp();break;case t.ESCAPE:this.collapse()}},doKeyInput:function(e){this.isForceCheck=!1,KL.KEY.ENTER==e.keyCode&&Ev.preventDefault(e),KL.KEY.TAB==e.keyCode&&this.collapse();var t=KL.KEY;switch(e.keyCode){case t.ENTER:case t.DOWN:case t.LEFT:case t.RIGHT:case t.UP:break;default:if(""==this.getDisplayEl().getValue()&&this.dataSet.isFiltered())this.clearFilter();else if(this.lastValue!=this.getDisplayEl().getValue()){if(this.autoComplete||(this.lastValue=this.getDisplayEl().getValue()),this.filterTask)return;if(!(!0!==e.altKey&&!0!==e.ctrlKey||!0===e.ctrlKey&&"V"==String.fromCharCode(e.keyCode)))return;this.expand(),this.autoComplete&&(this.filterTask=new Rui.util.LDelayedTask(this.doFilter,this),this.filterTask.delay("remote"==this.filterMode?this.remoteDelayTime:this.localDelayTime))}}},doFilter:function(e){this.filterTask.cancel(),this.filterTask=null,this.filter(this.getDisplayEl().getValue(),this.filterFn)},onOptionMouseDown:function(e){this.collapseIf(e),this.getDisplayEl().focus()},expand:function(){if(!0!==this.disabled&&(!0!==this.isLoad&&this.doLoadDataSet(),this.optionDivEl&&this.optionDivEl.hasClass("L-hide-display"))){this.doExpand(),this.getActiveIndex()<0&&this.firstActive();try{this.getDisplayEl().focus()}catch(e){}}},createOptionDiv:function(){var e;!0===this.useDataSet&&(this.getDisplayEl(),(e=document.createElement("div")).id=Rui.useFixedId()?Rui.id(this.el,"LTextBox-opt-"+this.id):Rui.id(),this.optionDivEl=Rui.get(e),this.optionDivEl.setWidth(-1<this.listWidth?this.listWidth:this.width-this.el.getBorderWidth("lr")),this.optionDivEl.addClass(this.CSS_BASE+"-list-wrapper"),this.optionDivEl.addClass("L-hide-display"),Rui.useAccessibility()&&(this.optionDivEl.setAttribute("role","listbox"),this.optionDivEl.setAttribute("aria-expaned","false")),this.optionDivEl.on("mousedown",this.onOptionMouseDown,this,!0),this.listRenderer&&this.optionDivEl.addClass("L-custom-list"),document.body.appendChild(e))},getOptionDiv:function(){return this.optionDivEl},getActive:function(){var e=this.optionDivEl.select(".active");if(!(e.length<1))return e.getAt(0)},getActiveIndex:function(){for(var e=this.optionDivEl.select("div.L-list"),t=-1,i=0;i<e.length;i++)if(e.getAt(i).hasClass("active")){t=i;break}return t},getDataIndex:function(e){for(var t=this.optionDivEl.select("div.L-list"),i=-1,s=0;s<t.length;s++){var a=t.getAt(s).select(".L-display-field").getAt(0).dom.firstChild;if(a&&Rui.util.LString.trim(a.nodeValue)==(e&&0<e.length&&Rui.util.LString.trim(e))){i=s;break}}return-1<i&&!0===this.useEmptyText&&i--,i},getItemByRecordId:function(e){if(!this.optionDivEl)return null;for(var t=this.optionDivEl.select("div.L-list"),i=null,s=0;s<t.length;s++){var a=t.getAt(s),n=a.select(".L-display-field").getAt(0).dom.firstChild;if(n&&Rui.util.LString.trim(n.nodeValue)==(e&&0<e.length&&Rui.util.LString.trim(e))){i="r"+a.dom.className.match(Rui.ui.form.LTextBox.ROW_RE)[1];break}}return i},firstActive:function(){var e=this.optionDivEl.select(":first-child");0<e.length&&e.getAt(0).addClass("active")},nextActive:function(){var e=this.getActive();if(null==e)this.firstActive();else{var t=Dom.getNextSibling(e.dom);if(null==t)return;var i=Rui.get(t);e.removeClass("active"),i.addClass("active"),this.scrollDown()}},prevActive:function(){var e=this.getActive();if(null==e)this.firstActive();else{var t=Dom.getPreviousSibling(e.dom);if(null==t)return;var i=Rui.get(t);e.removeClass("active"),i.addClass("active"),this.scrollUp()}},pageUp:function(){var e,t;this.dataSet&&(this.isExpand()||this.expand(),(t=(e=this.dataSet).getRow()-this.expandCount)<0&&(t=!0===this.useEmptyText?-1:0),e.setRow(t))},pageDown:function(){var e,t;this.dataSet&&(this.isExpand()||this.expand(),t=(e=this.dataSet).getRow()+this.expandCount,e.getCount()-1<t&&(t=e.getCount()-1),e.setRow(t))},scrollDown:function(){var e,t;"scroll"==this.optionDivEl.getStyle(this.overflowCSS)&&"auto"==this.optionDivEl.getStyle(this.overflowCSS)||(e=this.getActive(),t=(this.getActiveIndex()+1)*e.getHeight()-this.optionDivEl.getHeight(),this.optionDivEl.dom.scrollTop<t&&(this.optionDivEl.dom.scrollTop=t))},scrollUp:function(){var e,t;"scroll"==this.optionDivEl.getStyle(this.overflowCSS)&&"auto"==this.optionDivEl.getStyle(this.overflowCSS)||(e=this.getActive(),t=this.getActiveIndex()*e.getHeight(),this.optionDivEl.dom.scrollTop>t&&(this.optionDivEl.dom.scrollTop=t))},doExpand:function(){this.optionDivEl.setTop(0),this.optionDivEl.setLeft(0),this.optionDivEl.removeClass("L-hide-display"),this.optionDivEl.addClass("L-show-display"),Rui.useAccessibility()&&this.optionDivEl.setAttribute("aria-expaned","true");var e=this.getDisplayEl().getValue();(""===e||this.useEmptyText&&e==this.emptyText)&&(this._itemRendered=!1,this.editable&&this.autoComplete&&this.dataSet.clearFilter(!1)),!0!==this._itemRendered&&this.doDataChangedDataSet(),this.optionAutoHeight();var t=Rui.util.LDom.getViewport().width,i=this.optionDivEl.getHeight(),s=this.optionDivEl.getWidth(),a=this.el.getTop(),n=this.el.getLeft(),a=(a+=this.el.getHeight())||0,n=n||0;("auto"!=this.listPosition||Rui.util.LDom.isVisibleSide(i+a))&&"up"!=this.listPosition||(a=this.el.getTop()-i),Rui.rightToLeft()?(n-=s-this.getWidth()+2*(this.marginLeft+(Rui.browser.msie67?-2:0)))<0&&(n+=s-this.getWidth()+this.marginLeft+(Rui.browser.msie67?-2:0)):t<=(n=n+this.marginLeft+(Rui.browser.msie67?-2:0))+s&&s>this.getWidth()&&(n-=s-this.getWidth()+2*(this.marginLeft+(Rui.browser.msie67?-2:0))),this.optionDivEl.setTop(a+this.marginTop+(Rui.browser.msie67?-2:0)),this.optionDivEl.setLeft(n),this.optionDivEl.select(".L-list").removeClass("selected"),this.activeItem(),null!=this.el.findParent(".L-overlay")&&(this.checkOptionDivDelegate=Rui.later(100,this,this._checkOptionDiv,null,!0)),this.reOnDeferOnBlur(),this.fireEvent("expand")},_checkOptionDiv:function(){var e=this.inputEl.getLeft(),t=this.inputEl.getTop();(Rui.browser.msie&&8==Rui.browser.version||this.inputEl.getTop()-2<=t&&this.inputEl.getTop()>=t)&&this.inputEl.getLeft()-2<=e&&this.inputEl.getLeft()>=e||this.collapse()},isExpand:function(){return this.optionDivEl&&this.optionDivEl.hasClass("L-show-display")},collapseIf:function(e){var t,i,s,a=e.target;this.optionDivEl&&this.optionDivEl.dom==a||this.iconEl&&this.iconEl.dom==a||this.inputEl&&this.inputEl.dom==a||(t=Rui.get(a))&&((i=t.hasClass("L-list"))||(s=t.findParent("div.L-list",3))&&(t=s,i=!0),i&&(t.removeClass("active"),this.doChangedItem(t.dom)),this.collapse())},collapse:function(){this.optionDivEl.removeClass("L-show-display"),this.optionDivEl.addClass("L-hide-display"),Rui.useAccessibility()&&this.optionDivEl.setAttribute("aria-expaned","false"),this.checkOptionDivDelegate&&this.checkOptionDivDelegate.cancel(),this.isFocus&&this.getDisplayEl().focus(),this.fireEvent("collapse"),this.optionDivEl.select(".active").removeClass("active")},optionAutoHeight:function(){var e,t,i,s,a;this.optionDivEl&&(e=this.dataSet.getCount(),t=this.optionDivEl.getHeight(),this.useEmptyText&&e++,this.expandCount||(this.expandCount=10),e>this.expandCount?0<this.optionDivEl.dom.childNodes.length&&(i=this.expandCount*s,s=this.optionDivEl.dom.firstChild.offsetHeight,t!=i&&t!=i+this.optionDivEl.getStyle("border-top-width")+this.optionDivEl.getStyle("border-bottom-width")&&this.optionDivEl.setHeight(this.expandCount*s+"px")):this.optionDivEl.setHeight("auto"),t=this.optionDivEl.getHeight(),a=this.el.getTop(),this.optionDivEl.getTop()<a&&this.optionDivEl.setTop(a-t))},onScroll:function(){this.collapse()},activeItem:function(){var e,t;this.isForceCheck=!1,""!=this.getDisplayEl().getValue()&&(e=this.optionDivEl.select(".L-list"),(t=this.dataSet.getAt(this.dataSet.getRow()))&&e.each(function(e){if(-1<e.dom.className.indexOf("L-row-"+t.id))return e.addClass("selected"),e.addClass("active"),this.scrollDown(),!1},this))},doLoadDataSet:function(){this._itemRendered=!1,this.optionDivEl&&(this.doDataChangedDataSet(),this.isLoad=!0,this.focusDefaultValue()),this.doCacheData()},onBeforeLoadDataSet:function(e){this.bindMDataSet||this.dataSet.setRow(-1)},onLoadDataSet:function(e){var t;this._newLoaded=!0,this._itemRendered=!1,this.doLoadDataSet(),this.optionAutoHeight(),this.bindMDataSet&&-1<this.bindMDataSet.getRow()&&(t=this.bindMDataSet.getRow(),!0===this.autoComplete&&!0===this.dataSet.isLoad||this.setValue(this.bindMDataSet.getNameValue(t,this.bindObject.id),!0))},setDefaultValue:function(e){this.defaultValue=e},setSelectedIndex:function(e){this.selectedIndex=e},focusDefaultValue:function(){var e;this.bindMDataSet||!0===this.autoComplete||(!0!==this.isLoad&&Rui.isEmpty(this.defaultValue)&&(this.defaultValue=this.getValue()),!(e=!1)===this.ignoreEvent&&this.gridPanel&&(e=!0),Rui.isEmpty(this.defaultValue)?!1!==this.selectedIndex&&0<=this.selectedIndex?this.dataSet.getCount()-1>=this.selectedIndex&&this.setValue(this.dataSet.getNameValue(this.selectedIndex,this.valueField),e):this.firstChangedEvent&&this.setValue(null,e):this.setValue(this.defaultValue,e))},doChangedItem:function(e){var t,i;e.innerHTML&&(i=(t=Rui.get(e).select(".L-display-field").getAt(0).dom.firstChild)?t.nodeValue:"",this.setValue(i),this.isFocus&&this.getDisplayEl().focus())},onRowPosChangedDataSet:function(e){},onAddData:function(e){var t=e.row,i=e.target,s=this.createItem({record:this.dataSet.getAt(t),row:t});if(1<i.getCount()){var a=t-1;if(a<0){var n=t+1,l=this.getRowEl(n);if(null==l)return;l.insertBefore(s.dom)}else{var r=this.getRowEl(a);if(null==r)return;r.insertAfter(s.dom)}}else this.optionDivEl&&this.getOptionDiv().appendChild(s.dom)},onUpdateData:function(e){var t,i,s,a,n,l=e.row;e.colId!=this.displayField||(t=this.getRowEl(l))&&(i=this.dataSet.getAt(l),s=this.createItem({record:i,row:l}),t.html(s.getHtml()),l==this.dataSet.getRow()&&(a=this.getDisplayEl(),n=i.get(this.displayField),n=Rui.isEmpty(n)?"":n,a.setValue(n)))},onRemoveData:function(e){var t=e.row,i=this.getRowEl(t);null!=i&&i.remove()},onUndoData:function(e){e.beforeState==Rui.data.LRecord.STATE_INSERT&&this.onRemoveData(e)},onDataChangedDataSet:function(e){this._itemRendered=!1,this.doDataChangedDataSet()},doDataChangedDataSet:function(){if(!0!==this.autoComplete&&!0!==this.editable&&this.getValue()&&!this.bindMDataSet&&this.dataSet.findRow(this.valueField,this.getValue())<0&&this.setValue(""),!0===this.autoComplete||this.isFocus){if(this.removeAllItem(),!0===this.useEmptyText&&this.createEmptyText(),this.optionDivEl){for(var e,t=Rui.data.LRecord.STATE_DELETE,i=this.dataSet,s=0,a=i.getCount();s<a;s++){t!=i.getState(s)&&(e=this.createItem({record:i.getAt(s),row:s}),this.appendOption(e.dom))}this._itemRendered=!0}this.autoComplete&&this.optionAutoHeight()}},appendOption:function(e){this.optionDivEl.appendChild(e)},hasEmptyText:function(){return this.optionDivEl?!(this.optionDivEl.dom.childNodes.length<1)&&Dom.hasClass(this.optionDivEl.dom.childNodes[0],"L-empty"):this.useEmptyText},createEmptyText:function(){try{if(!this.el)return;var e={};this.valueField&&(e[this.valueField]=""),e[this.displayField]=this.emptyText;var t=this.dataSet.createRecord(e),i=this.createItem({record:t,row:-1});i.addClass("L-empty"),this.insertEmptyText(i.dom)}catch(e){}},insertEmptyText:function(e){0<this.optionDivEl.dom.childNodes.length?Dom.insertBefore(e,this.optionDivEl.dom.childNodes[0]):this.optionDivEl.appendChild(e)},removeEmptyText:function(){this.hasEmptyText()&&Dom.removeNode(this.optionDivEl.dom.childNodes[0])},getRowEl:function(e){if(this.optionDivEl){var t=this.optionDivEl.select(".L-list");return 0<t.length?t.getAt(this.useEmptyText?e+1:e):null}return null},createItem:function(e){var t=e.record,i=t.get(this.displayField),i=Rui.isEmpty(i)?"":i,s="",s=this.listRenderer?this.listRenderer(t):'<div class="L-display-field" id="LTextBox-listItem-'+this.id+"-"+(e.row+1)+'">'+i+"</div>",a=Rui.createElements('<div class="L-list L-row-'+t.id+'" id="LTextBox-optList-'+this.id+"-"+(e.row+1)+'">'+s+"</div>").getAt(0),n=this.optionDivEl;return Rui.useAccessibility()&&a.setAttribute("role","option"),a.hover(function(){this.addClass("active")},function(){n.select(".active").removeClass("active")}),a},findRowIndex:function(e){var t=Rui.get(e).findParent(".L-list");if(!t)return-1;var i=t.dom;if(!i||!i.className)return-1;var s=i.className.match(this.rowRe);if(s&&s[1]){var a=this.dataSet.indexOfKey("r"+s[1]);return-1!=a&&a}},add:function(e,t){var i=this.dataSet.createRecord(e,{id:Rui.data.LRecord.getNewRecordId()});this.dataSet.add(i,t)},addAll:function(e,t){for(var i=0;i<e.length;i++)this.add(e[i],t)},setData:function(e,t){e>this.dataSet.getCount()-1||0==e||this.dataSet.getAt(e).setValues(t)},removeAt:function(e){this.dataSet.removeAt(e)},removeAllItem:function(){null!=this.optionDivEl&&this.optionDivEl.select(".L-list").remove()},getCount:function(){return this.dataSet.getCount()},filter:function(s,e){var t;"remote"==this.filterMode?((t={})[this.displayField]=s,this.dataSet.load({url:this.filterUrl,params:t})):(e=e||function(e,t){var i=t.get(this.displayField);if(ST.startsWith(i.toLowerCase(),s.toLowerCase()))return!0},this.dataSet.filter(e,this,!1))},clearFilter:function(){this.dataSet&&this.dataSet.clearFilter(!1)},getValue:function(){var e=this.getDisplayEl().getValue();return this.mask&&null!=e&&""!=e&&0==this.maskValue&&(e=this.getUnmaskValue(e)),this.mask&&null!=e&&""!=e&&1==this.maskValue&&(e=""==this.getUnmaskValue(e)?"":e),e==this.placeholder||""==e?this.getEmptyValue(e):e},getEmptyValue:function(e){return e===this.emptyValue?e:this.emptyValue},getUnmaskValue:function(e){var i=[];return Rui.each(e.split(""),function(e,t){this.tests[t]&&this.tests[t].test(e)&&i.push(e)},this),i.join("")},getBuffer:function(e){var i=this.definitions,s=[],a=e.split(""),n=0;return Rui.each(this.mask.split(""),function(e,t){"?"!=e&&s.push(i[e]?this.maskPlaceholder:e),this.tests[t]&&this.tests[t].test(e)&&a.length>n&&(s[t]=a[n++])},this),s},getDisplayValue:function(){return this.getDisplayEl().getValue()},setDisplayValue:function(e){this.getDisplayEl().setValue(e)},setValue:function(e,t){var i,s;!0===Rui.isUndefined(e)||this.lastValue===e&&null===this.inputType||((i=this.getDisplayEl())&&(i.dom.value=e,s=this.checkValue().displayValue,i.dom.value=s,this.lastDisplayValue=s),!0!==t&&this.doChanged(),this.lastValue=e,this.setPlaceholder())},doChanged:function(){this.fireEvent("changed",{target:this,value:this.getValue(),displayValue:this.getDisplayValue()})},getDataSet:function(){return this.dataSet},setDataSet:function(e){this.doUnSyncDataSet(),this.dataSet=e,this.initDataSet(),this.onLoadDataSet()},doCacheData:Rui.emptyFn,onFireKey:function(e){(Ev.isSpecialKey(e)&&!this.isExpand()||!0===e.ctrlKey&&(70===e.keyCode||"V"==String.fromCharCode(e.keyCode)))&&this.fireEvent("specialkey",e)},initMask:function(){var i=this.definitions,s=[];this.partialPosition=this.mask.length,this.firstNonMaskPos=null,this.maskLength=this.mask.length,Rui.each(this.mask.split(""),function(e,t){"?"==e?(this.maskLength--,this.partialPosition=t):i[e]?(s.push(new RegExp(i[e])),null==this.firstNonMaskPos&&(this.firstNonMaskPos=s.length-1)):s.push(null)},this),this.tests=s,this.buffer=[],Rui.each(this.mask.split(""),function(e,t){"?"!=e&&this.buffer.push(i[e]?this.maskPlaceholder:e)},this)},initMaskEvent:function(){this.on("focus",function(){var e;Rui.mobile.ios&&0==this.checkContainBlur||(this.getDisplayValue()==this.placeholder&&this.getDisplayEl().setValue(""),e=this.checkValue().pos,!1!==this.editable&&this.writeBuffer(),setTimeout(Rui.util.LFunction.createDelegate(function(){e==this.mask.length?this.setCaret(0,e):this.setCaret(e)},this),0))},this,!0),this.on("blur",function(){Rui.mobile.ios&&0==this.checkContainBlur||this.setDisplayValue(this.checkValue().displayValue)}),Rui.mobile.ios||(this.on("keydown",this.onKeyDownMask,this,!0),this.on("keypress",this.onKeyPressMask,this,!0)),this.on("paste",function(e){this.cfg.getProperty("disabled")||Rui.mobile.ios&&0==this.checkContainBlur||setTimeout(Rui.util.LFunction.createDelegate(function(){this.setCaret(this.checkValue(!0).pos)},this),0)},this,!0),Rui.mobile.ios&&0==this.checkContainBlur||!this._rendered||this.setDisplayValue(this.checkValue().displayValue)},setCaret:function(e,t){var i,s=this.getDisplayEl().dom;t="number"==typeof t?t:e;try{s.setSelectionRange?(s.focus(),s.setSelectionRange(e,t)):s.createTextRange&&((i=s.createTextRange()).collapse(!0),i.moveEnd("character",t),i.moveStart("character",e),i.select())}catch(e){}},getCaret:function(){var e,t=this.getDisplayEl().dom;return t.setSelectionRange?(begin=t.selectionStart,end=t.selectionEnd):document.selection&&document.selection.createRange&&(e=document.selection.createRange(),begin=0-e.duplicate().moveStart("character",-1e5),end=begin+e.text.length),{begin:begin,end:end}},clearBuffer:function(e,t){for(var i=e;i<t&&i<this.maskLength;i++)this.tests[i]&&(this.buffer[i]=this.maskPlaceholder)},writeBuffer:function(){return this.setDisplayValue(this.buffer.join(""))},onKeyDownMask:function(e){if(this.cfg.getProperty("disabled")||1!=this.editable)return!0;var t=this.getCaret(),i=e.keyCode;return this.ignore=i<16||16<i&&i<32||32<i&&i<41,t.begin-t.end==0||this.ignore&&8!=i&&46!=i||this.clearBuffer(t.begin,t.end),8==i||46==i?(this.shiftL(t.begin+(46==i?0:-1)),Ev.preventDefault(e),!1):27==i?(0!=this.checkContainBlur&&this.setCaret(0,this.checkValue().pos),Ev.preventDefault(e),!1):void 0},onKeyPressMask:function(e){if(this.ignore)return this.ignore=!1,8!=e.keyCode&&null;var t=(e=e||window.event).charCode||e.keyCode||e.which,i=this.getCaret();if(e.ctrlKey||e.altKey||e.metaKey)return!0;if(32<=t&&t<=125||186<t){if(this.cfg.getProperty("disabled")||1!=this.editable)return!0;var s,a,n=this.seekNext(i.begin-1);n<this.maskLength&&(s=String.fromCharCode(t),this.tests[n].test(s)&&(this.shiftR(n),this.buffer[n]=s,this.writeBuffer(),a=this.seekNext(n),this.setCaret(a)))}return Ev.preventDefault(e),!1},seekNext:function(e){for(;++e<=this.maskLength&&!this.tests[e];);return e},shiftL:function(e){for(;!this.tests[e]&&0<=--e;);for(var t=e;t<this.maskLength;t++)if(this.tests[t]){this.buffer[t]=this.maskPlaceholder;var i=this.seekNext(t);if(!(i<this.maskLength&&this.tests[t].test(this.buffer[i])))break;this.buffer[t]=this.buffer[i]}this.writeBuffer(),this.setCaret(Math.max(this.firstNonMaskPos,e))},shiftR:function(e){for(var t=e,i=this.maskPlaceholder;t<this.maskLength;t++)if(this.tests[t]){var s=this.seekNext(t),a=this.buffer[t];if(this.buffer[t]=i,!(s<this.maskLength&&this.tests[s].test(a)))break;i=a}},checkValue:function(e){for(var t=this.getDisplayValue(),i=-1,s=0,a=0;s<this.maskLength;s++)if(this.tests[s]){for(this.buffer[s]=this.maskPlaceholder;a++<t.length;){var n=t.charAt(a-1);if(this.tests[s].test(n)){this.buffer[s]=n,i=s;break}}if(a>t.length)break}else this.buffer[s]==t[a]&&s!=this.partialPosition&&(a++,i=s);return!e&&i+1<this.partialPosition?(t="",this.clearBuffer(0,this.maskLength)):(e||i+1>=this.partialPosition)&&(this.writeBuffer(),e||(t=this.getDisplayValue().substring(0,i+1))),{pos:this.partialPosition?s:this.firstNonMaskPos,displayValue:t}},validateValue:function(e){return"email"!=this.type||""==this.getValue()||new Rui.validate.LEmailValidator({id:this.id}).validate(this.getValue())},findRowElById:function(e){if(!this.optionDivEl)return null;var t=this.optionDivEl.select(".L-row-"+e);return 0<t.length?t.getAt(0):null},destroy:function(){this.dataSet&&this.doUnSyncDataSet(),this.inputEl&&(this.inputEl.unOnAll(),this.inputEl.remove(),delete this.inputEl),this.displayEl&&(this.displayEl.unOnAll(),this.displayEl.remove(),delete this.displayEl),this.optionDivEl&&(this.optionDivEl.unOnAll(),this.optionDivEl.remove(),delete this.optionDivEl),Rui.ui.form.LTextBox.superclass.destroy.call(this)},getNormalValue:function(e){return e}})}(),Rui.namespace("Rui.ui.form"),Rui.ui.form.LCombo=function(e){e=Rui.applyIf(e||{},Rui.getConfig().getFirst("$.ext.combo.defaultProperties"));var t=Rui.getConfig().getFirst("$.ext.combo.dataSet");t&&(!e.valueField&&t.valueField&&(e.valueField=t.valueField),!e.displayField&&t.displayField&&(e.displayField=t.displayField)),this.emptyText=e.emptyText||this.emptyText,this.dataMap={},Rui.ui.form.LCombo.superclass.constructor.call(this,e),this.dataSet.focusFirstRow=0==Rui.isUndefined(this.focusFirstRow)&&this.focusFirstRow,-1<this.dataSet.getRow()&&1==this._rendered&&!0===this.forceSelection&&this.setDisplayValue(this.dataSet.getNameValue(this.dataSet.getRow(),this.displayField)),this.onWheelDelegate=Rui.util.LFunction.createDelegate(this.onWheel,this)},Rui.extend(Rui.ui.form.LCombo,Rui.ui.form.LTextBox,{otype:"Rui.ui.form.LCombo",CSS_BASE:"L-combo",valueField:"value",displayField:"text",emptyTextMessageCode:"$.base.msg108",emptyText:null,useEmptyText:!0,iconWidth:20,iconMarginLeft:1,forceSelection:!0,lastDisplayValue:"",changed:!1,selectedIndex:-1,editable:!1,useDataSet:!0,checkContainBlur:!0,rendererField:null,autoMapping:!1,dataMap:null,dataSetId:null,items:null,initComponent:function(e){this.emptyText=null==this.emptyText?Rui.getMessageManager().get(this.emptyTextMessageCode):this.emptyText,!0===this.cfg.getProperty("useEmptyText")&&(this.forceSelection=!1),(this.rendererField||this.autoMapping)&&(this.beforeRenderer=this.comboRenderer),this.items&&(this.createDataSet(),this.loadItems(),this.doDataChangedDataSet(),this.isLoad=!0,this.initDataSet(),this.focusDefaultValue())},initEvents:function(){Rui.ui.form.LCombo.superclass.initEvents.call(this),this.initAutoMapDataSet()},initAutoMapDataSet:function(){this.autoMapping&&this.dataSet&&(this.doUnOnClearMapDataSet(),this.doOnClearMapDataSet())},initDataSet:function(){Rui.ui.form.LCombo.superclass.initDataSet.call(this),this.initSync&&this.dataSet&&(this.dataSet.sync=!0)},doRender:function(){this.createTemplate(this.el);var e=document.createElement("input");e.type="hidden",e.name=this.name||this.id,e.id=Rui.useFixedId()?Rui.id(this.el,"LCombo-hidden-"+this.id):Rui.id(),e.instance=this,e.className="L-instance L-hidden-field",this.el.appendChild(e),this.hiddenInputEl=Rui.get(e),this.hiddenInputEl.addClass("L-hidden-field"),this.inputEl.removeAttribute("name"),this.inputEl.setStyle("ime-mode","disabled");var t=this.inputEl.dom;Rui.useAccessibility()&&(t.setAttribute("role","combobox"),t.setAttribute("aria-readonly","true"),t.setAttribute("aria-autocomplete","none"),e.setAttribute("role","combobox"),e.setAttribute("aria-hidden","true")),this.doRenderButton()},doRenderButton:function(){var e=document.createElement("div");e.className="icon",e.id=Rui.useFixedId()?Rui.id(this.el,"LCombo-icon-"+this.id):Rui.id(),this.el.appendChild(e),this.iconEl=Rui.get(e)},onClearDataMap:function(e){this.dataMap={}},doOnClearMapDataSet:function(){this.dataSet.on("load",this.onClearDataMap,this,!0),this.dataSet.on("dataChanged",this.onClearDataMap,this,!0),this.dataSet.on("add",this.onClearDataMap,this,!0),this.dataSet.on("update",this.onClearDataMap,this,!0),this.dataSet.on("remove",this.onClearDataMap,this,!0),this.dataSet.on("undo",this.onClearDataMap,this,!0)},doUnOnClearMapDataSet:function(){this.dataSet.unOn("load",this.onClearDataMap,this),this.dataSet.unOn("dataChanged",this.onClearDataMap,this),this.dataSet.unOn("add",this.onClearDataMap,this),this.dataSet.unOn("update",this.onClearDataMap,this),this.dataSet.unOn("remove",this.onClearDataMap,this),this.dataSet.unOn("undo",this.onClearDataMap,this)},createContainer:function(e){if(this.el&&"SELECT"==this.el.dom.tagName){var t=Rui.util.LDom;this.id=this.id||this.el.id,this.oldDom=this.el.dom;var i=this.oldDom.options;if(i&&0<i.length){this.items=[];for(var s,a=0;i&&a<i.length;a++){t.hasClass(i[a],"empty")?(this.cfg.setProperty("useEmptyText",!0),this.emptyText=i[a].text):((s={})[this.valueField]=i[a].value,s[this.displayField]=i[a].text,this.items.push(s),i[a].selected&&(this.defaultValue=i[a].value))}}this.name=this.name||this.oldDom.name;this.el.parent();this.el=Rui.get(this.createElement().cloneNode(!1)),this.el.dom.id=this.id,t.replaceChild(this.el.dom,this.oldDom),this.el.appendChild(this.oldDom),t.removeNode(this.oldDom),delete this.oldDom}Rui.ui.form.LTextBox.superclass.createContainer.call(this,e)},afterRender:function(e){Rui.ui.form.LCombo.superclass.afterRender.call(this,e),this.items&&(this.loadItems(),this.doDataChangedDataSet(),this.isLoad=!0,this.initDataSet(),this.focusDefaultValue()),Rui.useAccessibility()&&(this.inputEl.setAttribute("aria-owns",this.optionDivEl.id),this.iconEl.setAttribute("aria-controls",this.optionDivEl.id)),this.isGridEditor&&this.rendererField&&this.initUpdateEvent(),!0===this.forceSelection&&this.dataSet.getRow()<0&&this.dataSet.setRow(0),this.iconEl&&this.iconEl.on("click",this.doIconClick,this,!0),this.applyEmptyText()},createDataSet:function(){this.dataSet||(this.dataSet=new(eval(this.dataSetClassName))({id:this.dataSetId||this.id+"DataSet",fields:[{id:this.valueField},{id:this.displayField}],focusFirstRow:!1,sync:!0===this.initSync}))},loadItems:function(){this.dataSet.batch(function(){for(var e=0;e<this.items.length;e++){var t={};t[this.valueField]=this.items[e][this.valueField],t[this.displayField]=this.items[e][this.displayField]||this.items[e][this.valueField];var i=new Rui.data.LRecord(t,{dataSet:this.dataSet});this.dataSet.add(i),this.dataSet.setState(this.dataSet.getCount()-1,Rui.data.LRecord.STATE_NORMAL)}},this),this.dataSet.commit(),this.dataSet.isLoad=!0,delete this.items},doIconClick:function(e){this.isFocus||this.onFocus(e),this.isExpand()?(this.collapse(),Rui.util.LEvent.removeListener(document,"mousewheel",this.onWheelDelegate)):(this.expand(),Rui.util.LEvent.addListener(document,"mousewheel",this.onWheelDelegate,this))},onWheel:function(e){var t;this.isExpand()&&(t=e.target,this.el.isAncestor(t)&&(this.collapse(),Rui.util.LEvent.addListener(document,"mousewheel",this.onWheelDelegate,this)))},_setWidth:function(e,t,i){t[0]<0||(Rui.ui.form.LCombo.superclass._setWidth.call(this,e,t,i),this.getDisplayEl().setWidth(this.getContentWidth()-(this.iconEl.getWidth()||this.iconWidth)-this.iconMarginLeft))},setSelectedIndex:function(e){this.dataSet.getCount()-1<e||this.setValue(this.dataSet.getNameValue(e,this.valueField))},setDisplayValue:function(e){e!=this.getDisplayValue()&&(e=!0!==this.forceSelection||this.isForceSelectValue(e)?e:this.lastDisplayValue,this.inputEl.setValue(e),this.applyEmptyText(),this.bindDataSet()),this.lastDisplayValue=this.inputEl.getValue(),this.lastDisplayValue==this.emptyText&&(this.lastDisplayValue="")},bindDataSet:function(){var e,t,i,s,a=this.dataSet;a&&!this.editable&&(e=this.getDisplayValue(),a.getNameValue(a.getRow(),this.displayField)!=e&&((t=this.getItemByRecordId(e))?(i=a.indexOfKey(t),a.setRow(i,{isForce:a.isFiltered()}),(s=a.getAt(i))?this.hiddenInputEl.setValue(s.get(this.valueField)):this.hiddenInputEl.setValue("")):this.hiddenInputEl.setValue(""))),this.changed=!0},getRemovedSkipRow:function(e){for(var t=this.dataSet,i=null,s=0,a=0,n=t.getCount();s<n;s++){var l=t.getAt(s);if(l.state!=Rui.data.LRecord.STATE_DELETE&&a++,e<=s&&e<=a){i=l;break}}return i},getRemainRemovedRow:function(e){for(var t=this.dataSet,i=-1,s=0,a=0;s<t.getCount();s++){if(t.getAt(s).state!=Rui.data.LRecord.STATE_DELETE&&a++,e==a){i=a;break}}return i},isForceSelectValue:function(i){var e=this.optionDivEl.select(".L-list"),s=!1;return e.each(function(e){var t=e.select(".L-display-field").getAt(0).dom.firstChild;if(t&&t.nodeValue==i)return!(s=!0)}),s},applyEmptyText:function(){0!=this.useEmptyText&&(""==this.inputEl.getValue()||this.inputEl.getValue()==this.emptyText?(this.inputEl.setValue(this.emptyText),this.inputEl.addClass("empty")):this.inputEl.removeClass("empty"))},getDisplayValue:function(){if(!this.inputEl)return null;var e=this.inputEl.getValue();return e=e==this.emptyText?"":e},getBindValue:function(e){e=e||this.valueField;var t=this.getValue(),i=this.dataSet.findRow(this.valueField,t);return i<0?"":this.dataSet.getAt(i).get(e)},repaint:function(){this.onLoadDataSet(),this.applyEmptyText()},doChangedItem:function(e){var t=Rui.get(e).select(".L-display-field").getAt(0).dom,i=this.findRowIndex(t),s=-1<i?this.dataSet.getNameValue(i,this.valueField):this.emptyValue;this.setValue(s),this.isFocus&&this.getDisplayEl().focus()},onUpdateData:function(e){Rui.ui.form.LCombo.superclass.onUpdateData.call(this,e);var t,i,s,a=e.row,n=e.colId;a==this.dataSet.getRow()&&this.hiddenInputEl&&(t=this.dataSet.getAt(a),n==this.valueField&&this.hiddenInputEl.setValue(t.get(this.valueField)),n==this.displayField&&(i=this.getDisplayEl(),s=t.get(this.displayField),s=Rui.isEmpty(s)?"":s,i.setValue(s)))},onRowPosChangedDataSet:function(e){this.doRowPosChangedDataSet(e.row,!0)},doRowPosChangedDataSet:function(e,t){if(this.hiddenInputEl){var i,s=this.dataSet,a=null,a=s.remainRemoved?this.getRemovedSkipRow(e):s.getAt(e);if(e<0)this.hiddenInputEl.setValue(""),this.setDisplayValue("");else{if(e<0||e>=s.getCount())return;var n=a.get(this.valueField),n=Rui.isEmpty(n)?"":n;this.hiddenInputEl.setValue(n);var l=a.get(this.displayField),l=Rui.isEmpty(l)?"":l;this.inputEl.setValue(l)}a?(i=this.findRowElById(a.id))&&(i.hasClass("active")||(this.optionDivEl.select(".active").removeClass("active"),i.addClass("active"),i.dom.tabIndex=0,i.focus(),this.isFocus&&this.getDisplayEl().focus(),i.dom.removeAttribute("tabIndex"))):-1===e&&!0===this.useEmptyText&&(this.optionDivEl.select(".active").removeClass("active"),(i=Rui.get(this.optionDivEl.dom.childNodes[0]))&&(i.addClass("active"),i.dom.tabIndex=0,i.focus(),this.isFocus&&this.getDisplayEl().focus(),i.dom.removeAttribute("tabIndex"))),!0!==this.ignoreChangedEvent&&this.doChanged()}},getValue:function(){if(!this.hiddenInputEl)return this.emptyValue;var e=this.hiddenInputEl.getValue();return""===e?this.getEmptyValue(e):e},setValue:function(e,t){var i,s;this.hiddenInputEl&&(!0!==this._newLoaded&&this.hiddenInputEl.dom.value===e||(this._newLoaded=!1,i=this.dataSet,this.bindMDataSet&&-1<this.bindMDataSet.getRow()&&!0!==i.isLoad||(1==this.isLoad?(s=i.findRow(this.valueField,e),this.ignoreChangedEvent=!0,s!==i.getRow()?i.setRow(s):-1<s&&(this.hiddenInputEl.dom.value=e,this.getDisplayEl().setValue(i.getNameValue(s,this.displayField))),s=i.getRow(),delete this.ignoreChangedEvent,!0!==this.forceSelection&&s<0&&(this.hiddenInputEl.dom.value=""),s<0&&(this.getDisplayEl().setValue(""),this.applyEmptyText())):this.setDefaultValue(e),!0!==t&&this.doChanged())))},_setDisabled:function(e,t,i){this.isExpand()&&this.collapse(),Rui.ui.form.LCombo.superclass._setDisabled.call(this,e,t,i)},displayRenderer:function(n){var l=n.getDataSet();return function(e,t,i,s,a){return i.state==Rui.data.LRecord.STATE_NORMAL?i.get(n.displayField):-1<(s=l.findRow(n.valueField,e))?l.getAt(s).get(n.displayField):e}},onFocus:function(e){Rui.ui.form.LCombo.superclass.onFocus.call(this,e);var t=this.getDisplayEl();t.removeClass("empty"),t.getValue()==this.emptyText&&!0===this.editable&&t.setValue(""),this.editable&&Rui.util.LEvent.addListener(Rui.browser.msie?document.body:document,"mousedown",this.onEditableChanged,this,!0)},onEditableChanged:function(e){this.doEditableChanged()},doEditableChanged:function(){var e=this.getDisplayValue(),t=this.findValueByDisplayValue(e);0!=this.forceSelection||""!=e&&null!=t?this.lastDisplayValue!=e&&this.setValue(t):this.setValue(this.emptyValue)},onBlur:function(e){Rui.ui.form.LCombo.superclass.onBlur.call(this,e),this.doForceSelection(),this.applyEmptyText(),this.editable&&Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.onEditableChanged),this.autoComplete&&this.editable&&this.clearFilter()},clearFilter:function(){var e,t;this.dataSet&&1==this.dataSet.isFiltered()&&(e=this.dataSet.getRow(),t=this.dataSet.getAt(e),this.dataSet.clearFilter(!1),void 0!==t&&(e=this.dataSet.indexOfKey(t.id),this.dataSet.focusRow({ignoreCanRowPosChange:!0,forceRow:!0,row:e})))},onKeydown:function(e){this.editable&&e.keyCode==Rui.util.LKey.KEY.TAB&&this.doEditableChanged(),Rui.ui.form.LCombo.superclass.onKeydown.call(this,e)},comboRenderer:function(e,t,i,s,a){if(Rui.isEmpty(e))return"";var n=void 0,n=this.dataMap[e];if(Rui.isUndefined(n)&&this.autoMapping)if(this.dataSet.isFiltered())for(var a=0,l=this.dataSet.snapshot.length;a<l;a++){var r=this.dataSet.snapshot.getAt(a);if(r.get(this.valueField)===e){n=r.get(this.displayField);break}}else{var o=this.dataSet.findRow(this.valueField,e);-1<o&&(n=this.dataSet.getNameValue(o,this.displayField))}return Rui.isUndefined(n)&&(n=this.rendererField?i.get(this.rendererField):e),Rui.isUndefined(n)&&(n=this.dataMap[e]?this.dataMap[e]:n),this.dataMap[e]=n},initUpdateEvent:function(){var t;this.gridPanel&&!0!==this.isInitUpdateEvent&&this.rendererField&&(t=this.gridPanel.getView().getDataSet(),this.on("changed",function(e){t.setNameValue(t.getRow(),this.rendererField,this.dataSet.getNameValue(this.dataSet.getRow(),this.displayField))},this,!0),this.isInitUpdateEvent=!0)},doChangedDisplayValue:function(e){this.bindDataSet()},doForceSelection:function(){var e;!0===this.forceSelection&&1==this.changed&&(e=this.getDisplayEl(),this.dataSet.findRow(this.displayField,e.getValue())<0?this.setDisplayValue(this.lastDisplayValue):this.bindDataSet())},setDataSet:function(e){Rui.ui.form.LCombo.superclass.setDataSet.call(this,e),this.initAutoMapDataSet()},doCacheData:function(){for(var e=0;e<this.dataSet.getCount();e++)this.dataMap[this.dataSet.getNameValue(e,this.valueField)]=this.dataSet.getNameValue(e,this.displayField)},clearCacheData:function(){this.dataMap={}},findValueByDisplayValue:function(a){var n=-1;return this.dataSet.data.each(function(e,t,i){var s=t.get(this.displayField);if(s&&s.toLowerCase()==a.toLowerCase())return n=i,!1},this),-1<n?this.dataSet.getAt(n).get(this.valueField):null},destroy:function(){this.iconEl&&(this.iconEl.remove(),delete this.iconEl),Rui.ui.form.LCombo.superclass.destroy.call(this),this.dataMap=null,this.iconEl=null,this.hiddenInputEl=null}}),Rui.ui.form.LDateBox=function(e){if(e=Rui.applyIf(e||{},Rui.getConfig().getFirst("$.ext.dateBox.defaultProperties")),Rui.platform.isMobile&&(e.localeMask=!1,e.picker=!1),e.localeMask&&this.initLocaleMask(),!e.placeholder){var t=this.getLocaleFormat();try{t=t.toLowerCase().replace("%y","yyyy").replace("%m","mm").replace("%d","dd")}catch(e){}e.placeholder=t}Rui.ui.form.LDateBox.superclass.constructor.call(this,e)},Rui.extend(Rui.ui.form.LDateBox,Rui.ui.form.LTextBox,{otype:"Rui.ui.form.LDateBox",CSS_BASE:"L-datebox",dateType:"date",valueFormat:"%Y-%m-%d",selectingInputDate:!0,width:90,iconWidth:20,iconMarginLeft:1,localeMask:!1,checkContainBlur:!Rui.platform.isMobile,listPosition:"auto",picker:!0,displayValue:Rui.platform.isMobile?"%Y-%m-%d":"%x",emptyValue:null,calendarConfig:null,iconTabIndex:0,initComponent:function(e){Rui.ui.form.LDateBox.superclass.initComponent.call(this,e),this.calendarClass=Rui.ui.calendar.LCalendar;var t=this.displayValue.split("%");1<t.length&&1<t[1].length&&(this.displayValueSep=t[1].substring(1))},doRender:function(){!Rui.platform.isMobile||null!=this.type&&"text"!=this.type||(this.type="date"),this.createTemplate(this.el);var e=document.createElement("input");e.type="hidden",e.name=this.name||this.id,e.id=Rui.useFixedId()?Rui.id(this.el,"LDateBox-hidden-"+this.id):Rui.id(),e.instance=this,e.className="L-instance L-hidden-field",this.el.appendChild(e),this.hiddenInputEl=Rui.get(e),this.hiddenInputEl.addClass("L-hidden-field"),this.inputEl.removeAttribute("name"),this.inputEl.setStyle("ime-mode","disabled"),Rui.platform.isMobile&&this.inputEl.on("change",function(e){this.setValue(this.inputEl.getValue())},this,!0),this.doRenderCalendar()},doRenderCalendar:function(){var e,t,i;this.picker&&((e=document.createElement("div")).className="L-cal-container",e.id=Rui.useFixedId()?Rui.id(this.el,"LDateBox-cal-"+this.id):Rui.id(),this.calendarDivEl=Rui.get(e),document.body.appendChild(e),(t=document.createElement("a")).className="icon",t.id=Rui.useFixedId()?Rui.id(this.el,"LDateBox-icon-"+this.id):Rui.id(),this.el.appendChild(t),this.iconEl=Rui.get(t),Rui.useAccessibility()&&this.iconEl.setAttribute("role","button"),(i=this.calendarConfig||{}).applyTo=this.calendarDivEl.id,this.calendarDivEl.addClass(this.CSS_BASE+"-calendar"),this.calendar=new this.calendarClass(i),this.calendar.render(),this.calendar.hide())},pickerOn:function(){this.iconEl&&(this.iconEl.on("mousedown",this.onIconClick,this,!0),this.iconEl.setStyle("cursor","pointer"),-1<this.iconTabIndex&&this.iconEl.setAttribute("tabindex",this.iconTabIndex))},pickerOff:function(){this.iconEl&&(this.iconEl.unOn("mousedown",this.onIconClick,this),this.iconEl.setStyle("cursor","default"),-1<this.iconTabIndex&&this.iconEl.removeAttribute("tabindex"))},deferOnBlur:function(e){var t,i;this.calendarDivEl&&this.calendarDivEl.isAncestor(e.target)&&("a"==(t=Rui.get(e.target)).dom.tagName.toLowerCase()&&t.hasClass("selector")&&(i=this.calendar.getProperty("pagedate"),i=new Date(i.getFullYear(),i.getMonth(),parseInt(t.getHtml())),this.setValue(i),this.calendar&&this.calendar.hide())),Rui.util.LFunction.defer(this.checkBlur,10,this,[e])},checkBlur:function(e){var t,i,s;1!=e.deferCancelBubble&&!0===this.isFocus&&(t=e.target,i=Rui.get(e.target),s=this.calendar.id,t===this.el.dom||this.el.isAncestor(t)||this.calendarDivEl&&(t===this.calendarDivEl.dom||this.calendarDivEl.isAncestor(t)||"a"===i.dom.tagName.toLowerCase()&&-1!==i.dom.id.indexOf(s))?e.deferCancelBubble=!0:(Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.onBlur.call(this,e),this.isFocus=!1))},onBlur:function(e){Rui.ui.form.LDateBox.superclass.onBlur.call(this,e),this.calendar&&this.calendar.hide()},doChangedDisplayValue:function(e){this.setValue(e)},getDate:function(e){if(e instanceof Date)return e;var t=Rui.util.LFormat.stringToDate(e,{format:this.displayValue||"%x"});return t instanceof Date||(t=Rui.util.LFormat.stringToDate(e,{format:this.valueFormat})),t instanceof Date&&t},getDateString:function(e,t){t=t||"%Y%m%d";var i=e?Rui.util.LFormat.dateToString(e,{format:t}):"";return i||""},setCalendarXY:function(){var e=this.calendarDivEl.getHeight()||0,t=this.getDisplayEl().getTop()+this.getDisplayEl().getHeight(),i=this.getDisplayEl().getLeft();("auto"!=this.listPosition||Rui.util.LDom.isVisibleSide(e+t))&&"up"!=this.listPosition||(t=this.getDisplayEl().getTop()-e),Rui.util.LDom.getViewport().width<=i+this.calendarDivEl.getWidth()&&(i-=this.calendarDivEl.getWidth()/2),this.calendarDivEl.setTop(t),this.calendarDivEl.setLeft(i)},onIconClick:function(e){this.showCalendar(),this.inputEl.focus(),Rui.util.LEvent.preventDefault(e)},showCalendar:function(){!0!==this.disabled&&(this.calendarDivEl.setTop(0),this.calendarDivEl.setLeft(0),this.selectingInputDate&&this.selectCalendarDate(),this.calendar.show(),this.setCalendarXY())},selectCalendarDate:function(e){var t;(e=e||this.getValue())instanceof Date||(e=this.getDate(e)),e&&(this.calendar.clear(),0<(t=this.calendar.select(e,!1)).length&&(this.calendar.cfg.setProperty("pagedate",t[0]),this.calendar.render()))},initLocaleMask:function(){if(!Rui.platform.isMobile){for(var e=this.getLocaleFormat().split("%"),t="",i=1;i<e.length;i++){switch(e[i].toLowerCase().charAt(0)){case"y":t+="9999";break;case"m":case"d":t+="99"}1<e[i].length&&(t+=e[i].charAt(1))}this.mask=t}this.displayValue="%x"},getLocaleFormat:function(){var e,t=Rui.getConfig().getFirst("$.core.defaultLocale");return this.displayValue&&this.displayValue.length<4?(e=this.displayValue.substring(1),Rui.util.LDateLocale[t][e]):this.displayValue},_setWidth:function(e,t,i){t[0]<0||(Rui.ui.form.LDateBox.superclass._setWidth.call(this,e,t,i),this.iconEl&&this.getDisplayEl().setWidth(this.getContentWidth()-(this.iconEl.getWidth()||this.iconWidth)-this.iconMarginLeft))},_setDisabled:function(e,t,i){!1===t[0]?this.pickerOn():this.pickerOff(),Rui.ui.form.LDateBox.superclass._setDisabled.call(this,e,t,i)},setValue:function(e,t){var i,s,a,n=e;"string"==typeof e&&(e=e&&Rui.isString(e)&&!0===Rui.platform.isMobile?(e=e.replace(/-/g,""),Rui.util.LString.toDate(e,"%Y%m%d")):(e=8==e.length||14==e.length||Rui.util.LString.isHangul(e)?e:this.getUnmaskValue(e),Rui.isEmpty(e)?null:this.localeMask?this.getDate(n):this.getDate(e))),!1===e?(i=Rui.getMessageManager().get("$.base.msg016"),Rui.util.LDom.toast(i,this.el.dom),this.invalid(i),this.getDisplayEl().dom.value=this.lastDisplayValue||""):(s=null===e?"":this.getDateString(e,this.valueFormat),a=null===e?"":this.getDateString(e),a=this.localeMask?this.getDateString(e,this.getLocaleFormat()):(Rui.platform.isMobile&&e?this.getDisplayEl().dom.value=e.format("%Y-%m-%d"):this.getDisplayEl().dom.value=a,this.checkValue().displayValue),Rui.platform.isMobile&&(a=this.getDisplayEl().dom.value),this.getDisplayEl().dom.value=a,this.hiddenInputEl.dom.value!==s&&(this.hiddenInputEl.setValue(s),this.lastDisplayValue=a,!0!==t&&this.fireEvent("changed",{target:this,value:this.getValue(),displayValue:this.getDisplayValue()})))},getValue:function(){var e=Rui.ui.form.LDateBox.superclass.getValue.call(this),t=null,t=this.localeMask?(format="%x"!=this.displayValue?Rui.util.LString.replaceAll(this.displayValue,this.displayValueSep,""):"%q",Rui.util.LFormat.stringToDate(e,{format:format})):this.getDate(e);return"date"==this.dateType?t||this.getEmptyValue(e):this.getDateString(t,this.valueFormat)},hide:function(e){this.calendar&&this.calendar.hide(),Rui.ui.form.LDateBox.superclass.hide.call(this,e)},destroy:function(){this.iconEl&&(this.iconEl.remove(),delete this.iconEl),this.calendar&&this.calendar.destroy(),Rui.ui.form.LDateBox.superclass.destroy.call(this)}}),Rui.namespace("Rui.ui.calendar"),function(){var X=Rui.util.LDom,f=Rui.util.LEvent,g=Rui;function $(e,t,i){1==arguments.length&&"object"==typeof e&&(e=t=(i=e).applyTo||e.renderTo||e.id||Rui.id()),this.init.call(this,e,t,i),(i=i||{})&&(i.applyTo||i.renderTo)&&this.render()}$.IMG_ROOT=null,$.DATE="D",$.MONTH_DAY="MD",$.WEEKDAY="WD",$.RANGE="R",$.MONTH="M",$.DISPLAY_DAYS=42,$.STOP_RENDER="S",$.SHORT="short",$.LONG="long",$.MEDIUM="medium",$.ONE_CHAR="1char";var e,Q=$._DEFAULT_CONFIG={PAGEDATE:{key:"pagedate",value:null},SELECTED:{key:"selected",value:null},TITLE:{key:"title",value:null},CLOSE:{key:"close",value:!1},IFRAME:{key:"iframe",value:!!(Rui.browser.msie&&Rui.browser.msie<=6)},MINDATE:{key:"mindate",value:null},MAXDATE:{key:"maxdate",value:null},MULTI_SELECT:{key:"multi_select",value:!1},START_WEEKDAY:{key:"start_weekday",value:0},SHOW_WEEKDAYS:{key:"show_weekdays",value:!0},SHOW_WEEK_HEADER:{key:"show_week_header",value:!1},SHOW_WEEK_FOOTER:{key:"show_week_footer",value:!1},HIDE_BLANK_WEEKS:{key:"hide_blank_weeks",value:!1},NAV_ARROW_LEFT:{key:"nav_arrow_left",value:null},NAV_ARROW_RIGHT:{key:"nav_arrow_right",value:null},MONTHS_SHORT:{key:"months_short",value:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},MONTHS_LONG:{key:"months_long",value:["January","February","March","April","May","June","July","August","September","October","November","December"]},WEEKDAYS_1CHAR:{key:"weekdays_1char",value:["S","M","T","W","T","F","S"]},WEEKDAYS_SHORT:{key:"weekdays_short",value:["Su","Mo","Tu","We","Th","Fr","Sa"]},WEEKDAYS_MEDIUM:{key:"weekdays_medium",value:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},WEEKDAYS_LONG:{key:"weekdays_long",value:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},LOCALE_MONTHS:{key:"locale_months",value:"long"},LOCALE_WEEKDAYS:{key:"locale_weekdays",value:"short"},DATE_DELIMITER:{key:"date_delimiter",value:","},DATE_FIELD_DELIMITER:{key:"date_field_delimiter",value:"/"},DATE_RANGE_DELIMITER:{key:"date_range_delimiter",value:"~"},MY_MONTH_POSITION:{key:"my_month_position",value:1},MY_YEAR_POSITION:{key:"my_year_position",value:2},MD_MONTH_POSITION:{key:"md_month_position",value:1},MD_DAY_POSITION:{key:"md_day_position",value:2},MDY_MONTH_POSITION:{key:"mdy_month_position",value:1},MDY_DAY_POSITION:{key:"mdy_day_position",value:2},MDY_YEAR_POSITION:{key:"mdy_year_position",value:3},MY_LABEL_MONTH_POSITION:{key:"my_label_month_position",value:1},MY_LABEL_YEAR_POSITION:{key:"my_label_year_position",value:2},MY_LABEL_MONTH_SUFFIX:{key:"my_label_month_suffix",value:" "},MY_LABEL_YEAR_SUFFIX:{key:"my_label_year_suffix",value:""},NAV:{key:"navigator",value:null},STRINGS:{key:"strings",value:{previousMonth:"Previous Month",nextMonth:"Next Month",previousYear:"Previous Year",nextYear:"Next Year",close:"Close"},supercedes:["close","title"]}};$._EVENT_TYPES={BEFORE_SELECT:"beforeSelect",SELECT:"select",BEFORE_DESELECT:"beforeDeselect",DESELECT:"deselect",BEFORE_CHANGE_PAGE:"beforeChangePage",CHANGE_PAGE:"changePage",BEFORE_RENDER:"beforeRender",RENDER:"render",RENDER_CELL:"renderCell",BEFORE_DESTROY:"beforeDestroy",DESTROY:"destroy",RESET:"reset",CLEAR:"clear",BEFORE_HIDE:"beforeHide",HIDE:"hide",BEFORE_SHOW:"beforeShow",SHOW:"show",BEFORE_HIDE_NAV:"beforeHideNav",HIDE_NAV:"hideNav",BEFORE_SHOW_NAV:"beforeShowNav",SHOW_NAV:"showNav",BEFORE_RENDER_NAV:"beforeRenderNav",RENDER_NAV:"renderNav",CURSOR_IN:"cursorIn",CURSOR_OUT:"cursorOut"},$._STYLES={CSS_ROW_HEADER:"L-calrowhead",CSS_ROW_FOOTER:"L-calrowfoot",CSS_CELL:"L-calcell",CSS_CELL_SELECTOR:"selector",CSS_CELL_SELECTED:"selected",CSS_CELL_SELECTABLE:"selectable",CSS_CELL_RESTRICTED:"restricted",CSS_CELL_TODAY:"today",CSS_CELL_OOM:"oom",CSS_CELL_OOB:"oob",CSS_HEADER:"L-calheader",CSS_HEADER_TEXT:"L-calhead",CSS_BODY:"L-calbody",CSS_WEEKDAY_CELL:"L-calweekdaycell",CSS_WEEKDAY_ROW:"L-calweekdayrow",CSS_FOOTER:"L-calfoot",CSS_CALENDAR:"L-calendar",CSS_SINGLE:"L-single",CSS_CONTAINER:"L-calcontainer",CSS_NAV_YEAR_LEFT:"L-calnavyearleft",CSS_NAV_YEAR_RIGHT:"L-calnavyearright",CSS_NAV_LEFT:"L-calnavleft",CSS_NAV_RIGHT:"L-calnavright",CSS_NAV:"L-calnav",CSS_CLOSE:"L-calclose",CSS_CELL_TOP:"L-calcelltop",CSS_CELL_LEFT:"L-calcellleft",CSS_CELL_RIGHT:"L-calcellright",CSS_CELL_BOTTOM:"L-calcellbottom",CSS_CELL_HOVER:"L-calcellhover",CSS_CELL_HIGHLIGHT1:"highlight1",CSS_CELL_HIGHLIGHT2:"highlight2",CSS_CELL_HIGHLIGHT3:"highlight3",CSS_CELL_HIGHLIGHT4:"highlight4"},$.prototype={Config:null,parent:null,index:-1,cells:null,cellDates:null,id:null,containerId:null,oDomContainer:null,today:null,titleCode:"$.base.msg118",renderStack:null,_renderStack:null,oNavigator:null,_selectedDates:null,domEventMap:null,_parseArgs:function(e){var t={id:null,container:null,config:null};if(e&&e.length&&0<e.length)switch(e.length){case 1:t.id=e[0].id?e[0].id:null,t.container=e[0].applyTo?e[0].applyTo:e[0],t.config="object"==typeof e[0]?e[0]:null;break;case 2:!Rui.isObject(e[1])||e[1].tagName||e[1]instanceof String?(t.id=e[0],t.container=e[1],t.config=null):(t.id=null,t.container=e[0],t.config=e[1]);break;default:t.id=e[0],t.container=e[1],t.config=e[2]}return t},init:function(e,t,i){var s,a=this._parseArgs(arguments);e=a.id,t=a.container,i=a.config,(i=Rui.applyIf(i,Rui.getConfig().getFirst("$.ext.calendar.defaultProperties"))).titleCode&&(s=Rui.getMessageManager(),i.title=s.get(i.titleCode));var n=Rui.get(t).dom;n.id||(n.id=X.generateId()),e=e||n.id+"_t",this.id=e,this.containerId=n.id,this.initEvents(),!this.today&&i&&i.today?this.today=i.today:this.today=new Date,Rui.util.LDate.clearTime(this.today),this.cfg=new Rui.ui.LConfig(this),this.Options={},this.Locale={},this.initStyles(),X.addClass(n,this.Style.CSS_CONTAINER),X.addClass(n,this.Style.CSS_SINGLE),X.addClass(n,"L-fixed"),this.oDomContainer=n,this.cellDates=[],this.cells=[],this.renderStack=[],this._renderStack=[],this.setupConfig(),i&&this.cfg.applyConfig(i,!0),this.cfg.fireQueue(),this._setDefaultLocale()},setProperty:function(e,t){this.cfg.setProperty(e,t)},getProperty:function(e){return this.cfg.getProperty(e)},_setDefaultLocale:function(e){for(var t=Rui.getConfig().getFirst("$.core.defaultLocale"),i=Rui.getMessageManager(),s=i.get(this.titleCode),a=Rui.util.LDate.getLocale(t),n=a.x,l=n.split("%"),r=1,o=2,h=3,u=1;u<l.length;u++)switch(l[u].toLowerCase().charAt(0)){case"y":r=u;break;case"m":o=u;break;case"d":h=u}var d="%"==n.charAt(2)?"":n.charAt(2);null==this.cfg.getProperty("TITLE")&&this.cfg.setProperty("TITLE",s),this.cfg.setProperty("START_WEEKDAY",i.get("$.core.startWeekDay")),this.cfg.setProperty("MONTHS_SHORT",a.b),this.cfg.setProperty("MONTHS_LONG",a.B),this.cfg.setProperty("WEEKDAYS_1CHAR",i.get("$.core.weekdays1Char")),this.cfg.setProperty("WEEKDAYS_SHORT",i.get("$.core.shortDayInWeek")),this.cfg.setProperty("WEEKDAYS_MEDIUM",a.a),this.cfg.setProperty("WEEKDAYS_LONG",a.A),this.cfg.setProperty("LOCALE_MONTHS",i.get("$.core.localeMonths")),this.cfg.setProperty("LOCALE_WEEKDAYS",i.get("$.core.localeWeekdays")),this.cfg.setProperty("DATE_DELIMITER",i.get("$.core.dateDelimiter")),this.cfg.setProperty("DATE_FIELD_DELIMITER",d),this.cfg.setProperty("DATE_RANGE_DELIMITER",i.get("$.core.dateRangeDelimiter")),this.cfg.setProperty("MY_MONTH_POSITION",o),this.cfg.setProperty("MY_YEAR_POSITION",r),this.cfg.setProperty("MD_MONTH_POSITION",o),this.cfg.setProperty("MD_DAY_POSITION",h),this.cfg.setProperty("MDY_MONTH_POSITION",o),this.cfg.setProperty("MDY_DAY_POSITION",h),this.cfg.setProperty("MDY_YEAR_POSITION",r),this.cfg.setProperty("MY_LABEL_MONTH_POSITION",o),this.cfg.setProperty("MY_LABEL_YEAR_POSITION",r),this.cfg.setProperty("MY_LABEL_MONTH_SUFFIX",i.get("$.core.myLabelMonthSuffix")),this.cfg.setProperty("MY_LABEL_YEAR_SUFFIX",i.get("$.core.myLabelYearSuffix"))},configIframe:function(e,t,i){var s,a=t[0];this.parent||X.inDocument(this.oDomContainer)&&(a?"absolute"!=(s=X.getStyle(this.oDomContainer,"position"))&&"relative"!=s||X.inDocument(this.iframe)||(this.iframe=document.createElement("iframe"),this.iframe.width=this.oDomContainer.style.width,this.iframe.height=this.oDomContainer.style.height,X.setStyle(this.iframe,"opacity","0"),Rui.browser.msie&&Rui.browser.msie<=6&&X.addClass(this.iframe,"fixedsize"),this.oDomContainer.insertBefore(this.iframe,this.oDomContainer.firstChild)):this.iframe&&(this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.iframe=null))},configTitle:function(e,t,i){var s=t[0];s?this.createTitleBar(s):this.cfg.getProperty(Q.CLOSE.key)?this.createTitleBar("&#160;"):this.removeTitleBar()},configClose:function(e,t,i){var s=t[0],a=this.cfg.getProperty(Q.TITLE.key);s?(a||this.createTitleBar("&#160;"),this.createCloseButton()):(this.removeCloseButton(),a||this.removeTitleBar())},initEvents:function(){var e=$._EVENT_TYPES,t=Rui.util.LCustomEvent,i=this;i.beforeSelectEvent=new t(e.BEFORE_SELECT,this,!1,Rui.util.LCustomEvent.FLAT),i.selectEvent=new t(e.SELECT,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeDeselectEvent=new t(e.BEFORE_DESELECT),i.deselectEvent=new t(e.DESELECT,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeChangePageEvent=new t(e.BEFORE_CHANGE_PAGE,this,!1,Rui.util.LCustomEvent.FLAT),i.changePageEvent=new t(e.CHANGE_PAGE,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeRenderEvent=new t(e.BEFORE_RENDER,this,!1,Rui.util.LCustomEvent.FLAT),i.renderEvent=new t(e.RENDER,this,!1,Rui.util.LCustomEvent.FLAT),i.renderCellEvent=new t(e.RENDER_CELL,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeDestroyEvent=new t(e.BEFORE_DESTROY,this,!1,Rui.util.LCustomEvent.FLAT),i.destroyEvent=new t(e.DESTROY,this,!1,Rui.util.LCustomEvent.FLAT),i.resetEvent=new t(e.RESET,this,!1,Rui.util.LCustomEvent.FLAT),i.clearEvent=new t(e.CLEAR,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeShowEvent=new t(e.BEFORE_SHOW,this,!1,Rui.util.LCustomEvent.FLAT),i.showEvent=new t(e.SHOW,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeHideEvent=new t(e.BEFORE_HIDE,this,!1,Rui.util.LCustomEvent.FLAT),i.hideEvent=new t(e.HIDE,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeShowNavEvent=new t(e.BEFORE_SHOW_NAV,this,!1,Rui.util.LCustomEvent.FLAT),i.showNavEvent=new t(e.SHOW_NAV,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeHideNavEvent=new t(e.BEFORE_HIDE_NAV,this,!1,Rui.util.LCustomEvent.FLAT),i.hideNavEvent=new t(e.HIDE_NAV,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeRenderNavEvent=new t(e.BEFORE_RENDER_NAV,this,!1,Rui.util.LCustomEvent.FLAT),i.renderNavEvent=new t(e.RENDER_NAV,this,!1,Rui.util.LCustomEvent.FLAT),i.cursorInEvent=new t(e.CURSOR_IN,this,!1,Rui.util.LCustomEvent.FLAT),i.cursorOutEvent=new t(e.CURSOR_OUT,this,!1,Rui.util.LCustomEvent.FLAT),i.beforeSelectEvent.on(i.onBeforeSelect,this,!0),i.selectEvent.on(i.onSelect,this,!0),i.beforeDeselectEvent.on(i.onBeforeDeselect,this,!0),i.deselectEvent.on(i.onDeselect,this,!0),i.changePageEvent.on(i.onChangePage,this,!0),i.renderEvent.on(i.onRender,this,!0),i.resetEvent.on(i.onReset,this,!0),i.clearEvent.on(i.onClear,this,!0)},doPreviousMonthNav:function(t,i){f.preventDefault(t),setTimeout(function(){if(0!=i.beforeChangePageEvent.fire(this,t)){i.previousMonth();var e=X.getElementsByClassName(i.Style.CSS_NAV_LEFT,"a",i.oDomContainer);if(e&&e[0])try{e[0].focus()}catch(e){}}},Rui.platform.isMobile?10:0)},doNextMonthNav:function(t,i){f.preventDefault(t),setTimeout(function(){if(0!=i.beforeChangePageEvent.fire(this,t)){i.nextMonth();var e=X.getElementsByClassName(i.Style.CSS_NAV_RIGHT,"a",i.oDomContainer);if(e&&e[0])try{e[0].focus()}catch(e){}}},Rui.platform.isMobile?10:0)},doPreviousYearNav:function(t,i){f.preventDefault(t),setTimeout(function(){if(0!=i.beforeChangePageEvent.fire(this,t)){i.previousYear();var e=X.getElementsByClassName(i.Style.CSS_NAV_YEAR_LEFT,"a",i.oDomContainer);if(e&&e[0])try{e[0].focus()}catch(e){}}},Rui.platform.isMobile?10:0)},doNextYearNav:function(t,i){f.preventDefault(t),setTimeout(function(){if(0!=i.beforeChangePageEvent.fire(this,t)){i.nextYear();var e=X.getElementsByClassName(i.Style.CSS_NAV_YEAR_RIGHT,"a",i.oDomContainer);if(e&&e[0])try{e[0].focus()}catch(e){}}},Rui.platform.isMobile?10:0)},doSelectCell:function(e,t){for(var i,s,a,n,l=f.getTarget(e),r=l.tagName.toLowerCase(),o=!1;"td"!=r&&!X.hasClass(l,t.Style.CSS_CELL_SELECTABLE);)if(!o&&"a"==r&&X.hasClass(l,t.Style.CSS_CELL_SELECTOR)&&(o=!0),r=(l=l.parentNode).tagName.toLowerCase(),l==this.oDomContainer||"html"==r)return;o&&f.preventDefault(e),i=l,X.hasClass(i,t.Style.CSS_CELL_SELECTABLE)&&-1<(n=t.getIndexFromId(i.id))&&t.cellDates[n]&&(t.Options.MULTI_SELECT?((s=i.getElementsByTagName("a")[0])&&s.blur(),a=t.cellDates[n],-1<t._indexOfSelectedFieldArray(a)?t.deselectCell(n):t.selectCell(n)):((s=i.getElementsByTagName("a")[0])&&s.blur(),t.selectCell(n)))},doCellMouseOver:function(e,t){for(var i,s,a=e?f.getTarget(e):this;a.tagName&&"td"!=a.tagName.toLowerCase();)if(!(a=a.parentNode).tagName||"html"==a.tagName.toLowerCase())return;a.id&&(X.hasClass(a,t.Style.CSS_CELL_SELECTABLE)&&X.addClass(a,t.Style.CSS_CELL_HOVER),i=t.getIndexFromId(a.id),s=t.cellDates[i],t.cursorInEvent.fire({cellDate:s,date:t._toDate(s)}))},doCellMouseOut:function(e,t){for(var i,s,a=e?f.getTarget(e):this;a.tagName&&"td"!=a.tagName.toLowerCase();)if(!(a=a.parentNode).tagName||"html"==a.tagName.toLowerCase())return;a.id&&(X.hasClass(a,t.Style.CSS_CELL_SELECTABLE)&&X.removeClass(a,t.Style.CSS_CELL_HOVER),i=t.getIndexFromId(a.id),s=t.cellDates[i],t.cursorOutEvent.fire({cellDate:s,date:t._toDate(s)}))},setupConfig:function(){var e=this.cfg;e.addProperty(Q.PAGEDATE.key,{value:new Date,handler:this.configPageDate}),e.addProperty(Q.SELECTED.key,{value:[],handler:this.configSelected}),e.addProperty(Q.TITLE.key,{value:Q.TITLE.value,handler:this.configTitle}),e.addProperty(Q.CLOSE.key,{value:Q.CLOSE.value,handler:this.configClose}),e.addProperty(Q.IFRAME.key,{value:Q.IFRAME.value,handler:this.configIframe,validator:e.checkBoolean}),e.addProperty(Q.MINDATE.key,{value:Q.MINDATE.value,handler:this.configMinDate}),e.addProperty(Q.MAXDATE.key,{value:Q.MAXDATE.value,handler:this.configMaxDate}),e.addProperty(Q.MULTI_SELECT.key,{value:Q.MULTI_SELECT.value,handler:this.configOptions,validator:e.checkBoolean}),e.addProperty(Q.START_WEEKDAY.key,{value:Q.START_WEEKDAY.value,handler:this.configOptions,validator:e.checkNumber}),e.addProperty(Q.SHOW_WEEKDAYS.key,{value:Q.SHOW_WEEKDAYS.value,handler:this.configOptions,validator:e.checkBoolean}),e.addProperty(Q.SHOW_WEEK_HEADER.key,{value:Q.SHOW_WEEK_HEADER.value,handler:this.configOptions,validator:e.checkBoolean}),e.addProperty(Q.SHOW_WEEK_FOOTER.key,{value:Q.SHOW_WEEK_FOOTER.value,handler:this.configOptions,validator:e.checkBoolean}),e.addProperty(Q.HIDE_BLANK_WEEKS.key,{value:Q.HIDE_BLANK_WEEKS.value,handler:this.configOptions,validator:e.checkBoolean}),e.addProperty(Q.NAV_ARROW_LEFT.key,{value:Q.NAV_ARROW_LEFT.value,handler:this.configOptions}),e.addProperty(Q.NAV_ARROW_RIGHT.key,{value:Q.NAV_ARROW_RIGHT.value,handler:this.configOptions}),e.addProperty(Q.MONTHS_SHORT.key,{value:Q.MONTHS_SHORT.value,handler:this.configLocale}),e.addProperty(Q.MONTHS_LONG.key,{value:Q.MONTHS_LONG.value,handler:this.configLocale}),e.addProperty(Q.WEEKDAYS_1CHAR.key,{value:Q.WEEKDAYS_1CHAR.value,handler:this.configLocale}),e.addProperty(Q.WEEKDAYS_SHORT.key,{value:Q.WEEKDAYS_SHORT.value,handler:this.configLocale}),e.addProperty(Q.WEEKDAYS_MEDIUM.key,{value:Q.WEEKDAYS_MEDIUM.value,handler:this.configLocale}),e.addProperty(Q.WEEKDAYS_LONG.key,{value:Q.WEEKDAYS_LONG.value,handler:this.configLocale});function t(){e.refireEvent(Q.LOCALE_MONTHS.key),e.refireEvent(Q.LOCALE_WEEKDAYS.key)}e.subscribeToConfigEvent(Q.START_WEEKDAY.key,t,this,!0),e.subscribeToConfigEvent(Q.MONTHS_SHORT.key,t,this,!0),e.subscribeToConfigEvent(Q.MONTHS_LONG.key,t,this,!0),e.subscribeToConfigEvent(Q.WEEKDAYS_1CHAR.key,t,this,!0),e.subscribeToConfigEvent(Q.WEEKDAYS_SHORT.key,t,this,!0),e.subscribeToConfigEvent(Q.WEEKDAYS_MEDIUM.key,t,this,!0),e.subscribeToConfigEvent(Q.WEEKDAYS_LONG.key,t,this,!0),e.addProperty(Q.LOCALE_MONTHS.key,{value:Q.LOCALE_MONTHS.value,handler:this.configLocaleValues}),e.addProperty(Q.LOCALE_WEEKDAYS.key,{value:Q.LOCALE_WEEKDAYS.value,handler:this.configLocaleValues}),e.addProperty(Q.DATE_DELIMITER.key,{value:Q.DATE_DELIMITER.value,handler:this.configLocale}),e.addProperty(Q.DATE_FIELD_DELIMITER.key,{value:Q.DATE_FIELD_DELIMITER.value,handler:this.configLocale}),e.addProperty(Q.DATE_RANGE_DELIMITER.key,{value:Q.DATE_RANGE_DELIMITER.value,handler:this.configLocale}),e.addProperty(Q.MY_MONTH_POSITION.key,{value:Q.MY_MONTH_POSITION.value,handler:this.configLocale,validator:e.checkNumber}),e.addProperty(Q.MY_YEAR_POSITION.key,{value:Q.MY_YEAR_POSITION.value,handler:this.configLocale,validator:e.checkNumber}),e.addProperty(Q.MD_MONTH_POSITION.key,{value:Q.MD_MONTH_POSITION.value,handler:this.configLocale,validator:e.checkNumber}),e.addProperty(Q.MD_DAY_POSITION.key,{value:Q.MD_DAY_POSITION.value,handler:this.configLocale,validator:e.checkNumber}),e.addProperty(Q.MDY_MONTH_POSITION.key,{value:Q.MDY_MONTH_POSITION.value,handler:this.configLocale,validator:e.checkNumber}),e.addProperty(Q.MDY_DAY_POSITION.key,{value:Q.MDY_DAY_POSITION.value,handler:this.configLocale,validator:e.checkNumber}),e.addProperty(Q.MDY_YEAR_POSITION.key,{value:Q.MDY_YEAR_POSITION.value,handler:this.configLocale,validator:e.checkNumber}),e.addProperty(Q.MY_LABEL_MONTH_POSITION.key,{value:Q.MY_LABEL_MONTH_POSITION.value,handler:this.configLocale,validator:e.checkNumber}),e.addProperty(Q.MY_LABEL_YEAR_POSITION.key,{value:Q.MY_LABEL_YEAR_POSITION.value,handler:this.configLocale,validator:e.checkNumber}),e.addProperty(Q.MY_LABEL_MONTH_SUFFIX.key,{value:Q.MY_LABEL_MONTH_SUFFIX.value,handler:this.configLocale}),e.addProperty(Q.MY_LABEL_YEAR_SUFFIX.key,{value:Q.MY_LABEL_YEAR_SUFFIX.value,handler:this.configLocale}),e.addProperty(Q.NAV.key,{value:Q.NAV.value,handler:this.configNavigator}),e.addProperty(Q.STRINGS.key,{value:Q.STRINGS.value,handler:this.configStrings,validator:function(e){return Rui.isObject(e)},supercedes:Q.STRINGS.supercedes})},configStrings:function(e,t,i){var s=g.merge(Q.STRINGS.value,t[0]);this.cfg.setProperty(Q.STRINGS.key,s,!0)},configPageDate:function(e,t,i){this.cfg.setProperty(Q.PAGEDATE.key,this._parsePageDate(t[0]),!0)},configMinDate:function(e,t,i){var s=t[0];Rui.isString(s)&&(s=this._parseDate(s),this.cfg.setProperty(Q.MINDATE.key,Rui.util.LDate.getDate(s[0],s[1]-1,s[2])))},configMaxDate:function(e,t,i){var s=t[0];Rui.isString(s)&&(s=this._parseDate(s),this.cfg.setProperty(Q.MAXDATE.key,Rui.util.LDate.getDate(s[0],s[1]-1,s[2])))},configSelected:function(e,t,i){var s=t[0],a=Q.SELECTED.key;s&&Rui.isString(s)&&this.cfg.setProperty(a,this._parseDates(s),!0),this._selectedDates||(this._selectedDates=this.cfg.getProperty(a))},configOptions:function(e,t,i){this.Options[e.toUpperCase()]=t[0]},configLocale:function(e,t,i){this.Locale[e.toUpperCase()]=t[0],this.cfg.refireEvent(Q.LOCALE_MONTHS.key),this.cfg.refireEvent(Q.LOCALE_WEEKDAYS.key)},configLocaleValues:function(e,t,i){e=e.toLowerCase();var s=t[0],a=this.cfg,n=this.Locale;switch(e){case Q.LOCALE_MONTHS.key:switch(s){case $.SHORT:n.LOCALE_MONTHS=a.getProperty(Q.MONTHS_SHORT.key).concat();break;case $.LONG:n.LOCALE_MONTHS=a.getProperty(Q.MONTHS_LONG.key).concat()}break;case Q.LOCALE_WEEKDAYS.key:switch(s){case $.ONE_CHAR:n.LOCALE_WEEKDAYS=a.getProperty(Q.WEEKDAYS_1CHAR.key).concat();break;case $.SHORT:n.LOCALE_WEEKDAYS=a.getProperty(Q.WEEKDAYS_SHORT.key).concat();break;case $.MEDIUM:n.LOCALE_WEEKDAYS=a.getProperty(Q.WEEKDAYS_MEDIUM.key).concat();break;case $.LONG:n.LOCALE_WEEKDAYS=a.getProperty(Q.WEEKDAYS_LONG.key).concat()}var l=a.getProperty(Q.START_WEEKDAY.key);if(0<l)for(var r=0;r<l;++r)n.LOCALE_WEEKDAYS.push(n.LOCALE_WEEKDAYS.shift())}},configNavigator:function(e,t,i){var s=t[0];Rui.ui.calendar.LCalendarNavigator&&(!0===s||Rui.isObject(s))?this.oNavigator||(this.oNavigator=new Rui.ui.calendar.LCalendarNavigator(this),this.beforeRenderEvent.on(function(){this.pages||this.oNavigator.erase()},this,!0)):this.oNavigator&&(this.oNavigator.destroy(),this.oNavigator=null)},initStyles:function(){var e=$._STYLES;this.Style={CSS_ROW_HEADER:e.CSS_ROW_HEADER,CSS_ROW_FOOTER:e.CSS_ROW_FOOTER,CSS_CELL:e.CSS_CELL,CSS_CELL_SELECTOR:e.CSS_CELL_SELECTOR,CSS_CELL_SELECTED:e.CSS_CELL_SELECTED,CSS_CELL_SELECTABLE:e.CSS_CELL_SELECTABLE,CSS_CELL_RESTRICTED:e.CSS_CELL_RESTRICTED,CSS_CELL_TODAY:e.CSS_CELL_TODAY,CSS_CELL_OOM:e.CSS_CELL_OOM,CSS_CELL_OOB:e.CSS_CELL_OOB,CSS_HEADER:e.CSS_HEADER,CSS_HEADER_TEXT:e.CSS_HEADER_TEXT,CSS_BODY:e.CSS_BODY,CSS_WEEKDAY_CELL:e.CSS_WEEKDAY_CELL,CSS_WEEKDAY_ROW:e.CSS_WEEKDAY_ROW,CSS_FOOTER:e.CSS_FOOTER,CSS_CALENDAR:e.CSS_CALENDAR,CSS_SINGLE:e.CSS_SINGLE,CSS_CONTAINER:e.CSS_CONTAINER,CSS_NAV_YEAR_LEFT:e.CSS_NAV_YEAR_LEFT,CSS_NAV_YEAR_RIGHT:e.CSS_NAV_YEAR_RIGHT,CSS_NAV_LEFT:e.CSS_NAV_LEFT,CSS_NAV_RIGHT:e.CSS_NAV_RIGHT,CSS_NAV:e.CSS_NAV,CSS_CLOSE:e.CSS_CLOSE,CSS_CELL_TOP:e.CSS_CELL_TOP,CSS_CELL_LEFT:e.CSS_CELL_LEFT,CSS_CELL_RIGHT:e.CSS_CELL_RIGHT,CSS_CELL_BOTTOM:e.CSS_CELL_BOTTOM,CSS_CELL_HOVER:e.CSS_CELL_HOVER,CSS_CELL_HIGHLIGHT1:e.CSS_CELL_HIGHLIGHT1,CSS_CELL_HIGHLIGHT2:e.CSS_CELL_HIGHLIGHT2,CSS_CELL_HIGHLIGHT3:e.CSS_CELL_HIGHLIGHT3,CSS_CELL_HIGHLIGHT4:e.CSS_CELL_HIGHLIGHT4}},buildMonthLabel:function(){return this._buildMonthLabel(this.cfg.getProperty(Q.PAGEDATE.key))},_buildMonthLabel:function(e){var t=this.Locale.LOCALE_MONTHS[e.getMonth()],i=this.Locale.MY_LABEL_MONTH_SUFFIX,s=e.getFullYear(),a=this.Locale.MY_LABEL_YEAR_SUFFIX;return 2==this.Locale.MY_LABEL_MONTH_POSITION||1==this.Locale.MY_LABEL_YEAR_POSITION?'<span class="year">'+s+'</span><span class="year-suffix">'+a+'</span><span class="month">'+t+'</span><span class="month-suffix">'+i+"</span>":'<span class="month">'+t+'</span><span class="month-suffix">'+i+'</span><span class="year">'+s+'</span><span class="year-suffix">'+a+"</span>"},_buildYearLabel:function(e){var t=this.Locale.LOCALE_MONTHS[e.getMonth()],i=this.Locale.MY_LABEL_MONTH_SUFFIX,s=e.getFullYear(),a=this.Locale.MY_LABEL_YEAR_SUFFIX;return 2==this.Locale.MY_LABEL_MONTH_POSITION||1==this.Locale.MY_LABEL_YEAR_POSITION?'<span class="year">'+s+'</span><span class="year-suffix">'+a+'</span><span class="month">'+t+'</span><span class="month-suffix">'+i+"</span>":'<span class="month">'+t+'</span><span class="month-suffix">'+i+'</span><span class="year">'+s+'</span><span class="year-suffix">'+a+"</span>"},buildDayLabel:function(e){return e.getDate()},createTitleBar:function(e){var t=X.getElementsByClassName(Rui.ui.calendar.LCalendarGroup.CSS_2UPTITLE,"div",this.oDomContainer)[0]||document.createElement("div");return t.className=Rui.ui.calendar.LCalendarGroup.CSS_2UPTITLE,t.innerHTML=e,this.oDomContainer.insertBefore(t,this.oDomContainer.firstChild),X.addClass(this.oDomContainer,"withtitle"),t},removeTitleBar:function(){var e=X.getElementsByClassName(Rui.ui.calendar.LCalendarGroup.CSS_2UPTITLE,"div",this.oDomContainer)[0]||null;e&&(f.purgeElement(e),this.oDomContainer.removeChild(e)),X.removeClass(this.oDomContainer,"withtitle")},createCloseButton:function(){var e,t=Rui.ui.calendar.LCalendarGroup.CSS_2UPCLOSE,i=X.getElementsByClassName("link-close","a",this.oDomContainer)[0],s=this.cfg.getProperty(Q.STRINGS.key),a=s&&s.close?s.close:"";return i||(i=document.createElement("a"),f.addListener(i,"click",function(e,t){t.hide(),f.preventDefault(e)},this)),i.href="#",i.className="link-close",null!==$.IMG_ROOT?((e=X.getElementsByClassName(t,"img",i)[0]||document.createElement("img")).src=$.IMG_ROOT+"us/my/bn/x_d.gif",e.className=t,i.appendChild(e)):i.innerHTML='<span class="'+t+" "+this.Style.CSS_CLOSE+'">'+a+"</span>",this.oDomContainer.appendChild(i),i},removeCloseButton:function(){var e=X.getElementsByClassName("link-close","a",this.oDomContainer)[0]||null;e&&(f.purgeElement(e),this.oDomContainer.removeChild(e))},renderHeader:function(e){var t,i,s=7,a=this.cfg,n=a.getProperty(Q.PAGEDATE.key),l=a.getProperty(Q.STRINGS.key),r=l&&l.previousMonth?l.previousMonth:"",o=l&&l.nextMonth?l.nextMonth:"",h=l&&l.previousYear?l.previousYear:"",u=l&&l.nextYear?l.nextYear:"";a.getProperty(Q.SHOW_WEEK_HEADER.key)&&(s+=1),a.getProperty(Q.SHOW_WEEK_FOOTER.key)&&(s+=1),e[e.length]="<thead>",e[e.length]="<tr>",e[e.length]='<th colspan="'+s+'" class="'+this.Style.CSS_HEADER_TEXT+'">',e[e.length]='<div class="'+this.Style.CSS_HEADER+'">';var d,c,E,f,g=!1;this.parent?(0===this.index&&(d=!0),this.index==this.parent.cfg.getProperty("pages")-1&&(g=!0)):g=d=!0,d&&(t=this._buildMonthLabel(Rui.util.LDate.subtract(n,Rui.util.LDate.MONTH,1)),i=this._buildYearLabel(Rui.util.LDate.subtract(n,Rui.util.LDate.YEAR,1)),null===(c=a.getProperty(Q.NAV_ARROW_LEFT.key))&&null!==$.IMG_ROOT&&(c=$.IMG_ROOT+"us/tr/callt.gif"),E=null===c?"":' style="background-image:url('+c+')"',f='<a class="'+this.Style.CSS_NAV_YEAR_LEFT+'"'+E+' href="#" id="'+this.id+'_calnavyearleft"'+(Rui.useAccessibility()?'role="button"':"")+">"+h+" ("+i+")</a>",f+='<a class="'+this.Style.CSS_NAV_LEFT+'"'+E+' href="#" id="'+this.id+'_calnavleft"'+(Rui.useAccessibility()?'role="button"':"")+">"+r+" ("+t+")</a>",e[e.length]=f);var p,v,y,S=this.buildMonthLabel();return(this.parent||this).cfg.getProperty("navigator")&&(S='<a class="'+this.Style.CSS_NAV+'" href="#" id="'+this.id+'_calnav"'+(Rui.useAccessibility()?'role="heading"':"")+">"+S+"</a>"),e[e.length]=S,g&&(t=this._buildMonthLabel(Rui.util.LDate.add(n,Rui.util.LDate.MONTH,1)),i=this._buildYearLabel(Rui.util.LDate.add(n,Rui.util.LDate.YEAR,1)),null===(p=a.getProperty(Q.NAV_ARROW_RIGHT.key))&&null!==$.IMG_ROOT&&(p=$.IMG_ROOT+"us/tr/calrt.gif"),v=null===p?"":' style="background-image:url('+p+')"',y='<a class="'+this.Style.CSS_NAV_RIGHT+'"'+v+' href="#" id="'+this.id+'_calnavright"'+(Rui.useAccessibility()?'role="button"':"")+">"+o+" ("+t+")</a>",y+='<a class="'+this.Style.CSS_NAV_YEAR_RIGHT+'"'+v+' href="#" id="'+this.id+'_calnavryearight"'+(Rui.useAccessibility()?'role="button"':"")+">"+u+" ("+i+")</a>",e[e.length]=y),e[e.length]="</div>\n</th>\n</tr>",a.getProperty(Q.SHOW_WEEKDAYS.key)&&(e=this.buildWeekdays(e)),e[e.length]="</thead>",e},buildWeekdays:function(e){e[e.length]='<tr class="'+this.Style.CSS_WEEKDAY_ROW+'">',this.cfg.getProperty(Q.SHOW_WEEK_HEADER.key)&&(e[e.length]="<th>&#160;</th>");for(var t=0;t<this.Locale.LOCALE_WEEKDAYS.length;++t)e[e.length]='<th class="L-calweekdaycell">'+this.Locale.LOCALE_WEEKDAYS[t]+"</th>";return this.cfg.getProperty(Q.SHOW_WEEK_FOOTER.key)&&(e[e.length]="<th>&#160;</th>"),e[e.length]="</tr>",e},renderBody:function(e,t){var i=this.cfg.getProperty(Q.START_WEEKDAY.key);this.preMonthDays=e.getDay(),0<i&&(this.preMonthDays-=i),this.preMonthDays<0&&(this.preMonthDays+=7),this.monthDays=Rui.util.LDate.getLastDayOfMonth(e).getDate(),this.postMonthDays=$.DISPLAY_DAYS-this.preMonthDays-this.monthDays,e=Rui.util.LDate.subtract(e,Rui.util.LDate.DAY,this.preMonthDays);var s,a,n,l,r=this.today,o=this.cfg,h=r.getFullYear(),u=r.getMonth(),d=r.getDate(),c=o.getProperty(Q.PAGEDATE.key),E=o.getProperty(Q.HIDE_BLANK_WEEKS.key),f=o.getProperty(Q.SHOW_WEEK_FOOTER.key),g=o.getProperty(Q.SHOW_WEEK_HEADER.key),p=o.getProperty(Q.MINDATE.key),v=o.getProperty(Q.MAXDATE.key),p=p&&Rui.util.LDate.clearTime(p),v=v&&Rui.util.LDate.clearTime(v);t[t.length]='<tbody class="m'+(c.getMonth()+1)+" "+this.Style.CSS_BODY+'">';var y=0,S=document.createElement("div"),C=document.createElement("td");S.appendChild(C);for(var m=this.parent||this,L=0;L<6&&(a="w"+(s=Rui.util.LDate.getWeekNumber(e,i)),0===L||!0!==E||e.getMonth()==c.getMonth());L++){t[t.length]='<tr class="'+a+'">',g&&(t=this.renderRowHeader(s,t));for(var D=0;D<7;D++){n=[],this.clearElement(C),C.className=this.Style.CSS_CELL,C.id=this.id+"_cell"+y,e.getDate()==d&&e.getMonth()==u&&e.getFullYear()==h&&(n[n.length]=m.renderCellStyleToday);var _=[e.getFullYear(),e.getMonth()+1,e.getDate()];if(this.cellDates[this.cellDates.length]=_,e.getMonth()!=c.getMonth())n[n.length]=m.renderCellNotThisMonth;else{X.addClass(C,"wd"+e.getDay()),X.addClass(C,"d"+e.getDate());for(var R=0;R<this.renderStack.length;++R){l=null;var T,A,O,b=this.renderStack[R];switch(b[0]){case $.DATE:T=b[1][1],A=b[1][2],O=b[1][0],e.getMonth()+1==T&&e.getDate()==A&&e.getFullYear()==O&&(l=b[2],this.renderStack.splice(R,1));break;case $.MONTH_DAY:T=b[1][0],A=b[1][1],e.getMonth()+1==T&&e.getDate()==A&&(l=b[2],this.renderStack.splice(R,1));break;case $.RANGE:var N=b[1][0],I=b[1][1],k=N[1],M=N[2],P=N[0],F=Rui.util.LDate.getDate(P,k-1,M),w=I[1],Y=I[2],H=I[0],B=Rui.util.LDate.getDate(H,w-1,Y);e.getTime()>=F.getTime()&&e.getTime()<=B.getTime()&&(l=b[2],e.getTime()==B.getTime()&&this.renderStack.splice(R,1));break;case $.WEEKDAY:var x=b[1][0];e.getDay()+1==x&&(l=b[2]);break;case $.MONTH:T=b[1][0],e.getMonth()+1==T&&(l=b[2])}l&&(n[n.length]=l)}}-1<this._indexOfSelectedFieldArray(_)&&(n[n.length]=m.renderCellStyleSelected),p&&e.getTime()<p.getTime()||v&&e.getTime()>v.getTime()?n[n.length]=m.renderOutOfBoundsDate:(n[n.length]=m.styleCellDefault,n[n.length]=m.renderCellDefault);var V={date:e,pageDate:c,cell:C,stop:!1};if(this.renderCellEvent.fire(V),!0!==V.stop)for(var W=0;W<n.length&&n[W].call(m,e,C)!=$.STOP_RENDER;++W);e.setTime(e.getTime()+Rui.util.LDate.ONE_DAY_MS),e=Rui.util.LDate.clearTime(e),0<=y&&y<=6&&X.addClass(C,this.Style.CSS_CELL_TOP),y%7==0&&X.addClass(C,this.Style.CSS_CELL_LEFT),(y+1)%7==0&&X.addClass(C,this.Style.CSS_CELL_RIGHT);var K=this.postMonthDays;if(E&&7<=K)for(var G=Math.floor(K/7),U=0;U<G;++U)K-=7;y>=this.preMonthDays+K+this.monthDays-7&&X.addClass(C,this.Style.CSS_CELL_BOTTOM),Rui.useAccessibility()&&C.setAttribute("role","gridcell"),t[t.length]=S.innerHTML,y++}f&&(t=this.renderRowFooter(s,t)),t[t.length]="</tr>"}return t[t.length]="</tbody>",t},renderFooter:function(e){return e},render:function(){this.beforeRenderEvent.fire();var e=Rui.util.LDate.getFirstDayOfMonth(this.cfg.getProperty(Q.PAGEDATE.key));this.resetRenderers(),this.cellDates.length=0,f.purgeElement(this.oDomContainer,!0);var t=[];t[t.length]='<table cellSpacing="0" class="'+this.Style.CSS_CALENDAR+" y"+e.getFullYear()+'" id="'+this.id+'-table" '+(Rui.useAccessibility()?'role="grid"':"")+">",t=this.renderHeader(t),t=this.renderBody(e,t),(t=this.renderFooter(t))[t.length]="</table>",this.oDomContainer.innerHTML=t.join("\n"),this.applyListeners(),this.cells=this.oDomContainer.getElementsByTagName("td"),this.cfg.refireEvent(Q.TITLE.key),this.cfg.refireEvent(Q.CLOSE.key),this.cfg.refireEvent(Q.IFRAME.key),this.renderEvent.fire()},applyListeners:function(){var e,t=this.oDomContainer,i=this.parent||this,s="click",a=X.getElementsByClassName(this.Style.CSS_NAV_LEFT,"a",t),n=X.getElementsByClassName(this.Style.CSS_NAV_RIGHT,"a",t),l=X.getElementsByClassName(this.Style.CSS_NAV_YEAR_LEFT,"a",t),r=X.getElementsByClassName(this.Style.CSS_NAV_YEAR_RIGHT,"a",t);if(a&&0<a.length&&(this.linkLeft=a[0],f.addListener(this.linkLeft,s,this.doPreviousMonthNav,i,!0)),n&&0<n.length&&(this.linkRight=n[0],f.addListener(this.linkRight,s,this.doNextMonthNav,i,!0)),l&&0<l.length&&(this.yearLinkLeft=l[0],f.addListener(this.yearLinkLeft,s,this.doPreviousYearNav,i,!0)),r&&0<r.length&&(this.yearLinkRight=r[0],f.addListener(this.yearLinkRight,s,this.doNextYearNav,i,!0)),null!==i.cfg.getProperty("navigator")&&this.applyNavListeners(),this.domEventMap)for(var o in this.domEventMap)if(g.hasOwnProperty(this.domEventMap,o)){var h=this.domEventMap[o];h instanceof Array||(h=[h]);for(var u=0;u<h.length;u++)for(var d=h[u],c=X.getElementsByClassName(o,d.tag,this.oDomContainer),E=0;E<c.length;E++)e=c[E],f.addListener(e,d.event,d.handler,d.scope,d.correct)}f.addListener(this.oDomContainer,"click",this.doSelectCell,this),f.addListener(this.oDomContainer,"mouseover",this.doCellMouseOver,this),f.addListener(this.oDomContainer,"mouseout",this.doCellMouseOut,this)},applyNavListeners:function(){var n=this.parent||this,l=this,e=X.getElementsByClassName(this.Style.CSS_NAV,"a",this.oDomContainer);0<e.length&&f.addListener(e,"click",function(e,t){var i,s,a;0!=l.beforeChangePageEvent.fire(this,e)&&(this!==(i=f.getTarget(e))&&!X.isAncestor(this,i)||f.preventDefault(e),(s=n.oNavigator)&&(a=l.cfg.getProperty("pagedate"),s.setYear(a.getFullYear()),s.setMonth(a.getMonth()),s.show()))})},getDateByCellId:function(e){var t=this.getDateFieldsByCellId(e);return t?Rui.util.LDate.getDate(t[0],t[1]-1,t[2]):null},getDateFieldsByCellId:function(e){return-1<(e=this.getIndexFromId(e))?this.cellDates[e]:null},getCellIndex:function(e){var t=-1;if(e)for(var i=e.getMonth(),s=e.getFullYear(),a=e.getDate(),n=this.cellDates,l=0;l<n.length;++l){var r=n[l];if(r[0]===s&&r[1]===i+1&&r[2]===a){t=l;break}}return t},getIndexFromId:function(e){var t=-1,i=e.lastIndexOf("_cell");return-1<i&&(t=parseInt(e.substring(i+5),10)),t},renderOutOfBoundsDate:function(e,t){return X.addClass(t,this.Style.CSS_CELL_OOB),t.innerHTML=e.getDate(),$.STOP_RENDER},renderRowHeader:function(e,t){return t[t.length]='<th class="L-calrowhead">'+e+"</th>",t},renderRowFooter:function(e,t){return t[t.length]='<th class="L-calrowfoot">'+e+"</th>",t},renderCellDefault:function(e,t){t.innerHTML='<a href="#" class="'+this.Style.CSS_CELL_SELECTOR+'">'+this.buildDayLabel(e)+"</a>"},styleCellDefault:function(e,t){X.addClass(t,this.Style.CSS_CELL_SELECTABLE)},renderCellStyleHighlight1:function(e,t){X.addClass(t,this.Style.CSS_CELL_HIGHLIGHT1)},renderCellStyleHighlight2:function(e,t){X.addClass(t,this.Style.CSS_CELL_HIGHLIGHT2)},renderCellStyleHighlight3:function(e,t){X.addClass(t,this.Style.CSS_CELL_HIGHLIGHT3)},renderCellStyleHighlight4:function(e,t){X.addClass(t,this.Style.CSS_CELL_HIGHLIGHT4)},renderCellStyleToday:function(e,t){X.addClass(t,this.Style.CSS_CELL_TODAY)},renderCellStyleSelected:function(e,t){X.addClass(t,this.Style.CSS_CELL_SELECTED),Rui.useAccessibility()&&t.setAttribute("aria-selected","true")},renderCellNotThisMonth:function(e,t){return X.addClass(t,this.Style.CSS_CELL_OOM),t.innerHTML=e.getDate(),$.STOP_RENDER},renderBodyCellRestricted:function(e,t){return X.addClass(t,this.Style.CSS_CELL),X.addClass(t,this.Style.CSS_CELL_RESTRICTED),t.innerHTML=e.getDate(),$.STOP_RENDER},addMonths:function(e){var t=Q.PAGEDATE.key;this.cfg.setProperty(t,Rui.util.LDate.add(this.cfg.getProperty(t),Rui.util.LDate.MONTH,e)),this.resetRenderers(),this.changePageEvent.fire()},subtractMonths:function(e){var t=Q.PAGEDATE.key;this.cfg.setProperty(t,Rui.util.LDate.subtract(this.cfg.getProperty(t),Rui.util.LDate.MONTH,e)),this.resetRenderers(),this.changePageEvent.fire()},addYears:function(e){var t=Q.PAGEDATE.key;this.cfg.setProperty(t,Rui.util.LDate.add(this.cfg.getProperty(t),Rui.util.LDate.YEAR,e)),this.resetRenderers(),this.changePageEvent.fire()},subtractYears:function(e){var t=Q.PAGEDATE.key;this.cfg.setProperty(t,Rui.util.LDate.subtract(this.cfg.getProperty(t),Rui.util.LDate.YEAR,e)),this.resetRenderers(),this.changePageEvent.fire()},nextMonth:function(){this.addMonths(1)},previousMonth:function(){this.subtractMonths(1)},nextYear:function(){this.addYears(1)},previousYear:function(){this.subtractYears(1)},reset:function(){this.cfg.resetProperty(Q.SELECTED.key),this.cfg.resetProperty(Q.PAGEDATE.key),this.resetEvent.fire()},clear:function(){this.cfg.setProperty(Q.SELECTED.key,[]),this.cfg.setProperty(Q.PAGEDATE.key,new Date(this.today.getTime())),this.clearEvent.fire()},select:function(e,t){t=null==t||t;for(var i=this._toFieldArray(e),s=[],a=[],n=Q.SELECTED.key,l=0;l<i.length;++l){var r=i[l],e=this._toDate(r);this.isDateOOB(e)||(0===s.length&&(t&&this.beforeSelectEvent.fire(),a=this.cfg.getProperty(n)),s.push(e),-1==this._indexOfSelectedFieldArray(r)&&(a[a.length]=r))}return 0<s.length&&(this.parent?this.parent.cfg.setProperty(n,a):this.cfg.setProperty(n,a),t&&this.selectEvent.fire({target:this,date:this.MULTI_SELECT?s:s[0]})),this.getSelectedDates()},selectCell:function(e){var t,i,s,a,n=this.cells[e],l=this.cellDates[e],r=this._toDate(l);return X.hasClass(n,this.Style.CSS_CELL_SELECTABLE)&&(this.beforeSelectEvent.fire(),t=Q.SELECTED.key,i=this.cfg.getProperty(t),s=l.concat(),-1==this._indexOfSelectedFieldArray(s)&&(i[i.length]=s),this.parent?this.parent.cfg.setProperty(t,i):this.cfg.setProperty(t,i),this.renderCellStyleSelected(r,n),a=this.toDate(s),this.selectEvent.fire({target:this,date:this.MULTI_SELECT?[a]:a}),this.doCellMouseOut.call(n,null,this)),this.getSelectedDates()},deselect:function(e){for(var t=this._toFieldArray(e),i=[],s=[],a=Q.SELECTED.key,n=0;n<t.length;++n){var l,r=t[n],e=this._toDate(r);this.isDateOOB(e)||(0===i.length&&(this.beforeDeselectEvent.fire(),s=this.cfg.getProperty(a)),i.push(e),-1!=(l=this._indexOfSelectedFieldArray(r))&&s.splice(l,1))}return 0<i.length&&(this.parent?this.parent.cfg.setProperty(a,s):this.cfg.setProperty(a,s),this.deselectEvent.fire({target:this,date:this.MULTI_SELECT?i:i[0]})),this.getSelectedDates()},deselectCell:function(e){var t,i,s,a,n=this.cells[e],l=this.cellDates[e],r=this._indexOfSelectedFieldArray(l);return X.hasClass(n,this.Style.CSS_CELL_SELECTABLE)&&(this.beforeDeselectEvent.fire(),t=this.cfg.getProperty(Q.SELECTED.key),i=this._toDate(l),s=l.concat(),-1<r&&(this.cfg.getProperty(Q.PAGEDATE.key).getMonth()==i.getMonth()&&this.cfg.getProperty(Q.PAGEDATE.key).getFullYear()==i.getFullYear()&&(X.removeClass(n,this.Style.CSS_CELL_SELECTED),Rui.useAccessibility()&&n.removeAttribute("aria-selected")),t.splice(r,1)),this.parent?this.parent.cfg.setProperty(Q.SELECTED.key,t):this.cfg.setProperty(Q.SELECTED.key,t),a=this.toDate(s),this.deselectEvent.fire({target:this,date:this.MULTI_SELECT?[a]:a})),this.getSelectedDates()},deselectAll:function(){this.beforeDeselectEvent.fire();var e=Q.SELECTED.key,t=this.cfg.getProperty(e),i=t.length,s=t.concat();this.parent?this.parent.cfg.setProperty(e,[]):this.cfg.setProperty(e,[]);for(var a=[],n=0;n<s.length;n++)a.push(this.toDate(s[n]));return 0<i&&this.deselectEvent.fire({target:this,date:this.MULTI_SELECT?a:a[0]}),this.getSelectedDates()},_toFieldArray:function(e){var t=[];if(e instanceof Date)t=[[e.getFullYear(),e.getMonth()+1,e.getDate()]];else if(Rui.isString(e))t=this._parseDates(e);else if(g.isArray(e))for(var i=0;i<e.length;++i){var s=e[i];t[t.length]=[s.getFullYear(),s.getMonth()+1,s.getDate()]}return t},toDate:function(e){return this._toDate(e)},_toDate:function(e){return e instanceof Date?e:Rui.util.LDate.getDate(e[0],e[1]-1,e[2])},_fieldArraysAreEqual:function(e,t){var i=!1;return e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]&&(i=!0),i},_indexOfSelectedFieldArray:function(e){for(var t=-1,i=this.cfg.getProperty(Q.SELECTED.key),s=0;s<i.length;++s){var a=i[s];if(e[0]==a[0]&&e[1]==a[1]&&e[2]==a[2]){t=s;break}}return t},isDateOOM:function(e){return e.getMonth()!=this.cfg.getProperty(Q.PAGEDATE.key).getMonth()},isDateOOB:function(e){var t=this.cfg.getProperty(Q.MINDATE.key),i=this.cfg.getProperty(Q.MAXDATE.key),s=Rui.util.LDate,t=t&&s.clearTime(t),i=i&&s.clearTime(i),a=new Date(e.getTime()),a=s.clearTime(a);return t&&a.getTime()<t.getTime()||i&&a.getTime()>i.getTime()},_parsePageDate:function(e){var t,i,s;return e?e instanceof Date?Rui.util.LDate.getFirstDayOfMonth(e):(t=e.split(this.cfg.getProperty(Q.DATE_FIELD_DELIMITER.key)),i=parseInt(t[this.cfg.getProperty(Q.MY_MONTH_POSITION.key)-1],10)-1,s=parseInt(t[this.cfg.getProperty(Q.MY_YEAR_POSITION.key)-1],10),Rui.util.LDate.getDate(s,i,1)):Rui.util.LDate.getDate(this.today.getFullYear(),this.today.getMonth(),1)},onBeforeSelect:function(){!1===this.cfg.getProperty(Q.MULTI_SELECT.key)&&(this.parent?(this.parent.callChildFunction("clearAllBodyCellStyles",this.Style.CSS_CELL_SELECTED),this.parent.deselectAll()):(this.clearAllBodyCellStyles(this.Style.CSS_CELL_SELECTED),this.deselectAll()))},onSelect:function(e){},onBeforeDeselect:function(){},onDeselect:function(e){},onChangePage:function(){this.render()},onRender:function(){},onReset:function(){this.render()},onClear:function(){this.render()},validate:function(){return!0},_parseDate:function(e){var t,i=e.split(this.Locale.DATE_FIELD_DELIMITER);2==i.length?(t=[i[this.Locale.MD_MONTH_POSITION-1],i[this.Locale.MD_DAY_POSITION-1]]).type=$.MONTH_DAY:(t=[i[this.Locale.MDY_YEAR_POSITION-1],i[this.Locale.MDY_MONTH_POSITION-1],i[this.Locale.MDY_DAY_POSITION-1]]).type=$.DATE;for(var s=0;s<t.length;s++)t[s]=parseInt(t[s],10);return t},_parseDates:function(e){for(var t=[],i=e.split(this.Locale.DATE_DELIMITER),s=0;s<i.length;++s){var a,n,l,r,o,h=i[s];-1!=h.indexOf(this.Locale.DATE_RANGE_DELIMITER)?(a=h.split(this.Locale.DATE_RANGE_DELIMITER),n=this._parseDate(a[0]),l=this._parseDate(a[1]),r=this._parseRange(n,l),t=t.concat(r)):(o=this._parseDate(h),t.push(o))}return t},_parseRange:function(e,t){var i=Rui.util.LDate.add(Rui.util.LDate.getDate(e[0],e[1]-1,e[2]),Rui.util.LDate.DAY,1),s=Rui.util.LDate.getDate(t[0],t[1]-1,t[2]),a=[];for(a.push(e);i.getTime()<=s.getTime();)a.push([i.getFullYear(),i.getMonth()+1,i.getDate()]),i=Rui.util.LDate.add(i,Rui.util.LDate.DAY,1);return a},resetRenderers:function(){this.renderStack=this._renderStack.concat()},removeRenderers:function(){this._renderStack=[],this.renderStack=[]},clearElement:function(e){e.innerHTML="&#160;",e.className=""},addRenderer:function(e,t){for(var i=this._parseDates(e),s=0;s<i.length;++s){var a=i[s];2==a.length?a[0]instanceof Array?this._addRenderer($.RANGE,a,t):this._addRenderer($.MONTH_DAY,a,t):3==a.length&&this._addRenderer($.DATE,a,t)}},_addRenderer:function(e,t,i){var s=[e,t,i];this.renderStack.unshift(s),this._renderStack=this.renderStack.concat()},addMonthRenderer:function(e,t){this._addRenderer($.MONTH,[e],t)},addWeekdayRenderer:function(e,t){this._addRenderer($.WEEKDAY,[e],t)},clearAllBodyCellStyles:function(e){for(var t=0;t<this.cells.length;++t)X.removeClass(this.cells[t],e),Rui.useAccessibility()&&e==this.Style.CSS_CELL_SELECTED&&this.cells[t].removeAttribute("aria-selected")},setMonth:function(e){var t=Q.PAGEDATE.key,i=this.cfg.getProperty(t);i.setMonth(parseInt(e,10)),this.cfg.setProperty(t,i)},setYear:function(e){var t=Q.PAGEDATE.key,i=this.cfg.getProperty(t);i.setFullYear(parseInt(e,10)),this.cfg.setProperty(t,i)},getSelectedDates:function(){for(var e=[],t=this.cfg.getProperty(Q.SELECTED.key),i=0;i<t.length;++i){var s=t[i],a=Rui.util.LDate.getDate(s[0],s[1]-1,s[2]);e.push(a)}return e.sort(function(e,t){return e-t}),e},hide:function(){this.beforeHideEvent.fire()&&(Rui.useAccessibility()&&this.oDomContainer.setAttribute("aria-hidden","true"),this.oDomContainer.style.display="none",this.hideEvent.fire())},show:function(){this.beforeShowEvent.fire()&&(this.oDomContainer.style.display="block",Rui.useAccessibility()&&this.oDomContainer.setAttribute("aria-hidden","false"),this.isSyncIframeSize||this._syncIframeSize(),this.showEvent.fire())},_syncIframeSize:function(){var e;this.iframe&&this.oDomContainer&&(e=Rui.get(this.oDomContainer),this.iframe.style.width=e.getWidth()+"px",this.iframe.style.height=e.getHeight()+"px",this.isSyncIframeSize=!0)},browser:-1!=(e=navigator.userAgent.toLowerCase()).indexOf("opera")?"opera":-1!=e.indexOf("msie 7")?"ie7":-1!=e.indexOf("msie")?"ie":-1!=e.indexOf("safari")?"safari":-1!=e.indexOf("gecko")&&"gecko",toString:function(){return"LCalendar "+this.id},destroy:function(){var e;this.beforeDestroyEvent.fire()&&((e=this).navigator&&e.navigator.destroy(),e.cfg&&e.cfg.destroy(),f.purgeElement(e.oDomContainer,!0),X.removeClass(e.oDomContainer,"withtitle"),X.removeClass(e.oDomContainer,e.Style.CSS_CONTAINER),X.removeClass(e.oDomContainer,e.Style.CSS_SINGLE),e.oDomContainer.innerHTML="",e.oDomContainer.parentNode&&e.oDomContainer.parentNode.removeChild(e.oDomContainer),e.oDomContainer=null,e.cells=null,this.destroyEvent.fire())},on:function(e,t,i,s){var a=this[e+"Event"];a&&a.on(t,i||this,!!Rui.isUndefined(s)||s)}},Rui.ui.calendar.LCalendar=$}(),function(){var c=Rui.util.LDom,n=Rui.util.LDate,s=Rui.util.LEvent,l=Rui.ui.calendar.LCalendar;function a(e,t,i){1==arguments.length&&"object"==typeof e&&(e=t=(i=e).applyTo||e.renderTo||Rui.id()),i=Rui.applyIf(i,Rui.getConfig().getFirst("$.ext.calendarGroup.defaultProperties")),0<arguments.length&&this.init.call(this,e,t,i),i&&(i.applyTo||i.renderTo)&&this.render()}(a._DEFAULT_CONFIG=l._DEFAULT_CONFIG).PAGES={key:"pages",value:2};var E=a._DEFAULT_CONFIG;a.prototype={today:null,init:function(e,t,i){var s=this._parseArgs(arguments);e=s.id,t=s.container,i=s.config,this.oDomContainer=c.get(t),this.oDomContainer.id||(this.oDomContainer.id=c.generateId()),e=e||this.oDomContainer.id+"_t",this.id=e,this.containerId=this.oDomContainer.id,this.initEvents(),this.initStyles(),this.pages=[],c.addClass(this.oDomContainer,a.CSS_CONTAINER),c.addClass(this.oDomContainer,a.CSS_MULTI_UP),c.addClass(this.oDomContainer,"L-fixed"),this.cfg=new Rui.ui.LConfig(this),this.Options={},this.Locale={},!this.today&&i&&i.today&&(this.today=i.today),this.setupConfig(),i&&this.cfg.applyConfig(i,!0),this.cfg.fireQueue(),Rui.browser.opera&&(this.renderEvent.on(this._fixWidth,this,!0),this.showEvent.on(this._fixWidth,this,!0))},setupConfig:function(){var e=this.cfg;e.addProperty(E.PAGES.key,{value:E.PAGES.value,validator:e.checkNumber,handler:this.configPages}),e.addProperty(E.PAGEDATE.key,{value:new Date,handler:this.configPageDate}),e.addProperty(E.SELECTED.key,{value:[],handler:this.configSelected}),e.addProperty(E.TITLE.key,{value:E.TITLE.value,handler:this.configTitle}),e.addProperty(E.CLOSE.key,{value:E.CLOSE.value,handler:this.configClose}),e.addProperty(E.IFRAME.key,{value:E.IFRAME.value,handler:this.configIframe,validator:e.checkBoolean}),e.addProperty(E.MINDATE.key,{value:E.MINDATE.value,handler:this.delegateConfig}),e.addProperty(E.MAXDATE.key,{value:E.MAXDATE.value,handler:this.delegateConfig}),e.addProperty(E.MULTI_SELECT.key,{value:E.MULTI_SELECT.value,handler:this.delegateConfig,validator:e.checkBoolean}),e.addProperty(E.START_WEEKDAY.key,{value:E.START_WEEKDAY.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.SHOW_WEEKDAYS.key,{value:E.SHOW_WEEKDAYS.value,handler:this.delegateConfig,validator:e.checkBoolean}),e.addProperty(E.SHOW_WEEK_HEADER.key,{value:E.SHOW_WEEK_HEADER.value,handler:this.delegateConfig,validator:e.checkBoolean}),e.addProperty(E.SHOW_WEEK_FOOTER.key,{value:E.SHOW_WEEK_FOOTER.value,handler:this.delegateConfig,validator:e.checkBoolean}),e.addProperty(E.HIDE_BLANK_WEEKS.key,{value:E.HIDE_BLANK_WEEKS.value,handler:this.delegateConfig,validator:e.checkBoolean}),e.addProperty(E.NAV_ARROW_LEFT.key,{value:E.NAV_ARROW_LEFT.value,handler:this.delegateConfig}),e.addProperty(E.NAV_ARROW_RIGHT.key,{value:E.NAV_ARROW_RIGHT.value,handler:this.delegateConfig}),e.addProperty(E.MONTHS_SHORT.key,{value:E.MONTHS_SHORT.value,handler:this.delegateConfig}),e.addProperty(E.MONTHS_LONG.key,{value:E.MONTHS_LONG.value,handler:this.delegateConfig}),e.addProperty(E.WEEKDAYS_1CHAR.key,{value:E.WEEKDAYS_1CHAR.value,handler:this.delegateConfig}),e.addProperty(E.WEEKDAYS_SHORT.key,{value:E.WEEKDAYS_SHORT.value,handler:this.delegateConfig}),e.addProperty(E.WEEKDAYS_MEDIUM.key,{value:E.WEEKDAYS_MEDIUM.value,handler:this.delegateConfig}),e.addProperty(E.WEEKDAYS_LONG.key,{value:E.WEEKDAYS_LONG.value,handler:this.delegateConfig}),e.addProperty(E.LOCALE_MONTHS.key,{value:E.LOCALE_MONTHS.value,handler:this.delegateConfig}),e.addProperty(E.LOCALE_WEEKDAYS.key,{value:E.LOCALE_WEEKDAYS.value,handler:this.delegateConfig}),e.addProperty(E.DATE_DELIMITER.key,{value:E.DATE_DELIMITER.value,handler:this.delegateConfig}),e.addProperty(E.DATE_FIELD_DELIMITER.key,{value:E.DATE_FIELD_DELIMITER.value,handler:this.delegateConfig}),e.addProperty(E.DATE_RANGE_DELIMITER.key,{value:E.DATE_RANGE_DELIMITER.value,handler:this.delegateConfig}),e.addProperty(E.MY_MONTH_POSITION.key,{value:E.MY_MONTH_POSITION.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.MY_YEAR_POSITION.key,{value:E.MY_YEAR_POSITION.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.MD_MONTH_POSITION.key,{value:E.MD_MONTH_POSITION.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.MD_DAY_POSITION.key,{value:E.MD_DAY_POSITION.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.MDY_MONTH_POSITION.key,{value:E.MDY_MONTH_POSITION.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.MDY_DAY_POSITION.key,{value:E.MDY_DAY_POSITION.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.MDY_YEAR_POSITION.key,{value:E.MDY_YEAR_POSITION.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.MY_LABEL_MONTH_POSITION.key,{value:E.MY_LABEL_MONTH_POSITION.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.MY_LABEL_YEAR_POSITION.key,{value:E.MY_LABEL_YEAR_POSITION.value,handler:this.delegateConfig,validator:e.checkNumber}),e.addProperty(E.MY_LABEL_MONTH_SUFFIX.key,{value:E.MY_LABEL_MONTH_SUFFIX.value,handler:this.delegateConfig}),e.addProperty(E.MY_LABEL_YEAR_SUFFIX.key,{value:E.MY_LABEL_YEAR_SUFFIX.value,handler:this.delegateConfig}),e.addProperty(E.NAV.key,{value:E.NAV.value,handler:this.configNavigator}),e.addProperty(E.STRINGS.key,{value:E.STRINGS.value,handler:this.configStrings,validator:function(e){return Rui.isObject(e)},supercedes:E.STRINGS.supercedes})},initEvents:function(){function e(e,t,i){for(var s=0;s<a.pages.length;++s){a.pages[s][this.type+"Event"].on(e,t,i)}}function t(e,t){for(var i=0;i<a.pages.length;++i){a.pages[i][this.type+"Event"].unOn(e,t)}}var a=this,i=Rui.util.LCustomEvent,s=l._EVENT_TYPES;a.beforeSelectEvent=new i(s.BEFORE_SELECT),a.beforeSelectEvent.on=e,a.beforeSelectEvent.unOn=t,a.selectEvent=new i(s.SELECT),a.selectEvent.on=e,a.selectEvent.unOn=t,a.beforeDeselectEvent=new i(s.BEFORE_DESELECT),a.beforeDeselectEvent.on=e,a.beforeDeselectEvent.unOn=t,a.deselectEvent=new i(s.DESELECT),a.deselectEvent.on=e,a.deselectEvent.unOn=t,a.beforeChangePageEvent=new i(s.BEFORE_CHANGE_PAGE),a.beforeChangePageEvent.on=e,a.beforeChangePageEvent.unOn=t,a.changePageEvent=new i(s.CHANGE_PAGE),a.changePageEvent.on=e,a.changePageEvent.unOn=t,a.beforeRenderEvent=new i(s.BEFORE_RENDER),a.beforeRenderEvent.on=e,a.beforeRenderEvent.unOn=t,a.renderEvent=new i(s.RENDER),a.renderEvent.on=e,a.renderEvent.unOn=t,a.resetEvent=new i(s.RESET),a.resetEvent.on=e,a.resetEvent.unOn=t,a.clearEvent=new i(s.CLEAR),a.clearEvent.on=e,a.clearEvent.unOn=t,a.beforeShowEvent=new i(s.BEFORE_SHOW),a.showEvent=new i(s.SHOW),a.beforeHideEvent=new i(s.BEFORE_HIDE),a.hideEvent=new i(s.HIDE),a.beforeShowNavEvent=new i(s.BEFORE_SHOW_NAV),a.showNavEvent=new i(s.SHOW_NAV),a.beforeHideNavEvent=new i(s.BEFORE_HIDE_NAV),a.hideNavEvent=new i(s.HIDE_NAV),a.beforeRenderNavEvent=new i(s.BEFORE_RENDER_NAV),a.renderNavEvent=new i(s.RENDER_NAV),a.beforeDestroyEvent=new i(s.BEFORE_DESTROY),a.destroyEvent=new i(s.DESTROY)},configPages:function(e,t,i){for(var s,a=t[0],n=E.PAGEDATE.key,l=null,r=0;r<a;++r){var o=this.id+"_"+r,h=this.containerId+"_"+r,u=this.cfg.getConfig();u.close=!1,u.title=!1,u.navigator=null,0<r&&(s=new Date(l),this._setMonthOnDate(s,s.getMonth()+r),u.pageDate=s);var d=this.constructChild(o,h,u);c.removeClass(d.oDomContainer,this.Style.CSS_SINGLE),c.addClass(d.oDomContainer,"groupcal"),0===r&&(l=d.cfg.getProperty(n),c.addClass(d.oDomContainer,"first-of-type")),r==a-1&&c.addClass(d.oDomContainer,"last-of-type"),d.parent=this,d.index=r,this.pages[this.pages.length]=d}},configPageDate:function(e,t,i){for(var s,a=t[0],n=E.PAGEDATE.key,l=0;l<this.pages.length;++l){var r,o=this.pages[l];0===l?(s=o._parsePageDate(a),o.cfg.setProperty(n,s)):(r=new Date(s),this._setMonthOnDate(r,r.getMonth()+l),o.cfg.setProperty(n,r))}},configSelected:function(e,t,i){var s=E.SELECTED.key;this.delegateConfig(e,t,i);var a=0<this.pages.length?this.pages[0].cfg.getProperty(s):[];this.cfg.setProperty(s,a,!0)},delegateConfig:function(e,t,i){for(var s=t[0],a=0;a<this.pages.length;a++)this.pages[a].cfg.setProperty(e,s)},setProperty:function(e,t){this.cfg.setProperty(e,t)},setChildFunction:function(e,t){for(var i=this.cfg.getProperty(E.PAGES.key),s=0;s<i;++s)this.pages[s][e]=t},callChildFunction:function(e,t){for(var i=this.cfg.getProperty(E.PAGES.key),s=0;s<i;++s){var a=this.pages[s];a[e]&&a[e].call(a,t)}},constructChild:function(e,t,i){var s=document.getElementById(t);return s||((s=document.createElement("div")).id=t,this.oDomContainer.appendChild(s)),this.today&&(i.today=this.today),new l(e,t,i)},setMonth:function(e){var t;e=parseInt(e,10);for(var i=E.PAGEDATE.key,s=0;s<this.pages.length;++s){var a=this.pages[s],n=a.cfg.getProperty(i);0===s?t=n.getFullYear():n.setFullYear(t),this._setMonthOnDate(n,e+s),a.cfg.setProperty(i,n)}},setYear:function(e){var t=E.PAGEDATE.key;e=parseInt(e,10);for(var i=0;i<this.pages.length;++i){var s=this.pages[i];s.cfg.getProperty(t).getMonth()+1==1&&0<i&&(e+=1),s.setYear(e)}},render:function(){this.renderHeader();for(var e=0;e<this.pages.length;++e){this.pages[e].render()}this.renderFooter()},select:function(e){for(var t=0;t<this.pages.length;++t){this.pages[t].select(e)}return this.getSelectedDates()},selectCell:function(e){for(var t=0;t<this.pages.length;++t){this.pages[t].selectCell(e)}return this.getSelectedDates()},deselect:function(e){for(var t=0;t<this.pages.length;++t){this.pages[t].deselect(e)}return this.getSelectedDates()},deselectAll:function(){for(var e=0;e<this.pages.length;++e){this.pages[e].deselectAll()}return this.getSelectedDates()},deselectCell:function(e){for(var t=0;t<this.pages.length;++t){this.pages[t].deselectCell(e)}return this.getSelectedDates()},reset:function(){for(var e=0;e<this.pages.length;++e){this.pages[e].reset()}},clear:function(){for(var e=0;e<this.pages.length;++e){this.pages[e].clear()}this.cfg.setProperty(E.SELECTED.key,[]),this.cfg.setProperty(E.PAGEDATE.key,new Date(this.pages[0].today.getTime())),this.render()},nextMonth:function(){for(var e=0;e<this.pages.length;++e){this.pages[e].nextMonth()}},previousMonth:function(){for(var e=this.pages.length-1;0<=e;--e){this.pages[e].previousMonth()}},nextYear:function(){for(var e=0;e<this.pages.length;++e){this.pages[e].nextYear()}},previousYear:function(){for(var e=0;e<this.pages.length;++e){this.pages[e].previousYear()}},getSelectedDates:function(){for(var e=[],t=this.cfg.getProperty(E.SELECTED.key),i=0;i<t.length;++i){var s=t[i],a=n.getDate(s[0],s[1]-1,s[2]);e.push(a)}return e.sort(function(e,t){return e-t}),e},addRenderer:function(e,t){for(var i=0;i<this.pages.length;++i){this.pages[i].addRenderer(e,t)}},addMonthRenderer:function(e,t){for(var i=0;i<this.pages.length;++i){this.pages[i].addMonthRenderer(e,t)}},addWeekdayRenderer:function(e,t){for(var i=0;i<this.pages.length;++i){this.pages[i].addWeekdayRenderer(e,t)}},removeRenderers:function(){this.callChildFunction("removeRenderers")},renderHeader:function(){},renderFooter:function(){},addMonths:function(e){this.callChildFunction("addMonths",e)},subtractMonths:function(e){this.callChildFunction("subtractMonths",e)},addYears:function(e){this.callChildFunction("addYears",e)},subtractYears:function(e){this.callChildFunction("subtractYears",e)},getCalendarPage:function(e){var t=null;if(e)for(var i=e.getFullYear(),s=e.getMonth(),a=this.pages,n=0;n<a.length;++n){var l=a[n].cfg.getProperty("pagedate");if(l.getFullYear()===i&&l.getMonth()===s){t=a[n];break}}return t},_setMonthOnDate:function(e,t){var i;Rui.browser.webkit&&Rui.browser.webkit<420&&(t<0||11<t)?(i=n.add(e,n.MONTH,t-e.getMonth()),e.setTime(i.getTime())):e.setMonth(t)},_fixWidth:function(){for(var e=0,t=0;t<this.pages.length;++t){e+=this.pages[t].oDomContainer.offsetWidth}0<e&&(this.oDomContainer.style.width=e+"px")},toString:function(){return"LCalendarGroup "+this.id},destroy:function(){if(this.beforeDestroyEvent.fire()){var e=this;e.navigator&&e.navigator.destroy(),e.cfg&&e.cfg.destroy(),s.purgeElement(e.oDomContainer,!0),c.removeClass(e.oDomContainer,a.CSS_CONTAINER),c.removeClass(e.oDomContainer,a.CSS_MULTI_UP);for(var t=0,i=e.pages.length;t<i;t++)e.pages[t].destroy(),e.pages[t]=null;e.oDomContainer.innerHTML="",e.oDomContainer=null,this.destroyEvent.fire()}}},a.CSS_CONTAINER="L-calcontainer",a.CSS_MULTI_UP="L-multi",a.CSS_2UPTITLE="L-title",a.CSS_2UPCLOSE="close-icon",Rui.applyPrototype(a,l,"buildDayLabel","buildMonthLabel","renderOutOfBoundsDate","renderRowHeader","renderRowFooter","renderCellDefault","styleCellDefault","renderCellStyleHighlight1","renderCellStyleHighlight2","renderCellStyleHighlight3","renderCellStyleHighlight4","renderCellStyleToday","renderCellStyleSelected","renderCellNotThisMonth","renderBodyCellRestricted","initStyles","configTitle","configClose","configIframe","configStrings","configNavigator","createTitleBar","createCloseButton","removeTitleBar","removeCloseButton","hide","show","toDate","_toDate","_parseArgs","browser"),Rui.ui.calendar.LCalendarGroup=a}(),Rui.ui.calendar.LCalendarNavigator=function(e){this.init(e)},function(){var e=Rui.ui.calendar.LCalendarNavigator;e.CLASSES={NAV:"L-cal-nav",NAV_VISIBLE:"L-cal-nav-visible",MASK:"L-cal-nav-mask",YEAR:"L-cal-nav-y",MONTH:"L-cal-nav-m",BUTTONS:"L-cal-nav-b",BUTTON:"L-cal-nav-btn",ERROR:"L-cal-nav-e",YEAR_CTRL:"L-cal-nav-yc",MONTH_CTRL:"L-cal-nav-mc",INVALID:"L-invalid",DEFAULT:"L-default"},e._DEFAULT_CFG=null,e.ID_SUFFIX="_nav",e.MONTH_SUFFIX="_month",e.YEAR_SUFFIX="_year",e.ERROR_SUFFIX="_error",e.CANCEL_SUFFIX="_cancel",e.SUBMIT_SUFFIX="_submit",e.YR_MAX_DIGITS=4,e.YR_MINOR_INC=1,e.YR_MAJOR_INC=10,e.UPDATE_DELAY=50,e.YR_PATTERN=/^\d+$/,e.TRIM=/^\s*(.*?)\s*$/}(),Rui.ui.calendar.LCalendarNavigator.prototype={id:null,cal:null,navEl:null,maskEl:null,yearEl:null,monthEl:null,errorEl:null,submitEl:null,cancelEl:null,firstCtrl:null,lastCtrl:null,_doc:null,_year:null,_month:0,__rendered:!1,init:function(e){var t=e.oDomContainer;this.cal=e,this.id=t.id+Rui.ui.calendar.LCalendarNavigator.ID_SUFFIX,this._doc=t.ownerDocument;var i=Rui.browser.msie;this.__isIEQuirks=i&&(i<=6||"BackCompat"==this._doc.compatMode)},show:function(){var e=Rui.ui.calendar.LCalendarNavigator.CLASSES;this.cal.beforeShowNavEvent.fire()&&(this.__rendered||this.render(),this.clearErrors(),this._updateMonthUI(),this._updateYearUI(),this._show(this.monthComboEl,!!Rui.isUndefined(Rui.ui.calendar.LMonthCalendar)||!(this.cal instanceof Rui.ui.calendar.LMonthCalendar)),this._show(this.navEl,!0),this.setInitialFocus(),this.showMask(),Rui.util.LDom.addClass(this.cal.oDomContainer,e.NAV_VISIBLE),this.cal.showNavEvent.fire())},hide:function(){var e=Rui.ui.calendar.LCalendarNavigator.CLASSES;this.cal.beforeHideNavEvent.fire()&&(this._show(this.navEl,!1),this.hideMask(),Rui.util.LDom.removeClass(this.cal.oDomContainer,e.NAV_VISIBLE),this.cal.hideNavEvent.fire())},showMask:function(){this._show(this.maskEl,!0),this.__isIEQuirks&&this._syncMask()},hideMask:function(){this._show(this.maskEl,!1)},getMonth:function(){return this._month},getYear:function(){return this._year},setMonth:function(e){0<=e&&e<12&&(this._month=e),this._updateMonthUI()},setYear:function(e){var t=Rui.ui.calendar.LCalendarNavigator.YR_PATTERN;Rui.isNumber(e)&&t.test(e+"")&&(this._year=e),this._updateYearUI()},render:function(){this.cal.beforeRenderNavEvent.fire(),this.__rendered||(this.createNav(),this.createMask(),this.applyListeners(),this.__rendered=!0),this.cal.renderNavEvent.fire()},createNav:function(){var e=Rui.ui.calendar.LCalendarNavigator,t=this._doc,i=t.createElement("div");i.className=e.CLASSES.NAV;var s=this.renderNavContents([]);i.innerHTML=s.join(""),this.cal.oDomContainer.appendChild(i),this.navEl=i,this.monthComboEl=i.childNodes[0],this.yearEl=t.getElementById(this.id+e.YEAR_SUFFIX),this.monthEl=t.getElementById(this.id+e.MONTH_SUFFIX),this.errorEl=t.getElementById(this.id+e.ERROR_SUFFIX),this.submitEl=t.getElementById(this.id+e.SUBMIT_SUFFIX),this.cancelEl=t.getElementById(this.id+e.CANCEL_SUFFIX),Rui.browser.gecko&&this.yearEl&&"text"==this.yearEl.type&&this.yearEl.setAttribute("autocomplete","off"),this._setFirstLastElements()},createMask:function(){var e=Rui.ui.calendar.LCalendarNavigator.CLASSES,t=this._doc.createElement("div");t.className=e.MASK,this.cal.oDomContainer.appendChild(t),this.maskEl=t},_syncMask:function(){var e,t=this.cal.oDomContainer;t&&this.maskEl&&(e=Rui.util.LDom.getRegion(t),Rui.util.LDom.setStyle(this.maskEl,"width",e.right-e.left+"px"),Rui.util.LDom.setStyle(this.maskEl,"height",e.bottom-e.top+"px"))},renderNavContents:function(e){var t=Rui.ui.calendar.LCalendarNavigator,i=t.CLASSES,s=e;return s[s.length]='<div class="'+i.MONTH+'">',this.renderMonth(s),s[s.length]="</div>",s[s.length]='<div class="'+i.YEAR+'">',this.renderYear(s),s[s.length]="</div>",s[s.length]='<div class="'+i.BUTTONS+'">',this.renderButtons(s),s[s.length]="</div>",s[s.length]='<div class="'+i.ERROR+'" id="'+this.id+t.ERROR_SUFFIX+'"></div>',s},renderMonth:function(e){var t=Rui.ui.calendar.LCalendarNavigator,i=t.CLASSES,s=this.id+t.MONTH_SUFFIX,a=this.__getCfg("monthFormat"),n=this.cal.cfg.getProperty(a==Rui.ui.calendar.LCalendar.SHORT?"MONTHS_SHORT":"MONTHS_LONG"),l=e;if(n&&0<n.length){l[l.length]='<label for="'+s+'">',l[l.length]=this.__getCfg("month",!0),l[l.length]="</label>",l[l.length]='<select name="'+s+'" id="'+s+'" class="'+i.MONTH_CTRL+'">';for(var r=0;r<n.length;r++)l[l.length]='<option value="'+r+'">',l[l.length]=n[r],l[l.length]="</option>";l[l.length]="</select>"}return l},renderYear:function(e){var t=Rui.ui.calendar.LCalendarNavigator,i=t.CLASSES,s=this.id+t.YEAR_SUFFIX,a=t.YR_MAX_DIGITS,n=e;return n[n.length]='<label for="'+s+'">',n[n.length]=this.__getCfg("year",!0),n[n.length]="</label>",n[n.length]='<input type="text" name="'+s+'" id="'+s+'" class="'+i.YEAR_CTRL+'" maxlength="'+a+'"/>',n},renderButtons:function(e){var t=Rui.ui.calendar.LCalendarNavigator.CLASSES,i=e;return i[i.length]='<span class="'+t.BUTTON+" "+t.DEFAULT+'">',i[i.length]='<button type="button" id="'+this.id+'_submit">',i[i.length]=this.__getCfg("submit",!0),i[i.length]="</button>",i[i.length]="</span>",i[i.length]='<span class="'+t.BUTTON+'">',i[i.length]='<button type="button" id="'+this.id+'_cancel">',i[i.length]=this.__getCfg("cancel",!0),i[i.length]="</button>",i[i.length]="</span>",i},applyListeners:function(){var e=Rui.util.LEvent;e.on(this.submitEl,"click",this.submit,this,!0),e.on(this.cancelEl,"click",this.cancel,this,!0),e.on(this.yearEl,"blur",function(){this.validate()&&this.setYear(this._getYearFromUI())},this,!0),e.on(this.monthEl,"change",function(){this.setMonth(this._getMonthFromUI())},this,!0),this.__isIEQuirks&&Rui.util.LEvent.on(this.cal.oDomContainer,"resize",this._syncMask,this,!0),this.applyKeyListeners()},purgeListeners:function(){var e=Rui.util.LEvent;e.removeListener(this.submitEl,"click",this.submit),e.removeListener(this.cancelEl,"click",this.cancel),e.removeListener(this.yearEl,"blur"),e.removeListener(this.monthEl,"change"),this.__isIEQuirks&&e.removeListener(this.cal.oDomContainer,"resize",this._syncMask),this.purgeKeyListeners()},applyKeyListeners:function(){var e=Rui.util.LEvent,t=Rui.browser,i=t.ie||t.webkit?"keydown":"keypress",s=t.ie||t.opera||t.webkit?"keydown":"keypress";e.on(this.yearEl,"keypress",this._handleEnterKey,this,!0),e.on(this.yearEl,i,this._handleDirectionKeys,this,!0),e.on(this.lastCtrl,s,this._handleTabKey,this,!0),e.on(this.firstCtrl,s,this._handleShiftTabKey,this,!0)},purgeKeyListeners:function(){var e=Rui.util.LEvent,t=Rui.browser,i=t.ie||t.webkit?"keydown":"keypress",s=t.ie||t.opera||t.webkit?"keydown":"keypress";e.removeListener(this.yearEl,"keypress",this._handleEnterKey),e.removeListener(this.yearEl,i,this._handleDirectionKeys),e.removeListener(this.lastCtrl,s,this._handleTabKey),e.removeListener(this.firstCtrl,s,this._handleShiftTabKey)},submit:function(){var e,t,i;this.validate()&&(this.hide(),this.setMonth(this._getMonthFromUI()),this.setYear(this._getYearFromUI()),e=this.cal,0<(t=Rui.ui.calendar.LCalendarNavigator.UPDATE_DELAY)?(i=this,window.setTimeout(function(){i._update(e)},t)):this._update(e))},_update:function(e){e.setYear(this.getYear()),e.setMonth(this.getMonth()),e.render()},cancel:function(){this.hide()},validate:function(){return null!==this._getYearFromUI()?(this.clearErrors(),!0):(this.setYearError(),this.setError(this.__getCfg("invalidYear",!0)),!1)},setError:function(e){this.errorEl&&(this.errorEl.innerHTML=e,this._show(this.errorEl,!0))},clearError:function(){this.errorEl&&(this.errorEl.innerHTML="",this._show(this.errorEl,!1))},setYearError:function(){Rui.util.LDom.addClass(this.yearEl,Rui.ui.calendar.LCalendarNavigator.CLASSES.INVALID)},clearYearError:function(){Rui.util.LDom.removeClass(this.yearEl,Rui.ui.calendar.LCalendarNavigator.CLASSES.INVALID)},clearErrors:function(){this.clearError(),this.clearYearError()},setInitialFocus:function(){var e=this.submitEl,t=this.__getCfg("initialFocus");if(t&&t.toLowerCase)if("year"==(t=t.toLowerCase())){e=this.yearEl;try{this.yearEl.select()}catch(e){}}else"month"==t&&(e=this.monthEl);if(e&&Rui.isFunction(e.focus))try{e.focus()}catch(e){}},erase:function(){var e,t;this.__rendered&&(this.purgeListeners(),this.yearEl=null,this.monthEl=null,this.errorEl=null,this.submitEl=null,this.cancelEl=null,this.firstCtrl=null,this.lastCtrl=null,this.navEl&&(this.navEl.innerHTML=""),(e=this.navEl.parentNode)&&e.removeChild(this.navEl),this.navEl=null,(t=this.maskEl.parentNode)&&t.removeChild(this.maskEl),this.maskEl=null,this.__rendered=!1)},destroy:function(){this.erase(),this._doc=null,this.cal=null,this.id=null},_show:function(e,t){e&&Rui.util.LDom.setStyle(e,"display",t?"block":"none")},_getMonthFromUI:function(){return this.monthEl?this.monthEl.selectedIndex:0},_getYearFromUI:function(){var e,t=Rui.ui.calendar.LCalendarNavigator,i=null;return this.yearEl&&(e=(e=this.yearEl.value).replace(t.TRIM,"$1"),t.YR_PATTERN.test(e)&&(i=parseInt(e,10))),i},_updateYearUI:function(){this.yearEl&&null!==this._year&&(this.yearEl.value=this._year)},_updateMonthUI:function(){this.monthEl&&(this.monthEl.selectedIndex=this._month)},_setFirstLastElements:function(){this.firstCtrl=this.monthEl,this.lastCtrl=this.cancelEl,this.__isMac&&(Rui.browser.webkit&&Rui.browser.webkit<420&&(this.firstCtrl=this.monthEl,this.lastCtrl=this.yearEl),Rui.browser.gecko&&(this.firstCtrl=this.yearEl,this.lastCtrl=this.yearEl))},_handleEnterKey:function(e){var t=Rui.util.LKey.KEY;Rui.util.LEvent.getCharCode(e)==t.ENTER&&(Rui.util.LEvent.preventDefault(e),this.submit())},_handleDirectionKeys:function(e){var t=Rui.util.LEvent,i=Rui.util.LKey.KEY,s=Rui.ui.calendar.LCalendarNavigator,a=this.yearEl.value?parseInt(this.yearEl.value,10):null;if(isFinite(a)){var n=!1;switch(t.getCharCode(e)){case i.UP:this.yearEl.value=a+s.YR_MINOR_INC,n=!0;break;case i.DOWN:this.yearEl.value=Math.max(a-s.YR_MINOR_INC,0),n=!0;break;case i.PAGE_UP:this.yearEl.value=a+s.YR_MAJOR_INC,n=!0;break;case i.PAGE_DOWN:this.yearEl.value=Math.max(a-s.YR_MAJOR_INC,0),n=!0}if(n){t.preventDefault(e);try{this.yearEl.select()}catch(e){}}}},_handleTabKey:function(e){var t=Rui.util.LEvent,i=Rui.util.LKey.KEY;if(t.getCharCode(e)==i.TAB&&!e.shiftKey)try{t.preventDefault(e),this.firstCtrl.focus()}catch(e){}},_handleShiftTabKey:function(e){var t=Rui.util.LEvent,i=Rui.util.LKey.KEY;if(e.shiftKey&&t.getCharCode(e)==i.TAB)try{t.preventDefault(e),this.lastCtrl.focus()}catch(e){}},getDefaultCfg:function(){var e;return Rui.ui.calendar.LCalendarNavigator._DEFAULT_CFG||(e=Rui.getMessageManager(),Rui.ui.calendar.LCalendarNavigator._DEFAULT_CFG={strings:{month:e.get("$.core.calendarNavigatorLabelMonth"),year:e.get("$.core.calendarNavigatorLabelYear"),submit:e.get("$.base.msg044"),cancel:e.get("$.base.msg121"),invalidYear:"Year needs to be a number"},monthFormat:Rui.ui.calendar.LCalendar.LONG,initialFocus:"year"}),Rui.ui.calendar.LCalendarNavigator._DEFAULT_CFG},__getCfg:function(e,t){var i=this.getDefaultCfg(),s=this.cal.cfg.getProperty("navigator");return t?!0!==s&&s.strings&&s.strings[e]?s.strings[e]:i.strings[e]:!0!==s&&s[e]?s[e]:i[e]},__isMac:-1!=navigator.userAgent.toLowerCase().indexOf("macintosh")};