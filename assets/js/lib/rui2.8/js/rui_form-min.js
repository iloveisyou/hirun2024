/*
 * @(#) rui_form-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.namespace("Rui.ui.form"),Rui.ui.form.LField=function(t){Rui.ui.form.LField.superclass.constructor.call(this,t),this.createEvent("changed"),this.createEvent("valid"),this.createEvent("invalid"),this.createEvent("specialkey")},Rui.extend(Rui.ui.form.LField,Rui.ui.LUIComponent,{otype:"Rui.ui.form.LField",fieldObject:!0,name:null,borderSize:1,checkContainBlur:!1,initDefaultConfig:function(){Rui.ui.form.LField.superclass.initDefaultConfig.call(this),this.cfg.addProperty("editable",{handler:this._setEditable,value:this.editable,validator:Rui.isBoolean}),this.cfg.addProperty("defaultValue",{handler:this._setDefaultValue,value:this.value})},getContentWidth:function(){var t=this.el.getWidth(!0);return t<1?this.width-2*this.borderSize:t},getContentHeight:function(){var t=this.el.getHeight(!0);return t<1?this.height-2*this.borderSize:t},setValue:function(t){this.el.setValue(t)},getValue:function(){return this.el.getValue()},valid:function(){return this.el.valid(),this.fireEvent("valid"),this},invalid:function(t){return this.el.invalid(t),this.fireEvent("invalid",t),this},setName:function(t){this.name=t},getName:function(){return this.name},setEditable:function(t){this.cfg.setProperty("editable",!0!==this.disabled&&t)},_setEditable:function(t,e,i){this.editable=!!e[0]},_setDefaultValue:function(t,e,i){this.setValue(e[0])},onFireKey:function(t){Rui.util.LEvent.isSpecialKey(t)&&this.fireEvent("specialkey",t)},toString:function(){return(this.otype||"Rui.ui.form.LField ")+" "+this.id}}),Rui.namespace("Rui.ui.form"),function(){var Dom=Rui.util.LDom,KL=Rui.util.LKey,ST=Rui.util.LString,Ev=Rui.util.LEvent;Rui.ui.form.LTextBox=function(t){t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.textBox.defaultProperties"));var e=Rui.getConfig().getFirst("$.ext.textBox.dataSet");e&&!t.displayField&&e.displayField&&(t.displayField=e.displayField),this.overflowCSS=Rui.browser.opera?"overflow":"overflowY",this.useDataSet=!0===t.autoComplete||this.useDataSet,!0===this.useDataSet&&t.dataSet&&(this.dataSet=t.dataSet,this.initDataSet(),this.isLoad=!0),this.mask=t.mask||this.mask||null,this.mask&&this.initMask(),Rui.ui.form.LTextBox.superclass.constructor.call(this,t),this.mask&&this.initMaskEvent(),Rui.mobile.ios&&(this.mask=null),!0===this.useDataSet&&Rui.isEmpty(this.dataSet)&&Rui.isEmpty(t.dataSet)&&this.createDataSet(),!0===this.useDataSet&&(this.dataSet&&this.initDataSet(),t.url&&this.dataSet.load({url:t.url,params:t.params}))},Rui.ui.form.LTextBox.ROW_RE=new RegExp("L-row-r([^\\s]+)",""),Rui.extend(Rui.ui.form.LTextBox,Rui.ui.form.LField,{otype:"Rui.ui.form.LTextBox",CSS_BASE:"L-textbox",CSS_PLACEHOLDER:"L-placeholder",displayField:"text",type:"text",editable:!0,width:100,height:-1,defaultValue:"",listWidth:-1,dataSetClassName:"Rui.data.LJsonDataSet",filterMode:"local",localDelayTime:30,remoteDelayTime:250,filterUrl:"",useDataSet:!1,autoComplete:!1,selectedIndex:!1,firstChangedEvent:!0,dataSet:null,marginTop:0,marginLeft:0,includeChars:null,inputType:null,currFocus:!1,imeMode:"auto",emptyText:"Choose a state",useEmptyText:!1,emptyValue:"",mask:null,maskValue:!1,definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},maskPlaceholder:"_",placeholder:null,invalidBlur:!1,filterFn:null,optionDivEl:null,expandCount:0,stringFromChatCode:!1,listRenderer:null,dataSetId:null,listPosition:"auto",rowRe:new RegExp("L-row-r([^\\s]+)",""),ignoreEvent:!0,initEvents:function(){Rui.ui.form.LTextBox.superclass.initEvents.call(this),this.createEvent("keydown"),this.createEvent("keyup"),this.createEvent("keypress"),this.createEvent("cut"),this.createEvent("copy"),this.createEvent("paste"),this.createEvent("expand"),this.createEvent("collapse")},initDefaultConfig:function(){Rui.ui.form.LTextBox.superclass.initDefaultConfig.call(this),this.cfg.addProperty("listWidth",{handler:this._setListWidth,value:this.listWidth,validator:Rui.isNumber}),this.cfg.addProperty("useEmptyText",{handler:this._setAddEmptyText,value:this.useEmptyText,validator:Rui.isBoolean})},createContainer:function(t){if(this.el){this.oldDom=this.el.dom,"INPUT"==this.el.dom.tagName&&(this.id=this.id||this.el.id,this.name=this.name||this.oldDom.name,this.el.parent(),this.el=Rui.get(this.createElement().cloneNode(!1)),this.el.dom.id=this.id,Dom.replaceChild(this.el.dom,this.oldDom),this.el.appendChild(this.oldDom),Dom.removeNode(this.oldDom)),this.attrs=this.attrs||{};var e=this.oldDom.attributes;if(void 0!==e)if(Rui.browser.msie67)for(var i=0,s=e.length;i<s;i++){var a=e[i].value;a&&"null"!==a&&""!==a&&(this.attrs[e[i].name]=Rui.util.LObject.parseObject(a))}else for(i=0,s=e.length;i<s;i++)this.attrs[e[i].name]=e[i].value;delete this.attrs.id,delete this.oldDom}Rui.ui.form.LTextBox.superclass.createContainer.call(this,t)},doRender:function(){this.createTemplate(this.el),(this.inputEl.dom.instance=this).inputEl.addClass("L-instance"),Rui.useAccessibility()&&this.el.setAttribute("role","textbox")},createTemplate:function(t){var e=Rui.get(t);e.addClass(this.CSS_BASE),e.addClass("L-fixed"),e.addClass("L-form-field");var i="";for(var s in this.attrs)i+=" "+s+'="'+this.attrs[s]+'"';var a="";this.autoComplete&&(a=' autocomplete="off"');var l=Rui.createElements('<input type="'+this.type+'" '+i+a+">").getAt(0).dom;return l.id=Rui.useFixedId()?Rui.id(this.el,"LTextBox-"+this.id):Rui.id(),l.name=this.name||l.name||this.id,e.appendChild(l),this.inputEl=Rui.get(l),this.inputEl.addClass("L-display-field"),e},afterRender:function(t){Rui.ui.form.LTextBox.superclass.afterRender.call(this,t);var e=this.getDisplayEl();e.on("click",function(t){1!=this.editable&&this.expand()},this,!0),null!=this.inputType&&e.on("keydown",this.onFilterKey,this,!0),this.inputType!=ST.PATTERN_TYPE_KOREAN&&(null!=this.includeChars&&(this.imeMode="disabled"),null!=this.inputType&&(this.imeMode="disabled")),"auto"!==this.imeMode&&e.setStyle("ime-mode",this.imeMode),!0===this.useDataSet&&!0===this.autoComplete&&e.on("keyup",this.onKeyAutoComplete,this,!0),Rui.browser.webkit||Rui.browser.msie||Rui.browser.chrome?e.on("keydown",this.onSpecialkeyEvent,this,!0):e.on("keypress",this.onSpecialkeyEvent,this,!0),e.on("keydown",this.onKeydown,this,!0),e.on("keyup",this.onKeyup,this,!0),e.on("keypress",this.onKeypress,this,!0);var i=Rui.browser.msie||Rui.browser.chrome||Rui.browser.safari&&3==Rui.browser.version?"keydown":"keypress";e.on(i,this.onFireKey,this,!0),this.createOptionDiv(),this.optionDivEl&&(!0===this.useDataSet&&Rui.isEmpty(this.dataSet)?this.createDataSet():this.doLoadDataSet()),this.initFocus(),"text"!=this.type&&this.initType(),this.focusDefaultValue(),this.setPlaceholder()},createDataSet:function(){this.dataSet||(this.dataSet=new(eval(this.dataSetClassName))({id:this.dataSetId||this.id+"DataSet",fields:[{id:this.displayField}],focusFirstRow:!1}))},initType:function(){"url"==this.type?(this.placeholder="http://",this.inputEl.on("focus",function(){""==this.inputEl.getValue()&&this.inputEl.setValue(this.placeholder)},this,!0)):"email"==this.type&&(this.placeholder=Rui.getMessageManager().get("$.base.msg111"))},initDataSet:function(){this.doSyncDataSet()},doSyncDataSet:function(){!0!==this.isBindEvent&&(this.dataSet.on("beforeLoad",this.onBeforeLoadDataSet,this,!0,{system:!0}),this.dataSet.on("load",this.onLoadDataSet,this,!0,{system:!0}),this.dataSet.on("dataChanged",this.onDataChangedDataSet,this,!0,{system:!0}),this.dataSet.on("rowPosChanged",this.onRowPosChangedDataSet,this,!0,{system:!0}),this.dataSet.on("add",this.onAddData,this,!0,{system:!0}),this.dataSet.on("update",this.onUpdateData,this,!0,{system:!0}),this.dataSet.on("remove",this.onRemoveData,this,!0,{system:!0}),this.dataSet.on("undo",this.onUndoData,this,!0,{system:!0}),this.isBindEvent=!0)},doUnSyncDataSet:function(){this.dataSet.unOn("beforeLoad",this.onBeforeLoadDataSet,this),this.dataSet.unOn("load",this.onLoadDataSet,this),this.dataSet.unOn("dataChanged",this.onDataChangedDataSet,this),this.dataSet.unOn("rowPosChanged",this.onRowPosChangedDataSet,this),this.dataSet.unOn("add",this.onAddData,this),this.dataSet.unOn("update",this.onUpdateData,this),this.dataSet.unOn("remove",this.onRemoveData,this),this.dataSet.unOn("undo",this.onUndoData,this),this.isBindEvent=!1},initFocus:function(){var t=this.getDisplayEl();t&&(t.on("focus",this.onCheckFocus,this,!0),t.on("blur",this.checkBlur,this,!0))},setPlaceholder:function(){var t,e;this.placeholder&&(t=this.getDisplayEl(),Rui.browser.msie6789?(e=t.getValue(),this.isFocus&&!0===this.editable?(this.placeholder&&e===this.placeholder&&t.setValue(""),t.removeClass(this.CSS_PLACEHOLDER)):!e||e.length<1||e===this.placeholder?(t.setValue(this.placeholder),t.addClass(this.CSS_PLACEHOLDER)):this.placeholder!==e&&t.removeClass(this.CSS_PLACEHOLDER)):this.getDisplayEl().dom.placeholder=this.placeholder)},onFilterKey:function(t){if(null!=this.inputType){var e=KL.KEY;if(t.keyCode==e.SPACE||!Ev.isSpecialKey(t)&&t.keyCode!=e.BACK_SPACE&&t.keyCode!=e.DELETE){var i=t.charCode||t.which||t.keyCode;if(229!=i||this.inputType!=ST.PATTERN_TYPE_STRING&&this.inputType!=ST.PATTERN_TYPE_NUMSTRING){var s=!1===this.stringFromChatCode?this.fromCharCode(i):String.fromCharCode(i),a=this.inputType;if(null==this.includeChars)if(this.inputType==ST.PATTERN_TYPE_KOREAN){if(!ST.isHangul(s))return void Ev.preventDefault(t)}else if(!a.test(s))return void Ev.preventDefault(t);this.ctrlKeypress}else Ev.preventDefault(t)}}},fromCharCode:function(t){96<=t&&t<=105&&(t-=48);var e=String.fromCharCode(t);switch(t){case 105:break;case 106:e="*";break;case 107:e="+";break;case 109:e="-";break;case 110:case 190:e=".";break;case 111:e="/";break;case 188:e=",";break;case 191:e="/"}return e},onFocus:function(t){Rui.ui.form.LTextBox.superclass.onFocus.call(this,t),this.lastValue=this.getValue(),this.lastDisplayValue=this.getDisplayValue(),this.setPlaceholder(),this.currFocus=!0,this.doFocus(t)},doFocus:function(t){},setSelectionRange:function(t,e){this.currFocus&&Dom.setSelectionRange(this.getDisplayEl().dom,t,e)},checkBlur:function(t){if(this.isFocus&&(!this.gridPanel||1!=t.deferCancelBubble)){var e=t.target;if((!this.iconEl||this.iconEl.dom!=e)&&this.el.dom!==e){var i=!1;if(Rui.isUndefined(this.optionDivEl)?this.el.isAncestor(e)||(i=!0):0==this.el.isAncestor(e)&&(this.optionDivEl&&(this.optionDivEl.dom===e||this.optionDivEl.isAncestor(e))||(i=!0)),0==this.checkContainBlur||1==i){if(!1===this.onCanBlur(t))return void this.setValue(this.lastValue||"",!0);Ev.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.onBlur.call(this,t)}else t.deferCancelBubble=!0}}},onCanBlur:function(t){var e=this.getDisplayEl().getValue();return!(e=this.getNormalValue(e))||this.lastDisplayValue==e||0!=this.validateValue(e)||(!0!==this.invalidBlur||(this.setValue(this.lastValue,!0),this.setDisplayValue(this.lastDisplayValue)),!1)},onBlur:function(t){this.isFocus&&(this.isFocus=null,this.isExpand()&&this.collapse(),0==Rui.isUndefined(this.lastDisplayValue)&&this.lastDisplayValue!=this.getDisplayValue()&&this.doChangedDisplayValue(this.getDisplayValue()),Rui.ui.form.LTextBox.superclass.onBlur.call(this,t),this.setPlaceholder())},doChangedDisplayValue:function(t){this.setValue(t)},_setWidth:function(t,e,i){e[0]<0||(Rui.ui.form.LTextBox.superclass._setWidth.call(this,t,e,i),this.getDisplayEl().setWidth(this.getContentWidth()),this.optionDivEl&&this.setListWidth(e[0]))},_setHeight:function(t,e,i){e[0]<0||(Rui.ui.form.LTextBox.superclass._setHeight.call(this,t,e,i),this.getDisplayEl().setHeight(this.getContentHeight()+(Rui.browser.msie67?-2:0)),Rui.browser.msie&&-1<e[0]&&this.getDisplayEl().setStyle("line-height",e[0]+"px"))},_setListWidth:function(t,e,i){var s;this.optionDivEl&&(s=this.el.getWidth()||this.width,0<this.listWidth&&(s=Math.max(this.listWidth,s)),this.optionDivEl.setWidth(s))},setListWidth:function(t){this.cfg.setProperty("listWidth",t)},getListWidth:function(){return this.cfg.getProperty("listWidth")},_setAddEmptyText:function(t,e,i){this.optionDivEl&&(1==e[0]&&0==this.hasEmptyText()?this.createEmptyText():this.removeEmptyText())},setAddEmptyText:function(t){this.cfg.setProperty("useEmptyText",t)},getAddEmptyText:function(){return this.cfg.getProperty("useEmptyText")},setHeight:function(t){this.cfg.setProperty("height",t)},getHeight:function(){return this.cfg.getProperty("height")},_setDisabled:function(t,e,i){this.disabled=!!e[0],this.el&&(!1===this.disabled?(this.el.removeClass("L-disabled"),this.getDisplayEl().dom.disabled=!1,this.getDisplayEl().dom.readOnly=void 0===this.latestEditable?!this.editable:!this.latestEditable):(this.el.addClass("L-disabled"),this.getDisplayEl().dom.disabled=!0,this.getDisplayEl().dom.readOnly=!0)),this.fireEvent(this.disabled?"disable":"enable")},setEditable:function(t){this.cfg.setProperty("editable",!0!==this.disabled&&t)},_setEditable:function(t,e,i){Rui.ui.form.LTextBox.superclass._setEditable.call(this,t,e,i),this.latestEditable=this.editable,this.getDisplayEl().dom.readOnly=!this.editable},getDisplayEl:function(){return this.inputEl||this.el},focus:function(){this.getDisplayEl().focus()},blur:function(){var t;this.checkContainBlur?(Ev.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),t={type:"mousedown",target:document.body},this.onBlur.call(this,t)):this.getDisplayEl().blur()},isValid:function(){return this.getDisplayEl().isValid()},onKeyup:function(t){var e=KL.KEY;if(t.keyCode==e.DOWN||t.keyCode==e.UP||t.keyCode==e.TAB)return this.onFocus(),void this.fireEvent("keydown",t);if(null!=this.inputType){if(null!=this.inputType&&this.inputType!=Rui.util.LString.PATTERN_TYPE_KOREAN){var i=this.getValue();if(null!=i){var s=(i+"").replace(/[\ㄱ-ㅎ가-힣]/g,"");if(s!=i)return this.setValue(s),Ev.stopEvent(t),void(t.returnValue=!1)}}(t.shiftKey||t.altKey||t.ctrlKey)&&(this.specialKeypress=!1,this.ctrlKeypress=!1),this.fireEvent("keyup",t)}else this.fireEvent("keyup",t)},onKeydown:function(t){if(null!=this.inputType){var e=KL.KEY;if(t.keyCode!=e.SPACE&&t.keyCode!=e.SHIFT&&(Ev.isSpecialKey(t)||t.keyCode==e.BACK_SPACE||t.keyCode==e.DELETE))return;if(229==(t.charCode||t.which||t.keyCode)&&this.inputType!=ST.PATTERN_TYPE_KOREAN)return void Ev.preventDefault(t)}this.fireEvent("keydown",t)},onKeypress:function(t){if(null!=this.inputType){var e=t.charCode||t.which||t.keyCode;if(8!=e&&39!=e&&45!=e&&46!=e&&(!this.ctrlKeypress||97!=e&&99!=e&&118!=e&&120!=e)){var i=String.fromCharCode(e),s=this.inputType;if(null!=this.includeChars&&new RegExp("["+this.includeChars+"]","i").exec(i))this.fireEvent("keypress",t);else{if(this.inputType==ST.PATTERN_TYPE_KOREAN){if(!ST.isHangul(i))return void Ev.preventDefault(t)}else if(!s.test(i))return void Ev.preventDefault(t);this.fireEvent("keypress",t)}}}else this.fireEvent("keypress",t)},onSpecialkeyEvent:function(t){if(!0===this.checkContainBlur&&t.keyCode==KL.KEY.TAB){if(0==this.onCanBlur(t)){this.focus();try{Ev.stopEvent(t)}catch(t){}return!1}Ev.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.onBlur.call(this,t),this.isFocus=null}this.optionDivEl&&this.doKeyMove(t),t.ctrlKey&&"X"==String.fromCharCode(t.keyCode)?this.fireEvent("cut",t):t.ctrlKey&&"C"==String.fromCharCode(t.keyCode)?this.fireEvent("copy",t):t.ctrlKey&&"V"==String.fromCharCode(t.keyCode)&&(this.lastValue=null,this.fireEvent("paste",t))},onKeyAutoComplete:function(t){!0===this.useDataSet&&!0===this.autoComplete&&this.doKeyInput(t)},doKeyMove:function(t){var e=KL.KEY;switch(t.keyCode){case e.ENTER:var i=this.getActive();null!=i&&this.doChangedItem(i.dom),this.collapse();break;case e.DOWN:this.expand(),this.nextActive(),Ev.stopEvent(t);break;case e.UP:this.expand(),this.prevActive(),Ev.stopEvent(t);break;case e.PAGE_DOWN:this.pageDown(t);break;case e.PAGE_UP:this.pageUp();break;case e.ESCAPE:this.collapse()}},doKeyInput:function(t){this.isForceCheck=!1,KL.KEY.ENTER==t.keyCode&&Ev.preventDefault(t),KL.KEY.TAB==t.keyCode&&this.collapse();var e=KL.KEY;switch(t.keyCode){case e.ENTER:case e.DOWN:case e.LEFT:case e.RIGHT:case e.UP:break;default:if(""==this.getDisplayEl().getValue()&&this.dataSet.isFiltered())this.clearFilter();else if(this.lastValue!=this.getDisplayEl().getValue()){if(this.autoComplete||(this.lastValue=this.getDisplayEl().getValue()),this.filterTask)return;if(!(!0!==t.altKey&&!0!==t.ctrlKey||!0===t.ctrlKey&&"V"==String.fromCharCode(t.keyCode)))return;this.expand(),this.autoComplete&&(this.filterTask=new Rui.util.LDelayedTask(this.doFilter,this),this.filterTask.delay("remote"==this.filterMode?this.remoteDelayTime:this.localDelayTime))}}},doFilter:function(t){this.filterTask.cancel(),this.filterTask=null,this.filter(this.getDisplayEl().getValue(),this.filterFn)},onOptionMouseDown:function(t){this.collapseIf(t),this.getDisplayEl().focus()},expand:function(){if(!0!==this.disabled&&(!0!==this.isLoad&&this.doLoadDataSet(),this.optionDivEl&&this.optionDivEl.hasClass("L-hide-display"))){this.doExpand(),this.getActiveIndex()<0&&this.firstActive();try{this.getDisplayEl().focus()}catch(t){}}},createOptionDiv:function(){var t;!0===this.useDataSet&&(this.getDisplayEl(),(t=document.createElement("div")).id=Rui.useFixedId()?Rui.id(this.el,"LTextBox-opt-"+this.id):Rui.id(),this.optionDivEl=Rui.get(t),this.optionDivEl.setWidth(-1<this.listWidth?this.listWidth:this.width-this.el.getBorderWidth("lr")),this.optionDivEl.addClass(this.CSS_BASE+"-list-wrapper"),this.optionDivEl.addClass("L-hide-display"),Rui.useAccessibility()&&(this.optionDivEl.setAttribute("role","listbox"),this.optionDivEl.setAttribute("aria-expaned","false")),this.optionDivEl.on("mousedown",this.onOptionMouseDown,this,!0),this.listRenderer&&this.optionDivEl.addClass("L-custom-list"),document.body.appendChild(t))},getOptionDiv:function(){return this.optionDivEl},getActive:function(){var t=this.optionDivEl.select(".active");if(!(t.length<1))return t.getAt(0)},getActiveIndex:function(){for(var t=this.optionDivEl.select("div.L-list"),e=-1,i=0;i<t.length;i++)if(t.getAt(i).hasClass("active")){e=i;break}return e},getDataIndex:function(t){for(var e=this.optionDivEl.select("div.L-list"),i=-1,s=0;s<e.length;s++){var a=e.getAt(s).select(".L-display-field").getAt(0).dom.firstChild;if(a&&Rui.util.LString.trim(a.nodeValue)==(t&&0<t.length&&Rui.util.LString.trim(t))){i=s;break}}return-1<i&&!0===this.useEmptyText&&i--,i},getItemByRecordId:function(t){if(!this.optionDivEl)return null;for(var e=this.optionDivEl.select("div.L-list"),i=null,s=0;s<e.length;s++){var a=e.getAt(s),l=a.select(".L-display-field").getAt(0).dom.firstChild;if(l&&Rui.util.LString.trim(l.nodeValue)==(t&&0<t.length&&Rui.util.LString.trim(t))){i="r"+a.dom.className.match(Rui.ui.form.LTextBox.ROW_RE)[1];break}}return i},firstActive:function(){var t=this.optionDivEl.select(":first-child");0<t.length&&t.getAt(0).addClass("active")},nextActive:function(){var t=this.getActive();if(null==t)this.firstActive();else{var e=Dom.getNextSibling(t.dom);if(null==e)return;var i=Rui.get(e);t.removeClass("active"),i.addClass("active"),this.scrollDown()}},prevActive:function(){var t=this.getActive();if(null==t)this.firstActive();else{var e=Dom.getPreviousSibling(t.dom);if(null==e)return;var i=Rui.get(e);t.removeClass("active"),i.addClass("active"),this.scrollUp()}},pageUp:function(){var t,e;this.dataSet&&(this.isExpand()||this.expand(),(e=(t=this.dataSet).getRow()-this.expandCount)<0&&(e=!0===this.useEmptyText?-1:0),t.setRow(e))},pageDown:function(){var t,e;this.dataSet&&(this.isExpand()||this.expand(),e=(t=this.dataSet).getRow()+this.expandCount,t.getCount()-1<e&&(e=t.getCount()-1),t.setRow(e))},scrollDown:function(){var t,e;"scroll"==this.optionDivEl.getStyle(this.overflowCSS)&&"auto"==this.optionDivEl.getStyle(this.overflowCSS)||(t=this.getActive(),e=(this.getActiveIndex()+1)*t.getHeight()-this.optionDivEl.getHeight(),this.optionDivEl.dom.scrollTop<e&&(this.optionDivEl.dom.scrollTop=e))},scrollUp:function(){var t,e;"scroll"==this.optionDivEl.getStyle(this.overflowCSS)&&"auto"==this.optionDivEl.getStyle(this.overflowCSS)||(t=this.getActive(),e=this.getActiveIndex()*t.getHeight(),this.optionDivEl.dom.scrollTop>e&&(this.optionDivEl.dom.scrollTop=e))},doExpand:function(){this.optionDivEl.setTop(0),this.optionDivEl.setLeft(0),this.optionDivEl.removeClass("L-hide-display"),this.optionDivEl.addClass("L-show-display"),Rui.useAccessibility()&&this.optionDivEl.setAttribute("aria-expaned","true");var t=this.getDisplayEl().getValue();(""===t||this.useEmptyText&&t==this.emptyText)&&(this._itemRendered=!1,this.editable&&this.autoComplete&&this.dataSet.clearFilter(!1)),!0!==this._itemRendered&&this.doDataChangedDataSet(),this.optionAutoHeight();var e=Rui.util.LDom.getViewport().width,i=this.optionDivEl.getHeight(),s=this.optionDivEl.getWidth(),a=this.el.getTop(),l=this.el.getLeft(),a=(a+=this.el.getHeight())||0,l=l||0;("auto"!=this.listPosition||Rui.util.LDom.isVisibleSide(i+a))&&"up"!=this.listPosition||(a=this.el.getTop()-i),Rui.rightToLeft()?(l-=s-this.getWidth()+2*(this.marginLeft+(Rui.browser.msie67?-2:0)))<0&&(l+=s-this.getWidth()+this.marginLeft+(Rui.browser.msie67?-2:0)):e<=(l=l+this.marginLeft+(Rui.browser.msie67?-2:0))+s&&s>this.getWidth()&&(l-=s-this.getWidth()+2*(this.marginLeft+(Rui.browser.msie67?-2:0))),this.optionDivEl.setTop(a+this.marginTop+(Rui.browser.msie67?-2:0)),this.optionDivEl.setLeft(l),this.optionDivEl.select(".L-list").removeClass("selected"),this.activeItem(),null!=this.el.findParent(".L-overlay")&&(this.checkOptionDivDelegate=Rui.later(100,this,this._checkOptionDiv,null,!0)),this.reOnDeferOnBlur(),this.fireEvent("expand")},_checkOptionDiv:function(){var t=this.inputEl.getLeft(),e=this.inputEl.getTop();(Rui.browser.msie&&8==Rui.browser.version||this.inputEl.getTop()-2<=e&&this.inputEl.getTop()>=e)&&this.inputEl.getLeft()-2<=t&&this.inputEl.getLeft()>=t||this.collapse()},isExpand:function(){return this.optionDivEl&&this.optionDivEl.hasClass("L-show-display")},collapseIf:function(t){var e,i,s,a=t.target;this.optionDivEl&&this.optionDivEl.dom==a||this.iconEl&&this.iconEl.dom==a||this.inputEl&&this.inputEl.dom==a||(e=Rui.get(a))&&((i=e.hasClass("L-list"))||(s=e.findParent("div.L-list",3))&&(e=s,i=!0),i&&(e.removeClass("active"),this.doChangedItem(e.dom)),this.collapse())},collapse:function(){this.optionDivEl.removeClass("L-show-display"),this.optionDivEl.addClass("L-hide-display"),Rui.useAccessibility()&&this.optionDivEl.setAttribute("aria-expaned","false"),this.checkOptionDivDelegate&&this.checkOptionDivDelegate.cancel(),this.isFocus&&this.getDisplayEl().focus(),this.fireEvent("collapse"),this.optionDivEl.select(".active").removeClass("active")},optionAutoHeight:function(){var t,e,i,s,a;this.optionDivEl&&(t=this.dataSet.getCount(),e=this.optionDivEl.getHeight(),this.useEmptyText&&t++,this.expandCount||(this.expandCount=10),t>this.expandCount?0<this.optionDivEl.dom.childNodes.length&&(i=this.expandCount*s,s=this.optionDivEl.dom.firstChild.offsetHeight,e!=i&&e!=i+this.optionDivEl.getStyle("border-top-width")+this.optionDivEl.getStyle("border-bottom-width")&&this.optionDivEl.setHeight(this.expandCount*s+"px")):this.optionDivEl.setHeight("auto"),e=this.optionDivEl.getHeight(),a=this.el.getTop(),this.optionDivEl.getTop()<a&&this.optionDivEl.setTop(a-e))},onScroll:function(){this.collapse()},activeItem:function(){var t,e;this.isForceCheck=!1,""!=this.getDisplayEl().getValue()&&(t=this.optionDivEl.select(".L-list"),(e=this.dataSet.getAt(this.dataSet.getRow()))&&t.each(function(t){if(-1<t.dom.className.indexOf("L-row-"+e.id))return t.addClass("selected"),t.addClass("active"),this.scrollDown(),!1},this))},doLoadDataSet:function(){this._itemRendered=!1,this.optionDivEl&&(this.doDataChangedDataSet(),this.isLoad=!0,this.focusDefaultValue()),this.doCacheData()},onBeforeLoadDataSet:function(t){this.bindMDataSet||this.dataSet.setRow(-1)},onLoadDataSet:function(t){var e;this._newLoaded=!0,this._itemRendered=!1,this.doLoadDataSet(),this.optionAutoHeight(),this.bindMDataSet&&-1<this.bindMDataSet.getRow()&&(e=this.bindMDataSet.getRow(),!0===this.autoComplete&&!0===this.dataSet.isLoad||this.setValue(this.bindMDataSet.getNameValue(e,this.bindObject.id),!0))},setDefaultValue:function(t){this.defaultValue=t},setSelectedIndex:function(t){this.selectedIndex=t},focusDefaultValue:function(){var t;this.bindMDataSet||!0===this.autoComplete||(!0!==this.isLoad&&Rui.isEmpty(this.defaultValue)&&(this.defaultValue=this.getValue()),!(t=!1)===this.ignoreEvent&&this.gridPanel&&(t=!0),Rui.isEmpty(this.defaultValue)?!1!==this.selectedIndex&&0<=this.selectedIndex?this.dataSet.getCount()-1>=this.selectedIndex&&this.setValue(this.dataSet.getNameValue(this.selectedIndex,this.valueField),t):this.firstChangedEvent&&this.setValue(null,t):this.setValue(this.defaultValue,t))},doChangedItem:function(t){var e,i;t.innerHTML&&(i=(e=Rui.get(t).select(".L-display-field").getAt(0).dom.firstChild)?e.nodeValue:"",this.setValue(i),this.isFocus&&this.getDisplayEl().focus())},onRowPosChangedDataSet:function(t){},onAddData:function(t){var e=t.row,i=t.target,s=this.createItem({record:this.dataSet.getAt(e),row:e});if(1<i.getCount()){var a=e-1;if(a<0){var l=e+1,n=this.getRowEl(l);if(null==n)return;n.insertBefore(s.dom)}else{var o=this.getRowEl(a);if(null==o)return;o.insertAfter(s.dom)}}else this.optionDivEl&&this.getOptionDiv().appendChild(s.dom)},onUpdateData:function(t){var e,i,s,a,l,n=t.row;t.colId!=this.displayField||(e=this.getRowEl(n))&&(i=this.dataSet.getAt(n),s=this.createItem({record:i,row:n}),e.html(s.getHtml()),n==this.dataSet.getRow()&&(a=this.getDisplayEl(),l=i.get(this.displayField),l=Rui.isEmpty(l)?"":l,a.setValue(l)))},onRemoveData:function(t){var e=t.row,i=this.getRowEl(e);null!=i&&i.remove()},onUndoData:function(t){t.beforeState==Rui.data.LRecord.STATE_INSERT&&this.onRemoveData(t)},onDataChangedDataSet:function(t){this._itemRendered=!1,this.doDataChangedDataSet()},doDataChangedDataSet:function(){if(!0!==this.autoComplete&&!0!==this.editable&&this.getValue()&&!this.bindMDataSet&&this.dataSet.findRow(this.valueField,this.getValue())<0&&this.setValue(""),!0===this.autoComplete||this.isFocus){if(this.removeAllItem(),!0===this.useEmptyText&&this.createEmptyText(),this.optionDivEl){for(var t,e=Rui.data.LRecord.STATE_DELETE,i=this.dataSet,s=0,a=i.getCount();s<a;s++){e!=i.getState(s)&&(t=this.createItem({record:i.getAt(s),row:s}),this.appendOption(t.dom))}this._itemRendered=!0}this.autoComplete&&this.optionAutoHeight()}},appendOption:function(t){this.optionDivEl.appendChild(t)},hasEmptyText:function(){return this.optionDivEl?!(this.optionDivEl.dom.childNodes.length<1)&&Dom.hasClass(this.optionDivEl.dom.childNodes[0],"L-empty"):this.useEmptyText},createEmptyText:function(){try{if(!this.el)return;var t={};this.valueField&&(t[this.valueField]=""),t[this.displayField]=this.emptyText;var e=this.dataSet.createRecord(t),i=this.createItem({record:e,row:-1});i.addClass("L-empty"),this.insertEmptyText(i.dom)}catch(t){}},insertEmptyText:function(t){0<this.optionDivEl.dom.childNodes.length?Dom.insertBefore(t,this.optionDivEl.dom.childNodes[0]):this.optionDivEl.appendChild(t)},removeEmptyText:function(){this.hasEmptyText()&&Dom.removeNode(this.optionDivEl.dom.childNodes[0])},getRowEl:function(t){if(this.optionDivEl){var e=this.optionDivEl.select(".L-list");return 0<e.length?e.getAt(this.useEmptyText?t+1:t):null}return null},createItem:function(t){var e=t.record,i=e.get(this.displayField),i=Rui.isEmpty(i)?"":i,s="",s=this.listRenderer?this.listRenderer(e):'<div class="L-display-field" id="LTextBox-listItem-'+this.id+"-"+(t.row+1)+'">'+i+"</div>",a=Rui.createElements('<div class="L-list L-row-'+e.id+'" id="LTextBox-optList-'+this.id+"-"+(t.row+1)+'">'+s+"</div>").getAt(0),l=this.optionDivEl;return Rui.useAccessibility()&&a.setAttribute("role","option"),a.hover(function(){this.addClass("active")},function(){l.select(".active").removeClass("active")}),a},findRowIndex:function(t){var e=Rui.get(t).findParent(".L-list");if(!e)return-1;var i=e.dom;if(!i||!i.className)return-1;var s=i.className.match(this.rowRe);if(s&&s[1]){var a=this.dataSet.indexOfKey("r"+s[1]);return-1!=a&&a}},add:function(t,e){var i=this.dataSet.createRecord(t,{id:Rui.data.LRecord.getNewRecordId()});this.dataSet.add(i,e)},addAll:function(t,e){for(var i=0;i<t.length;i++)this.add(t[i],e)},setData:function(t,e){t>this.dataSet.getCount()-1||0==t||this.dataSet.getAt(t).setValues(e)},removeAt:function(t){this.dataSet.removeAt(t)},removeAllItem:function(){null!=this.optionDivEl&&this.optionDivEl.select(".L-list").remove()},getCount:function(){return this.dataSet.getCount()},filter:function(s,t){var e;"remote"==this.filterMode?((e={})[this.displayField]=s,this.dataSet.load({url:this.filterUrl,params:e})):(t=t||function(t,e){var i=e.get(this.displayField);if(ST.startsWith(i.toLowerCase(),s.toLowerCase()))return!0},this.dataSet.filter(t,this,!1))},clearFilter:function(){this.dataSet&&this.dataSet.clearFilter(!1)},getValue:function(){var t=this.getDisplayEl().getValue();return this.mask&&null!=t&&""!=t&&0==this.maskValue&&(t=this.getUnmaskValue(t)),this.mask&&null!=t&&""!=t&&1==this.maskValue&&(t=""==this.getUnmaskValue(t)?"":t),t==this.placeholder||""==t?this.getEmptyValue(t):t},getEmptyValue:function(t){return t===this.emptyValue?t:this.emptyValue},getUnmaskValue:function(t){var i=[];return Rui.each(t.split(""),function(t,e){this.tests[e]&&this.tests[e].test(t)&&i.push(t)},this),i.join("")},getBuffer:function(t){var i=this.definitions,s=[],a=t.split(""),l=0;return Rui.each(this.mask.split(""),function(t,e){"?"!=t&&s.push(i[t]?this.maskPlaceholder:t),this.tests[e]&&this.tests[e].test(t)&&a.length>l&&(s[e]=a[l++])},this),s},getDisplayValue:function(){return this.getDisplayEl().getValue()},setDisplayValue:function(t){this.getDisplayEl().setValue(t)},setValue:function(t,e){var i,s;!0===Rui.isUndefined(t)||this.lastValue===t&&null===this.inputType||((i=this.getDisplayEl())&&(i.dom.value=t,s=this.checkValue().displayValue,i.dom.value=s,this.lastDisplayValue=s),!0!==e&&this.doChanged(),this.lastValue=t,this.setPlaceholder())},doChanged:function(){this.fireEvent("changed",{target:this,value:this.getValue(),displayValue:this.getDisplayValue()})},getDataSet:function(){return this.dataSet},setDataSet:function(t){this.doUnSyncDataSet(),this.dataSet=t,this.initDataSet(),this.onLoadDataSet()},doCacheData:Rui.emptyFn,onFireKey:function(t){(Ev.isSpecialKey(t)&&!this.isExpand()||!0===t.ctrlKey&&(70===t.keyCode||"V"==String.fromCharCode(t.keyCode)))&&this.fireEvent("specialkey",t)},initMask:function(){var i=this.definitions,s=[];this.partialPosition=this.mask.length,this.firstNonMaskPos=null,this.maskLength=this.mask.length,Rui.each(this.mask.split(""),function(t,e){"?"==t?(this.maskLength--,this.partialPosition=e):i[t]?(s.push(new RegExp(i[t])),null==this.firstNonMaskPos&&(this.firstNonMaskPos=s.length-1)):s.push(null)},this),this.tests=s,this.buffer=[],Rui.each(this.mask.split(""),function(t,e){"?"!=t&&this.buffer.push(i[t]?this.maskPlaceholder:t)},this)},initMaskEvent:function(){this.on("focus",function(){var t;Rui.mobile.ios&&0==this.checkContainBlur||(this.getDisplayValue()==this.placeholder&&this.getDisplayEl().setValue(""),t=this.checkValue().pos,!1!==this.editable&&this.writeBuffer(),setTimeout(Rui.util.LFunction.createDelegate(function(){t==this.mask.length?this.setCaret(0,t):this.setCaret(t)},this),0))},this,!0),this.on("blur",function(){Rui.mobile.ios&&0==this.checkContainBlur||this.setDisplayValue(this.checkValue().displayValue)}),Rui.mobile.ios||(this.on("keydown",this.onKeyDownMask,this,!0),this.on("keypress",this.onKeyPressMask,this,!0)),this.on("paste",function(t){this.cfg.getProperty("disabled")||Rui.mobile.ios&&0==this.checkContainBlur||setTimeout(Rui.util.LFunction.createDelegate(function(){this.setCaret(this.checkValue(!0).pos)},this),0)},this,!0),Rui.mobile.ios&&0==this.checkContainBlur||!this._rendered||this.setDisplayValue(this.checkValue().displayValue)},setCaret:function(t,e){var i,s=this.getDisplayEl().dom;e="number"==typeof e?e:t;try{s.setSelectionRange?(s.focus(),s.setSelectionRange(t,e)):s.createTextRange&&((i=s.createTextRange()).collapse(!0),i.moveEnd("character",e),i.moveStart("character",t),i.select())}catch(t){}},getCaret:function(){var t,e=this.getDisplayEl().dom;return e.setSelectionRange?(begin=e.selectionStart,end=e.selectionEnd):document.selection&&document.selection.createRange&&(t=document.selection.createRange(),begin=0-t.duplicate().moveStart("character",-1e5),end=begin+t.text.length),{begin:begin,end:end}},clearBuffer:function(t,e){for(var i=t;i<e&&i<this.maskLength;i++)this.tests[i]&&(this.buffer[i]=this.maskPlaceholder)},writeBuffer:function(){return this.setDisplayValue(this.buffer.join(""))},onKeyDownMask:function(t){if(this.cfg.getProperty("disabled")||1!=this.editable)return!0;var e=this.getCaret(),i=t.keyCode;return this.ignore=i<16||16<i&&i<32||32<i&&i<41,e.begin-e.end==0||this.ignore&&8!=i&&46!=i||this.clearBuffer(e.begin,e.end),8==i||46==i?(this.shiftL(e.begin+(46==i?0:-1)),Ev.preventDefault(t),!1):27==i?(0!=this.checkContainBlur&&this.setCaret(0,this.checkValue().pos),Ev.preventDefault(t),!1):void 0},onKeyPressMask:function(t){if(this.ignore)return this.ignore=!1,8!=t.keyCode&&null;var e=(t=t||window.event).charCode||t.keyCode||t.which,i=this.getCaret();if(t.ctrlKey||t.altKey||t.metaKey)return!0;if(32<=e&&e<=125||186<e){if(this.cfg.getProperty("disabled")||1!=this.editable)return!0;var s,a,l=this.seekNext(i.begin-1);l<this.maskLength&&(s=String.fromCharCode(e),this.tests[l].test(s)&&(this.shiftR(l),this.buffer[l]=s,this.writeBuffer(),a=this.seekNext(l),this.setCaret(a)))}return Ev.preventDefault(t),!1},seekNext:function(t){for(;++t<=this.maskLength&&!this.tests[t];);return t},shiftL:function(t){for(;!this.tests[t]&&0<=--t;);for(var e=t;e<this.maskLength;e++)if(this.tests[e]){this.buffer[e]=this.maskPlaceholder;var i=this.seekNext(e);if(!(i<this.maskLength&&this.tests[e].test(this.buffer[i])))break;this.buffer[e]=this.buffer[i]}this.writeBuffer(),this.setCaret(Math.max(this.firstNonMaskPos,t))},shiftR:function(t){for(var e=t,i=this.maskPlaceholder;e<this.maskLength;e++)if(this.tests[e]){var s=this.seekNext(e),a=this.buffer[e];if(this.buffer[e]=i,!(s<this.maskLength&&this.tests[s].test(a)))break;i=a}},checkValue:function(t){for(var e=this.getDisplayValue(),i=-1,s=0,a=0;s<this.maskLength;s++)if(this.tests[s]){for(this.buffer[s]=this.maskPlaceholder;a++<e.length;){var l=e.charAt(a-1);if(this.tests[s].test(l)){this.buffer[s]=l,i=s;break}}if(a>e.length)break}else this.buffer[s]==e[a]&&s!=this.partialPosition&&(a++,i=s);return!t&&i+1<this.partialPosition?(e="",this.clearBuffer(0,this.maskLength)):(t||i+1>=this.partialPosition)&&(this.writeBuffer(),t||(e=this.getDisplayValue().substring(0,i+1))),{pos:this.partialPosition?s:this.firstNonMaskPos,displayValue:e}},validateValue:function(t){return"email"!=this.type||""==this.getValue()||new Rui.validate.LEmailValidator({id:this.id}).validate(this.getValue())},findRowElById:function(t){if(!this.optionDivEl)return null;var e=this.optionDivEl.select(".L-row-"+t);return 0<e.length?e.getAt(0):null},destroy:function(){this.dataSet&&this.doUnSyncDataSet(),this.inputEl&&(this.inputEl.unOnAll(),this.inputEl.remove(),delete this.inputEl),this.displayEl&&(this.displayEl.unOnAll(),this.displayEl.remove(),delete this.displayEl),this.optionDivEl&&(this.optionDivEl.unOnAll(),this.optionDivEl.remove(),delete this.optionDivEl),Rui.ui.form.LTextBox.superclass.destroy.call(this)},getNormalValue:function(t){return t}})}(),Rui.namespace("Rui.ui.form"),Rui.ui.form.LCombo=function(t){t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.combo.defaultProperties"));var e=Rui.getConfig().getFirst("$.ext.combo.dataSet");e&&(!t.valueField&&e.valueField&&(t.valueField=e.valueField),!t.displayField&&e.displayField&&(t.displayField=e.displayField)),this.emptyText=t.emptyText||this.emptyText,this.dataMap={},Rui.ui.form.LCombo.superclass.constructor.call(this,t),this.dataSet.focusFirstRow=0==Rui.isUndefined(this.focusFirstRow)&&this.focusFirstRow,-1<this.dataSet.getRow()&&1==this._rendered&&!0===this.forceSelection&&this.setDisplayValue(this.dataSet.getNameValue(this.dataSet.getRow(),this.displayField)),this.onWheelDelegate=Rui.util.LFunction.createDelegate(this.onWheel,this)},Rui.extend(Rui.ui.form.LCombo,Rui.ui.form.LTextBox,{otype:"Rui.ui.form.LCombo",CSS_BASE:"L-combo",valueField:"value",displayField:"text",emptyTextMessageCode:"$.base.msg108",emptyText:null,useEmptyText:!0,iconWidth:20,iconMarginLeft:1,forceSelection:!0,lastDisplayValue:"",changed:!1,selectedIndex:-1,editable:!1,useDataSet:!0,checkContainBlur:!0,rendererField:null,autoMapping:!1,dataMap:null,dataSetId:null,items:null,initComponent:function(t){this.emptyText=null==this.emptyText?Rui.getMessageManager().get(this.emptyTextMessageCode):this.emptyText,!0===this.cfg.getProperty("useEmptyText")&&(this.forceSelection=!1),(this.rendererField||this.autoMapping)&&(this.beforeRenderer=this.comboRenderer),this.items&&(this.createDataSet(),this.loadItems(),this.doDataChangedDataSet(),this.isLoad=!0,this.initDataSet(),this.focusDefaultValue())},initEvents:function(){Rui.ui.form.LCombo.superclass.initEvents.call(this),this.initAutoMapDataSet()},initAutoMapDataSet:function(){this.autoMapping&&this.dataSet&&(this.doUnOnClearMapDataSet(),this.doOnClearMapDataSet())},initDataSet:function(){Rui.ui.form.LCombo.superclass.initDataSet.call(this),this.initSync&&this.dataSet&&(this.dataSet.sync=!0)},doRender:function(){this.createTemplate(this.el);var t=document.createElement("input");t.type="hidden",t.name=this.name||this.id,t.id=Rui.useFixedId()?Rui.id(this.el,"LCombo-hidden-"+this.id):Rui.id(),t.instance=this,t.className="L-instance L-hidden-field",this.el.appendChild(t),this.hiddenInputEl=Rui.get(t),this.hiddenInputEl.addClass("L-hidden-field"),this.inputEl.removeAttribute("name"),this.inputEl.setStyle("ime-mode","disabled");var e=this.inputEl.dom;Rui.useAccessibility()&&(e.setAttribute("role","combobox"),e.setAttribute("aria-readonly","true"),e.setAttribute("aria-autocomplete","none"),t.setAttribute("role","combobox"),t.setAttribute("aria-hidden","true")),this.doRenderButton()},doRenderButton:function(){var t=document.createElement("div");t.className="icon",t.id=Rui.useFixedId()?Rui.id(this.el,"LCombo-icon-"+this.id):Rui.id(),this.el.appendChild(t),this.iconEl=Rui.get(t)},onClearDataMap:function(t){this.dataMap={}},doOnClearMapDataSet:function(){this.dataSet.on("load",this.onClearDataMap,this,!0),this.dataSet.on("dataChanged",this.onClearDataMap,this,!0),this.dataSet.on("add",this.onClearDataMap,this,!0),this.dataSet.on("update",this.onClearDataMap,this,!0),this.dataSet.on("remove",this.onClearDataMap,this,!0),this.dataSet.on("undo",this.onClearDataMap,this,!0)},doUnOnClearMapDataSet:function(){this.dataSet.unOn("load",this.onClearDataMap,this),this.dataSet.unOn("dataChanged",this.onClearDataMap,this),this.dataSet.unOn("add",this.onClearDataMap,this),this.dataSet.unOn("update",this.onClearDataMap,this),this.dataSet.unOn("remove",this.onClearDataMap,this),this.dataSet.unOn("undo",this.onClearDataMap,this)},createContainer:function(t){if(this.el&&"SELECT"==this.el.dom.tagName){var e=Rui.util.LDom;this.id=this.id||this.el.id,this.oldDom=this.el.dom;var i=this.oldDom.options;if(i&&0<i.length){this.items=[];for(var s,a=0;i&&a<i.length;a++){e.hasClass(i[a],"empty")?(this.cfg.setProperty("useEmptyText",!0),this.emptyText=i[a].text):((s={})[this.valueField]=i[a].value,s[this.displayField]=i[a].text,this.items.push(s),i[a].selected&&(this.defaultValue=i[a].value))}}this.name=this.name||this.oldDom.name;this.el.parent();this.el=Rui.get(this.createElement().cloneNode(!1)),this.el.dom.id=this.id,e.replaceChild(this.el.dom,this.oldDom),this.el.appendChild(this.oldDom),e.removeNode(this.oldDom),delete this.oldDom}Rui.ui.form.LTextBox.superclass.createContainer.call(this,t)},afterRender:function(t){Rui.ui.form.LCombo.superclass.afterRender.call(this,t),this.items&&(this.loadItems(),this.doDataChangedDataSet(),this.isLoad=!0,this.initDataSet(),this.focusDefaultValue()),Rui.useAccessibility()&&(this.inputEl.setAttribute("aria-owns",this.optionDivEl.id),this.iconEl.setAttribute("aria-controls",this.optionDivEl.id)),this.isGridEditor&&this.rendererField&&this.initUpdateEvent(),!0===this.forceSelection&&this.dataSet.getRow()<0&&this.dataSet.setRow(0),this.iconEl&&this.iconEl.on("click",this.doIconClick,this,!0),this.applyEmptyText()},createDataSet:function(){this.dataSet||(this.dataSet=new(eval(this.dataSetClassName))({id:this.dataSetId||this.id+"DataSet",fields:[{id:this.valueField},{id:this.displayField}],focusFirstRow:!1,sync:!0===this.initSync}))},loadItems:function(){this.dataSet.batch(function(){for(var t=0;t<this.items.length;t++){var e={};e[this.valueField]=this.items[t][this.valueField],e[this.displayField]=this.items[t][this.displayField]||this.items[t][this.valueField];var i=new Rui.data.LRecord(e,{dataSet:this.dataSet});this.dataSet.add(i),this.dataSet.setState(this.dataSet.getCount()-1,Rui.data.LRecord.STATE_NORMAL)}},this),this.dataSet.commit(),this.dataSet.isLoad=!0,delete this.items},doIconClick:function(t){this.isFocus||this.onFocus(t),this.isExpand()?(this.collapse(),Rui.util.LEvent.removeListener(document,"mousewheel",this.onWheelDelegate)):(this.expand(),Rui.util.LEvent.addListener(document,"mousewheel",this.onWheelDelegate,this))},onWheel:function(t){var e;this.isExpand()&&(e=t.target,this.el.isAncestor(e)&&(this.collapse(),Rui.util.LEvent.addListener(document,"mousewheel",this.onWheelDelegate,this)))},_setWidth:function(t,e,i){e[0]<0||(Rui.ui.form.LCombo.superclass._setWidth.call(this,t,e,i),this.getDisplayEl().setWidth(this.getContentWidth()-(this.iconEl.getWidth()||this.iconWidth)-this.iconMarginLeft))},setSelectedIndex:function(t){this.dataSet.getCount()-1<t||this.setValue(this.dataSet.getNameValue(t,this.valueField))},setDisplayValue:function(t){t!=this.getDisplayValue()&&(t=!0!==this.forceSelection||this.isForceSelectValue(t)?t:this.lastDisplayValue,this.inputEl.setValue(t),this.applyEmptyText(),this.bindDataSet()),this.lastDisplayValue=this.inputEl.getValue(),this.lastDisplayValue==this.emptyText&&(this.lastDisplayValue="")},bindDataSet:function(){var t,e,i,s,a=this.dataSet;a&&!this.editable&&(t=this.getDisplayValue(),a.getNameValue(a.getRow(),this.displayField)!=t&&((e=this.getItemByRecordId(t))?(i=a.indexOfKey(e),a.setRow(i,{isForce:a.isFiltered()}),(s=a.getAt(i))?this.hiddenInputEl.setValue(s.get(this.valueField)):this.hiddenInputEl.setValue("")):this.hiddenInputEl.setValue(""))),this.changed=!0},getRemovedSkipRow:function(t){for(var e=this.dataSet,i=null,s=0,a=0,l=e.getCount();s<l;s++){var n=e.getAt(s);if(n.state!=Rui.data.LRecord.STATE_DELETE&&a++,t<=s&&t<=a){i=n;break}}return i},getRemainRemovedRow:function(t){for(var e=this.dataSet,i=-1,s=0,a=0;s<e.getCount();s++){if(e.getAt(s).state!=Rui.data.LRecord.STATE_DELETE&&a++,t==a){i=a;break}}return i},isForceSelectValue:function(i){var t=this.optionDivEl.select(".L-list"),s=!1;return t.each(function(t){var e=t.select(".L-display-field").getAt(0).dom.firstChild;if(e&&e.nodeValue==i)return!(s=!0)}),s},applyEmptyText:function(){0!=this.useEmptyText&&(""==this.inputEl.getValue()||this.inputEl.getValue()==this.emptyText?(this.inputEl.setValue(this.emptyText),this.inputEl.addClass("empty")):this.inputEl.removeClass("empty"))},getDisplayValue:function(){if(!this.inputEl)return null;var t=this.inputEl.getValue();return t=t==this.emptyText?"":t},getBindValue:function(t){t=t||this.valueField;var e=this.getValue(),i=this.dataSet.findRow(this.valueField,e);return i<0?"":this.dataSet.getAt(i).get(t)},repaint:function(){this.onLoadDataSet(),this.applyEmptyText()},doChangedItem:function(t){var e=Rui.get(t).select(".L-display-field").getAt(0).dom,i=this.findRowIndex(e),s=-1<i?this.dataSet.getNameValue(i,this.valueField):this.emptyValue;this.setValue(s),this.isFocus&&this.getDisplayEl().focus()},onUpdateData:function(t){Rui.ui.form.LCombo.superclass.onUpdateData.call(this,t);var e,i,s,a=t.row,l=t.colId;a==this.dataSet.getRow()&&this.hiddenInputEl&&(e=this.dataSet.getAt(a),l==this.valueField&&this.hiddenInputEl.setValue(e.get(this.valueField)),l==this.displayField&&(i=this.getDisplayEl(),s=e.get(this.displayField),s=Rui.isEmpty(s)?"":s,i.setValue(s)))},onRowPosChangedDataSet:function(t){this.doRowPosChangedDataSet(t.row,!0)},doRowPosChangedDataSet:function(t,e){if(this.hiddenInputEl){var i,s=this.dataSet,a=null,a=s.remainRemoved?this.getRemovedSkipRow(t):s.getAt(t);if(t<0)this.hiddenInputEl.setValue(""),this.setDisplayValue("");else{if(t<0||t>=s.getCount())return;var l=a.get(this.valueField),l=Rui.isEmpty(l)?"":l;this.hiddenInputEl.setValue(l);var n=a.get(this.displayField),n=Rui.isEmpty(n)?"":n;this.inputEl.setValue(n)}a?(i=this.findRowElById(a.id))&&(i.hasClass("active")||(this.optionDivEl.select(".active").removeClass("active"),i.addClass("active"),i.dom.tabIndex=0,i.focus(),this.isFocus&&this.getDisplayEl().focus(),i.dom.removeAttribute("tabIndex"))):-1===t&&!0===this.useEmptyText&&(this.optionDivEl.select(".active").removeClass("active"),(i=Rui.get(this.optionDivEl.dom.childNodes[0]))&&(i.addClass("active"),i.dom.tabIndex=0,i.focus(),this.isFocus&&this.getDisplayEl().focus(),i.dom.removeAttribute("tabIndex"))),!0!==this.ignoreChangedEvent&&this.doChanged()}},getValue:function(){if(!this.hiddenInputEl)return this.emptyValue;var t=this.hiddenInputEl.getValue();return""===t?this.getEmptyValue(t):t},setValue:function(t,e){var i,s;this.hiddenInputEl&&(!0!==this._newLoaded&&this.hiddenInputEl.dom.value===t||(this._newLoaded=!1,i=this.dataSet,this.bindMDataSet&&-1<this.bindMDataSet.getRow()&&!0!==i.isLoad||(1==this.isLoad?(s=i.findRow(this.valueField,t),this.ignoreChangedEvent=!0,s!==i.getRow()?i.setRow(s):-1<s&&(this.hiddenInputEl.dom.value=t,this.getDisplayEl().setValue(i.getNameValue(s,this.displayField))),s=i.getRow(),delete this.ignoreChangedEvent,!0!==this.forceSelection&&s<0&&(this.hiddenInputEl.dom.value=""),s<0&&(this.getDisplayEl().setValue(""),this.applyEmptyText())):this.setDefaultValue(t),!0!==e&&this.doChanged())))},_setDisabled:function(t,e,i){this.isExpand()&&this.collapse(),Rui.ui.form.LCombo.superclass._setDisabled.call(this,t,e,i)},displayRenderer:function(l){var n=l.getDataSet();return function(t,e,i,s,a){return i.state==Rui.data.LRecord.STATE_NORMAL?i.get(l.displayField):-1<(s=n.findRow(l.valueField,t))?n.getAt(s).get(l.displayField):t}},onFocus:function(t){Rui.ui.form.LCombo.superclass.onFocus.call(this,t);var e=this.getDisplayEl();e.removeClass("empty"),e.getValue()==this.emptyText&&!0===this.editable&&e.setValue(""),this.editable&&Rui.util.LEvent.addListener(Rui.browser.msie?document.body:document,"mousedown",this.onEditableChanged,this,!0)},onEditableChanged:function(t){this.doEditableChanged()},doEditableChanged:function(){var t=this.getDisplayValue(),e=this.findValueByDisplayValue(t);0!=this.forceSelection||""!=t&&null!=e?this.lastDisplayValue!=t&&this.setValue(e):this.setValue(this.emptyValue)},onBlur:function(t){Rui.ui.form.LCombo.superclass.onBlur.call(this,t),this.doForceSelection(),this.applyEmptyText(),this.editable&&Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.onEditableChanged),this.autoComplete&&this.editable&&this.clearFilter()},clearFilter:function(){var t,e;this.dataSet&&1==this.dataSet.isFiltered()&&(t=this.dataSet.getRow(),e=this.dataSet.getAt(t),this.dataSet.clearFilter(!1),void 0!==e&&(t=this.dataSet.indexOfKey(e.id),this.dataSet.focusRow({ignoreCanRowPosChange:!0,forceRow:!0,row:t})))},onKeydown:function(t){this.editable&&t.keyCode==Rui.util.LKey.KEY.TAB&&this.doEditableChanged(),Rui.ui.form.LCombo.superclass.onKeydown.call(this,t)},comboRenderer:function(t,e,i,s,a){if(Rui.isEmpty(t))return"";var l=void 0,l=this.dataMap[t];if(Rui.isUndefined(l)&&this.autoMapping)if(this.dataSet.isFiltered())for(var a=0,n=this.dataSet.snapshot.length;a<n;a++){var o=this.dataSet.snapshot.getAt(a);if(o.get(this.valueField)===t){l=o.get(this.displayField);break}}else{var h=this.dataSet.findRow(this.valueField,t);-1<h&&(l=this.dataSet.getNameValue(h,this.displayField))}return Rui.isUndefined(l)&&(l=this.rendererField?i.get(this.rendererField):t),Rui.isUndefined(l)&&(l=this.dataMap[t]?this.dataMap[t]:l),this.dataMap[t]=l},initUpdateEvent:function(){var e;this.gridPanel&&!0!==this.isInitUpdateEvent&&this.rendererField&&(e=this.gridPanel.getView().getDataSet(),this.on("changed",function(t){e.setNameValue(e.getRow(),this.rendererField,this.dataSet.getNameValue(this.dataSet.getRow(),this.displayField))},this,!0),this.isInitUpdateEvent=!0)},doChangedDisplayValue:function(t){this.bindDataSet()},doForceSelection:function(){var t;!0===this.forceSelection&&1==this.changed&&(t=this.getDisplayEl(),this.dataSet.findRow(this.displayField,t.getValue())<0?this.setDisplayValue(this.lastDisplayValue):this.bindDataSet())},setDataSet:function(t){Rui.ui.form.LCombo.superclass.setDataSet.call(this,t),this.initAutoMapDataSet()},doCacheData:function(){for(var t=0;t<this.dataSet.getCount();t++)this.dataMap[this.dataSet.getNameValue(t,this.valueField)]=this.dataSet.getNameValue(t,this.displayField)},clearCacheData:function(){this.dataMap={}},findValueByDisplayValue:function(a){var l=-1;return this.dataSet.data.each(function(t,e,i){var s=e.get(this.displayField);if(s&&s.toLowerCase()==a.toLowerCase())return l=i,!1},this),-1<l?this.dataSet.getAt(l).get(this.valueField):null},destroy:function(){this.iconEl&&(this.iconEl.remove(),delete this.iconEl),Rui.ui.form.LCombo.superclass.destroy.call(this),this.dataMap=null,this.iconEl=null,this.hiddenInputEl=null}}),Rui.namespace("Rui.ui.form"),Rui.ui.form.LCheckBox=function(t){t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.checkBox.defaultProperties")),Rui.ui.form.LCheckBox.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LCheckBox,Rui.ui.form.LField,{otype:"Rui.ui.form.LCheckBox",CSS_BASE:"L-checkbox",label:"",value:null,checked:!1,bindValues:null,bindFn:null,gridFixed:!1,initDefaultConfig:function(){Rui.ui.form.LCheckBox.superclass.initDefaultConfig.call(this),this.cfg.addProperty("checked",{handler:this._setChecked})},initComponent:function(t){Rui.ui.form.LCheckBox.superclass.initComponent.call(this),this.gridFixed&&(this.beforeRenderer=this.gridFixedRenderer)},createContainer:function(t){var e,i;this.el&&"INPUT"==this.el.dom.tagName&&(e=Rui.util.LDom,i=this.el.dom,this.id=this.id||this.el.id,!1===this.checked&&(this.cfg.setProperty("checked",i.checked),this.checked=i.checked),this.name=this.name||i.name,this.value=this.value||i.value,this.el.parent(),this.el=Rui.get(this.createElement().cloneNode(!1)),this.el.dom.id=this.id,e.replaceChild(this.el.dom,i),this.el.appendChild(i),e.removeNode(i),this.el.dom.id=i.id),Rui.ui.form.LCheckBox.superclass.createContainer.call(this,t)},doRender:function(t){this.createTemplate(),this.el.addClass(this.CSS_BASE+"-panel"),this.el.addClass("L-fixed"),this.el.addClass("L-form-field"),this.width&&this.el.setWidth(Rui.isBorderBox?this.width-2:this.width-1);var e=this.getRenderBody();this.el.html(e);var i=this.el.select("input").getAt(0).dom;if(this.attrs)for(var s in this.attrs)i[s]=this.attrs[s];var a=this.getDisplayEl(),l=Rui.browser.msie||Rui.browser.chrome||Rui.browser.safari&&3==Rui.browser.version?"keydown":"keypress";a.on(l,this.onFireKey,this,!0),i.instance=this,i.className="L-instance"},gridBindEvent:function(t){t&&1==this.gridFixed&&!0!==t.isExcel&&(t.on("beforeEdit",this.onBeforeEdit,this,!0),t.on("cellClick",this.onCellClick,this,!0),t.on("keypress",this.onCellKeypress,this,!0))},gridUnBindEvent:function(t){t&&1==this.gridFixed&&!0!==t.isExcel&&(t.unOn("beforeEdit",this.onBeforeEdit,this),t.unOn("cellClick",this.onCellClick,this),t.unOn("keypress",this.onCellKeypress,this))},createTemplate:function(){var t=this.templates||{};t.input=new Rui.LTemplate('<input id="{id}" type="checkbox" name="{name}" class="'+this.CSS_BASE+'" style="{style}" value="{value}" {checked} />'),t.label=new Rui.LTemplate('<label for="{id}" class="L-label">{label}</label>'),this.templates=t},getRenderBody:function(){var t=this.templates||{},e={id:Rui.id(this.el,"LCheckBox-"+this.id),name:this.name||this.id,value:this.value,label:this.label,checked:this.checked?'checked=""':""},i=t.input.apply(e);return this.label&&(i+=t.label.apply(e)),i},afterRender:function(t){Rui.ui.form.LCheckBox.superclass.afterRender.call(this,t),this.getDisplayEl().dom.checked=this.cfg.getProperty("checked"),this.el.on("click",function(t){this.getDisplayEl().focus(),Rui.util.LEvent.stopPropagation(t)},this,!0);var e=this.getDisplayEl();e&&(e.on("focus",this.onCheckFocus,this,!0),e.on("click",this.onClick,this,!0)),Rui.useAccessibility()&&(this.el.setAttribute("role","checkbox"),this.el.setAttribute("aria-checked",!1),this.el.setAttribute("aria-describedby","checkbox "+(this.name?this.name:this.id)))},getDisplayEl:function(){return!this.displayEl&&this.el&&(this.displayEl=this.el.select("input").getAt(0),this.displayEl.addClass("L-display-field")),this.displayEl},focus:function(){return this.getDisplayEl().focus(),this},blur:function(){return this.getDisplayEl().blur(),this},setValue:function(t){var e=Rui.isBoolean(t)?t:this.bindValues?this.bindValues[0]==t:0==Rui.isEmpty(t)&&this.getRawValue()==t;return this.cfg.setProperty("checked",e),this},getValue:function(){if(this.groupInstance)return this.groupInstance.getValue();var t=this.cfg.getProperty("checked");return this.bindFn?this.bindFn.call(this,t):this.bindValues?this.bindValues[t?0:1]:this.getRawValue()},isChecked:function(){return this.cfg.getProperty("checked")},setChecked:function(t){return this.cfg.setProperty("checked",t),this},getRawValue:function(){return this.cfg.getProperty("checked")?this.getDisplayEl().getValue():""},_setChecked:function(t,e,i){var s=e[0];this._rendered&&(this.getDisplayEl().dom.checked=s),s?this.el.addClass("L-checked"):this.el.removeClass("L-checked"),Rui.useAccessibility()&&this.el.dom.setAttribute("aria-checked",s),this.fireEvent("changed",{target:this,value:s})},_setDisabled:function(t,e,i){!1===e[0]?(this.el.removeClass("L-disabled"),this.getDisplayEl().dom.disabled=!1,this.fireEvent("enable")):(this.el.addClass("L-disabled"),this.getDisplayEl().dom.disabled=!0,this.fireEvent("disable"))},onFocus:function(t){Rui.ui.form.LCheckBox.superclass.onFocus.call(this,t),this.doFocus()},doFocus:function(t){Rui.util.LEvent.addListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur,this,!0)},onBlur:function(t){this.cfg.getProperty("checked")!=this.getDisplayEl().dom.checked&&this.cfg.setProperty("checked",this.getDisplayEl().dom.checked),Rui.ui.form.LCheckBox.superclass.onBlur.call(this,t)},deferOnBlur:function(t){Rui.util.LFunction.defer(this.onBlurContains,10,this,[t])},onBlurContains:function(t){var e;1!=t.deferCancelBubble&&(e=t.target,this.el.dom===e||this.el.isAncestor(e)?t.deferCancelBubble=!0:(Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.onBlur(t),this.isFocus=null))},onClick:function(t){return this.cfg.setProperty("checked",t.target.checked),this},onCheckFocus:function(t){this.isFocus||(this.doFocus(this,t),this.isFocus=!0)},onBeforeEdit:function(t){if(t.colId==this.gridFieldId)return!1},onCellClick:function(t){var e,i,s,a,l;t.event.shiftKey||t.event.ctrlKey||t.event.altKey||(s=(e=this.gridPanel).getView(),e.getSelectionModel().isLocked()||!0===(i=e.columnModel.getColumnById(t.colId)).editable&&((s=e.getView()).getColumnModel(),e.dataSet.getRow()!=t.row||(a=s.getCellDom(t.row,t.col))&&Rui.get(a).hasClass("L-grid-cell-editable")&&i.getId()==this.gridFieldId&&(l=s.getDataSet(),this.bindValues[0]==l.getNameValue(t.row,i.getField())?l.setNameValue(t.row,i.getField(),this.bindValues[1]):l.setNameValue(t.row,i.getField(),this.bindValues[0]),Rui.util.LEvent.stopEvent(t))))},onCellKeypress:function(t){if((t.which||t.keyCode)==Rui.util.LKey.KEY.SPACE){var e=this.gridPanel,i=e.getView(),s=e.getSelectionModel(),a=s.getCol(),l=i.getColumnModel();if(s.isLocked())return;var n=l.getColumnAt(a,!0);if(!n||n.id!=this.gridFieldId||0==n.editable)return;var o=l.getColumnById(this.gridFieldId),h=i.getDataSet(),u=h.getRow();this.bindValues[0]==h.getNameValue(u,o.getField())?h.setNameValue(u,o.getField(),this.bindValues[1]):h.setNameValue(u,o.getField(),this.bindValues[0]),Rui.util.LEvent.stopEvent(t)}},gridFixedRenderer:function(t,e,i,s,a){return t==this.bindValues[0]&&e.css.push("L-grid-col-select-mark"),'<div class="L-grid-col-checkBox L-ignore-event"/>'},destroy:function(){return this.getDisplayEl()&&(this.displayEl.remove(),delete this.displayEl),Rui.ui.form.LCheckBox.superclass.destroy.call(this),this}}),Rui.namespace("Rui.ui.form"),Rui.ui.form.LCheckBoxGroup=function(t){this.items=[],Rui.ui.form.LCheckBoxGroup.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LCheckBoxGroup,Rui.ui.form.LField,{otype:"Rui.ui.form.LCheckBoxGroup",CSS_BASE:"L-checkbox-group",items:null,width:null,checkContainBlur:!0,initComponent:function(t){Rui.ui.form.LCheckBoxGroup.superclass.initComponent.call(this),this.name=this.name||Rui.id(this.el,"LCheckBoxGrp-"+this.id)},doRender:function(t){this.el.addClass(this.CSS_BASE),this.el.addClass("L-fixed"),this.el.addClass("L-form-field"),Rui.useAccessibility()&&this.el.setAttribute("role","group"),this.width&&this.el.setWidth(Rui.isBorderBox?this.width-2:this.width-1),Rui.util.LArray.each(this.items,function(t,e){t instanceof Rui.ui.form.LCheckBox==0&&(t.name=this.name,t.id=t.id||t.value,t=new Rui.ui.form.LCheckBox(t),this.items[e]=t),t.render(this.el.dom)},this)},afterRender:function(t){Rui.ui.form.LCheckBoxGroup.superclass.afterRender.call(this,t),this.el.on("click",function(t){0<this.items.length&&this.items[0].focus(),Rui.util.LEvent.stopPropagation(t)},this,!0),Rui.util.LArray.each(this.items,function(t){t.unOn("changed",this.onChanged,this),t.unOn("focus",this.onItemFocus,this),t.unOn("blur",this.onItemBlur,this),t.on("changed",this.onChanged,this,!0),t.on("focus",this.onItemFocus,this,!0),t.on("blur",this.onItemBlur,this,!0)},this)},invoke:function(e,i){var t=this.items;return Rui.each(t,function(t){Rui.ui.form.LCheckBox.prototype[e].apply(t,i)},this),this},onChanged:function(t){this.fireEvent("changed",t)},onItemFocus:function(t){this.isFocus||(this.doFocus(this,t),this.isFocus=!0)},doFocus:function(t){this.onFocus(t),Rui.util.LEvent.addListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur,this,!0)},onItemBlur:function(t){this.deferOnBlur(t)},deferOnBlur:function(t){Rui.util.LFunction.defer(this.onBlurContains,10,this,[t])},onBlurContains:function(t){var e=t.target;1!=t.deferCancelBubble&&(this.el.dom===e||this.el.isAncestor(e)?t.deferCancelBubble=!0:(Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.onBlur(t),this.isFocus=null))},_setDisabled:function(t,e,i){!1===e[0]?Rui.util.LArray.each(this.items,function(t){t.enable()},this):Rui.util.LArray.each(this.items,function(t){t.disable()},this)},focus:function(){return 0<this.items.length&&this.items[0].focus(),this},setValue:function(e){return Rui.util.LArray.each(this.items,function(t){t.setValue(e,!1)},this),this},getValue:function(){var e=[];return Rui.util.LArray.each(this.items,function(t){e.push(t.getValue())},this),e},getItem:function(t){return this.items[t]},destroy:function(){return Rui.ui.form.LCheckBoxGroup.superclass.destroy.call(this),this}}),function(){var t=Rui.ui.form.LCheckBox.prototype,e=Rui.ui.form.LCheckBoxGroup.prototype;for(var i in t)Rui.isFunction(t[i])&&function(t){e[t]=e[t]||function(){return this.invoke(t,arguments)}}.call(e,i)}(),Rui.namespace("Rui.ui.form"),Rui.ui.form.LRadio=function(t){t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.radio.defaultProperties")),Rui.applyObject(this,t,!0),Rui.ui.form.LRadio.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LRadio,Rui.ui.form.LCheckBox,{otype:"Rui.ui.form.LRadio",CSS_BASE:"L-radio",checkContainBlur:!0,createTemplate:function(){var t=this.templates||{};t.input=new Rui.LTemplate('<input id="{id}" type="radio" name="{name}" class="'+this.CSS_BASE+' L-fixed " style="{style}" value="{value}" {checked} />'),t.label=new Rui.LTemplate('<label for="{id}" class="L-label">{label}</label>'),this.templates=t},afterRender:function(t){Rui.ui.form.LRadio.superclass.afterRender.call(this,t),Rui.useAccessibility()&&(this.el.setAttribute("role","radio"),this.el.setAttribute("aria-checked",!1),this.el.setAttribute("aria-describedby","radio "+(this.label?this.label:this.id)))}}),Rui.namespace("Rui.ui.form"),Rui.ui.form.LRadioGroup=function(t){Rui.ui.form.LRadioGroup.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LRadioGroup,Rui.ui.form.LCheckBoxGroup,{otype:"Rui.ui.form.LRadioGroup",CSS_BASE:"L-radio-group",checkContainBlur:!0,initEvents:function(){Rui.ui.form.LRadioGroup.superclass.initEvents.call(this);var i=1;Rui.util.LArray.each(this.items,function(t,e){t instanceof Rui.ui.form.LRadio==0&&(t.name=this.name,t.id=this.name+""+i++,t=new Rui.ui.form.LRadio(t),this.items[e]=t),t.groupInstance=this,t.on("specialkey",this._onSpecialkey,this,!0)},this)},doRender:function(t){this.el.addClass(this.CSS_BASE),this.el.addClass("L-fixed"),this.el.addClass("L-form-field"),Rui.useAccessibility()&&this.el.setAttribute("role","radiogroup"),this.width&&this.el.setWidth(Rui.isBorderBox?this.width-2:this.width-5),Rui.util.LArray.each(this.items,function(t){t._rendered?this.el.appendChild(t.el):t.render(this.el.dom)},this)},clearAllChecked:function(i){return Rui.util.LArray.each(this.items,function(t,e){t.setValue(!1,i)},this),this},onChanged:function(t){var e=this.getCheckedItem(),i=t.target;Rui.util.LArray.each(this.items,function(t){t!==i&&(t.checked=!1,t.el.removeClass("L-checked"),Rui.useAccessibility()&&t.el.setAttribute("aria-checked",!1))},this),null!=e&&t.target!=e||(t.target=this,Rui.ui.form.LRadioGroup.superclass.onChanged.call(this,t))},getCheckedItem:function(){var i=null;return Rui.util.LArray.each(this.items,function(t,e){if(!0===t.getDisplayEl().dom.checked)return i=t,!1},this),i},getCheckedIndex:function(){var i=-1;return Rui.util.LArray.each(this.items,function(t,e){if(!0===t.getDisplayEl().dom.checked)return i=e,!1},this),i},setCheckedIndex:function(t){if(!(this.items.length<t))return this.items[t].setChecked(!0),this},setValue:function(t){var e=this.getRadioElByVal(t);if(null!=e){for(var i=0;i<this.items.length;i++)this.items[i]==e?this.items[i].setValue(!0,!1):this.items[i].setValue(!1,!1);return this}this.clearAllChecked(!1)},getValue:function(){var t=this.getCheckedItem();return null!=t?t.getRawValue():null},getRadioElByVal:function(i){var s=null;return Rui.util.LArray.each(this.items,function(t,e){if(t.getDisplayEl().dom.value==i)return s=t,!1},this),s},before:function(){var t=this.getCheckedIndex();if(!(t<1))return this.setCheckedIndex(--t),this},next:function(){var t=this.getCheckedIndex();if(!(t>=this.items.length-1))return this.setCheckedIndex(++t),this},_onSpecialkey:function(t){var e=Rui.util.LKey.KEY;return t.keyCode==e.LEFT?(this.before(),Rui.util.LEvent.stopEvent(t),!1):t.keyCode==e.RIGHT?(this.next(),Rui.util.LEvent.stopEvent(t),!1):void this.onFireKey(t)},gridFixedRenderer:function(s,t,e){var a='<div class="L-radio-panel L-fixed L-form-field">';return Rui.util.LArray.each(this.items,function(t,e){a+='<div class="L-radio-group L-fixed L-form-field">';var i=s==t.value?"checked":"";a+='<input type="radio" class="'+this.CSS_BASE+'" value="'+t.value+'" '+i+" /><label>"+t.label+"</label></div>"},this),a+"</div>"}}),function(){var t=Rui.ui.form.LRadio.prototype,e=Rui.ui.form.LRadioGroup.prototype;for(var i in t)Rui.isFunction(t[i])&&function(t){e[t]=e[t]||function(){return this.invoke(t,arguments)}}.call(e,i)}(),Rui.namespace("Rui.ui.form"),Rui.ui.form.LTextArea=function(t){t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.textArea.defaultProperties")),Rui.ui.form.LTextArea.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LTextArea,Rui.ui.form.LTextBox,{otype:"Rui.ui.form.LTextArea",CSS_BASE:"L-textarea",width:180,multiLine:!0,initEvents:function(){Rui.ui.form.LTextArea.superclass.initEvents.call(this),this.on("specialkey",this._onSpecialkey,this,!0)},createContainer:function(t){if(this.el&&"TEXTAREA"==this.el.dom.tagName){this.id=this.id||this.el.id,this.oldDom=this.el.dom,this.attrs=this.attrs||{};var e=this.oldDom.attributes;if(void 0!==e)if(Rui.browser.msie67)for(var i=0,s=e.length;i<s;i++){var a=e[i].value;a&&"null"!==a&&""!==a&&(this.attrs[e[i].name]=Rui.util.LObject.parseObject(a))}else for(i=0,s=e.length;i<s;i++)this.attrs[e[i].name]=e[i].value;delete this.attrs.id,this.attrs.value=this.oldDom.value,this.name=this.name||this.oldDom.name;this.el.parent();this.el=Rui.get(this.createElement().cloneNode(!1)),this.el.dom.id=this.id,Rui.util.LDom.replaceChild(this.el.dom,this.oldDom),this.el.appendChild(this.oldDom),Rui.util.LDom.removeNode(this.oldDom),delete this.oldDom}Rui.ui.form.LTextArea.superclass.createContainer.call(this,t)},createTemplate:function(t){var e=Rui.get(t);e.addClass(this.CSS_BASE),e.addClass("L-fixed"),e.addClass("L-form-field");var i=document.createElement("textarea");for(var s in this.autoComplete&&(i.autocomplete="off"),this.attrs)"value"==s?i.value=this.attrs.value:i.setAttribute(s,this.attrs[s]);return i.id=Rui.useFixedId()?Rui.id(this.el,"LTextArea-"+this.id):Rui.id(),i.name=this.name||i.name||this.id,e.appendChild(i),this.inputEl=Rui.get(i),this.inputEl.addClass("L-display-field"),e},_onSpecialkey:function(t){var e=Rui.util.LKey.KEY;switch(t.keyCode){case e.DOWN:case e.UP:case e.LEFT:case e.RIGHT:return Rui.util.LEvent.stopPropagation(t),!1}},onKeyup:function(t){var e=Rui.util.LKey.KEY;if(t.keyCode!=e.DOWN&&t.keyCode!=e.UP)return t.keyCode==e.TAB?(this.onFocus(),void this.fireEvent("keydown",t)):void this.fireEvent("keyup",t);Rui.util.LEvent.stopEvent(t)},_setHeight:function(t,e,i){Rui.ui.form.LTextArea.superclass._setHeight.call(this,t,e,i),Rui.browser.msie&&this.getDisplayEl().setStyle("line-height","")},getRenderBody:function(){var t=this.templates||{},e={id:Rui.id(),name:this.name||this.id,value:this.value||""};return t.apply(e)},getDisplayEl:function(){return!this.displayEl&&this.el&&(this.displayEl=this.el.select("textarea").getAt(0)),this.displayEl},onFireKey:function(t){Rui.util.LEvent.isSpecialKey(t)&&t.keyCode!=Rui.util.LKey.KEY.ENTER&&this.fireEvent("specialkey",t)}}),Rui.namespace("Rui.ui.form"),function(){var n=Rui.util.LDom,o=Rui.util.LString;Rui.ui.form.LNumberBox=function(t){t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.numberBox.defaultProperties")),Rui.ui.form.LNumberBox.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LNumberBox,Rui.ui.form.LTextBox,{otype:"Rui.ui.form.LNumberBox",CSS_BASE:"L-numberbox",includeChars:"0123456789",decimalPrecision:-1,dummyDecimalPrecision:-1,minValue:null,maxValue:null,thousandsSeparator:",",decimalSeparator:".",checkContainBlur:!1,specialKeypress:!1,ctrlKeypress:!1,filterKey:!0,progress:!1,constValue:null,caretPos:0,selectedText:"",caretS:0,caretE:0,emptyValue:null,isCurrency:!0,initComponent:function(t){0!=this.decimalPrecision&&(this.includeChars+=this.decimalSeparator),null!=this.minValue&&this.minValue<0&&(this.includeChars+="-"),this.isCurrency&&(this.includeChars+=this.thousandsSeparator)},createTemplate:function(t){var e=Rui.ui.form.LNumberBox.superclass.createTemplate.call(this,t);return Rui.platform.isMobile&&(this.inputEl.dom.type="number"),null!=this.maxValue&&(this.inputEl.dom.max=this.maxValue),null!=this.minValue&&(this.inputEl.dom.min=this.minValue),e},doRender:function(){this.createTemplate(this.el);var t=document.createElement("input");t.type="hidden",t.name=this.name||this.id,t.instance=this,t.className="L-instance L-hidden-field",this.el.appendChild(t),this.hiddenInputEl=Rui.get(t),this.hiddenInputEl.addClass("L-hidden-field"),this.inputEl.removeAttribute("name"),this.inputEl.setStyle("ime-mode","disabled")},isLimitValue:function(t){if(null!=this.mask)return!1;if(null==this.getValue())return!1;if(null==this.maxValue&&this.decimalPrecision<1)return!1;this.progress=!1,this.constValue=null;var e=n.getSelectionStart(this.getDisplayEl().dom),i=this.getDisplayEl().dom;Rui.browser.msie&&(e=i.value.toString().length);var s=i.value.substring(0,e).replace(/ /g," ")||" ";if(0==this.caretE)return!0;var a=s.split(this.decimalSeparator),l=this.maxValue?this.maxValue.toString().length:20;return this.maxValue<a[0]?(Rui.util.LEvent.stopEvent(t),t.returnValue=!1,this.progress=!0,this.constValue=i.value,!0):this.maxValue<=i.value||(e==l||l<e)&&a.length<2?(Rui.util.LEvent.stopEvent(t),t.returnValue=!1,this.progress=!0,this.constValue=a[0],!0):a.length<2?(i.value=i.value+this.decimalSeparator+"0",Rui.util.LEvent.stopEvent(t),t.returnValue=!1,this.constValue=i.value,!0):1==this.decimalPrecision?(Rui.util.LEvent.stopEvent(t),t.returnValue=!1,this.constValue=a[0]+this.decimalSeparator,!0):this.decimalPrecision>=a[1].length?(Rui.util.LEvent.stopEvent(t),t.returnValue=!1,this.constValue=i.value,!0):void 0},updatePos:function(t){var e;Rui.platform.isMobile||null!=(e=n.getSelectionInfo(t))&&(this.caretPos=e.begin,this.selectedText=e.selectedText,this.preText=e.preText,this.afterText=e.afterText,this.maxLength=e.maxLength,this.caretS=e.begin,this.caretE=e.end)},onFilterKey:function(t){if(this.filterKey&&!this.cfg.getProperty("disabled")&&1==this.cfg.getProperty("editable")&&(this.updatePos(this.getDisplayEl().dom),null!=this.includeChars&&""!=this.includeChars)){var e=Rui.util.LKey.KEY;if((t.shiftKey||t.altKey||t.ctrlKey)&&(this.specialKeypress=!0,t.keyCode==e.CONTROL))this.ctrlKeypress=!0;else if((t.keyCode==e.SPACE||!Rui.util.LEvent.isSpecialKey(t)&&t.keyCode!=e.BACK_SPACE&&t.keyCode!=e.DELETE)&&(!0!==t.ctrlKey||70!==t.keyCode&&"V"!=String.fromCharCode(t.keyCode))){var i=t.charCode||t.which||t.keyCode,s=this.fromCharCode(i);if(s!=this.decimalSeparator)if(-1===this.includeChars.indexOf(s)){if(this.ctrlKeypress&&(65==i||67==i||86==i||88==i))return;if((189==i||109==i)&&0==this.caretPos)return;Rui.util.LEvent.stopEvent(t),t.returnValue=!1}else{if(189==i||109==i){if(0==this.caretPos)return;if(0<this.caretPos)return Rui.util.LEvent.stopEvent(t),void(t.returnValue=!1)}if(null!=this.mask)return;if(s==this.decimalSeparator){if(-1<this.decimalPrecision&&this.decimalPrecision<1)return void Rui.util.LEvent.stopEvent(t);var a=this.getDisplayEl().dom;return void this.setCaret(a.value.length+1)}if(this.isCurrency&&s==this.thousandsSeparator)return;if(void 0===this.preText)return;var l=this.preText.split(this.decimalSeparator);if(0==l.length)return;if(0==this.selectedText.trim().length&&1<l.length&&l[1].length!=this.decimalPrecision)if(this.getDisplayEl().dom.value.split(this.decimalSeparator)[1].length!=this.decimalPrecision)return;if(l.length<2)return;0<this.decimalPrecision&&this.arrangeValues(t,s)}else{if(-1<this.decimalPrecision&&this.decimalPrecision<1)return void Rui.util.LEvent.stopEvent(t);var n=this.getValue();n&&String(n).replace(this.selectedText,s)}}}},onKeypress:function(t){if(this.filterKey){var e,i=Rui.util.LKey.KEY,s=t.charCode||t.which||t.keyCode,a=this.getDisplayEl().dom;if(s==i.BACK_SPACE||!this.specialKeypress&&37==s||39==s||45==s||46==s)return 46==s&&-1<a.value.indexOf(this.decimalSeparator)?void Rui.util.LEvent.stopEvent(t):void(46==s&&-1<this.decimalPrecision&&this.decimalPrecision<1&&Rui.util.LEvent.stopEvent(t));189!=s&&109!=s&&(this.ctrlKeypress&&(97==s||99==s||118==s||120==s)||189==s||109==s||((e=String.fromCharCode(s))==this.decimalSeparator&&(-1<a.value.indexOf(this.decimalSeparator)||""==a.value)&&Rui.util.LEvent.stopEvent(t),new RegExp("[0-9\\"+this.decimalSeparator+(this.isCurrency?this.thousandsSeparator:"")+"]").test(e)||Rui.util.LEvent.stopEvent(t)))}},onKeyup:function(t){if(this.filterKey){var e=Rui.util.LKey.KEY;if(Rui.util.LEvent.isSpecialKey(t))return t.keyCode!=e.SHIFT&&t.keyCode!=e.ALT&&t.keyCode!=e.CONTROL||(this.specialKeypress=!1,t.keyCode==e.CONTROL&&(this.ctrlKeypress=!1)),void this.fireEvent("keyup",t);var i=t.charCode||t.which||t.keyCode,s=this.fromCharCode(i),a=this.getValue();if(-1===this.includeChars.indexOf(s)){if(this.ctrlKeypress&&(65==i||67==i||86==i||88==i))return;if(189==i||109==i)return;var l=(a+"").replace(/[\ㄱ-ㅎ가-힣]/g,"");l!=a&&this.setValue(l);var n=this.getDisplayEl();return o.isHangul(n.getValue())&&n.setValue(o.getSkipHangulChar(n.getValue())),Rui.util.LEvent.stopEvent(t),void(t.returnValue=!1)}189!=i&&109!=i&&this.fireEvent("keyup",t)}},arrangeValues:function(t,e){var i=this.getDisplayEl().dom;if(""!=i.value&&(i.value=i.value.toString(),this.currFocus&&("-"!=i.value&&0==this.caretPos&&0==this.caretS&&0==this.caretE&&0==this.afterText.length&&(i.value=""),this.currFocus=!1),this.isLimitValue(t))){var s=i.value;if(null!=s){if(this.caretPos<=s.length&&(0!=this.caretPos||this.caretS!=this.caretE)){if(this.selectedText,this.preText=this.preText.replace(/^\xa0'*|\xa0'*$/g,""),this.afterText=this.afterText.replace(/^\xa0'*|\xa0'*$/g,""),0==this.caretS&&this.caretE-this.caretS==1)return""==this.preText?i.value=e.toString()+this.afterText:i.value=s.concat(e),this.setCaret(this.caretE+1),this.caretPos=0,this.progress=!1,Rui.util.LEvent.stopEvent(t),void(t.returnValue=!1);if(0!=this.caretPos&&0<this.caretS&&this.caretS==this.caretE){var a=this.preText.split(this.decimalSeparator);return 2==a.length&&a[1].length==this.decimalPrecision?i.value=i.value.substring(0,i.value.length-1)+e+this.afterText:i.value.split(this.decimalSeparator)[1].length!=this.decimalPrecision?i.value=this.preText+e+this.afterText:i.value=this.preText+e+this.afterText.substring(1,this.afterText.length),void this.setCaret(this.caretE+1)}return i.value=s.replace(/^\xa0'*|\xa0'*$/g,""),this.caretS!=this.caretE&&(i.value=this.preText+e+this.afterText,this.setCaret(this.caretS+1)),this.caretPos=0,void(this.progress=!1)}if(0==this.caretE)return i.value=e+this.afterText,this.setCaret(this.caretE+1),this.progress=!0,Rui.util.LEvent.stopEvent(t),void(t.returnValue=!1);this.concatValues(i,s,e)}}},concatValues:function(t,e,i){var s;if(this.maxValue==this.constValue){if(t.value=this.constValue.substr(0,this.constValue.length-1),s=t.value.concat(i),!(this.maxValue>=s))return t.value=this.maxValue,void(this.progress=!1);t.value=s,this.progress=!1}else Rui.browser.msie?(t.value=this.constValue,this.caretPos=this.caretPos+1):t.value=e.substr(0,e.length-1);s=(this.progress&&0<this.decimalPrecision&&(t.value=this.constValue.concat(this.decimalSeparator)),t.value.concat(i)),t.value=s,this.progress=!1},afterRender:function(t){Rui.ui.form.LNumberBox.superclass.afterRender.call(this,t);var e=this.getDisplayEl();this.filterKey&&e.on("keydown",this.onFilterKey,this,!0),this.mask&&!Rui.platform.isMobile&&(e.on("keydown",this.onKeyDownMask,this,!0),e.on("keypress",this.onKeyPressMask,this,!0))},validateValue:function(t){if(t===this.lastValue)return!0;t=String(t);var e;if(0==(e=new Rui.validate.LNumberValidator({id:this.id}).validate(t)))return!1;if(!(Rui.isUndefined(t)||Rui.isNull(t)||0!=this.validateMaxValue(t)&&0!=this.validateMinValue(t)))return!1;var i=t.indexOf(this.decimalSeparator)||0;if(0<i){var s=t.substring(i+1);if(0<this.decimalPrecision&&s.length>this.decimalPrecision)return!1}return this.valid(),e},validateMaxValue:function(t){return 0!=this.isNumberValue(t)&&(!(null!=this.maxValue&&this.maxValue<t)||(n.toast(Rui.getMessageManager().get("$.base.msg012",[this.maxValue]),this.el.dom),this.setValue(this.lastValue,!0),this.inputEl.focus(),!1))},validateMinValue:function(t){return 0!=this.isNumberValue(t)&&(!(null!=this.minValue&&this.minValue>t)||(n.toast(Rui.getMessageManager().get("$.base.msg011",[this.minValue]),this.el.dom),this.setValue(this.lastValue,!0),this.inputEl.focus(),!1))},isNumberValue:function(t){return!Rui.isUndefined(t)&&!Rui.isNull(t)&&!1!==t&&(t=""==t?0:t)==parseFloat(t,10)},validateCurrencyValue:function(t){if(""===t)return!0;var e=Rui.getMessageManager().get("$.core.currencyRegExp");return null!==t.match(e)||(n.toast(Rui.getMessageManager().get("$.base.msg143"),this.el.dom),!1)},getValue:function(){var t="string"==typeof(t=Rui.ui.form.LNumberBox.superclass.getValue.call(this))?this.getNormalValue(t):t;if(this.validateValue(t)){if(Rui.isUndefined(this.lastValue)||t==this.lastValue)return Rui.isEmpty(t)||(t=parseFloat(t,10)),t;if(Rui.isEmpty(t))return this.getEmptyValue(t);t&&"."!=this.decimalSeparator&&(t=String(t).replace(this.decimalSeparator,".")),t=parseFloat(t,10),this.hiddenInputEl.setValue(t)}else t=this.lastValue?this.lastValue:this.getEmptyValue(t);return t},getDecimalValue:function(t){var e,i=t,s=t+"",a=s.indexOf(this.decimalSeparator)||0;return 0<a?(e=s.substring(a+1),0<this.decimalPrecision&&e.length>this.decimalPrecision&&(e=e.substring(0,this.decimalPrecision)),e=Rui.util.LString.rPad(e,"0",this.decimalPrecision),i=(t+"").substring(0,a+1)+e):i+=this.decimalSeparator+o.rPad("","0",-1<this.decimalPrecision?this.decimalPrecision:0),i=i.charAt(i.length-1)==this.decimalSeparator?i.substring(0,i.length-1):i},doChangedDisplayValue:function(t){var e=String(t),e=this.getNormalValue(e);!this.isNumberValue(e)&&null!==e&&""!==e||this.setValue(e)},setValue:function(t,e){var i,s;1!=Rui.isUndefined(t)&&(t=Rui.isNull(t)?"":t,this.validateValue(t)&&(this.hiddenInputEl.setValue(t),i=t,Rui.isEmpty(i)||(i=String(i),i=this.getNormalValue(i),(this.thousandsSeparator||this.decimalSeparator)&&(i=this.isCurrency?Rui.util.LNumber.format(parseFloat(i,10),{thousandsSeparator:this.thousandsSeparator,decimalSeparator:this.decimalSeparator}):Rui.util.LNumber.format(parseFloat(i,10),{decimalSeparator:this.decimalSeparator})),0<this.decimalPrecision&&(i=this.getDecimalValue(i))),this.getDisplayEl().setValue(Rui.platform.isMobile?t:i),this.isFocus&&(s=o.getByteLength(i),this.setSelectionRange(0,s)),!0!==e&&this.fireEvent("changed",{target:this,value:this.getValue(),displayValue:this.getDisplayValue()})),this.setPlaceholder())},onCanBlur:function(t){var e=Rui.ui.form.LNumberBox.superclass.onCanBlur.call(this,t),i=this.getDisplayEl().getValue();return(!this.isCurrency||0!=this.validateCurrencyValue(i))&&e},getNormalValue:function(t){var e=Rui.util.LString.replaceAll(t,this.thousandsSeparator,"");return e=e?e.replace(",","."):e}})}(),Rui.ui.form.LDateBox=function(t){if(t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.dateBox.defaultProperties")),Rui.platform.isMobile&&(t.localeMask=!1,t.picker=!1),t.localeMask&&this.initLocaleMask(),!t.placeholder){var e=this.getLocaleFormat();try{e=e.toLowerCase().replace("%y","yyyy").replace("%m","mm").replace("%d","dd")}catch(t){}t.placeholder=e}Rui.ui.form.LDateBox.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LDateBox,Rui.ui.form.LTextBox,{otype:"Rui.ui.form.LDateBox",CSS_BASE:"L-datebox",dateType:"date",valueFormat:"%Y-%m-%d",selectingInputDate:!0,width:90,iconWidth:20,iconMarginLeft:1,localeMask:!1,checkContainBlur:!Rui.platform.isMobile,listPosition:"auto",picker:!0,displayValue:Rui.platform.isMobile?"%Y-%m-%d":"%x",emptyValue:null,calendarConfig:null,iconTabIndex:0,initComponent:function(t){Rui.ui.form.LDateBox.superclass.initComponent.call(this,t),this.calendarClass=Rui.ui.calendar.LCalendar;var e=this.displayValue.split("%");1<e.length&&1<e[1].length&&(this.displayValueSep=e[1].substring(1))},doRender:function(){!Rui.platform.isMobile||null!=this.type&&"text"!=this.type||(this.type="date"),this.createTemplate(this.el);var t=document.createElement("input");t.type="hidden",t.name=this.name||this.id,t.id=Rui.useFixedId()?Rui.id(this.el,"LDateBox-hidden-"+this.id):Rui.id(),t.instance=this,t.className="L-instance L-hidden-field",this.el.appendChild(t),this.hiddenInputEl=Rui.get(t),this.hiddenInputEl.addClass("L-hidden-field"),this.inputEl.removeAttribute("name"),this.inputEl.setStyle("ime-mode","disabled"),Rui.platform.isMobile&&this.inputEl.on("change",function(t){this.setValue(this.inputEl.getValue())},this,!0),this.doRenderCalendar()},doRenderCalendar:function(){var t,e,i;this.picker&&((t=document.createElement("div")).className="L-cal-container",t.id=Rui.useFixedId()?Rui.id(this.el,"LDateBox-cal-"+this.id):Rui.id(),this.calendarDivEl=Rui.get(t),document.body.appendChild(t),(e=document.createElement("a")).className="icon",e.id=Rui.useFixedId()?Rui.id(this.el,"LDateBox-icon-"+this.id):Rui.id(),this.el.appendChild(e),this.iconEl=Rui.get(e),Rui.useAccessibility()&&this.iconEl.setAttribute("role","button"),(i=this.calendarConfig||{}).applyTo=this.calendarDivEl.id,this.calendarDivEl.addClass(this.CSS_BASE+"-calendar"),this.calendar=new this.calendarClass(i),this.calendar.render(),this.calendar.hide())},pickerOn:function(){this.iconEl&&(this.iconEl.on("mousedown",this.onIconClick,this,!0),this.iconEl.setStyle("cursor","pointer"),-1<this.iconTabIndex&&this.iconEl.setAttribute("tabindex",this.iconTabIndex))},pickerOff:function(){this.iconEl&&(this.iconEl.unOn("mousedown",this.onIconClick,this),this.iconEl.setStyle("cursor","default"),-1<this.iconTabIndex&&this.iconEl.removeAttribute("tabindex"))},deferOnBlur:function(t){var e,i;this.calendarDivEl&&this.calendarDivEl.isAncestor(t.target)&&("a"==(e=Rui.get(t.target)).dom.tagName.toLowerCase()&&e.hasClass("selector")&&(i=this.calendar.getProperty("pagedate"),i=new Date(i.getFullYear(),i.getMonth(),parseInt(e.getHtml())),this.setValue(i),this.calendar&&this.calendar.hide())),Rui.util.LFunction.defer(this.checkBlur,10,this,[t])},checkBlur:function(t){var e,i,s;1!=t.deferCancelBubble&&!0===this.isFocus&&(e=t.target,i=Rui.get(t.target),s=this.calendar.id,e===this.el.dom||this.el.isAncestor(e)||this.calendarDivEl&&(e===this.calendarDivEl.dom||this.calendarDivEl.isAncestor(e)||"a"===i.dom.tagName.toLowerCase()&&-1!==i.dom.id.indexOf(s))?t.deferCancelBubble=!0:(Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),this.onBlur.call(this,t),this.isFocus=!1))},onBlur:function(t){Rui.ui.form.LDateBox.superclass.onBlur.call(this,t),this.calendar&&this.calendar.hide()},doChangedDisplayValue:function(t){this.setValue(t)},getDate:function(t){if(t instanceof Date)return t;var e=Rui.util.LFormat.stringToDate(t,{format:this.displayValue||"%x"});return e instanceof Date||(e=Rui.util.LFormat.stringToDate(t,{format:this.valueFormat})),e instanceof Date&&e},getDateString:function(t,e){e=e||"%Y%m%d";var i=t?Rui.util.LFormat.dateToString(t,{format:e}):"";return i||""},setCalendarXY:function(){var t=this.calendarDivEl.getHeight()||0,e=this.getDisplayEl().getTop()+this.getDisplayEl().getHeight(),i=this.getDisplayEl().getLeft();("auto"!=this.listPosition||Rui.util.LDom.isVisibleSide(t+e))&&"up"!=this.listPosition||(e=this.getDisplayEl().getTop()-t),Rui.util.LDom.getViewport().width<=i+this.calendarDivEl.getWidth()&&(i-=this.calendarDivEl.getWidth()/2),this.calendarDivEl.setTop(e),this.calendarDivEl.setLeft(i)},onIconClick:function(t){this.showCalendar(),this.inputEl.focus(),Rui.util.LEvent.preventDefault(t)},showCalendar:function(){!0!==this.disabled&&(this.calendarDivEl.setTop(0),this.calendarDivEl.setLeft(0),this.selectingInputDate&&this.selectCalendarDate(),this.calendar.show(),this.setCalendarXY())},selectCalendarDate:function(t){var e;(t=t||this.getValue())instanceof Date||(t=this.getDate(t)),t&&(this.calendar.clear(),0<(e=this.calendar.select(t,!1)).length&&(this.calendar.cfg.setProperty("pagedate",e[0]),this.calendar.render()))},initLocaleMask:function(){if(!Rui.platform.isMobile){for(var t=this.getLocaleFormat().split("%"),e="",i=1;i<t.length;i++){switch(t[i].toLowerCase().charAt(0)){case"y":e+="9999";break;case"m":case"d":e+="99"}1<t[i].length&&(e+=t[i].charAt(1))}this.mask=e}this.displayValue="%x"},getLocaleFormat:function(){var t,e=Rui.getConfig().getFirst("$.core.defaultLocale");return this.displayValue&&this.displayValue.length<4?(t=this.displayValue.substring(1),Rui.util.LDateLocale[e][t]):this.displayValue},_setWidth:function(t,e,i){e[0]<0||(Rui.ui.form.LDateBox.superclass._setWidth.call(this,t,e,i),this.iconEl&&this.getDisplayEl().setWidth(this.getContentWidth()-(this.iconEl.getWidth()||this.iconWidth)-this.iconMarginLeft))},_setDisabled:function(t,e,i){!1===e[0]?this.pickerOn():this.pickerOff(),Rui.ui.form.LDateBox.superclass._setDisabled.call(this,t,e,i)},setValue:function(t,e){var i,s,a,l=t;"string"==typeof t&&(t=t&&Rui.isString(t)&&!0===Rui.platform.isMobile?(t=t.replace(/-/g,""),Rui.util.LString.toDate(t,"%Y%m%d")):(t=8==t.length||14==t.length||Rui.util.LString.isHangul(t)?t:this.getUnmaskValue(t),Rui.isEmpty(t)?null:this.localeMask?this.getDate(l):this.getDate(t))),!1===t?(i=Rui.getMessageManager().get("$.base.msg016"),Rui.util.LDom.toast(i,this.el.dom),this.invalid(i),this.getDisplayEl().dom.value=this.lastDisplayValue||""):(s=null===t?"":this.getDateString(t,this.valueFormat),a=null===t?"":this.getDateString(t),a=this.localeMask?this.getDateString(t,this.getLocaleFormat()):(Rui.platform.isMobile&&t?this.getDisplayEl().dom.value=t.format("%Y-%m-%d"):this.getDisplayEl().dom.value=a,this.checkValue().displayValue),Rui.platform.isMobile&&(a=this.getDisplayEl().dom.value),this.getDisplayEl().dom.value=a,this.hiddenInputEl.dom.value!==s&&(this.hiddenInputEl.setValue(s),this.lastDisplayValue=a,!0!==e&&this.fireEvent("changed",{target:this,value:this.getValue(),displayValue:this.getDisplayValue()})))},getValue:function(){var t=Rui.ui.form.LDateBox.superclass.getValue.call(this),e=null,e=this.localeMask?(format="%x"!=this.displayValue?Rui.util.LString.replaceAll(this.displayValue,this.displayValueSep,""):"%q",Rui.util.LFormat.stringToDate(t,{format:format})):this.getDate(t);return"date"==this.dateType?e||this.getEmptyValue(t):this.getDateString(e,this.valueFormat)},hide:function(t){this.calendar&&this.calendar.hide(),Rui.ui.form.LDateBox.superclass.hide.call(this,t)},destroy:function(){this.iconEl&&(this.iconEl.remove(),delete this.iconEl),this.calendar&&this.calendar.destroy(),Rui.ui.form.LDateBox.superclass.destroy.call(this)}}),Rui.ui.form.LTimeBox=function(t){t=Rui.applyIf(t||{},Rui.getConfig().getFirst("$.ext.timeBox.defaultProperties")),Rui.ui.form.LTimeBox.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.form.LTimeBox,Rui.ui.form.LTextBox,{otype:"Rui.ui.form.LTimeBox",CSS_BASE:"L-timebox",includeChars:"0123456789",mask:"99:99",width:50,iconWidth:9,iconMarginLeft:1,iconTabIndex:0,spinner:!Rui.platform.isMobile,checkContainBlur:!Rui.platform.isMobile,doRender:function(){Rui.platform.isMobile&&(this.type="time"),Rui.ui.form.LTimeBox.superclass.doRender.call(this),Rui.platform.isMobile&&this.getDisplayEl().on("change",this.onChange,this,!0,{system:!0}),this.doRenderSpinner()},doRenderSpinner:function(){var t,e,i;!0!==this.spinner||Rui.platform.isMobile||((t=document.createElement("div")).className="icon",t.id=Rui.useFixedId()?Rui.id(this.el,"LTimeBox-icon-"+this.id):Rui.id(),this.iconDivEl=Rui.get(t),this.el.appendChild(t),(e=document.createElement("div")).className="L-spin-up",e.id=Rui.useFixedId()?Rui.id(this.el,"LTimeBox-spinup-"+this.id):Rui.id(),this.spinUpEl=Rui.get(e),this.iconDivEl.appendChild(e),(i=document.createElement("div")).id=Rui.useFixedId()?Rui.id(this.el,"LTimeBox-spindown-"+this.id):Rui.id(),i.className="L-spin-down",this.spinDownEl=Rui.get(i),this.iconDivEl.appendChild(i))},spinnerOn:function(){this.iconDivEl&&(this.spinUpEl.on("mousedown",this.onSpinUpMouseEvent,this,!0),this.spinUpEl.on("mouseup",this.onSpinUpMouseEvent,this,!0),this.spinDownEl.on("mousedown",this.onSpinDownMouseEvent,this,!0),this.spinDownEl.on("mouseup",this.onSpinDownMouseEvent,this,!0),this.spinUpEl.on("click",this.spinUp,this,!0),this.spinDownEl.on("click",this.spinDown,this,!0),this.spinUpEl.setStyle("cursor","pointer"),this.spinDownEl.setStyle("cursor","pointer"),-1<this.iconTabIndex&&(this.spinUpEl.setAttribute("tabindex","0"),this.spinDownEl.setAttribute("tabindex","0")))},spinnerOff:function(){this.iconDivEl&&(this.spinUpEl.unOn("mousedown",this.onSpinUpMouseEvent,this),this.spinUpEl.unOn("mouseup",this.onSpinUpMouseEvent,this),this.spinDownEl.unOn("mousedown",this.onSpinDownMouseEvent,this),this.spinDownEl.unOn("mouseup",this.onSpinDownMouseEvent,this),this.spinUpEl.unOn("click",this.spinUp,this),this.spinDownEl.unOn("click",this.spinDown,this),this.spinUpEl.setStyle("cursor","default"),this.spinDownEl.setStyle("cursor","default"),-1<this.iconTabIndex&&(this.spinUpEl.removeAttribute("tabindex"),this.spinDownEl.removeAttribute("tabindex")))},onSpinUpMouseEvent:function(t){switch(t.type){case"mousedown":return void this.spinUpEl.addClass("L-spin-up-click");case"mouseup":return void this.spinUpEl.removeClass("L-spin-up-click")}},onSpinDownMouseEvent:function(t){switch(t.type){case"mousedown":return void this.spinDownEl.addClass("L-spin-down-click");case"mouseup":return void this.spinDownEl.removeClass("L-spin-down-click")}},onChange:function(t){var e=t.target.value;this.setValue(e)},spinUp:function(){var t,e,i;this.disabled||!1===this.cfg.getProperty("editable")||(t=(t=this.getValue()||"0000").replace(":",""),e=parseInt(t.substring(0,2),10),59==(i=parseInt(t.substring(2,4),10))?(e=23==e?0:e+1,i=0):i++,this.setValue(Rui.util.LString.lPad(e,"0",2)+Rui.util.LString.lPad(i,"0",2)))},spinDown:function(){var t,e,i;this.disabled||!1===this.cfg.getProperty("editable")||(t=(t=this.getValue()||"0000").replace(":",""),e=parseInt(t.substring(0,2),10),0==(i=parseInt(t.substring(2,4),10))?(e=0==e?23:e-1,i=59):i--,this.setValue(Rui.util.LString.lPad(e,"0",2)+Rui.util.LString.lPad(i,"0",2)))},_setWidth:function(t,e,i){e[0]<0||(Rui.ui.form.LTimeBox.superclass._setWidth.call(this,t,e,i),this.iconDivEl&&this.getDisplayEl().setWidth(this.getContentWidth()-(this.iconDivEl.getWidth()||this.iconWidth)-this.iconMarginLeft))},_setDisabled:function(t,e,i){!1===e[0]?this.spinnerOn():this.spinnerOff(),Rui.ui.form.LTimeBox.superclass._setDisabled.call(this,t,e,i)},validateValue:function(t){var e=!!Rui.isEmpty(t)||Rui.util.LString.isTime(t);return 0==e&&(Rui.util.LDom.toast(Rui.getMessageManager().get("$.base.msg040"),this.el.dom),this.rollback()),e},rollback:function(){this.setDisplayValue(this.lastDisplayValue)},setValue:function(t,e){t&&Rui.platform.isMobile&&t.indexOf(":")<0&&(t=t.substring(0,2)+":"+t.substring(2)),Rui.ui.form.LTimeBox.superclass.setValue.call(this,t,e);var i=this.getDisplayValue();i&&5!=i.length&&this.setDisplayValue(t.substring(0,2)+":"+t.substring(2,4))},beforeRenderer:function(t,e,i,s,a){return t?0<t.indexOf(":")?t:t.substring(0,2)+":"+t.substring(2):""}});