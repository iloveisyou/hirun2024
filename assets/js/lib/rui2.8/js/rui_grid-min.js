/*
 * @(#) rui_grid-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.namespace("Rui.ui.grid"),Rui.ui.grid.LCellMerge={getMultiHeaderInfo:function(e,t){var i,l,s,o,r,n,d=e.length,a=[],h=0,u=0,c=[];if(!(1<(t=t||this.getHeaderRowCount(e))))return null;for(var g=0;g<d;g++){if(n=i,i=e[g],0==g)a[h]=[],l=a[h];else if(this.isStartColumn(g,i,d,e)){if(c.push(n),u-1<t-1){rowspan=t-1-(u-1)+1,l[u-1].rowspan=t-1-(u-1)+1,o=1;for(var f=u;f<t;f++)l[f]={colspan:0,rowspan:-o,exist:!1},o++}u=0,++h>a.length-1&&(a[h]=[]),l=a[h]}if(u>l.length-1||!l[u])l[u]={id:i.id,rowspan:1,colspan:1,label:i.getLabel(),exist:!0};else{for(f=u;f<t&&(f<l.length&&!1===l[f].exist);f++)u++;l[u]={id:i.id,rowspan:1,colspan:1,label:i.getLabel(),exist:!0}}if(!0===l[u].exist&&((s=l[u]).colspan=this.getColSpan(g,i.id,d,e),1<s.colspan)){r=h+s.colspan;for(f=h+(o=1);f<r;f++)f>a.length-1&&(a[f]=[]),a[f][u]={exist:!1,colspan:-o,rowspan:0},o++}u++}if(l&&u-1<t-1){rowspan=t-1-(u-1)+1,l[u-1].rowspan=t-1-(u-1)+1,o=1;for(f=u;f<t;f++)l[f]={colspan:0,rowspan:-o,exist:!1},o++;rowspan=null}i&&c.push(i),a=this.updateCellIndex(a);try{return{colInfos:a,rowCount:t,colCount:d,dataColumns:c,columns:e}}finally{a=c=e=null}},getHeaderRowCount:function(e){for(var t,i,l,s,o=e.length,r=[],n=0,d=0,a=0;a<o;a++){if(t=e[a],0==a?(r[n]=[],i=r[n]):this.isStartColumn(a,t,o,e)&&(d=0,++n>r.length-1&&(r[n]=[]),i=r[n]),d>i.length-1||!i[d])i[d]={exist:!0};else{for(var h=d;h<i.length&&!1===i[h].exist;h++)d++;i[d]={exist:!0}}if(!0===i[d].exist&&((l=i[d]).colspan=this.getColSpan(a,t.id,o,e),1<l.colspan)){s=n+l.colspan;for(h=n+1;h<s;h++)h>r.length-1&&(r[h]=[]),r[h][d]={exist:!1}}d++}o=r.length;for(var u=1,a=0;a<o;a++)u<r[a].length&&(u=r[a].length);return u},updateCellIndex:function(e,t,i){if(0!=(t=e.length)){for(var l,i=e[0].length,s=[],o=0;o<t;o++)if(e[o]){l=e[o];for(var r=0;r<i;r++)0==o?(s[r]=0,l[r].cellIndex=s[r]):l[r].exist&&l[r].colspan<0&&(s[r]=s[r]+1,l[r].cellIndex=s[r])}return e}},isStartColumn:function(e,t,i,l){if(!t.groupId)return!0;if(l[e-1].id===t.groupId)return!1;for(var s=e-1;-1<s;s--)if(l[s].groupId===t.groupId)return!0;return!1},getColSpan:function(e,t,i,l){for(var s,o,r,n=0,d=e+1;d<i;d++)(s=l[d]).groupId===t&&((r=1)<(o=this.getColSpan(d,s.id,i,l))&&(r=o),n+=r);return 0==n?1:n},getCellMergeInfo:function(e,t){for(var i,l,s,o,r,n,d,a,h,u,c,g,f,m=e.gridView.dataSet,C=e.getColumnCount(!0),R=[],v=[],p=[],S=e.groupMerge,w=0,E=t.start,y=t.end,L=E,b=y,M=t.afterRows,D=0;D<C;D++)i=e.getColumnAt(D,!0),S&&(null==f&&!0===i.vMerge&&(f=!0),!0===f&&!0!==i.vMerge&&(f=!1)),R.push({vMerge:null==f?i.vMerge:f,hMerge:i.hMerge,field:i.field,mergeDateFormat:i.mergeDateFormat});for(D=E;D<y+1;D++){if(p=[],prevMergeLabel=void 0,L<=D&&D<b+1){d=n,n=m.getAt(D),i=void 0,V="";var I,x=D-L,_=0;x&&(_=(I=M[x-1].afterRowInfo)?I.sumRowsInfo.length:0);for(var A=0;A<C;A++){if(s={colspan:1,rowspan:1},l=i,(i=R[A]).vMerge||i.hMerge){var k=i.mergeDateFormat,T=l&&l.hMerge?V:void 0,V=n.get(i.field);Rui.isDate(V)&&(V=V.format(k)),void 0===V&&(V="");var W=void 0;if(d&&(W=d.get(i.field),Rui.isDate(W)&&(W=W.format(k))),a=d&&!1!==v[w-1][A].merge?W:void 0,i.vMerge&&i.hMerge){if(T===V||a===V)if(l&&T===V&&a===V)if(!l.vMerge&&l.hMerge)(r=p[A+(u=(u=p[A-1].colspan)<0?u-1:-1)]).colspan=r.colspan+1,s.colspan=u;else if(l.vMerge&&!l.hMerge)g=!0,S&&l.vMerge&&0<p[A-1].rowspan&&(g=!1),g&&((o=v[w+(c=(c=v[w-1][A].rowspan)<0?c-1:-1)][A]).rowspan=o.rowspan+1,s.rowspan=c);else if(l.vMerge&&l.hMerge)if(h=d.get(l.field),Rui.isDate(h)&&(h=h.format(k)),h===V&&v[w-1][A].colspan<1){g=!0;var B=1==p[A-1].colspan?2:Math.abs(p[A-1].colspan)+2;if(S&&0<p[A-1].rowspan&&-1<A-B&&0<p[A-B].rowspan&&(g=!1),g){u=(u=p[A-1].colspan)<0?u-1:-1,c=(c=v[w-1][A].rowspan)<0?c-1:-1,prevMergeLabel!==V&&((o=v[w+c][A+u]).rowspan=o.rowspan+1,prevMergeLabel=V);for(var P=Math.abs(u);0<P;P--)p[A-P].colspan=-(P-1),p[A-P].rowspan=c;s.colspan=u,s.rowspan=c}else(r=p[A+(u=(u=p[A-1].colspan)<0?u-1:-1)]).colspan=r.colspan+1,s.colspan=u}else g=!0,S&&0<p[A-1].rowspan&&(g=!1),g?((o=v[w+(c=(c=v[w-1][A].rowspan)<0?c-1:-1)][A]).rowspan=o.rowspan+1,s.rowspan=c):((r=p[A+(u=(u=p[A-1].colspan)<0?u-1:-1)]).colspan=r.colspan+1,s.colspan=u);else l.vMerge||l.hMerge||((o=v[w+(c=(c=v[w-1][A].rowspan)<0?c-1:-1)][A]).rowspan=o.rowspan+1,s.rowspan=c);else l&&T===V?!l.vMerge&&l.hMerge?((r=p[A+(u=(u=p[A-1].colspan)<0?u-1:-1)]).colspan=r.colspan+1,s.colspan=u):l.vMerge&&!l.hMerge||(l.vMerge&&l.hMerge?1==p[A-1].rowspan&&((r=p[A+(u=(u=p[A-1].colspan)<0?u-1:-1)]).colspan=r.colspan+1,s.colspan=u):l.vMerge||l.hMerge):a===V&&1==v[w-1][A].colspan&&(g=!0,S&&l&&l.vMerge&&0<p[A-1].rowspan&&(g=!1),g&&_<1&&((o=v[w+(c=(c=v[w-1][A].rowspan)<0?c-1:-1)][A]).rowspan=o.rowspan+1,s.rowspan=c))}else i.vMerge?a===V&&1==v[w-1][A].colspan&&(g=!0,S&&l&&l.vMerge&&0<p[A-1].rowspan&&(g=!1),g&&_<1&&((o=v[w+(c=(c=v[w-1][A].rowspan)<0?c-1:-1)][A]).rowspan=o.rowspan+1,s.rowspan=c)):i.hMerge&&l&&T===V&&(!l.vMerge&&l.hMerge?((r=p[A+(u=(u=p[A-1].colspan)<0?u-1:-1)]).colspan=r.colspan+1,s.colspan=u):l.vMerge&&!l.hMerge||(l.vMerge&&l.hMerge?1==p[A-1].rowspan&&((r=p[A+(u=(u=p[A-1].colspan)<0?u-1:-1)]).colspan=r.colspan+1,s.colspan=u):l.vMerge||l.hMerge))}p.push(s)}}else for(A=0;A<C;A++)p.push({colspan:1,rowspan:1,merge:!1});v.push(p),w++}return v}},Rui.namespace("Rui.ui.grid"),Rui.ui.grid.LColumn=function(e){var t=e||{},t=Rui.applyIf(t,Rui.getConfig().getFirst("$.ext.column.defaultProperties"));this.id=t.id||t.field||this.id,Rui.applyObject(this,t,!0),this.label=this.label||this.field||this.id,this.createEvent("hidden"),this.createEvent("sortable"),this.createEvent("label"),this.createEvent("columnResize"),this.createEvent("editorChanged"),this.init(),this.editable=0==Rui.isUndefined(t.editable)?t.editable:!!this.editor,this.editor&&(this.editor.isGridEditor=!0),this.headerCss=[],t=null},Rui.extend(Rui.ui.grid.LColumn,Rui.util.LEventProvider,{otype:"Rui.ui.grid.LColumn",id:null,columnModel:null,label:null,field:null,width:null,minWidth:25,autoWidth:!1,maxAutoWidth:1e3,hidden:!1,selected:!0,resizable:!0,fixed:!1,sortable:null,align:"",draggable:null,editable:!0,editor:null,cellStyle:null,headerCss:null,renderer:null,freeze:!1,renderRow:!1,expression:null,expressionType:null,vMerge:!1,hMerge:!1,mergeDateFormat:"%Y-%m-%d",columnType:"data",renderExcel:!0,tooltipText:null,summary:null,sumIds:null,sumType:null,sumText:null,headerTool:!0,clipboard:!0,clipboardVirtual:!0,clipboardRenderer:null,ignoreViewFocus:!0,tablet:null,init:function(){this.initEvents()},initEvents:function(){},bindEvent:function(e){this.editor&&(this.editor.gridPanel=e)},unbindEvent:function(e){},getId:function(){return this.id},getGroupId:function(){return this.groupId},getField:function(){return this.field},getColumnModel:function(){return this.columnModel},setColumnModel:function(e){this.columnModel=e},getLabel:function(){return this.label},setLabel:function(e){this.label=e;var t=this.columnModel;!0!==t.isBasicColumnModel&&t.isMultiheader()&&t.getBasicColumnModel().getColumnById(this.id).setLabel(e);var i=t.getInitOptions();if(!i&&t.currentColumnModel&&(i=t.currentColumnModel.getInitOptions()),i){for(var l=i.columns,s=l.length-1;0<=s;s--)if(l[s].id==this.id){l[s].label=e;break}l=null}this.fireEvent("label",{target:this,label:e}),t=i=null},getWidth:function(){return this.width},setWidth:function(e){var t;this.isResizable()&&(t=this.width,this.width=e,null!==this.columnModel&&(this.columnModel.clearTotalWidth(),this.columnModel.gridView&&this.columnModel.gridView.useColumnResize&&this.fireEvent("columnResize",{target:this,oldWidth:t,newWidth:e})))},getMinWidth:function(){return this.minWidth},setMinWidth:function(e){this.minWidth=e},getMaxAutoWidth:function(){return this.maxAutoWidth},setMaxAutoWidth:function(e){this.maxAutoWidth=e},isHidden:function(){return this.hidden},setHidden:function(e){this.hidden=e;for(var t=this.columnModel,i=this.id,l=t.getInitOptions(),s=l.columns,o=s.length-1;0<=o;o--)if(s[o].id==i&&(s[o].hidden=e,s[o].groupId))for(var r=this.getShowChildColumnCount(s,s[o].groupId),n=o-1;0<=n;n--)if(s[n].id==s[o].groupId){s[n].hidden=!(0<r),this.setHiddenGroup(s,o);break}delete t._initOptions,t.init(l),this.fireEvent("hidden",{target:this,hidden:e}),t=l=s=null},setHiddenGroup:function(e,t){if(e[t].groupId)for(var i=this.getShowChildColumnCount(e,e[t].groupId),l=t-1;0<=l;l--)if(e[l].id==e[t].groupId){e[l].hidden=!(0<i),this.setHiddenGroup(e,l);break}e=null},getShowChildColumnCount:function(e,t){for(var i=0,l=0,s=e.length;l<s;l++)e[l].groupId==t&&!0!==e[l].hidden&&i++;return e=null,i},isSelected:function(){return this.selected},setSelected:function(e){this.selected=e},isResizable:function(){return this.resizable},setResizable:function(e){this.resizable=e},isFixed:function(){return this.fixed},setFixed:function(e){this.fixed=e},isSortable:function(){return!0===this.sortable},setSortable:function(e){this.fireEvent("sortable",{target:this,sortable:e}),this.sortable=e},isEditable:function(){return this.editable},setEditable:function(e){this.editable=e},getEditor:function(){return this.editor},setEditor:function(e){this.editor!==e&&(this.editor=e,this.editor&&(this.editor.isGridEditor=!0),this.fireEvent("editorChanged",{target:this,id:this.id}))},isDraggable:function(){return this.draggable},setDraggable:function(e){this.draggable=e},setColumnType:function(e){this.columnType=e},getColumnType:function(){return this.columnType},isDataColumn:function(){return"data"===this.columnType},setSummary:function(e){Rui.applyObject(this,e)},clone:function(){var e={};for(var t in Rui.applyObject(e,this),e)Rui.util.LString.startsWith(t,"_")&&delete e[t];try{return new this.constructor(e)}finally{e=null}},addHeaderCss:function(e){Rui.util.LArray.indexOf(this.headerCss,e)<0&&this.headerCss.push(e)},removeHeaderCss:function(e){var t=Rui.util.LArray.indexOf(this.headerCss,e);-1<t&&(this.headerCss=Rui.util.LArray.removeAt(this.headerCss,t))},hasHeaderCss:function(e){return-1<Rui.util.LArray.indexOf(this.headerCss,e)}}),Rui.ui.grid.LTriggerColumn=function(e){Rui.ui.grid.LTriggerColumn.superclass.constructor.call(this,e),this.renderer=e&&e.renderer?e.renderer:this.doRenderer},Rui.extend(Rui.ui.grid.LTriggerColumn,Rui.ui.grid.LColumn,{selected:!1,sortable:!1,gridPanel:null,gridView:null,editor:null,bindEvent:function(e){Rui.ui.grid.LTriggerColumn.superclass.bindEvent.call(this,e),this.gridPanel=e,this.gridView=e.getView()},unbindEvent:function(e){Rui.ui.grid.LTriggerColumn.superclass.unbindEvent.call(this,e),this.gridPanel=e,this.gridView=e.getView()},doRenderer:function(e,t,i,l,s){return e}}),Rui.ui.grid.LNumberColumn=function(e){Rui.ui.grid.LNumberColumn.superclass.constructor.call(this,e)},Rui.extend(Rui.ui.grid.LNumberColumn,Rui.ui.grid.LTriggerColumn,{otype:"Rui.ui.grid.LNumberColumn",id:"num",mappingField:null,label:"No.",align:"right",width:35,resizable:!0,systemColumn:!0,bindEvent:function(e){Rui.ui.grid.LNumberColumn.superclass.bindEvent.call(this,e);var t=e.getView().getDataSet();t.on("add",this.onInvokeEvent,this,!0),t.on("remove",this.onInvokeEvent,this,!0),t.on("undo",this.onInvokeEvent,this,!0),t=null},unbindEvent:function(e){Rui.ui.grid.LNumberColumn.superclass.unbindEvent.call(this,e);var t=e.getView().getDataSet();t.unOn("add",this.onInvokeEvent,this),t.unOn("remove",this.onInvokeEvent,this),t.unOn("undo",this.onInvokeEvent,this),t=null},doRenderer:function(e,t,i,l,s){return this.mappingField?i.get(this.mappingField):l+1},onInvokeEvent:function(e){this.doNumberRender(e.row)},doNumberRender:function(e){var t=this.gridView.getDataSet(),i=this.getColumnModel().getIndexById(this.id,!0);try{for(var l=e;l<t.getCount();l++){var s=t.getAt(l),o=this.gridView.getCellDom(l,i);if(!o)return;var r=this.doRenderer(l,{},s,l,l);o.firstChild.innerHTML=r,s=null}}finally{t=i=s=o=null}}}),Rui.ui.grid.LStateColumn=function(e){Rui.ui.grid.LStateColumn.superclass.constructor.call(this,e)},Rui.extend(Rui.ui.grid.LStateColumn,Rui.ui.grid.LTriggerColumn,{id:"state",label:"S",align:"center",width:15,fixed:!0,resizable:!1,clipboard:!1,stateCol:-1,systemColumn:!0,bindEvent:function(e){Rui.ui.grid.LStateColumn.superclass.bindEvent.call(this,e),this.stateCol=this.columnModel.getIndexById(this.id,!0),this.removeDataSetEvent(),this.addDataSetEvent()},unbindEvent:function(e){Rui.ui.grid.LStateColumn.superclass.unbindEvent.call(this,e),this.removeDataSetEvent()},addDataSetEvent:function(){var e=this.gridPanel.getView().getDataSet();e.on("load",this.onChangeHeaderState,this,!0),e.on("add",this.onChangeHeaderState,this,!0),e.on("update",this.onUpdateState,this,!0),e.on("remove",this.onUpdateState,this,!0),e.on("undo",this.onUndo,this,!0),e.on("dataChanged",this.onChangeHeaderState,this,!0),e.on("commit",this.onCommit,this,!0),e.on("stateChanged",this.onStateChanged,this,!0)},removeDataSetEvent:function(){var e=this.gridPanel.getView().getDataSet();e.unOn("load",this.onChangeHeaderState,this),e.unOn("add",this.onChangeHeaderState,this),e.unOn("update",this.onUpdateState,this),e.unOn("remove",this.onUpdateState,this),e.unOn("undo",this.onUndo,this),e.unOn("dataChanged",this.onChangeHeaderState,this),e.unOn("commit",this.onCommit,this),e.unOn("stateChanged",this.onStateChanged,this)},doRenderer:function(e,t,i,l,s){var o=this.getState(i);return""!=o&&t.css.push("L-grid-cell-state-"+o),"&nbsp;"},onUpdateState:function(e){this.gridView&&this.doChangeRowState(e.row,e.record,e.record.state),this.onChangeHeaderState()},onUndo:function(e){this.doChangeRowState(e.row,e.record,e.beforeState),this.onChangeHeaderState()},onStateChanged:function(e){var t=this.gridView.dataSet.indexOfKey(e.record.id);this.doChangeRowState(t,e.record,e.beforeState),this.onChangeHeaderState()},doChangeRowState:function(e,t,i){var l,s;i===Rui.data.LRecord.STATE_INSERT||(l=this.gridView.getCellDom(e,this.stateCol))&&(((s=Rui.get(l)).hasClass("L-grid-cell-state-I")||s.hasClass("L-grid-cell-state-U")||s.hasClass("L-grid-cell-state-D"))&&s.removeClass("L-grid-cell-state-I").removeClass("L-grid-cell-state-U").removeClass("L-grid-cell-state-D"),(!0===t.dataSet.remainRemoved||!0!==t.dataSet.remainRemoved&&t.state!==Rui.data.LRecord.STATE_DELETE)&&s.addClass("L-grid-cell-state-"+this.getState(t)))},onChangeHeaderState:function(){var e=this.gridView.getHeaderCellEl(this.stateCol);e&&(this.gridView.dataSet.isUpdated()?e.addClass("L-grid-state-modified"):e.removeClass("L-grid-state-modified"))},onCommit:function(){this.gridView.getBodyEl().select(".L-grid-cell-state-I,.L-grid-cell-state-U,.L-grid-cell-state-D").removeClass(["L-grid-cell-state-I","L-grid-cell-state-U","L-grid-cell-state-D"]),this.gridView.getHeaderCellEl(this.stateCol).removeClass("L-grid-state-modified")},getState:function(e){switch(e.state){case Rui.data.LRecord.STATE_INSERT:return"I";case Rui.data.LRecord.STATE_UPDATE:return"U";case Rui.data.LRecord.STATE_DELETE:return"D"}return""}}),Rui.ui.grid.LSelectionColumn=function(e){e=e||{},Rui.ui.grid.LSelectionColumn.superclass.constructor.call(this,e),Rui.devGuide(this,"LSelectionColumn_constructor",[e])},Rui.extend(Rui.ui.grid.LSelectionColumn,Rui.ui.grid.LTriggerColumn,{id:"selection",selectionType:"checkBox",label:null,align:"center",width:28,fixed:!0,resizable:!1,syncRow:!1,clipboard:!1,systemColumn:!0,init:function(){Rui.ui.grid.LSelectionColumn.superclass.init.call(this);var e=Rui.useFixedId()?Rui.id(this.el,"LSelcol-header-"+this.id):"";this.label="selection"!=this.label?this.label:'<div id="'+e+'" class="L-grid-header-'+this.selectionType+'" style="width:20px"></div>'},bindEvent:function(e){Rui.ui.grid.LSelectionColumn.superclass.bindEvent.call(this,e);var t=e.getView().getDataSet();t.on("allMarked",this.onAllMarked,this),t.on("load",this.onLoad,this,!0),this.syncRow&&t.on("rowPosChanged",this.onRowPosChanged,this)},unbindEvent:function(e){Rui.ui.grid.LSelectionColumn.superclass.unbindEvent.call(this,e);var t=e.getView().getDataSet();t.unOn("allMarked",this.onAllMarked,this),t.unOn("load",this.onLoad,this),this.syncRow&&t.unOn("rowPosChanged",this.onRowPosChanged,this)},onLoad:function(e){!0!==e.options.add&&this.onAllMarked({isSelect:!1})},onRowPosChanged:function(e){e.row<0||e.target.setMarkOnly(e.row,!0)},onAllMarked:function(e){var t=this.gridPanel.getView(),i=this.columnModel.getIndexById(this.id,!0),l=t.getHeaderCellEl(i);l&&(0==e.isSelect?Rui.get(l.dom.childNodes[0]).removeClass("L-grid-header-checkBox-mark"):Rui.get(l.dom.childNodes[0]).addClass("L-grid-header-checkBox-mark"))},onMarked:function(e){var t,i=e.target,l=this.gridPanel.getView(),s=this.columnModel.getIndexById(this.id,!0),o=l.getHeaderCellEl(s);o&&(t=this.gridPanel.bodyEl.getElementsByClassName("L-grid-row-checkBox-disabled").length,i.data.length===i.selectedData.length+t?Rui.get(o.dom.childNodes[0]).addClass("L-grid-header-checkBox-mark"):Rui.get(o.dom.childNodes[0]).removeClass("L-grid-header-checkBox-mark"))},doRenderer:function(e,t,i,l,s){var o,r="";return Rui.useAccessibility()&&(r=i.dataSet.isMarked(l)?'aria-checked="true"':""),o=Rui.useFixedId()?Rui.id(this.el,"LSelcol-"+l+"-"+this.id):"",'<div class="L-grid-row-'+this.selectionType+" L-grid-row-"+this.selectionType+(i.dataSet.isMarkable(l)?"":"-disabled")+'" style="width:16px" '+r+' id="'+o+'"></div>'}}),Rui.ui.grid.LColumnModel=function(e){var t=e||{};Rui.applyObject(this,t,!0),this.cellConfig={},this.init(t),this.createEvent("columnMove"),this.createEvent("columnsChanged"),this.createEvent("cellConfigChanged"),t=null},Rui.extend(Rui.ui.grid.LColumnModel,Rui.util.LEventProvider,{columns:null,defaultWidth:100,totalWidth:null,defaultSortable:!1,defaultEditable:!0,autoWidthMargin:2,groupMerge:!1,defaultDraggable:!0,columnList:null,showColumnList:null,columnMap:null,gridPanel:null,cellConfig:null,freezeColumnId:null,freezeIndex:-1,multiheaderInfos:null,merged:!1,autoWidth:!1,adjustAutoWidth:!1,skipTags:!0,_isAutoWidth:!1,_isEditable:!1,init:function(e){var t=this.__RUI_events||{},i=this.__RUI_subscribers||{};this._isAutoWidth=this.autoWidth;var l=e.columns;1!=e.isBasicColumnModel&&(this._initOptions={},Rui.applyObject(this._initOptions,e)),this.clearTotalWidth(),this.initColumns();var s=!1;this.freezeIndex=-1,this.freezeColumnId=e.freezeColumnId;for(var o={},r=[],n=[],d=0,a=!1,h=0,u=0,c=l.length;h<c;h++){var g=null;Rui.isEmpty(l[h])||(g=l[h]instanceof Rui.ui.grid.LColumn?l[h]:(l[h].editor&&Rui.isUndefined(l[h].editable)&&(l[h].editable=this.defaultEditable),new Rui.ui.grid.LColumn(l[h])),this.autoWidth&&(g instanceof Rui.ui.grid.LTriggerColumn||(g.autoWidth=!0)),g.summary&&g.summary.ids&&(n=Rui.util.LArray.concat(n,g.summary.ids),1<g.summary.ids.length&&(a=!0),d++),"number"==g.type&&null==g.defaultValue&&(g.defaultValue=0),g.renderer&&Rui.ui.grid.LColumnModel.rendererMapper[g.renderer]&&(g.renderer=Rui.ui.grid.LColumnModel.rendererMapper[g.renderer]),this.freezeColumnId==g.id&&(this.freezeIndex=u,g.hidden&&(this.freezeColumnId=null,this.freezeIndex=-1)),!0!==g.hidden&&u++,g.autoWidth&&(this._isAutoWidth=!0),(o[g.id]=g).groupId&&o[g.groupId]&&o[g.groupId].setColumnType("group"),g.summary&&(this._isSummary=!0),g.setColumnModel(this),!0===this.defaultSortable&&g.field&&Rui.isNull(g.sortable)&&!(g instanceof Rui.ui.grid.LStateColumn||g instanceof Rui.ui.grid.LSelectionColumn)&&(g.sortable=this.defaultSortable),Rui.isNull(g.width)&&this.defaultWidth&&(g.width=this.defaultWidth),Rui.isNull(g.draggable)&&this.defaultDraggable&&(g.draggable=this.defaultDraggable),this.columnList.push(g),!0!==g.hidden&&this.showColumnList.push(g),this.columnMap[g.getId()]=g,this.columnIndex[g]=h,g.field&&(this.columnField[g.field]=g),g.editor&&(this._isEditable=!0),r.push(g),s||!g.vMerge&&!g.hMerge||(s=!0),g=null)}if(1!=e.isBasicColumnModel&&(this._initOptions.columns=r),r=null,delete o,this.merged=s,this.initMultiheaderInfos(),this.isMultiheader()&&Rui.isUndefined(e.makeDummyCell)&&(this.makeDummyCell=!0),this.__RUI_events=t,this.__RUI_subscribers=i,t=i=null,1<d&&0==a)for(h=0,c=n.length;h<c;h++){(g=this.columnMap[n[h]]).fixed=!0}Rui.devGuide(this,"LColumnModel_init"),n=null},bindEvent:function(e){this.gridPanel=e,this.gridView=e.getView();for(var t=0,i=this.getColumnCount();t<i;t++){var l=this.getColumnAt(t);l.bindEvent&&l.bindEvent(e),l=null}},unbindEvent:function(e){this.gridPanel=e,this.gridView=e.getView();for(var t=0,i=this.getColumnCount();t<i;t++){var l=this.getColumnAt(t);l.unbindEvent&&l.unbindEvent(e),l=null}},getColumnById:function(e){var t,i=this.columnMap[e];!i&&!0!==this.isBasicColumnModel&&this.isMultiheader()&&(i=(t=this.getBasicColumnModel())?t.getColumnById(e):null,t=null);try{return i}finally{i=null}},getColumnAt:function(e,t){return!0===t?this.showColumnList[e]:this.columnList[e]},isHidden:function(e){return this.getColumnAt(e).isHidden()},getIndexById:function(e,t){return this.getIndex(this.getColumnById(e),t)},getIndex:function(e,t){if(!e||e.isHidden())return-1;var i=this.columnIndex[e];if(t)for(var l=0,s=i;l<=s;l++)this.getColumnAt(l).isHidden()&&i--;return null==i?-1:i},getColumnByField:function(e){return this.columnField[e]},moveColumn:function(e,t){this.clearTotalWidth();for(var i=this.columnList,l=this.columnIndex,s=currNewIndex=0,o=this.getColumnAt(e,!0),r=this.getColumnAt(t,!0),n=0,d=i.length;n<d;n++){if(i[n].id==o.id)break;s++}for(n=0,d=i.length;n<d;n++){if(i[n].id==r.id)break;currNewIndex++}i=Rui.util.LArray.moveItem(i,s,currNewIndex);var a=this.showColumnList,a=Rui.util.LArray.moveItem(a,e,t);this.freezeIndex=-1;for(var h=i.length,n=0,u=0;n<h;n++)l[i[n]]=n,this.freezeColumnId==i[n].id&&(this.freezeIndex=u),!0!==i[n].hidden&&u++;this.columnList=i,this.showColumnList=a,this.columnIndex=l,this.initMultiheaderInfos(),this.fireEvent("columnMove",{target:this,oldIndex:s,newIndex:currNewIndex}),i=o=r=a=null},getColumnsWidth:function(e){for(var t=0,i=0,l=e.length;i<l;i++)t+=e[i].getWidth();return t},getFirstColumns:function(e){for(var t=[],i=0,l=this.getColumnCount();-1<this.freezeIndex&&i<l;i++){var s=this.getColumnAt(i);if((!0!==e||!0!==s.hidden)&&t.push(s),s.id==this.freezeColumnId){s=null;break}s=null}try{return t}finally{t=null}},getFirstColumnsWidth:function(e){var t;return this.firstColumnsWidth||(this.firstColumnsWidth=0,t=this.getFirstColumns(e),this.firstColumnsWidth=this.getColumnsWidth(t),t=null),this.firstColumnsWidth},getLastColumns:function(e){for(var t=[],i=!(-1<this.freezeIndex),l=0,s=this.getColumnCount();l<s;l++){var o=this.getColumnAt(l);!i||!0===e&&!0===o.hidden||t.push(o),this.freezeColumnId==o.id&&(i=!0),o=null}try{return t}finally{t=null}},getLastColumnsWidth:function(e){var t;return this.lastColumnsWidth||(this.lastColumnsWidth=0,t=this.getLastColumns(e),this.lastColumnsWidth=this.getColumnsWidth(t),t=null),this.lastColumnsWidth},getTotalWidth:function(e){if(!this.totalWidth){for(var t=[],i=this.totalWidth=0,l=this.getColumnCount(e);i<l;i++)t.push(this.getColumnAt(i,e));this.totalWidth=this.getColumnsWidth(t),t=null}return this.totalWidth},clearTotalWidth:function(){this.firstColumnsWidth=null,this.lastColumnsWidth=null,this.totalWidth=null},getFirstColumnCount:function(e){for(var t=0,i=0;i<=this.freezeIndex;i++){var l=this.getColumnAt(i);if(null==l)return t;(!0!==e||!0!==l.hidden)&&t++,l=null}return t},getLastColumnCount:function(e){for(var t=0,i=this.freezeIndex+1,l=this.columnList.length;i<=l;i++){var s=this.getColumnAt(i);if(null==s)return t;(!0!==e||!0!==s.hidden)&&t++,s=null}return t},getColumnCount:function(e){if(!0!==e)return this.columnList.length;if(this.visibleColumnCount)return this.visibleColumnCount;for(var t=0,i=0,l=this.columnList.length;i<l;i++){if(null==this.getColumnAt(i,!0))return t;t++}return this.visibleColumnCount=t},setCellConfig:function(e,t,i,l,s){s=Rui.applyIf(s||{},{ignoreEvent:!1});var o,r,n,d=this.gridPanel.dataSet.getAt(e);null!=d&&(o=null,"string"==typeof t?(o=this.getColumnById(t),t=this.getIndex(o,!0)):o=this.getColumnAt(t,!0),r=this.cellConfig[d.id]||{},n=(this.cellConfig[d.id]=r)[o.id]||{},(r[o.id]=n)[i]=l,!0!==s.ignoreEvent&&this.fireEvent("cellConfigChanged",{target:this,row:e,rowId:d.id,col:t,colId:o.id,key:i,value:l}),d=l=o=r=n=null)},getCellConfig:function(e,t,i){if(!this.gridView)return{};var l=this.gridView.dataSet.getAt(e);if(null!=l){var s="string"==typeof t?this.getColumnById(t):this.getColumnAt(t,!0),o=this.cellConfig[l.id]||{};if(!o)return null;var r=o[s.id]||{};try{return r[i]}finally{l=s=o=r=null}}},clearCellConfig:function(){this.cellConfig=null,delete this.cellConfig,this.cellConfig={},this.rowData=null,delete this.rowData,this.rowData={}},getMultiheaderInfos:function(e){return e=Rui.isUndefined(e)?this.multiheaderInfos.length-1:e,this.multiheaderInfos[e]},getMultiheaderAllColumns:function(){for(var e=[],t=0,i=0,l=this.multiheaderInfos.length;t<l;t++)for(i=0;i<this.multiheaderInfos[t].columns.length;i++)e.push(this.multiheaderInfos[t].columns[i]);try{return e}finally{e=null}},initMultiheaderInfos:function(){var e,t,i,l,s;this.isBasicColumnModel||(this.multiheaderInfos=[],-1<this.freezeIndex?(e=this.getRowCount(),t=this.getFirstColumns(!0),i=this.getLastColumns(!0),(s=this.createMultiheaderInfos(t,e))&&this.multiheaderInfos.push(s),(s=this.createMultiheaderInfos(i,e))&&this.multiheaderInfos.push(s),t=i=s=null):(l=this.getLastColumns(!0),(s=this.createMultiheaderInfos(l))&&this.multiheaderInfos.push(s),l=s=null),this.multiheaderInfos.length<1&&(this.multiheaderInfos=null),this.isBasicColumnModel||this.createDataColumns())},getRowCount:function(){return this.isMultiheader()?Rui.ui.grid.LCellMerge.getHeaderRowCount(this.getBasicColumnModel().columnList):1},getBasicColumnModel:function(){if(!this.basicColumnModel)if(this.isMultiheader()&&this._initOptions){var e={};Rui.applyObject(e,this._initOptions),e.isBasicColumnModel=!0;for(var t=[],i=0,l=e.columns.length;i<l;i++)t.push(e.columns[i].clone());e.columns=t,this.basicColumnModel=new this.constructor(e),this.basicColumnModel.currentColumnModel=this,e=t=null}else this.basicColumnModel=this;return this.basicColumnModel},createMultiheaderInfos:function(e,t){var i=Rui.ui.grid.LCellMerge.getMultiHeaderInfo(e,t);if(!i)return!1;try{return i}finally{i=null}},createDataColumns:function(){if(this.isMultiheader()){var e=this.columnList;this.initColumns();var t=null;this.freezeIndex=-1;for(var i=0,l=0,s=0,o=e.length;i<o;i++)"data"==(t=e[i]).getColumnType()&&(this.freezeColumnId==t.id&&(this.freezeIndex=s),this.columnList.push(t),!0!==t.hidden&&this.showColumnList.push(t),this.columnMap[t.getId()]=t,this.columnIndex[t]=l++,!0!==t.hidden&&s++,t.field&&(this.columnField[t.field]=t));e=t=null}},hasFreezeColumn:function(){return-1<this.freezeIndex},initColumns:function(){this.columnList=[],this.showColumnList=[],this.columnMap={},this.columnIndex={},this.columnField={},delete this.visibleColumnCount},isMultiheader:function(){return!!this.multiheaderInfos},setColumns:function(e,t){var i={};this.basicColumnModel&&(i=this.basicColumnModel.__RUI_events);if(this.gridPanel){for(var l=0,s=this.getColumnCount();l<s;l++){(r=this.getColumnAt(l)).editor&&r.editor.gridFixed&&r.editor.gridUnBindEvent(this.gridPanel)}this.gridPanel.getView().syncDataSet&&this.gridPanel.getView().doUnSyncDataSet()}delete this.basicColumnModel,this.init(e);var o=this.getBasicColumnModel();if(o&&(o.__RUI_events=i),this.gridPanel){for(var r,l=0,s=this.getColumnCount();l<s;l++){(r=this.getColumnAt(l)).editor&&r.editor.gridFixed&&(r.editor.gridFieldId=r.id,r.editor.gridBindEvent(this.gridPanel))}this.gridPanel.getView().syncDataSet&&this.gridPanel.getView().doSyncDataSet()}this.gridPanel.oldWidth=0,this.gridPanel.updateColumnsAutoWidth(),this.cellConfig={},!0!==t&&this.fireEvent("columnsChanged",{target:this}),i=o=null},isMerged:function(){return this.merged},setFreezeColumnId:function(e){this.clearTotalWidth();var t={};Rui.applyObject(t,this._initOptions),t.freezeColumnId=e,this.setColumns(t),t=null},getInitOptions:function(){return this._initOptions},updateColumnsAutoWidth:function(e){this.clearTotalWidth();for(var t=sumAutoWidth=0,i=[],l=0,s=this.getColumnCount(!0);l<s;l++){(d=this.getColumnAt(l,!0))instanceof Rui.ui.grid.LTriggerColumn||!d.isResizable()||!this.autoWidth&&!d.autoWidth?t+=d.width:(sumAutoWidth+=d.width,i.push(d)),d=null}var o=e-t-1;if(0<o){var r=[];if(this.calColumnAutoWidths(r,i,o,sumAutoWidth)){for(var n=[],l=sumAutoWidth=0,s=r.length;l<s;l++){var d=r[l].column,a=r[l].width;r[l].isResize?(o-=a,d.setWidth(a)):(sumAutoWidth+=d.width,n.push(r[l].column)),d=null}r=[],this.calColumnAutoWidths(r,n,o,sumAutoWidth),n=null}for(l=0,s=r.length;l<s;l++)l==s-1&&(r[l].width=r[l].width-this.autoWidthMargin),r[l].column.setWidth(r[l].width);r=null}i=null},calColumnAutoWidths:function(e,t,i,l){for(var s=!1,o=0,r=0,n=t.length;r<n;r++){var d=t[r],a=i*(d.width/l);o+=a=Math.floor(a);var h={column:d};d.minWidth>a?(a=d.minWidth,s=!0,h.isResize=!0):d.maxAutoWidth<a?(a=d.maxAutoWidth,s=!0,h.isResize=!0):h.isResize=!0===this.adjustAutoWidth,h.width=a,e.push(h)}return 0<e.length&&(e[e.length-1].width=e[e.length-1].width+(i-o)),!(t=e=null)===this.adjustAutoWidth||s},isSummary:function(){return this._isSummary},isAutoWidth:function(){return this._isAutoWidth},toString:function(){return"Rui.ui.grid.LColumnModel "+this.id},destroy:function(){this.basicColumnModel&&this.basicColumnModel.destroy(),Rui.ui.grid.LColumnModel.superclass.destroy.call(this)}}),Rui.ui.grid.LColumnModel.rendererMapper=[],Rui.ui.grid.LRowModel=function(e){e=e||{},Rui.applyObject(this,e,!0),this.rowConfig={},this.createEvent("rowConfigChanged")},Rui.extend(Rui.ui.grid.LRowModel,Rui.util.LEventProvider,{gridPanel:null,rowConfig:null,renderer:null,init:function(e){},bindEvent:function(e){this.gridPanel=e},unbindEvent:function(e){this.gridPanel=e},setRowConfig:function(e,t,i){var l,s=this.gridPanel.getView().dataSet.getAt(e);null!=s&&(l=this.rowConfig[s.id]||{},(this.rowConfig[s.id]=l)[t]=i,this.fireEvent("rowConfigChanged",{target:this,row:e,rowId:s.id,key:t,value:i}))},getRowConfig:function(e,t){var i=this.gridPanel.getView().dataSet.getAt(e);if(null!=i)return(this.rowConfig[i.id]||{})[t]},destroy:function(){this.rowConfig=null,delete this.rowConfig,this.renderer=null,delete this.renderer,Rui.ui.grid.LRowModel.superclass.destroy.call(this)},toString:function(){return"Rui.ui.grid.LRowModel "+this.id}}),Rui.ui.grid.LColumnResizer=function(e){this.grid=e;var t=this.grid.el.id+"columnResizerProxy";Rui.ui.grid.LColumnResizer.superclass.constructor.call(this,{id:this.grid.headerEl.dom.id,group:t,attributes:{dragElId:this.grid.resizeProxyEl.id,resizeFrame:!1}})},Rui.extend(Rui.ui.grid.LColumnResizer,Rui.dd.LDDProxy,{otype:"Rui.ui.grid.LColumnResizer",cellIndex:null,startX:null,b4StartDrag:function(e,t){this.grid.headerDisabled=!0;var i=this.grid.el.getHeight(),l=0<(l=this.grid.columnModel.getColumnAt(this.cellIndex,!0).getWidth()-this.grid.getMinColumnWidth())?l:0;this.grid.resizeProxyEl.setHeight(i),this.resetConstraints(),this.setXConstraint(l,1e3),this.setYConstraint(0,0),this.minX=e-l,this.maxX=e+1e3,this.startX=e,Rui.dd.LDDProxy.prototype.b4StartDrag.call(this,e,t)},handleMouseDown:function(e){var t,i,l,s,o,r,n,d=this.grid.findHeaderCellDom(e.target);d&&(i=(t=Rui.get(d)).getXY()[0],l=Rui.util.LEvent.getXY(e)[0],s=t.getWidth(),o=!1,l-i<=this.grid.resizeHandleWidth?o=-1:i+s-l<=this.grid.resizeHandleWidth&&(o=0),!1!==o?(r=this.grid.getCell(t.dom,e.pageX),this.cellIndex=r+o,(n=this.grid.columnModel.getColumnAt(this.cellIndex,!0))&&n.isResizable()&&Rui.ui.grid.LColumnResizer.superclass.handleMouseDown.apply(this,arguments)):this.grid.columnDD&&this.grid.columnDD.callHandleMouseDown(e))},endDrag:function(e){var t=Rui.util.LEvent.getPageX(e),i=(this.minX>=t?this.minX:t)-this.startX,l=this.grid.columnModel.getColumnAt(this.cellIndex,!0),s=l.getWidth()+i;l.minWidth>s&&(s=l.minWidth),l.setWidth(s),this.grid.headerDisabled=!1},autoOffset:function(){this.setDelta(0,0)}}),Rui.ui.grid.LColumnDD=function(e){this.grid=e,this.cellIndex=null,this.newCellIndex=null,this.headerCellEl=null;var t=this.grid.el.id+"columnDDProxy";Rui.ui.grid.LColumnDD.superclass.constructor.call(this,{id:this.grid.headerEl.dom.id,group:t,attributes:{dragElId:this.grid.ddProxyEl.id,resizeFrame:!1}})},Rui.extend(Rui.ui.grid.LColumnDD,Rui.dd.LDDProxy,{otype:"Rui.ui.grid.LColumnDD",b4StartDrag:function(e,t){this.grid.headerDisabled=!0;var i,l,s,o,r=this.grid.el.getHeight(),n=this.grid.columnModel.getColumnAt(this.cellIndex,!0);!0===n.draggable&&(i=n.getWidth(),l=this.grid.el.getRegion(),this.grid.ddProxyEl.setHeight(r),this.grid.ddProxyEl.setWidth(i),this.grid.ddTargetEl.setHeight(r),s=l.left,o=l.right,this.resetConstraints(),this.setXConstraint(s,o),this.setYConstraint(0,this.grid.headerEl.getHeight()),Rui.dd.LDDProxy.prototype.b4StartDrag.call(this,e,t))},clickValidator:function(e){var t=this.grid.findHeaderCellDom(e.target);if(t){this.headerCellEl=Rui.get(t),this.cellIndex=this.grid.getCell(t,e.pageX),this.newCellIndex=this.cellIndex;var i=this.grid.columnModel.getColumnAt(this.cellIndex,!0);if(this.grid._useColumnDD&&i.isDraggable()&&!i.isFixed()){var l=Rui.util.LEvent.getTarget(e);return this.id==this.handleElId||this.LDDM.handleWasClicked(l,this.id)}}},onDrag:function(e){var t,i,l,s,o,r,n,d,a=this.grid.findHeaderCellDom(e.target);a&&(t=Rui.get(a),i=this.grid.getCell(t.dom),(l=this.grid.columnModel.getColumnAt(i,!0)).isDraggable()&&!l.isFixed()&&(s=t.getXY(),this.grid.ddTargetEl.setXY([s[0],s[1]-5]),this.grid.ddTargetEl.show(),o=Rui.util.LEvent.getPageX(e),n=(r=t.getX())+t.getWidth()/2,adjust=o<n?(this.grid.ddTargetEl.setX(r),"front"):(d=t.getWidth(),this.grid.ddTargetEl.setX(r+d),"back"),this.cellIndex>i?("back"==adjust&&i++,this.newCellIndex=i):this.cellIndex<i&&("front"==adjust&&i--,this.newCellIndex=i)))},endDrag:function(){this.grid.ddTargetEl.hide(),this.cellIndex!==this.newCellIndex&&this.grid.columnModel.moveColumn(this.cellIndex,this.newCellIndex),this.newCellIndex=null,this.grid.headerDisabled=!1},autoOffset:function(){this.setDelta(0,-5)},callHandleMouseDown:function(e){Rui.ui.grid.LColumnDD.superclass.handleMouseDown.call(this,e)}}),function(){var a=Rui.util.LDom;Rui.ui.grid.LBufferGridView=function(e){e=e||{},e=Rui.applyIf(e,Rui.getConfig().getFirst("$.ext.grid.defaultProperties")),this.renderBodyEvent=this.createEvent("renderBody",{isCE:!0}),this.createEvent("syncDataSet"),this.createEvent("beforeRender"),this.createEvent("rendered"),this.createEvent("rowRendered"),this.createEvent("cellRendered"),this.createEvent("sortField"),this.createEvent("bodyScroll"),this.createEvent("redoRender"),this.createEvent("renderData"),this.createEvent("scrollY"),this.createEvent("scrollX"),this.dataSetEvents={},this.subTotalLabel=Rui.getMessageManager().get("$.base.msg122"),delete this.applyTo,delete e.applyTo,delete this.renderTo,delete e.renderTo,Rui.ui.grid.LBufferGridView.superclass.constructor.call(this,e),this.webStorage=new Rui.webdb.LWebStorage,e=null};var m=Rui.ui.grid.LBufferGridView;m.DEFAULT_ROW_HEIGHT=27,m.CELLP_CONFIG={editable:"L-grid-cell-editable",tooltipText:"L-grid-cell-tooltip"},Rui.applyObject(Rui.ui.grid.LBufferGridView,{CLASS_GRIDVIEW:"L-grid",CLASS_GRIDVIEW_SCROLLER:"L-grid-scroller",CLASS_GRIDVIEW_FOCUS:"L-grid-focus",CLASS_GRIDVIEW_RESIZE_PROXY:"L-grid-resize-proxy",CLASS_GRIDVIEW_DD_PROXY:"L-grid-dd-proxy",CLASS_GRIDVIEW_DD_TARGET:"L-grid-dd-target",CLASS_GRIDVIEW_COL:"L-grid-col",CLASS_GRIDVIEW_HEADER:"L-grid-header",CLASS_GRIDVIEW_HEADER_OFFSET:"L-grid-header-offset",CLASS_GRIDVIEW_HEADER_ROW:"L-grid-header-row",CLASS_GRIDVIEW_HEADER_CELL:"L-grid-header-cell",CLASS_GRIDVIEW_HEADER_INNER:"L-grid-header-inner",CLASS_GRIDVIEW_HEADER_BTN:"L-grid-header-btn",CLASS_GRIDVIEW_HEADER_OVER:"L-grid-header-over",CLASS_GRIDVIEW_BODY:"L-grid-body",CLASS_GRIDVIEW_BODY_EMPTY:"L-grid-body-empty",CLASS_GRIDVIEW_ROW:"L-grid-row",CLASS_GRIDVIEW_ROW_FIRST:"L-grid-row-first",CLASS_GRIDVIEW_ROW_LAST:"L-grid-row-last",CLASS_GRIDVIEW_ROW_ODD:"L-grid-row-odd",CLASS_GRIDVIEW_ROW_EVEN:"L-grid-row-even",CLASS_GRIDVIEW_ROW_OVER:"L-grid-row-over",CLASS_GRIDVIEW_CELL:"L-grid-cell",CLASS_GRIDVIEW_CELL_FIRST:"L-grid-cell-first",CLASS_GRIDVIEW_CELL_LAST:"L-grid-cell-last",CLASS_GRIDVIEW_CELL_INNER:"L-grid-cell-inner",CLASS_GRIDVIEW_SORT_ASC:"L-grid-sort-asc",CLASS_GRIDVIEW_SORT_DESC:"L-grid-sort-desc",CLASS_GRIDVIEW_ROW_SELECTED:"L-grid-row-selected",CLASS_GRIDVIEW_ROW_SELECT_MARK:"L-grid-row-marked",CLASS_GRIDVIEW_CELL_SELECTED:"L-grid-cell-selected",CLASS_GRIDVIEW_CELL_EDITED:"L-grid-cell-edited",CLASS_MULTI_HEADER:"L-grid-multi-header"}),Rui.extend(Rui.ui.grid.LBufferGridView,Rui.ui.LUIComponent,{otype:"Rui.ui.grid.LBufferGridView",columnModel:null,templates:null,dataSet:null,syncDataSet:!0,loadingMessage:"",emptyDataMessageCode:null,scrollerConfig:null,borderWidth:1,scrollerEl:null,headerEl:null,focusEl:null,headerOffsetEl:null,bodyEl:null,resizeProxyEl:null,resizeHandleWidth:8,rowHoverStyle:!0,minColumnWidth:10,cellSelector:"."+m.CLASS_GRIDVIEW_CELL,cellSelectorDepth:10,rowSelector:"."+m.CLASS_GRIDVIEW_ROW,rowSelectorDepth:10,headerDisabled:!1,useColumnResize:!0,useColumnDD:!0,headerTools:!1,activeHeaderEl:null,columnResizer:null,cellRe:new RegExp("L-grid-cell-([^\\s]+)",""),rowRe:new RegExp("L-grid-row-r([^\\s]+)",""),ddProxyEl:null,ddTargetEl:null,gridPanel:null,sortField:null,sortDir:null,isRemoteSort:!1,dataSetEvents:null,scroller:null,renderRange:null,skipRowCellEvent:!0,renderTime:50,renderDataTime:50,rowRenderingLimit:10,scrollTimeout:20,autoMappingSortable:!1,modifiedDate:new Date,pluginSpaceHeight:0,irregularScroll:!1,irregularField:null,customSortable:!1,syncYFocusRow:!0,gridScrollMessage:!0,gridId:null,initComponent:function(e){this._useColumnDD=this.useColumnDD,this.irregularScroll=this.irregularScroll||!!this.columnModel.isSummary(),Rui.devGuide(this,"LBufferGridView_irregularScroll",[this]),this.createTemplate()},initEvents:function(){Rui.ui.grid.LBufferGridView.superclass.initEvents.call(this),this.renderBodyEvent.unOnAll(),this.renderEvent.on(this.onRender,this)},initDefaultConfig:function(){Rui.ui.grid.LBufferGridView.superclass.initDefaultConfig.call(this),this.cfg.addProperty("syncDataSet",{handler:this._setSyncDataSet,value:this.syncDataSet,validator:Rui.isBoolean})},bindColumns:function(){this.columnAddListener(),!1!==this.useColumnResize&&(this.columnResizer=new Rui.ui.grid.LColumnResizer(this)),!1!==this.useColumnDD&&(this.columnDD=new Rui.ui.grid.LColumnDD(this));var e=this.columnModel.getColumnCount(!0);if(this.useColumnResize)for(var t=0;t<e;t++)this.columnModel.getColumnAt(t,!0).unOn("columnResize",this.onColumnResize,this),this.columnModel.getColumnAt(t,!0).on("columnResize",this.onColumnResize,this,!0)},setPanel:function(e){e.unOn("headerClick",this.onHeaderClick,this),e.on("headerClick",this.onHeaderClick,this,!0,{system:!0}),e.unOn("headerDblClick",this.onHeaderDblClick,this),e.on("headerDblClick",this.onHeaderDblClick,this,!0,{system:!0}),e.unOn("widthResize",this.onWidthResize,this),e.on("widthResize",this.onWidthResize,this,!0,{system:!0}),e.unOn("cellClick",this.onCellClick,this),e.on("cellClick",this.onCellClick,this,!0,{system:!0}),this.gridPanel=e,this.columnModel=this.gridPanel.columnModel,this.selectionModel=this.gridPanel.selectionModel},getDataSet:function(){return this.dataSet},renderMaster:function(e){var t=this.columnModel,i=t.getTotalWidth(!0),l=0;(!0===this.gridPanel.autoWidth||!this.width||this.width-i<0)&&(l=Rui.ui.LScroller.SCROLLBAR_SIZE),this.gridId=this.el.findParentNode(".L-grid-panel").parentNode.id;var s=this.templates.master.apply({ghId:Rui.useFixedId()?"LGrid-header-"+this.gridId:Rui.id(),ghoId:Rui.useFixedId()?"LGrid-header-offset-"+this.gridId:Rui.id(),gscrId:Rui.useFixedId()?"LGrid-header-scroll-"+this.gridId:Rui.id(),header:e,ostyle:"width:"+(i+l)+"px",bstyle:"width:"+i+"px"}),o=this.el.isMask();this.el.html(s),!0===o&&this.showLoadingMessage(),t.isMultiheader()&&this.el.addClass(m.CLASS_MULTI_HEADER),-1<t.freezeIndex?this.el.addClass("L-grid-column-freeze"):this.el.removeClass("L-grid-column-freeze"),this.gridPanel.editable&&this.el.addClass("L-editable"),t=null},renderMultiHeader:function(){this.headerOffsetEl.html(this.getRenderMultiheader())},getRenderRowBody:function(e,t,i,l,s){var o=this.templates||{},r=this.columnModel;i=i||r.getTotalWidth(!0);var n=r.getColumnCount(!0),d="",a=r.freezeIndex;if(-1<a){n=l?a+1:n;for(var h=l?0:a+1;h<n;h++)s&&(s[h].rowspan<0||s[h].colspan<0)||(d+=this.getRenderCell(e,h,n,t,s?s[h]:void 0))}else for(h=0;h<n;h++)s&&s[h]&&(s[h].rowspan<0||s[h].colspan<0)||(d+=this.getRenderCell(e,h,n,t,s?s[h]:void 0));d+=this.getRenderDummyCell(e);var u="width:"+i+"px;",c=o.rowBody.apply({tstyle:u,cells:d}),r=o=t=s=null;return c},showEmptyDataMessage:function(){for(;0<this.bodyEl.dom.childNodes.length&&0<this.bodyEl.dom.childNodes[0].childNodes.length;)a.removeNode(this.bodyEl.dom.childNodes[0].childNodes[0]);var e=null!=this.emptyDataMessageCode?this.emptyDataMessageCode:"$.base.msg115",t=Rui.getMessageManager().get(e),i='<tr class="'+m.CLASS_GRIDVIEW_BODY_EMPTY+'"><td colspan="'+this.columnModel.getColumnCount(!0)+'">'+t+"</td></tr>",l=document.createElement("div");l.innerHTML="<li></li><table></table><li><table>"+i+"</table></li>";var s=l.getElementsByTagName("li")[0],o=l.getElementsByTagName("li")[1],r=this.bodyEl.select("> .L-grid-ul");r.appendChild(s.cloneNode(!0)),r.appendChild(o.cloneNode(!0)),l=s=o=r=null},hideEmptyDataMessage:function(){this.bodyEl.select(" > ."+m.CLASS_GRIDVIEW_BODY_EMPTY).remove()},updateEmptyWidth:function(e){return Rui.get(this.bodyEl.dom.firstChild).hasClass(".L-grid-body-empty")},hasRows:function(){if(!this.bodyEl||!this.bodyEl.dom.childNodes||this.bodyEl.dom.childNodes.length<1||!this.bodyEl.dom.childNodes[0].childNodes)return!1;if(this.bodyEl.dom.childNodes[0].childNodes.length<1)return!1;var e=this.bodyEl.dom.childNodes[0].childNodes[1].childNodes[0].rows;try{return 0<e.length&&e[0].className!=m.CLASS_GRIDVIEW_BODY_EMPTY}finally{e=null}},getRows:function(e){return this.hasRows()?0!==e?this.getLastLiEl().dom.childNodes[0].rows:this.getFirstLiEl().dom.childNodes[0].rows:[]},syncLiFirst:function(e){-1<this.columnModel.freezeIndex&&this.getFirstLiEl().setStyle("top","-"+e+"px")},updateTotalWidth:function(){var e=this.columnModel.getTotalWidth(!0);if(this.bodyEl.setWidth(e),!this.updateEmptyWidth(e)){for(var t=this.bodyEl.dom.childNodes,i=null,l=0;l<t.length;l++)(i=t[l]).firstChild&&i.firstChild.style&&(i.firstChild.style.width=e+"px"),i.style.width=e+"px";t=i=null}},redoRender:function(e,t){!0!==e&&0<this.renderTime&&(this.delayRR||(this.delayRR=Rui.later(this.renderTime,this,this._redoRender,[e,t],!0))),(this.renderTime<1||!0===e)&&this._redoRender.call(this,e,t)},_redoRender:function(e,t){if(new Date-this.modifiedDate<this.renderTime&&!0!==e)Rui.log("ignore");else{this.delayRR&&this.delayRR.cancel(),this.delayRR=null,this.gridPanel.doRedoRender();var i=this.scroller?this.scroller.getScroll():null;this.scroller&&(this.scroller.destroy(),this.scroller=null),this.growedRowCount=0,this._temporaryGrowedCount=null;var l=this.el?Rui.util.LDom.getHiddenParent(this.el):null;if(l&&(l=Rui.get(l)).addClass("L-block-display"),this.updateView(),this.updateSizes(!0),this.makeScroll(!1,t),this.renderBody(this.getRenderBody(!0),{ignoreEvent:!0}),this.getRenderRange(),this.setLastGrowed(),this.setLastGrowed(),this.bodyEl.html(this.getRenderBody()),this.doEmptyDataMessage(),this.bindColumns(),this.resetScroller(),this.scroller&&i&&this.scroller.setScroll(i),this.onBodyScroll(),this.syncHeaderScroll(),this.plugins)for(var s=0,o=this.plugins.length;s<o;s++)this.plugins[s].updatePlugin({isRendered:!0});l&&l.removeClass("L-block-display"),0<this.dataSet.getCount()&&this.dataSet.getCount()==this.dataSet.selectedData.length&&this.getHeaderEl().select(".L-grid-header-selection").addClass("L-grid-header-checkBox-mark"),this.cfg.getProperty("disabled")&&this.disable(),this.fireEvent("redoRender"),i=null}},_setHeight:function(e,t,i){this._rendered&&this.height===t[0]||(Rui.ui.grid.LBufferGridView.superclass._setHeight.call(this,e,t,i),this._rendered&&(this.updateSizes(),this.redoRenderData({resetScroll:!0,renderCheckFirst:!0})))},_setWidth:function(e,t,i){this._rendered&&this.width===t[0]||(Rui.ui.grid.LBufferGridView.superclass._setWidth.call(this,e,t,i),this._rendered&&this.updateSizes())},updateHeaderSize:function(){var e,t;this.scroller&&(e=this.columnModel.getTotalWidth(!0),t=this.scroller&&this.scroller.existScrollbar(!0)?Rui.ui.LScroller.SCROLLBAR_SIZE:0,this.headerOffsetEl.setWidth(e+t))},syncHeaderScroll:function(){this.scroller&&(this.headerEl.dom.scrollLeft=this.scroller.getScrollLeft())},makeScroll:function(e,t){var i;this.scroller||(i=Rui.merge({scrollbar:this.columnModel.isAutoWidth()?"y":"auto",applyTo:this.scrollerEl,content:this.bodyEl,controlScrollbarDrag:"scroll"==this.pagerMode},this.scrollerConfig||{}),"scroll"===this.pagerMode&&(i.wheelStep=1),this.scroller=new Rui.ui.grid.LGridScroller(i),this.scroller.on("scrollY",this.onScrollY,this,!0),this.scroller.on("scrollX",this.onScrollX,this,!0),t&&(this.scroller.createScrollLeft=t),this.scrollInit&&this.scrollInit(this.scroller)),0<this.pluginSpaceHeight&&this.scroller.setSpace(this.pluginSpaceHeight,!1,"bottom")},resetScroller:function(e){var t,i;this.scroller&&(t=this.getDataCount(),i=this.renderRange?this.renderRange.visibleRowCount:0,0<t&&(this.irregularScroll?(t=t-i+this.growedRowCount,this.scroller.setSizes(t,0,0,Math.max(i-(this.getFirstGrowedCount()+1),1))):("scroll"===this.pagerMode?t=Math.ceil(t/this.pager.pageSize)-1:t-=this.getVisibleRowCount(!0),this.scroller.setSizes(t,0,0,i))),this.scroller.refresh(!0===e)),e&&this.syncLiFirst(0)},setLastGrowed:function(){this.renderRange&&!0===this.irregularScroll&&(this.growedRowCount=this.getLastGrowedCount())},getLastGrowedCount:function(){if(!0!==this.irregularScroll)return 0;if(!Rui.isEmpty(this._temporaryGrowedCount))return this._temporaryGrowedCount;var e=0,t=this.getDataCount(),i=this.renderRange?this.renderRange.visibleRowCount:this.getVisibleRowCount(!0,this.getIrregularRowHeight(!1)),l=this._getRenderedLastRows(t,Math.min(Math.max(i,3),t)),s=this._getExpectedStartRow(l),o=this.getVisibleRow(this.findRow(l[s]));if(-1==o)for(;s++&&-1===(o=this.getVisibleRow(this.findRow(l[s]))););return 0<o&&i<=(e=o-(t-i))&&(e=i-1),this._temporaryGrowedCount=e},getFirstGrowedCount:function(){if(!0!==this.irregularScroll)return 0;this.getDataCount(),this.renderRange?this.renderRange.visibleRowCount:this.getVisibleRowCount(!0,this.getIrregularRowHeight(!1));var e,t,i=this.getRows(),l=this._getExpectedLastRow(i,!0);if(l==i.length-1)return 0;if(e=this.getVisibleRow(this.findRow(i[0])),-1==(t=this.getVisibleRow(this.findRow(i[l]))))for(;l--&&-1===(t=this.getVisibleRow(this.findRow(i[l]))););return t-e+1},_getRenderedLastRows:function(e,t){var i;return this.renderRange&&(i=this.renderRange,(e=e||this.getDataCount())<(t=t||this.getVisibleRowCount(!0))&&(t=e),i.rowCount=e,i.end=e-1,i.start=i.end-(t-1),i.visibleStart=i.start,i.visibleEnd=i.end,this.bodyEl.html(this.getRenderBody(!1,!0,i))),this.getRows()},_getExpectedStartRow:function(e,t){for(var i=e.length-(t||0),l=i,s=0,o=this.scroller.getScrollHeight();l;)if(l--,o<(s+=this._getRowHeight(e[l]))){i<=++l&&(l=i-1);break}return l},_getExpectedLastRow:function(e,t){for(var i=0,l=e.length,s=0,o=this.scroller.getScrollHeight();i<l&&!(o<(s+=this._getRowHeight(e[i])));)i++;return t&&0<i?i-1:i},doRender:function(e){var t,i,l,s,o=this.columnModel;o.isAutoWidth()&&(t=this.gridPanel.width,o.getTotalWidth(!0)<t&&(s=l=0,this.scrollerConfig&&"n"===this.scrollerConfig.scrollbar?s=2*this.gridPanel.borderWidth:l=Rui.ui.LScroller.SCROLLBAR_SIZE,i=t-l-s,o.updateColumnsAutoWidth(i))),this.el.addClass(m.CLASS_GRIDVIEW),this.el.addClass("L-fixed"),Rui.useAccessibility()&&this.el.setAttribute("role","grid"),this.updateView(),this.useColumnDD&&(o.unOn("columnMove",this.onColumnMove,this),o.on("columnMove",this.onColumnMove,this,!0)),o.unOn("columnsChanged",this.onColumnsChanged,this),o.on("columnsChanged",this.onColumnsChanged,this,!0),Rui.util.LEvent.removeListener(this.el.dom,"mousedown",this.onCheckFocus),Rui.util.LEvent.addListener(this.el.dom,"mousedown",this.onCheckFocus,this,!0),this.updateSizes(),0<this.getDataCount()&&this.syncDataSet&&(this.doUnSyncDataSet(),this.doSyncDataSet()),this.doRenderData(),this.bindColumns(),null!=this.tooltip&&this.tooltip.gridEvents(this.gridPanel),this._rendered=!0,o=null},doRenderData:function(e){if(!e||!0!==e.cached){this.renderRange=null,this.growedRowCount=0,this._redoRenderDataOptions={},this._temporaryGrowedCount=null,this.renderBody(this.getRenderBody(!0),{ignoreEvent:!0}),this.getRenderRange(),this.setLastGrowed();for(var t=0,i=this.columnModel.getColumnCount(!0);this._rendered&&t<i;t++){var l=this.columnModel.getColumnAt(t,!0);if(l.editor&&l.editor.dataSet){var s=!1;if(this.renderRange&&l.field)for(var o=this.renderRange.visibleStart;o<=this.renderRange.visibleEnd;o++)if(this.dataSet.getNameValue(o,l.field)){s=!0;break}if(!0===s&&!0!==l.editor.dataSet.isLoad)return void this.redoRenderData({resetScroll:!0,isDataChanged:!0,renderCheckFirst:!0})}}if(this.renderBody(this.getRenderBody()),this.plugins)for(t=0,i=this.plugins.length;t<i;t++)this.plugins[t].updatePlugin({isRendered:!0});this.scroller||this.makeScroll(!0),"scroll"==this.pagerMode&&!1!==this.pager.loadDataSetByPager||this.resetScroller(),this.updateHeaderSize(),this.syncHeaderScroll();e={scrollbarXSize:0,scrollbarYSize:0};this.scroller&&(e.scrollbarXSize=this.scroller.existScrollbar(!0)?Rui.ui.LScroller.SCROLLBAR_SIZE:0,e.scrollbarYSize=this.scroller.existScrollbar()?Rui.ui.LScroller.SCROLLBAR_SIZE:0);var r,n=this.getRows();0<n.length&&(0<(r=this.getRowHeight(n[0]))?this.webStorage.set("DEFAULT_ROW_HEIGHT",r):r=this.webStorage.get("DEFAULT_ROW_HEIGHT",27),m.DEFAULT_ROW_HEIGHT=r),this.fireEvent("renderData",e)}this.el.isMask()&&this.dataSet.isLoad&&this.hideLoadingMessage()},redoRenderData:function(e){this._rendered&&!0===this.syncDataSet&&(e=e||{system:!1},Rui.applyObject(this._redoRenderDataOptions,e),!this.delayRRD&&!0!==e.system&&0<this.renderDataTime?this.delayRRD=Rui.later(this.renderDataTime,this,this._redoRenderData,null,!0):(!0===e.system||this.renderDataTime<1)&&this._redoRenderData.call(this))},_redoRenderData:function(){try{if(this.delayEditorRender=this.delayEditorRender||0,!this.isDelayEditorRender){if(new Date-this.modifiedDate<5e3)for(var e=0,t=this.columnModel.getColumnCount(!0);this.delayEditorRender<300&&e<t;e++){var i=this.columnModel.getColumnAt(e,!0);if(i.editor&&i.editor.dataSet){var l=!1;if(this.renderRange&&i.field)for(var s=this.renderRange.visibleStart;s<=this.renderRange.visibleEnd;s++)if(this.dataSet.getNameValue(s,i.field)){l=!0;break}if(!0===l&&!0!==i.editor.dataSet.isLoad)return}}this.isDelayEditorRender=!0}var o=this._redoRenderDataOptions;if(new Date-this.modifiedDate<this.renderDataTime&&!0!==o.system)return void Rui.log("ignore");if(this.delayRRD&&this.delayRRD.cancel(),this.delayRRD=null,this.irregularScroll&&o.isDataChanged||!0===o.renderCheckFirst||0<this.getDataCount()&&this.getRows().length<1?(!0===o.resetScroll&&(this.growedRowCount=0,this._temporaryGrowedCount=null),this.renderBody("",{ignoreEvent:!0}),this.renderBody(this.getRenderBody(!0),{ignoreEvent:!0}),this.getRenderRange(),this.renderRange&&this.setLastGrowed()):!0===o.resetScroll&&this.setLastGrowed(),this.renderBody(this.getRenderBody()),this.el.isMask()&&this.dataSet.isLoad&&this.hideLoadingMessage(),!0===o.resetScroll&&this.resetScroller(),this.syncHeaderScroll(),this.plugins)for(e=0,t=this.plugins.length;e<t;e++)this.plugins[e].updatePlugin({isDataChanged:o.isDataChanged,resetScroll:o.resetScroll});this._redoRenderDataOptions={},this.scroller&&this.scroller.scrollEl&&(Rui.rightToLeft()?0<=this.headerEl.dom.scrollLeft&&this.scroller.syncScrollLeft():0<this.headerEl.dom.scrollLeft&&this.scroller.syncScrollLeft()),this.fireEvent("renderData",{scrollXSize:this.scroller.existScrollbar(!0)?Rui.ui.LScroller.SCROLLBAR_SIZE:0,scrollYSize:this.scroller.existScrollbar()?Rui.ui.LScroller.SCROLLBAR_SIZE:0})}catch(e){Rui.log("error : "+e.message)}},setSyncDataSet:function(e){this.cfg.setProperty("syncDataSet",e),e&&this.doRenderData()},isSyncDataSet:function(){return this.syncDataSet},getMinColumnWidth:function(e){return e&&this.cm.getColumnAt(e,!0).getMinWidth()||this.minColumnWidth},getRenderBody:function(e,t,i){var l,s=this.columnModel,o=this.templates||{},r=this.getDataCount(),n="",d="";if(this.headerEl&&(l=this.headerEl.dom.childNodes[0].childNodes[0],this.firstWidth=parseFloat(Rui.util.LString.simpleReplace(Rui.get(l.childNodes[0].childNodes[0]).getStyle("width"),"px","").trim(),10),this.lastWidth=parseFloat(Rui.util.LString.simpleReplace(Rui.get(l.childNodes[1].childNodes[0]).getStyle("width"),"px","").trim(),10)),!0===e){delete this.cellMergeInfoSet;var a=this.columnModel.getIndexById(this.irregularField);if(this.irregularScroll&&-1<a){Math.min(r,2e3);for(var h=0;h<r;h++)C=this.getRowRecord(h),d+=this.getRenderRow(h,C,r,!1,!1,a)}else(C=this.getRowRecord(0))&&(d=this.getRenderRow(0,C,r,!1,!1)),(C=this.getRowRecord(1))&&(d+=this.getRenderRow(1,C,r,!1,!1));C=null}else if(i=i||(!0!==t?this.getRenderRange():this.renderRange)){var u=i.start,c=i.end+1;this.pagerMode&&(u=0,c=10<this.getDataCount()?10:this.getDataCount());var g=0;i.afterRows={};var f=i.afterRows;s.isSummary()&&(this.summaryInfos=this.getSummaryInfos());for(var m=u;m<c;m++,0){var C=this.getRowRecord(m),R=this.getAfterRowInfo(m,C,r,!0),v=m-u+g;f[m-u]={visibleRow:v,afterRow:g,afterRowsInfo:R},R&&(g+=R.idColumnCount),C=R=null}var p=null;if(this.getColumnModel().isMerged()){if(p=Rui.ui.grid.LCellMerge.getCellMergeInfo(s,i),!0===this.selectionMergedCell){var S,w=this.dataSet.rowPosition,E=p[this.getRenderedRow(w)];if(E)for(var y=0,L=E.length;y<L;y++)(S=E[y]).rowspan<0&&(p[w+S.rowspan][y].cls="L-grid-merged-cell-selected"),S=null;E=null}this.cellMergeInfoSet=p}for(h=0,m=u;m<c;m++,0){var C=this.getRowRecord(m),b=p?p[h]:void 0,R=f[m-u].afterRowsInfo;-1<s.freezeIndex&&(n+=this.getRenderRow(m,C,r,!0,b),(this.isAfterRenderRow||R)&&(n+=this.getAfterRenderRow(m,C,r,!0,b,R))),d+=this.getRenderRow(m,C,r,!1,b),(this.isAfterRenderRow||R)&&(d+=this.getAfterRenderRow(m,C,r,!1,b,R)),h++,C=R=null}p=f=null,this.renderRange.afterRows=i.afterRows}var M="width:"+this.firstWidth+"px;",D="width:"+this.lastWidth+"px;";-1<s.freezeIndex&&(this.marginLeft=s.getFirstColumnsWidth(!0),D+="margin-left:"+this.marginLeft+"px");var I="";this.headerHeight&&(I="top:"+this.headerHeight+"px");try{return o.body.apply({listyle:I,rows1:n,tstyle1:M,rows2:d,tstyle2:D})}finally{o=s=null}},renderBody:function(e,t){t=t||{},this.bodyEl.html(e),this.updateIrregularMinMaxSize(),this.doEmptyDataMessage(),!0!==t.ignoreEvent&&this.renderBodyEvent.fire(),t=null},updateIrregularMinMaxSize:function(){if(!0===this.irregularScroll){var e,t=this.getRows(),i=t.length,l=0,s=0;if(!(i<1)){l=this.minRowHeight||this._getRowHeight(t[0]),s=this.maxRowHeight||l;for(var o=0;o<i;o++)(e=this._getRowHeight(t[o]))<l&&(l=e),s<e&&(s=e);this.minRowHeight=l,this.maxRowHeight=Math.min(s,this.scroller.getScrollHeight())}}},moveYScroll:function(e){if(!(e<0)&&this.renderRange){var t,i=this.renderRange,l=this.scroller,s=-1<e?this.getVisibleRow(e):0,o=i.rowCount-(i.visibleEnd-i.visibleStart)-1<=e?this.getLastGrowedCount():this.getFirstGrowedCount(),r=i.visibleStart,n=0<o?i.visibleStart+(o-1):i.visibleEnd;if(s<r)0===s?l.goStart():l.go(s);else if(n<s){if(u=this.columnModel.isSummary()?this.getVisibleStartRowForSubSumOf(e):this.irregularScroll?e:s-(n-r),!0===this.irregularScroll){var d,a=this.getRows(),h=this.dataSet.getAt(s).id;for(R=a.length-1;0<=R&&(!(d=(e=a[R]).className.match(this.rowRe))||!d[1]||d[1]!=h.substring(1));R--);if(-1<R&&(t=this._getExpectedStartRow(a,a.length-(R+1)),-1==(u=this.findRow(a[t]))))for(;t++&&-1===(u=this.findRow(a[t])););}l.go(u)}else if(n===s){var u,c=this.getScrollerEl(),g=this.getRowDom(e);g&&g.offsetTop+g.offsetHeight>c.getHeight(!0)&&(u=this.columnModel.isSummary()?this.getVisibleStartRowForSubSumOf(e):s-(n-r)+1,l.go(u))}else if(this.irregularScroll&&s<n){for(var f=(a=this.getRows()).length,m=this.scroller.getScrollHeight(),C=0,R=0;R<f&&(C+=this._getRowHeight(a[R]),!(this.findRow(a[R])>=s));R++);m<C&&l.go(s)}i=l=null}},getVisibleStartRowForSubSumOf:function(e){var t,i,l=0,s=this.getScrollerEl().getHeight(!0),o=this.getRowHeight(),r=this.getVisibleRowCount(!0,o),n=this.getDataCount(),d=e-r,a=0,h=0,u=[],c=0;for(d<1&&(d=0),start=d;d<=e;d++){for(t=this.getAfterRowInfo(d,this.getRowRecord(d),n,!0),u[(a=d-start)+h]=d,c=0,i=t&&t.currentSumRows?t.currentSumRows.length:0;c<i;c++)u[a+h+c+1]=-1;h+=i}if(-1===(l=u[d=u.length-Math.floor(s/o)]))for(i=u.length;d++<i&&-1===(l=u[d]););return l},moveXScroll:function(e,t){var i=this.columnModel,l=this.getScrollerEl(),s=Rui.get(e),o=l.getVisibleScrollXY(s,!0,!0,this.marginLeft,!!this.scroller);o&&!Rui.isEmpty(o.left)&&0<=o.left&&this.scroller&&(i.freezeIndex<0||i.freezeIndex<t)&&(this.scroller.setScrollLeft(0<t?o.left:0),this.gridPanel&&this.gridPanel.currentCellEditor&&this.gridPanel.currentCellEditor.isShow()&&Rui.later(this.renderDataTime+10,this,function(e){var t=this.gridPanel.getSelectionModel();this.gridPanel.startEditor(t.getRow(),t.getCol())})),i=l=s=null},getCellXY:function(e){var t=Rui.isEmpty(e)?this.scrollerEl.getXY():Rui.get(e).getXY();return e=null,{x:t[0],y:t[1]}},getScrollerEl:function(){return this.scroller?this.scroller.scrollEl:this.scrollerEl},getScroller:function(){return this.scroller},getRowDom:function(e,t){if(null!==(e=this.getRenderedRow(e))&&-1!==e)try{var i=this.getRows(t);if(this.renderRange){var l=this.renderRange.afterRows;return l[e]?i[l[e].visibleRow]:i[e]}return i[e]}finally{l=null}return null===e?e:this.getRows(t)[e]},getRenderedRow:function(e){return!this.renderRange||(e-=this.renderRange.start)<0?null:e},showLoadingMessage:function(){this.el.mask()},hideLoadingMessage:function(){this.el.unmask()},doEmptyDataMessage:function(){0==this.getDataCount()?!0===this.dataSet.isLoad&&this.showEmptyDataMessage():this.hideEmptyDataMessage()},getIrregularRowHeight:function(e){return!0===this.irregularScroll?e?this.maxRowHeight:this.minRowHeight||this.getRowHeight():this.getRowHeight()},getRowHeight:function(){var e=this.getRows(),t=0;try{return 0<e.length&&(t=this._getRowHeight(e[e.length-1])),t<1&&(t=m.DEFAULT_ROW_HEIGHT),(!this._cacheRowHeight||0<t&&this._cacheRowHeight!=t)&&(this._cacheRowHeight=t),t=this._cacheRowHeight}finally{e=null}},_getRowHeight:function(e){return Rui.browser.msie?e.cells[e.cells.length-1].offsetHeight:e.offsetHeight},getVisibleRow:function(e){return e},getVisibleRowCount:function(e,t){var i=this._getVisibleRowCount(t);return i<1?0:!0===e?Math.floor(i):Math.ceil(i)},_getVisibleRowCount:function(e){var t=this.scroller?this.scroller.getScrollHeight():this.scrollerEl.getHeight(),i=e||this.getRowHeight();return 0<t&&(this._cacheHeight=t),t=this._cacheHeight||0,0<i?t/i:0},getRenderRange:function(e){var t,i,l,s,o,r=this.scroller,n=this.getDataCount(),d=0,a=0;0<n?(s=n+(this.growedRowCount||0),i=this._getVisibleRowCount(this.getIrregularRowHeight(!1)),l=Math.ceil(i),i=Math.floor(i),d=0<=(d=r?r.getStartRow():0)?d:0,(s<i||n-1<d)&&(d=0),s<(a=0==l?d:d+(l-1))&&(a=s-this.growedRowCount-1),n-1<a&&(a=n-1),o=i<s?a+(i!==l?-1:0):a,n-d<i-3&&((a=n-1)<0&&(a=0),o=a),t={start:d,end:a,visibleStart:d,visibleEnd:o,rowCount:n,visibleRowCount:i,afterRows:{}},"scroll"===this.pagerMode&&(t.start=t.visibleStart=0,t.end>this.pager.pageSize&&(t.end=t.visibleEnd=this.pager.pageSize))):t=null,this.renderRange=t;try{return t}finally{oldRange=t=null}},getCellDom:function(e,t){var i=1;if(-1<this.columnModel.freezeIndex&&(i=t<=this.columnModel.freezeIndex?0:1),this.isVirtualScroll&&this.cellMergeInfoSet&&this.getColumnModel().isMerged()&&0<t){if(renderedRow=this.getRenderedRow(e),null==renderedRow)return null;var l=e-renderedRow,s=this.cellMergeInfoSet,o=s[renderedRow];if(null==o)return null;var r=o[t],n=renderedRow;r.rowspan<0&&(n+=r.rowspan),o=s[n];for(var d=0,a=0,h=Math.min(o.length,t+1);a<h;a++)((r=o[a]).colspan<0||r.rowspan<0)&&d++,r=null;t-=d,e=n+l,s=o=null}var u=this.getRowDom(e,i);if(null==u)return null;try{return this.getRowCellDom(u,e,t)}finally{u=null}},getRowCellDom:function(e,t,i){var l=this.columnModel.freezeIndex,s=0;if(this.cellMergeInfoSet&&this.getColumnModel().isMerged()){var o=this.getRenderedRow(t);if(null!=o){var r=this.cellMergeInfoSet[o];if(r)for(var n=Math.min(i,r.length),d=0;d<n;d++){if(mergeColInfo=r[d],mergeColInfo.colspan<0||mergeColInfo.rowspan<0){if(-1<l&&d<=l)continue;s++}mergeColInfo=null}r=null}}-1<this.columnModel.freezeIndex&&i>this.columnModel.freezeIndex?i=i-(l+1)-s:i-=s;try{return e.cells[i]}finally{e=null}},getCell:function(e,t){try{if(e.className){var i=e.className.match(this.cellRe);if(i&&i[1]){var l=this.columnModel.getIndexById(i[1],!0);if(-1==l)return!1;if(this.columnModel.isMerged()&&t&&1<e.colSpan){for(var s=this.getHeaderCellEls(),o=this.scroller?this.scroller.getScrollLeft():0,r=l,n=s.length;r<n;r++){var d=s.getAt(r).dom.offsetLeft,a=this.columnModel.freezeIndex;if(-1<a&&a<r&&(d+=this.marginLeft),t+o<=(d+=this.el.getLeft())){l=r-1;break}0}s=null}return l}}return!1}finally{e=null}},getHeaderCellEl:function(e){var t=this.columnModel.getColumnAt(e,!0),i=null;try{return t&&0<(i=this.headerEl.select(".L-grid-cell-"+t.getId())).length?i.getAt(0):null}finally{t=i=null}},getHeaderEl:function(){return this.headerEl},findHeaderCell:function(e,t){return this.findCell(e,t,m.CLASS_GRIDVIEW_HEADER_CELL)},findRow:function(e,t,i){var l=this.findRowDom(e,t,i);if(!l||!l.className)return-1;var s=l.className.match(this.rowRe);if(s&&s[1]){var o=this.dataSet.indexOfKey("r"+s[1]);return-1!=o&&o}},findCell:function(e,t,i){var l=this.findCellDom(e);try{return!l||i&&!a.hasClass(l,i)?-1:this.getCell(l,t)}finally{l=null}},findRowDom:function(e,t,i){i=!!Rui.isUndefined(i)||i;var l,s,o,r,n,d=a.findParent(e,this.rowSelector,10);try{if(d&&this.columnModel.isMerged()&&i&&(l=this.findCellDom(e))&&1<l.rowSpan){if(o=Rui.get(d).getHeight(),Rui.browser.msie&&(r=d.getElementsByTagName("td")[d.cells.length-1],o=Rui.get(r).getHeight()),0==o)return d;for(s=t-a.getXY(l)[1],n=1;n<l.rowSpan&&!(s<o);n++)d=a.getNextSibling(d),o+=Rui.get(d).getHeight()}return d}finally{d=l=r=null}},findCellDom:function(e){return a.findParent(e,this.cellSelector,this.cellSelectorDepth)},findHeaderCellDom:function(e){var t=this.findCellDom(e);try{return t&&a.hasClass(t,m.CLASS_GRIDVIEW_HEADER_CELL)?t:null}finally{t=null}},doSortField:function(e){if(!this.selectionModel.isLocked()){var t=this.columnModel.getColumnAt(e,!0),i=this.dataSet,l=t.field;if(t&&t.isSortable()&&l){var s=null,o=this.getHeaderCellEl(e),r=i.multiSortable;if(i.sortDirection=i.sortDirection||{},o&&o.hasClass(m.CLASS_GRIDVIEW_HEADER_CELL)&&l){if(s="asc"==(s=i.sortDirection[l])?"desc":"desc"==s?"":"asc",!0!==this.isRemoteSort&&!0===r||this.clearFieldSortClass(),"asc"==s?(o.replaceClass(m.CLASS_GRIDVIEW_SORT_DESC,m.CLASS_GRIDVIEW_SORT_ASC),Rui.useAccessibility()&&o.setAttribute("aria-sort","ascending")):"desc"==s?(o.replaceClass(m.CLASS_GRIDVIEW_SORT_ASC,m.CLASS_GRIDVIEW_SORT_DESC),Rui.useAccessibility()&&o.setAttribute("aria-sort","descending")):(o.removeClass([m.CLASS_GRIDVIEW_SORT_ASC,m.CLASS_GRIDVIEW_SORT_DESC]),Rui.useAccessibility()&&o.setAttribute("aria-sort","")),!0!==this.isRemoteSort){var n=t.editor;if(n&&n.rendererField){var d=n.rendererField;if(this.autoMappingSortable&&!i.getFieldById(d)){for(var a=n.getDataSet(),h={},u=0,c=i.getCount();u<c;u++){var g,f=i.getAt(u).get(n.valueField);!Rui.isUndefined(h[f])||-1<(g=a.findRow(n.valueField,f))&&(h[f]=a.getAt(g).get(d)),i.getAt(u).data[d]=h[f]}a=h=null}delete i.sortDirection[l],!0!==this.customSortable&&(s=i.sortField(d,s)),delete i.sortDirection[d]}else!0!==this.customSortable&&(s=this.dataSet.sortField(l,s));n=null}s?i.sortDirection[l]=s:delete i.sortDirection[l],this.sortField=l,this.sortDir=s,this.fireEvent("sortField",{target:this,sortId:t.id,sortField:this.sortField,sortDir:this.sortDir,sortDirection:i.sortDirection})}o=null}t=i=l=null}},getLastSortInfo:function(){return{field:this.sortField,dir:this.sortDir}},clearFieldSortClass:function(){this.headerEl.select("."+m.CLASS_GRIDVIEW_SORT_ASC+",."+m.CLASS_GRIDVIEW_SORT_DESC).removeClass([m.CLASS_GRIDVIEW_SORT_ASC,m.CLASS_GRIDVIEW_SORT_DESC])},findFieldName:function(e){var t,l=null,i=this.findHeaderCellDom(e);return i&&(t=i.className.split(" "),Rui.util.LArray.each(t,function(e){var t=m.CLASS_GRIDVIEW_CELL+"-";if(Rui.util.LString.startsWith(e,t)){var i=e.substring(t.length);if(this.dataSet.getFieldById(i))return l=i,!1}}),i=t=null),l},addRowClass:function(e,t){var i=this.getRowDom(e,1);i&&a.addClass(i,t),-1<this.columnModel.freezeIndex&&(i=this.getRowDom(e,0))&&a.addClass(i,t),i=null},removeRowClass:function(e,t){var i=this.getRowDom(e,1);i&&a.removeClass(i,t),-1<this.columnModel.freezeIndex&&(i=this.getRowDom(e,0))&&a.removeClass(i,t),i=null},addCellClass:function(e,t,i){var l=this.getCellDom(e,t);l&&a.addClass(l,i),l=null},removeCellClass:function(e,t,i){var l=this.getCellDom(e,t);l&&a.removeClass(l,i),l=null},getCellAlt:function(e,t){var i=this.getCellDom(e,t);try{return null!=i?i.title:null}finally{i=null}},addCellAlt:function(e,t,i){var l=this.getCellDom(e,t);l&&(l.title=i),l=null},removeCellAlt:function(e,t){var i=this.getCellDom(e,t);null!=i&&(i.title=""),i=null},setValue:function(e,t,i){var l,s,o=this.getCellDom(e,t);o&&((l=document.createElement("div")).innerHTML="<table><tr>"+i+"</tr></table>",s=l.getElementsByTagName("td")[0],o.parentNode.replaceChild(s,o),s=l=null),o=null},getValue:function(e,t){var i=this.getCellDom(e,t);try{return i?i.innerHTML:null}finally{i=null}},setRowValue:function(e,t){var i,l=this.getRowDom(e);l&&((i=document.createElement("div")).innerHTML=t,l.innerHTML=i.firstChild.innerHTML,l=i=null)},getBodyEl:function(){return this.bodyEl},getColumnModel:function(){return this.columnModel},getBorderWidth:function(){return this.borderWidth},focusRow:function(e,t){this.scroller&&(!0!==this.isFocus||!0===this.gridPanel.isEdit)||(this.syncFocusRow(e,t),this.delayTask||(this.delayTask=new Rui.util.LDelayedTask(function(){if(!0===this.isFocus&&!0!==this.gridPanel.isEdit&&!0!==this.focusEl.isFocus){if(this.scroller)try{var e=this.focusEl.getX();Rui.rightToLeft()?this.scroller.scrollEl.getLeft()>e-10&&(e=this.scroller.scrollEl.getLeft()+10,this.focusEl.setX(e)):this.scroller.scrollEl.getRight()<e+10&&(e=this.scroller.scrollEl.getRight()-10,this.focusEl.setX(e))}catch(e){}Rui.platform.isMobile||!0===window.isRuiBlur||this.focusEl.focus()}this.delayTask=null},this),this.delayTask.delay(50)))},cancelViewFocus:function(){this.delayTask&&(this.delayTask.cancel(),this.delayTask=null)},updateView:function(){var e,t,i=this.el?Rui.util.LDom.getHiddenParent(this.el):null;i&&((i=Rui.get(i)).addClass("L-block-display"),this.width=this.el.getWidth()),Rui.ui.grid.LBufferGridView.superclass.updateView.call(this),this.renderMaster(this.getRenderHeader()),i&&i.removeClass("L-block-display"),this.headerEl&&this.headerEl.unOnAll(),this.scrollerEl&&this.scrollerEl.unOnAll(),this.bodyEl&&this.bodyEl.unOnAll(),this.focusEl&&this.focusEl.unOnAll(),this.resizeProxyEl&&this.resizeProxyEl.unOnAll(),this.ddProxyEl&&this.ddProxyEl.unOnAll(),this.ddTargetEl&&this.ddTargetEl.unOnAll(),this.headerEl=Rui.get(this.el.dom.childNodes[0]),this.headerOffsetEl=Rui.get(this.el.dom.childNodes[0].childNodes[0]),this.scrollerEl=Rui.get(this.el.dom.childNodes[1]),this.bodyEl=Rui.get(this.el.dom.childNodes[1].childNodes[0]),this.focusEl=Rui.get(this.scrollerEl.dom.childNodes[1]),this.focusEl.on("blur",function(e){this.isFocus=!1}),this.resizeProxyEl=Rui.get(this.el.dom.childNodes[2]),this.ddProxyEl=Rui.get(this.el.dom.childNodes[3]),this.ddTargetEl=Rui.get(this.el.dom.childNodes[4]),this.headerEl.on("mouseover",this.onHeaderMouseOver,this,!0),this.headerEl.on("mousemove",this.onHeaderMouseMove,this,!0),this.headerEl.on("mouseout",this.onHeaderMouseOut,this,!0),this.bodyEl.on("mouseover",this.onBodyMouseOver,this,!0),this.bodyEl.on("mouseout",this.onBodyMouseOut,this,!0),Rui.util.LEvent.removeListener(this.scrollerEl.dom,"scroll",this.onBodyScroll),Rui.util.LEvent.addListener(this.scrollerEl.dom,"scroll",this.onBodyScroll,this,!0),this.headerTools&&!Rui.ui.grid.LHeaderContextMenu&&(this.headerTools=!1),this.headerTools&&(e=[],t={},this.headerContextMenu&&(e=this.headerContextMenu.sorts,t=this.headerContextMenu.filters,this.headerContextMenu.destroy()),this.headerContextMenu=new Rui.ui.grid.LHeaderContextMenu({gridView:this,headerToolOptions:this.headerToolOptions}),this.headerContextMenu.render(this.el.dom),this.headerContextMenu.hide(),this.headerContextMenu.sorts=e,this.headerContextMenu.filters=t,e=t=null),this.headerCellsCache=null},updateSizes:function(e){var t=this.width;t&&Rui.browser.msie67&&(this.headerEl.setStyle("width",t+"px"),this.scrollerEl.setStyle("width",t+"px"));var i=0;if((e||this.height&&this.scrollerEl&&this.scrollerEl.getHeight()+this.headerEl.getHeight()!==this.height)&&0<(i=this.height-this.headerEl.getHeight())&&(this.scrollerEl.setHeight(i),this.scroller&&this.scroller.setHeight(i)),this.el&&this.el.getHeight()<1&&this.el.setStyle("height",""),this.plugins)for(var l=0,s=this.plugins.length;l<s;l++)this.plugins[l].updatePlugin({isRendered:!0});this.scroller&&0<i&&this.scroller.getScrollHeight()<1&&(this.scroller.refresh(),this.redoRenderData({resetScroll:!0}))},syncFocusRow:function(e,t){try{var i=this.getCellDom(e,t);this.moveXScroll(i,t);var l=this.getCellXY(i);0!=l.x&&(Rui.rightToLeft()?this.scroller.scrollEl.Left()<l.x-10&&(l.x=this.scroller.scrollEl.getLeft()+10):this.scroller.scrollEl.getRight()<l.x+10&&(l.x=this.scroller.scrollEl.getRight()-10),this.focusEl.setX(l.x)),!this.syncYFocusRow&&this.scroller||0!=l.y&&this.focusEl.setY(l.y)}catch(e){}},focus:function(){this.onCheckFocus(),Rui.platform.isMobile||this.focusEl.focus()},blur:function(){Rui.getBody().focus()},getLi:function(e){var t=1,i=this.columnModel;return-1<i.freezeIndex&&i.freezeIndex>e&&(t=0),i=null,t},getFirstLiEl:function(e){var t=null,t=e?this.getHeaderEl().dom.childNodes[0].childNodes:this.getBodyEl().dom.childNodes;try{return t&&0<t.length?Rui.get(t[0].childNodes[0]):null}finally{t=null}},getLastLiEl:function(e){var t=null,t=e?this.getHeaderEl().dom.childNodes[0].childNodes:this.getBodyEl().dom.childNodes;try{return t?Rui.get(t[0].childNodes[t[0].childNodes.length-1]):null}finally{t=null}},getRowRecord:function(e){return this.dataSet.getAt(e)},getDataCount:function(){return"scroll"===this.pagerMode?this.dataSet.getTotalCount():this.dataSet.getCount()},getHeaderCellEls:function(){if(this.headerCellsCache)return this.headerCellsCache;var e,t=this.getColumnModel();if(t.isMultiheader()){for(var i=[],l=t.getColumnCount(!0),s=0;s<l;s++){var o=t.getColumnAt(s,!0);i.push(".L-grid-cell-"+o.getId()),o=null}e=this.headerEl.select(i.join(", "))}else e=this.headerEl.select(".L-grid-header-cell");return t=null,this.headerCellsCache=e},updateColumnFit:function(e){var t=this.columnModel.getColumnAt(e,!0);if(t){var i=this.renderRange;if(i){for(var l=0,s=i.start;s<=i.end;s++){var o,r,n,d,a=this.getVisibleRow(s),h=Rui.get(this.getCellDom(a,e));null!=h&&(r=(o=h.select(".L-grid-cell-inner").getAt(0)).dom.innerText||o.dom.textContent,n=Rui.createElements('<span class="L-cell-width-temp">'+r+"</span>"),this.el.appendChild(n),l<(d=n.getWidth())&&(l=d),n.remove(),n=h=o=null)}t.setWidth(l+25),t=i=null}}},updateColumnsAutoWidth:function(e){e=e||this.gridPanel.width-Rui.ui.LScroller.SCROLLBAR_SIZE,this.columnModel.updateColumnsAutoWidth(e),this.redoRender()},updateEditable:function(e){this.gridPanel&&(e?this.el.addClass("L-editable"):this.el.removeClass("L-editable"))},destroy:function(){this.doUnSyncDataSet(),this.renderEvent.unOn(this.onRender,this),this.gridPanel&&this.gridPanel.unOn("widthResize",this.onWidthResize,this),this.headerEl&&(this.headerEl.remove(),delete this.headerEl),this.bodyEl&&(this.bodyEl.remove(),delete this.bodyEl),this.headerContextMenu&&this.headerContextMenu.destroy(),Rui.ui.grid.LBufferGridView.superclass.destroy.call(this)},toString:function(){return"Rui.ui.grid.LBufferGridView "+this.id}})}(),function(){var V=Rui.ui.grid.LBufferGridView,S=Rui.browser;Rui.applyObject(Rui.ui.grid.LBufferGridView.prototype,{createTemplate:function(){var e,t,i=this.templates||{};i.master||(i.master=new Rui.LTemplate('<div class="L-grid-header" style="{hstyle}" id="{ghId}">','<div class="L-grid-header-offset" style="{ostyle}" id="{ghoId}">{header}</div>','<div class="L-grid-header-tool L-hide-display"><span class="L-grid-header-tool-icon"></span></div>',"</div>",'<div class="L-grid-scroller" style="{sstyle}" id="{gscrId}">','<div class="L-grid-body L-grid-col-line" style="{bstyle}"></div><a class="L-grid-focus" tabIndex="-1" style="position:absolute;"></a>',"</div>",'<div class="L-grid-resize-proxy">&#160;</div>','<div class="L-grid-dd-proxy"><div>&#160;</div></div>','<div class="L-grid-dd-target">&#160;</div>')),i.header||(i.header=new Rui.LTemplate('<ul class="L-grid-ul">','<li class="L-grid-li-first">','<table id="{ghftId}" border="0" cellspacing="0" cellpadding="0" style="{tstyle1}" class="L-grid-header-table">',"<thead>{hrow1}</thead>","</table>","</li>",'<li class="L-grid-li-last">','<table id="{ghflId}" border="0" cellspacing="0" cellpadding="0" style="{tstyle2}" class="L-grid-header-table">',"<thead>{hrow2}</thead>","</table>","</li>","</ul>")),i.hrow||(i.hrow=new Rui.LTemplate('<tr class="L-grid-header-row {first_last}">{hcells}</tr>')),i.hcell||(i.hcell=new Rui.LTemplate('<td id="{hcId}" class="L-grid-header-cell L-grid-cell L-grid-cell-{id} {first_last} {hidden} {sortable} {css}" style="{style}" colspan="{colSpan}" rowSpan="{rowSpan}">','<div id="{hcInId}" class="L-grid-header-inner L-grid-header-{id}" style="{istyle}">','<a id="{hcBtnId}" class="L-grid-header-btn" >{value}</a><img id="{hcSrtId}" src="'+Rui.getRootPath()+Rui.BLANK_IMAGE_URL+'" class="L-grid-sort-icon"/>',"</div>","</td>")),i.hcellLabel||(i.hcellLabel=new Rui.LTemplate('<td id="{hcId}" class="L-grid-header-cell L-grid-cell L-grid-cell-{id} {first_last} {css} " style="{style}" colspan="{colSpan}" rowSpan="{rowSpan}">','<div id="{hcInId}" class="L-grid-header-inner L-grid-header-{id}" style="{istyle}">','<a id="{hcBtnId}" class="L-grid-header-btn" >{value}</a>',"</div>","</td>")),i.body||(i.body=new Rui.LTemplate('<ul class="L-grid-ul">','<li class="L-grid-li-first" style="{listyle}">','<table cellspacing="0" cellpadding="0" style="{tstyle1}">{rows1}</table>',"</li>",'<li class="L-grid-li-last">','<table cellspacing="0" cellpadding="0" style="{tstyle2}">{rows2}</table>',"</li>","</ul>")),i.row||(e=Rui.useAccessibility()?'role="row" {ariaAttr}':"",i.row=new Rui.LTemplate('<tr class="{className}" style="{rstyle}" '+e+">{rowBody}</tr>")),i.rowBody||(i.rowBody=new Rui.LTemplate("{cells}")),i.cell||(t=Rui.useAccessibility()?'role="gridcell" {tabIndex} {ariaInvalid} ':"",i.cell=new Rui.LTemplate('<td id="{cId}" class="L-grid-col L-grid-cell L-grid-cell-{id} {first_last} {hidden} {css} " style="{style}" colspan="{colspan}" rowspan="{rowspan}" '+t+" >",'<div id="{cInId}" class="L-grid-cell-inner L-grid-col-{id}" style="{istyle}">{bcell}{value}</div>',"</td>")),this.templates=i,i=null},adjustColumnWidth:function(e){var t=this._getBorderWidth();return 0<e+t?e+t:0},_getBorderWidth:function(){return Rui.isBorderBox?0:-this.borderWidth},getColumnWidth:function(e){return this.adjustColumnWidth(e.width)},getRenderHeader:function(e,t){return this.initColumn(),this.columnModel.isMultiheader()?this.getRenderMultiheader():this.getRenderBasicHeader()},getRenderBasicHeader:function(){for(var e=this.templates||{},t=(u=this.columnModel).getColumnCount(!0),i="",l=0;l<=u.freezeIndex;l++){var s=u.getColumnAt(l,!0);i+=this.getRenderCellBasicHeader(s,l,t),s=null}for(var o=e.hrow.apply({hcells:i,first_last:"L-grid-header-row-first L-grid-header-row-last"}),r=u.getFirstColumnsWidth(!0),n=-1<u.freezeIndex?"width:"+r+"px;":"",i="",l=u.freezeIndex+1;l<t;l++){s=u.getColumnAt(l,!0);i+=this.getRenderCellBasicHeader(s,l,t),s=null}var d=e.hrow.apply({hcells:i,first_last:"L-grid-header-row-first L-grid-header-row-last"}),a="width:"+(u.getLastColumnsWidth(!0)-(u.getLastColumnCount(!0)-2*this.borderWidth)||1)+"px;";-1<u.freezeIndex&&(a+="margin-left:"+r+"px");var h=e.header.apply({ghftId:Rui.useFixedId()?"LGrid-header-ft-"+this.gridId:Rui.id(),ghflId:Rui.useFixedId()?"LGrid-header-lt-"+this.gridId:Rui.id(),hrow1:o,tstyle1:n,hrow2:d,tstyle2:a}),e=null,u=null;return h},getRenderCellBasicHeader:function(e,t,i){var l=this.templates||{},s=0==t?"L-grid-cell-first":t==i-1?"L-grid-cell-last":"",o="width:"+this.adjustColumnWidth(e.width)+"px;";e.cellStyle&&(o+=e.cellStyle+";");var r=e.isSortable()?"L-grid-cell-sortable":"",n="";e.field&&this.dataSet.sortDirection&&(n=this.dataSet.sortDirection[e.field]),n&&(r+=" L-grid-sort-"+n);var d=[].concat(e.headerCss),a={id:e.id,hcId:Rui.useFixedId()?"LGridHeaderCell-"+this.gridId+"-"+e.id:void 0,hcInId:Rui.useFixedId()?"LGridHeaderCell-inner-"+this.gridId+"-"+e.id:void 0,hcBtnId:Rui.useFixedId()?"LGridHeaderCell-btn-"+this.gridId+"-"+e.id:void 0,hcSrtId:Rui.useFixedId()?"LGridHeaderCell-sort-"+this.gridId+"-"+e.id:void 0,first_last:s,style:o,sortable:r,value:e.getLabel(),css:d.join(" "),colSpan:"1",rowSpan:"1"};try{return l.hcell.apply(a)}finally{l=d=e=null}},getRenderMultiheader:function(){this.useColumnDD=!1;var e="",t="",i=0,l="width:"+(-1<(r=this.columnModel).freezeIndex?(o=r.getMultiheaderInfos(0),e=this.getMultiheaderHtml(o,0),i=r.getFirstColumnsWidth(!0),o=r.getMultiheaderInfos(1),t=this.getMultiheaderHtml(o,1),r.getLastColumnsWidth(!0)-(r.getLastColumnCount(!0)-2*this.borderWidth)):(o=r.getMultiheaderInfos(),t=this.getMultiheaderHtml(o,1),r.getLastColumnsWidth(!0)-(r.getColumnCount(!0)-2*this.borderWidth)))+"px;",s=r.getFirstColumnsWidth(!0);-1<r.freezeIndex&&(l+="margin-left:"+s+"px");var o=null,r=null;return(this.templates||{}).header.apply({ghftId:Rui.useFixedId()?"LGrid-header-ft-"+this.gridId:Rui.id(),ghflId:Rui.useFixedId()?"LGrid-header-lt-"+this.gridId:Rui.id(),hrow1:e,tstyle1:"width:"+i+"px;",hrow2:t,tstyle2:l})},getMultiheaderHtml:function(e,t){for(var i=this.columnModel.getBasicColumnModel(),l=this.columnModel,s=e.colInfos,o=e.rowCount,r=s?s.length:0,n="",d="",a="",h=this.templates||{},u=this.dataSet.sortDirection,c=[],g=0;g<o;g++)c.push("");for(g=0;g<r;g++)if(s[g]){R=!1;for(var f,m,C,R,v,p,S,w=o-1;-1<w;w--){(S=s[g][w]).exist&&(n=0==g?"L-grid-cell-first":g==r-1?"L-grid-cell-last":"",C=R?(f=0<t?l.freezeIndex+g+1:g,m=(m=this.getMultiHeaderInnerWidth(S,f,w,r)-this.borderWidth)<=0?1:m,D=l.getColumnById(S.id),C={id:S.id,hcId:Rui.useFixedId()?"LGridHeaderCell-"+this.gridId+"-"+D.id:void 0,hcInId:Rui.useFixedId()?"LGridHeaderCell-inner-"+this.gridId+"-"+D.id:void 0,hcBtnId:Rui.useFixedId()?"LGridHeaderCell-btn-"+this.gridId+"-"+D.id:void 0,first_last:n,css:"",style:"",sortable:"",value:D.label,colSpan:S.colspan,rowSpan:S.rowspan,istyle:"overflow: hidden;"},c[w]=c[w]+h.hcellLabel.apply(C),null):(R=!0,D=(D=l.getColumnById(S.id))||i.getColumnById(S.id),I=this.adjustColumnWidth(D.width),d="width:"+(D.width-this.borderWidth)+"px;",D.cellStyle&&(d+=D.cellStyle+";"),a=D.isSortable()?"L-grid-cell-sortable":"",v="",D.field&&u&&(v=u[D.field]),v&&(a+=" L-grid-sort-"+v),(p=[].concat(D.headerCss)).push("L-grid-header-cell-type-data"),1<S.rowspan&&p.push(" L-grid-cell-rowspan-"+S.rowspan),C={id:S.id,hcId:Rui.useFixedId()?"LGridHeaderCell-"+this.gridId+"-"+D.id:void 0,hcInId:Rui.useFixedId()?"LGridHeaderCell-inner-"+this.gridId+"-"+D.id:void 0,hcBtnId:Rui.useFixedId()?"LGridHeaderCell-btn-"+this.gridId+"-"+D.id:void 0,hcSrtId:Rui.useFixedId()?"LGridHeaderCell-sort-"+this.gridId+"-"+D.id:void 0,first_last:n,hidden:"",style:d,sortable:a,css:p.join(" "),value:D.label,colSpan:S.colspan,rowSpan:S.rowspan,istyle:""},c[w]=c[w]+h.hcell.apply(C),p=D=null)),S=null}}var E="";l.makeDummyCell&&void 0===this.makeDummyCell&&(C={style:"",istyle:"overflow: hidden;width:0px;",value:"",css:"L-grid-dummy-cell"},E=h.hcellLabel.apply(C),C=null);for(var y="",g=0;g<o;g++)n=0==g?"L-grid-header-row-first":g==o-1?"L-grid-header-row-last":"",y+=h.hrow.apply({hcells:c[g]+E,first_last:n});var L="";if(l.makeDummyCell&&void 0===this.makeDummyCell){L='<tr class="L-grid-row-dummy" >';var b=0,M=l.getColumnCount(!0)-1;-1<l.freezeIndex&&(0==t?(b=0,M=l.freezeIndex):b=l.freezeIndex+1);for(g=b;g<=M;g++){var D=l.getColumnAt(g,!0),I=this.adjustColumnWidth(D.width);L+='<td class="L-grid-row-dummy-cell" style="width:'+I+'px"></td>',D=null}L+="</tr>"}return c=h=l=i=s=null,L+y},getMultiHeaderInnerWidth:function(e,t,i,l){var s=this.columnModel.getBasicColumnModel();try{return this.adjustColumnWidth(s.getColumnById(e.id).width)}finally{s=null}},initColumn:function(){for(var e=this.columnModel.getColumnCount(),t=0;t<e;t++){var i=this.columnModel.getColumnAt(t);if(i.field){var l=this.dataSet.getFieldById(i.field);if(!l)throw new Error("DataSet field name was not found! Column Field name is '"+i.field+"' [grid id: "+this.gridPanel.id+"]");i.type=l.type}i=null}},getRenderRow:function(e,t,i,l,s,o){var r=this.columnModel,n=this.templates||{},d=0,a="width:"+(d=-1<r.freezeIndex&&l?this.firstWidth:this.lastWidth)+"px;",h={className:this.getRenderRowClassName(e,t,i,l),rowBody:this.getRenderRowBody(e,t,d,l,s,o),ariaAttr:this.getAriaAttr(e,t),rstyle:a};try{return n.row.apply(h)}finally{n=r=h=t=s=null}},getAriaAttr:function(e,t){return""},getSummaryInfos:function(){for(var e={},t={},i=[],l=0,s=this.columnModel,o=0,r=s.getColumnCount(!0);o<r;o++){var n=s.getColumnAt(o,!0),d=n.summary;if(d){if(d.ids){i.push(d);for(var a=0,h=d.ids.length;a<h;a++)e[d.ids[a]]=!0,l++}var u="function"==typeof d.type?d.type:V.getSummaryFunction(d.type||"sum");t[o]={col:o,column:n,sumType:u}}n=d=null}try{return{idColumns:e,idColumnCount:l,sumColumns:t,summarys:i}}finally{s=e=t=i=null}},getAfterRowInfo:function(e,t,i,l){var s,o=this.columnModel,r=this.dataSet,n=r.getCount(),d=[],a={},h=this.summaryInfos,u=0;if(o.isSummary()){d=h.summarys,s=[],depth=d.length;for(var c=d.length-1;0<=c;c--){for(var g=!1,f=0,m=(S=d[c].ids).length;f<m;f++){var C=S[f],R=t.get(C);if(e+1<n){var v=r.getAt(e+1).get(C);if(!1===g&&String(R)!=String(v)&&(depth=Math.min(depth,c),g=!0),g)break}}if(g)break}e==i-1&&(depth=0);for(var p={},c=d.length-1;depth<=c&&0<=c;c--)for(var S=d[c].ids,w=0;w<S.length;w++)if(!p[S[w]]){var C=S[w],R=t.get(C),E=r.getAt(e+1),v=E?E.get(C):null;if(String(R)!=String(v))for(var y=S.length-1;w<=y;y--)p[S[y]]||(s.push({summary:d[c],labelId:d[c].labelId,label:d[c].label,sumColId:S[y]}),p[S[y]]=!0,u++)}for(var L=0,f=0,m=s.length;f<m;f++)for(w=s[f].summary.ids.length-1;0<=w;w--)for(var C=s[f].sumColId,R=r.getAt(e).get(C),b=e;0<=b;b--){var M=r.getAt(b-1);if(L++,!M||String(R)!=String(M.get(C))){L=this.getBeforeDataRowCount(d,e,C,L),m-w-1==f&&(s[f].dataRowCnt=L),L=0;break}}d=null}try{return s&&0<s.length?(a.idColumns=h.idColumns,a.idColumnCount=u,a.currentSumRows=s,a.sumColumns=h.sumColumns,a):null}finally{s=idColumns=null}},getBeforeDataRowCount:function(e,t,i,l){if(l<1)return l;for(var s=-1,o=i,r=0;r<e.length;r++){for(var n=0;n<e[r].ids.length;n++)if(e[r].ids[n]==i){if(!(o=e[r].ids[n-1])||o==i)continue;s=(s=r-1)<0?0:s;break}if(0<=s)break}if(!o||o==i)return l;for(var d=this.dataSet,a=0,h=d.getNameValue(t,o),r=t;0<=r;r--,a++){var u=d.getNameValue(r,o);if(String(h)!=String(u))break}return 0<s?this.getBeforeDataRowCount(e,t,o,Math.min(l,a)):Math.min(l,a)},getAfterRenderRow:function(e,t,i,l,s,o){for(var r="",n=this.columnModel,d=n.getColumnCount(!0),a=this.templates||{},h=n.freezeIndex,u=o.idColumns,c={},g=[],f=o.currentSumRows.length,m=0;m<f;m++)for(var C=0;C<o.currentSumRows[m].summary.ids.length;C++){var R=o.currentSumRows[m].labelId||o.currentSumRows[m].summary.ids[C],v=n.getIndexById(R);c[R]=v,g.push(R)}for(var p={},m=0;m<f;m++){var S="",w=0;-1<h&&(d=l?h+1:d,w=l?0:h+1);var E=o.currentSumRows[m].summary,y=o.currentSumRows[m].dataRowCnt;if(!p[R=o.currentSumRows[m].labelId||g[m]]){for(var L=e-y+1,b=!l&&(-1<h&&h<w),M=1,D="L-grid-summary-col-"+R;w<d;w++){var I,x,_,A="",k=o.sumColumns[w],T={id:"",cId:Rui.useFixedId()?"LGridDummy-"+this.gridId+"-"+e+"-"+R+"-"+w:void 0,cInId:Rui.useFixedId()?"LGridDummy-inner-"+this.gridId+"-"+e+"-"+R+"-"+w:void 0,first_last:"",css:[],style:"",editable:!1,tooltip:!1,tooltipText:"",istyle:"",isSummary:!0};w==c[R]?(I=E.label||this.subTotalLabel,Rui.isFunction(I)&&(I=E.label.call(this,e,w,x)),T.value=I,T.css="L-grid-summary-col L-grid-summary-label "+D,M&&(T.colspan=M,M=0),A=a.cell.apply(T),b=!0):k?(x=k.column,_=k.sumType.call(this,L,e,w,T,x),T.id=x.id,T.css=["L-grid-summary-col","L-grid-summary-data",D],T.style="text-align:"+x.align+";",T.value=u[T.id]?"":this.getRendererValue(_,T,t,x,e,w),T.css=T.css.join(" "),M&&(T.colspan=M,M=0),A=a.cell.apply(T)):b?A=(x=n.getColumnAt(w)).expression?(_=0,this.dataSet,_=(Rui.isFunction(x.expressionType)?x.expressionType:V.getSummaryFunction(x.expressionType?x.expressionType:"sum")).call(this,L,e,w,T,x),T.id=x.id,T.css=["L-grid-summary-col","L-grid-summary-data",D],T.value=u[T.id]?"":this.getRendererValue(_,T,t,x,e,w),T.style="text-align:"+x.align+";",T.css=T.css.join(" "),T.isSummary=!0,M&&(T.colspan=M,M=0),a.cell.apply(T)):'<td id="'+(Rui.useFixedId()?"LGridDummy-"+e+"-"+R+"-"+w:Rui.id())+'" class="L-grid-col L-grid-cell L-grid-summary-col '+D+'" ></td>':M++,S+=A,p[R]=!0,T=x=k=null}r+='<tr class="L-grid-summary-row L-grid-summary-depth-'+m+'">',r+=S,r+="</tr>",E=null}}return n=c=a=o=p=null,r},getRenderRowClassName:function(e,t,i,l){var s=0==e?"L-grid-row-first":e==i-1?"L-grid-row-last":"",o=e%2==0?"odd":"even",r=[];!0!==this.skipRowCellEvent&&this.fireEvent("rowRendered",{css:r,row:e,record:t});var n=this.gridPanel.getRowModel();n.renderer&&n.renderer(r,e,t),this.dataSet.isMarked(e)&&r.push(V.CLASS_GRIDVIEW_ROW_SELECT_MARK);var d="L-grid-row L-grid-row-"+t.id+" L-grid-row-"+o+" "+s+" ";return d+=r.join(" "),e==this.dataSet.rowPosition&&(d+=" "+V.CLASS_GRIDVIEW_ROW_SELECTED),n=r=t=null,d},getRenderRowBody:function(e,t,i,l,s,o){var r=this.templates||{},n=this.columnModel,d=n.getColumnCount(!0),a="";if(null!=o&&this.irregularScroll&&this.irregularField)a+=this.getRenderCell(e,o,d,t,s?s[u]:void 0,!0);else{var h=n.freezeIndex;if(-1<h){d=l?h+1:d;for(var u=l?0:h+1;u<d;u++)s&&(s[u].rowspan<0||s[u].colspan<0)||(a+=this.getRenderCell(e,u,d,t,s?s[u]:void 0))}else for(u=0;u<d;u++)s&&s[u]&&(s[u].rowspan<0||s[u].colspan<0)||(a+=this.getRenderCell(e,u,d,t,s?s[u]:void 0));a+=this.getRenderDummyCell(e)}var c="width:"+(i=i||n.getTotalWidth(!0))+"px;",g=r.rowBody.apply({tstyle:c,cells:a});return cs=r=s=t=null,g},getRenderDummyCell:function(e){var t=this.getColumnModel(),i=p=null;try{return t.makeDummyCell&&void 0===this.makeDummyCell||!0===t.merged?(i=this.templates||{},p={style:"",istyle:"overflow: hidden;width:0px;",value:"test",css:"L-grid-dummy-cell"},i.cell.apply(p)):""}finally{t=i=p=null}},getRenderCell:function(e,t,i,l,s,o){var r=this.templates||{},n=this.columnModel,d=n.getColumnAt(t,!0),a=[];d.field&&l.isModifiedField(d.field)&&a.push("L-grid-cell-update"),!0!==this.skipRowCellEvent&&this.fireEvent("cellRendered",{css:a,row:e,col:t,record:l}),a=this.getRenderCellClass(a,e,t,l,d);var h,u=this.getRenderCellParams(e,R,i,d,l);!0===u.editable&&u.css.push(this.gridPanel.CLASS_GRID_CELL_EDITABLE),this.dataSet.isValid(e,l.id,t,d.field)||(u.css.push("L-invalid"),Rui.useAccessibility()&&(u.ariaInvalid='aria-invalid="true"')),Rui.useAccessibility()&&(h=0===e&&0===t?0:-1,u.tabIndex='tabIndex="'+h+'"');var c=n.getCellConfig(e,d.id,"tooltipText");Rui.isUndefined(c)&&(c=u.tooltipText,Rui.isEmpty(u.tooltipText)||n.setCellConfig(e,d.id,"tooltipText",c)),null!=this.tooltip&&""!=u.value&&0!=u.tooltip&&(Rui.isEmpty(d.tooltipText)||u.css.push("L-grid-cell-tooltip"),Rui.isEmpty(c)||(u.css.push("L-grid-cell-tooltip"),this.tooltip.text=c));for(var g,f=0;f<u.css.length;f++)a.push(u.css[f]);!0===this.selectionMergedCell&&this.cellMergeInfoSet&&this.getColumnModel().isMerged()&&this.cellMergeInfoSet[e]&&this.cellMergeInfoSet[e][t]&&((g=this.cellMergeInfoSet[e][t].cls)&&a.push(g)),u.css=a.join(" ");var m,C=this.adjustColumnWidth(d.width);if(s&&s.colspan&&1<s.colspan)for(var R=t+1,v=s.colspan;--v;)C+=this.adjustColumnWidth(n.getColumnAt(R,!0).width),R++;s&&s.colspan&&1<s.colspan&&(C+=s.colspan-1),m="width:"+C+"px;",""!=d.align&&(m+="text-align:"+d.align+";"),d.cellStyle&&(m+=d.cellStyle+";"),o&&(m+="display:table;"),u.style+=m,u.bcell=this.getRenderBeforeCell(u,l,d,e,t),Rui.isEmpty(u.value)&&(u.value=S.msie6?"&nbsp;":""),s&&(s.rowspan&&1<s.rowspan&&(u.rowspan=s.rowspan),s.colspan&&1<s.colspan&&(u.colspan=s.colspan)),u.cId=Rui.useFixedId()?"LGridCell-"+this.gridId+"-"+e+"-"+d.id:void 0,u.cInId=Rui.useFixedId()?"LGridCell-inner-"+this.gridId+"-"+e+"-"+d.id:void 0;try{return r.cell.apply(u)}finally{r=d=a=u=s=l=null}},getRenderCellParams:function(e,t,i,l,s){var o=this.columnModel,r=0==t?"L-grid-cell-first":t==i-1?"L-grid-cell-last":"",n={id:l.id,first_last:r,css:[],style:"",editable:l.editable,tooltip:!0,tooltipText:"",istyle:""};n.value=this.getRenderCellValue(n,s,l,e,t),this.isExcel&&!0===o.skipTags&&"string"==typeof n.value&&(n.value=Rui.util.LString.skipTags(n.value));var d=o.getCellConfig(e,l.id,"editable");return Rui.isUndefined(d)?(d=n.editable,Rui.isUndefined(n.editable)||o.setCellConfig(e,l.id,"editable",d,{ignoreEvent:!0})):Rui.isUndefined(n.editable)||d!=n.editable&&(d=n.editable,o.setCellConfig(e,l.id,"editable",d,{ignoreEvent:!0})),n.editable=d,n},getRenderBeforeCell:function(e,t,i,l,s){return""},getRenderCellClass:function(e,t,i,l,s){var o=this.selectionModel;if(!o)return[];(o.getRow()==t&&o.getCol&&o.getCol()==i||o.hasSelectedCell(t,i))&&e.push(V.CLASS_GRIDVIEW_CELL_SELECTED),s.field&&l.isModifiedField(s.field)&&e.push(V.CLASS_GRIDVIEW_CELL_EDITED);try{return e}finally{o=e=null}},getRenderCellValue:function(e,t,i,l,s){var o=t.get(i.field);return this.getRendererValue(o,e,t,i,l,s)},getRendererValue:function(e,t,i,l,s,o){try{if(this.isExcel&&!l.renderExcel)return"";if(l.editor&&(l.editor.beforeRenderer&&(e=l.editor.beforeRenderer(e,t,i,s,o)),l.editor.renderer)){var r=l.renderer(e,t,i,s,o);return l.columnModel.setCellConfig(s,l.id,"tooltipText",t.tooltipText),r}if(!l.expression||t.isSummary&&!0===t.isSummary||(e=l.expression(e,i,s,o)),l.beforeRenderer&&(e=l.beforeRenderer(e,t,i,s,o)),l.renderer){t.excel=!0===this.isExcel;r=l.renderer(e,t,i,s,o);return l.columnModel.setCellConfig(s,l.id,"tooltipText",t.tooltipText),r}return e}catch(e){Rui.log(e.message,"ERROR")}finally{e=l=i=t=null}},updateRenderRows:function(e){var t,i=this.bodyEl.select(".L-grid-row:nth-child(n+"+e+")");i.length<1||(t=!!i.getAt(0).hasClass("L-grid-row-even"),i.each(function(e){t?e.replaceClass("L-grid-row-odd","L-grid-row-even"):e.replaceClass("L-grid-row-even","L-grid-row-odd"),t=!t}),0==e&&(1<i.length&&i.getAt(1).removeClass("L-grid-row-first"),i.getAt(0).addClass("L-grid-row-first")),0<i.length-2&&i.getAt(i.length-2).removeClass("L-grid-row-last"),i.getAt(i.length-1).addClass("L-grid-row-last"),this.rowsMap=i=null)},updateEmptyWidth:function(e){var t=this.bodyEl.dom.firstChild;try{var i=Rui.isBorderBox?0:this.borderWidth;return t&&"L-grid-body-empty"==t.className?(t.style.width=e-i+"px",!0):!1}finally{t=null}}}),V.SUMMARY_FN={sum:function(e,t,i,l,s){return s.expression&&l.isSummary?V.getCalculateValue.call(this,e,t,i,l,s):this.dataSet.sum(s.field,e,t)},avg:function(e,t,i,l,s){return s.expression&&l.isSummary?V.getCalculateValue.call(this,e,t,i,l,s)/(t-e+1):this.dataSet.avg(s.id,e,t)},max:function(e,t,i,l,s){for(var o=this.dataSet,r=0,n=e;n<=t;n++){var d=o.getAt(n),a=d.get(s.field),h=s.expression?s.expression(a,d,n,i):a;r<h&&(r=h)}return r},min:function(e,t,i,l,s){for(var o,r=this.dataSet,n=e;n<=t;n++){var d=r.getAt(n),a=d.get(s.field),h=s.expression?s.expression(a,d,n,i):a;(n==e||h<o)&&(o=h)}return o},count:function(e,t,i,l,s){return t-e+1},countExcludeEmpty:function(e,t,i,l,s){for(var o=this.dataSet,r=0,n=e;n<=t;n++){var d=o.getAt(n).get(s.field);Rui.isEmpty(d)||r++}return r},empty:function(e,t,i,l,s){return""}},V.getSummaryFunction=function(e){return V.SUMMARY_FN[e]},V.getCalculateValue=function(e,t,i,l,s){for(var o=this.dataSet,r=0,n=e;n<=t;n++){var d=o.getAt(n),a=d.get(s.id);r+=s.expression?s.expression(a,d,n,i):a}return r}}(),Rui.applyObject(Rui.ui.grid.LBufferGridView.prototype,{_setSyncDataSet:function(e,t,i){var l=t[0];this.doUnSyncDataSet(),!0===l&&this.doSyncDataSet(),this.syncDataSet=l,this.fireEvent("syncDataSet",{target:this,isSync:l})},doSyncDataSet:function(){this.dataSet.on("add",this.doAddData,this,!0,{system:!0}),this.dataSet.on("update",this.doCellUpdateData,this,!0,{system:!0}),this.dataSet.on("remove",this.doRemoveData,this,!0,{system:!0}),this.dataSet.on("undo",this.doUndoData,this,!0,{system:!0}),this.dataSet.on("beforeLoad",this.doBeforeLoad,this,!0,{system:!0}),this.dataSet.on("load",this.onLoadDataSet,this,!0,{system:!0}),this.dataSet.on("dataChanged",this.onChangeRenderData,this,!0,{system:!0}),this.dataSet.on("commit",this.onCommitData,this,!0,{system:!0}),this.dataSet.on("rowPosChanged",this.onRowPosChangedData,this,!0,{system:!0}),this.dataSet.on("allMarked",this.onAllMarked,this,!0,{system:!0}),this.dataSet.on("invalid",this.onInvalid,this,!0,{system:!0}),this.dataSet.on("valid",this.onValid,this,!0,{system:!0}),this.dataSet.on("stateChanged",this.onAllMarked,this,!0,{system:!0}),this.dataSet.on("fieldsChanged",this.onFieldsChanged,this,!0,{system:!0}),this.gridPanel&&(this.columnModel.on("cellConfigChanged",this.onUpdateCellConfig,this,!0),this.columnModel.bindEvent(this.gridPanel))},doUnSyncDataSet:function(){this.dataSet.unOn("add",this.doAddData,this),this.dataSet.unOn("update",this.doCellUpdateData,this),this.dataSet.unOn("remove",this.doRemoveData,this),this.dataSet.unOn("undo",this.doUndoData,this),this.dataSet.unOn("beforeLoad",this.doBeforeLoad,this),this.dataSet.unOn("load",this.onLoadDataSet,this),this.dataSet.unOn("dataChanged",this.onChangeRenderData,this),this.dataSet.unOn("commit",this.onCommitData,this),this.dataSet.unOn("rowPosChanged",this.onRowPosChangedData,this),this.dataSet.unOn("allMarked",this.onAllMarked,this),this.dataSet.unOn("invalid",this.onInvalid,this),this.dataSet.unOn("valid",this.onValid,this),this.dataSet.unOn("stateChanged",this.onAllMarked,this),this.dataSet.unOn("fieldsChanged",this.onFieldsChanged,this),this.gridPanel&&(this.columnModel.unOn("cellConfigChanged",this.onUpdateCellConfig,this),this.columnModel.unbindEvent(this.gridPanel))}}),function(){var h=Rui.util.LDom,n=Rui.ui.grid.LBufferGridView;Rui.applyObject(Rui.ui.grid.LBufferGridView.prototype,{onRender:function(){},doBeforeLoad:function(e){this.modifiedDate=new Date,this.showLoadingMessage()},onLoadDataSet:function(e){"scroll"===this.pagerMode&&this.pager.cancelTimer(),"scroll"==this.pagerMode&&!1!==this.pager.loadDataSetByPager&&this.el.isMask()&&this.dataSet.isLoad&&this.hideLoadingMessage(),this.columnModel.clearCellConfig(),this.onRenderData(e),1==this.irregularScroll&&1==this.columnModel.merged&&this.redoRender()},onRenderData:function(e){Rui.isDebugTI&&Rui.log("grid start","time"),this.fireEvent("beforeRender"),e.options&&!0!==e.options.add&&(this.columnModel.cellConfig={}),this.doRenderData(e),e.options&&!0!==e.options.add&&this.scroller&&"scroll"!==this.pagerMode&&(Rui.rightToLeft()||this.scroller.setScrollLeft(0)),Rui.isDebugTI&&Rui.log("grid rendered","time"),this.fireEvent("rendered")},onChangeRenderData:function(e){e&&0==e.eventType&&this.scroller&&this.scroller.setScrollLeft(0),this.doRenderData(e),this.scroller&&this.scroller.onScrollX({isForce:!0}),e=null},onWidthResize:function(e){this.redoRender(!0)},doAddData:function(e){this.modifiedDate=new Date,this.redoRenderData({resetScroll:!0,isDataChanged:!0})},doCellUpdateData:function(e){var t=this.columnModel.getColumnById(e.colId);this.modifiedDate=new Date;var i=!0;t&&(t.vMerge||t.hMerge||t.summary)&&(i=!1);var l=this.summaryInfos;l&&i&&l.idColumns[e.colId]&&(i=!1);var s,o,r=this.getRenderRange();if(i){if(this._doCellUpdateData(e),this.irregularScroll&&((s=e.row>=e.target.getCount()-this.renderRange.visibleRowCount-1)&&(this.growedRowCount=0,this._temporaryGrowedCount=null),this.redoRenderData({resetScroll:s})),this.plugins)for(var n=0,d=this.plugins.length;n<d;n++)this.plugins[n].updatePlugin({isRendered:!1,isDataChanged:!0})}else t&&(o=this.getVisibleRow(e.row),r&&r.start<=o&&r.end>=o&&this.redoRenderData({resetScroll:!0,system:e.system,isDataChanged:!0}));t=e=null},_doCellUpdateData:function(e){var t=e.row,i=e.col,l=e.colId,s=e.record,o=this.getRenderRange(),r=this.getVisibleRow(t);if(o&&o.start<=r&&o.end>=r){0<=(i=this.columnModel.getIndexById(l,!0))&&this.doRenderCell(t,i,s);for(var n,d=this.cellMergeInfoSet,o=this.renderRange,a=0,h=this.columnModel.getColumnCount(!0);a<h;a++){!0===this.columnModel.getColumnAt(a,!0).renderRow&&(n=d?d[t-o.start][a]:void 0,this.doRenderCell(t,a,s,n),n=null)}}s=d=o=null},onUpdateCellConfig:function(e){if("editable"==e.key){if(!1===this.hasRows())return;if(-1<this.getVisibleRow(e.row)){if(!(i=this.getCellDom(e.row,e.col)))return;var t=Rui.get(i);!0===e.value?t.addClass(n.CELLP_CONFIG[e.key]):t.removeClass(n.CELLP_CONFIG[e.key]),i=t=null}}if("tooltipText"==e.key){if(!1===this.hasRows())return;var i;if(-1<this.getVisibleRow(e.row)){if(!(i=this.getCellDom(e.row,e.col)))return;t=Rui.get(i);Rui.isEmpty(e.value)?t.removeClass(n.CELLP_CONFIG[e.key]):t.addClass(n.CELLP_CONFIG[e.key])}}},onStateChanged:function(e){var t=e.row,i=e.col,l=e.colId,s=e.record;0<=(i=this.columnModel.getIndexById(l,!0))&&this.doRenderCell(t,i,s);for(var o,r=this.cellMergeInfoSet,n=this.renderRange,d=0,a=this.columnModel.getColumnCount(!0);d<a;d++){!0===this.columnModel.getColumnAt(d,!0).renderRow&&(o=r?r[t-n.start][d]:void 0,this.doRenderCell(t,d,s,o),o=null)}s=r=null},doRenderCell:function(e,t,i,l){this.setValue(e,t,this.getRenderCell(e,t,this.columnModel.getColumnCount(!0),i,l))},onRowUpdateData:function(e){var t=e.row,i=e.record,l=e.target,s=this.getRowDom(t);if(s){var o=this.getRenderRow(t,i,l.getCount()),r=document.createElement("div");r.innerHTML="<table>"+o+"</table>";for(var n=r.getElementsByTagName("tr")[0];0<s.childNodes.length;)h.removeNode(s.childNodes[0]);for(var d=Rui.get(s),a=0;a<n.childNodes.length;a++)d.appendChild(n.childNodes[a].cloneNode(!0));d=n=i=l=s=r=null}},doRemoveData:function(e){this.modifiedDate=new Date,this.redoRenderData({resetScroll:!0,isDataChanged:!0})},doUndoData:function(e){this.modifiedDate=new Date,this.redoRenderData({resetScroll:!0,isDataChanged:!0})},onCommitData:function(e){this.getBodyEl().select("."+n.CLASS_GRIDVIEW_CELL_EDITED).removeClass(n.CLASS_GRIDVIEW_CELL_EDITED)},onRowPosChangedData:function(e){var t;this.scroller||(t=this.selectionModel.getCol?this.selectionModel.getCol():0,this.syncFocusRow(e.row,t)),this.moveYScroll(e.row)},onAllMarked:function(e){if(!e.isSelect)for(var t,i=this.dataSet.getCount(),l=(n.CLASS_GRIDVIEW_ROW,n.CLASS_GRIDVIEW_ROW_SELECT_MARK),s=0;s<i;s++)this.dataSet.isMarked(s)||(t=this.dataSet.getAt(s).id,Rui.select(".L-grid-row-"+t+"."+l).removeClass(l))},onFieldsChanged:function(e){this.updateView()},onBodyMouseOver:function(e){var t;!0===this.getColumnModel().isMerged()||!1===this.rowHoverStyle||(t=this.findRowDom(e.target,e.pageY))&&(h.addClass(t,n.CLASS_GRIDVIEW_ROW_OVER),t=e=null)},onBodyMouseOut:function(e){var t;!0===this.getColumnModel().isMerged()||!1===this.rowHoverStyle||(t=this.findRowDom(e.target,e.pageY))&&(h.removeClass(t,n.CLASS_GRIDVIEW_ROW_OVER),t=e=null)},onHeaderMouseOver:function(e){var t=this.findHeaderCellDom(e.target);t&&!this.headerDisabled&&(this.activeHeaderColumnIndex=this.getCell(t,e.pageX),-1<this.activeHeaderColumnIndex&&(this.activeHeaderEl=Rui.get(t)),h.addClass(t,n.CLASS_GRIDVIEW_HEADER_OVER)),t=e=null},onHeaderMouseMove:function(e){var t,i,l,s;!this.headerDisabled&&-1<this.activeHeaderColumnIndex&&this.activeHeaderEl&&this.useColumnResize&&(t=this.activeHeaderEl.getRegion(),i=this.activeHeaderColumnIndex,(l=this.columnModel.getColumnAt(i,!0))&&(0<i&&this.columnModel.getColumnAt(i-1,!0).isResizable(),s=Rui.util.LEvent.getPageX(e),t.right-s<=this.resizeHandleWidth&&l.isResizable()?(this.activeHeaderEl.setStyle("cursor","col-resize"),this._useColumnDD=!1):(this.activeHeaderEl.setStyle("cursor",""),this._useColumnDD=!0)),t=l=e=null)},onHeaderMouseOut:function(e){var t=this.findHeaderCellDom(e.target);t&&(h.setStyle(t,"cursor",""),h.removeClass(t,n.CLASS_GRIDVIEW_HEADER_OVER),this.activeHeaderEl=null,this.activeHeaderColumnIndex=-1,t=null)},onHeaderClick:function(e){var t=Rui.get(e.event.target);try{if("col-resize"==t.getStyle("cursor")||!1===e.col)return;t.hasClass("L-grid-sort-icon")&&this.doSortField(e.col)}finally{t=e=null}},onHeaderDblClick:function(e){var t,i=Rui.get(e.event.target);try{"col-resize"==i.getStyle("cursor")&&(t=this.activeHeaderColumnIndex,this.updateColumnFit(t))}finally{i=e=null}},onBodyScroll:function(e){this.syncHeaderScroll(),this.fireEvent("bodyScroll")},onScrollX:function(e){this.onBodyScroll(e),this.fireEvent("scrollX",e)},onScrollY:function(e){try{var t;"scroll"===this.pagerMode?this.pager.timerGoPage(e):(this.redoRenderData(),Rui.platform.isMobile&&!1!==this.gridScrollMessage&&(e.isFirst?t=Rui.getMessageManager().get("$.base.msg126"):e.isEnd&&(t=Rui.getMessageManager().get("$.base.msg127")),t&&Rui.later(600,this,function(){this.gridPanel.toast(t,{delay:700})}))),this.fireEvent("scrollY",e)}catch(e){Rui.log(e.message)}},columnAddListener:function(){for(var e=this.columnModel,t=0,i=e.getColumnCount();t<i;t++){(s=e.getColumnAt(t)).unOn("hidden",this.onColumnHidden,this),s.on("hidden",this.onColumnHidden,this,!0),s.unOn("sortable",this.onColumnSortable,this),s.on("sortable",this.onColumnSortable,this,!0),s.unOn("label",this.onUpdateColumnLabel,this),s.on("label",this.onUpdateColumnLabel,this,!0),s=null}if(e.isMultiheader()){var l=e.getBasicColumnModel();if(l)for(var s,t=0,i=l.getColumnCount();t<i;t++){"data"!=(s=l.getColumnAt(t)).getColumnType()&&(s.unOn("label",this.onUpdateColumnLabel,this,!0),s.on("label",this.onUpdateColumnLabel,this,!0)),s=null}l=null}e=null},onColumnHidden:function(e){this.modifiedDate=new Date,this.redoRender()},onColumnSortable:function(e){var t=e.target,i=this.el.select(".L-grid-cell-"+t.id);e.sortable?i.addClass("L-grid-cell-sortable"):i.removeClass("L-grid-cell-sortable"),t=i=e=null},onUpdateColumnLabel:function(e){var t=e.target;this.getHeaderEl().select(".L-grid-header-"+t.id+" a").html(e.label),t=e=null},onRowSelect:function(e){if(this.addRowClass(e,n.CLASS_GRIDVIEW_ROW_SELECTED),!0===this.selectionMergedCell&&this.cellMergeInfoSet&&this.getColumnModel().isMerged()&&0<e){var t=this.getRenderedRow(e),i=this.cellMergeInfoSet[t];if(!i)return;for(var l,s,o=0,r=i.length;o<r;o++){(s=i[o]).rowspan<0&&(l=this.getCellDom(e+s.rowspan,o),h.addClass(l,"L-grid-merged-cell-selected"),l=null),s=null}s=null}},onRowDeselect:function(e){if(this.removeRowClass(e,n.CLASS_GRIDVIEW_ROW_SELECTED),!0===this.selectionMergedCell&&this.cellMergeInfoSet&&this.getColumnModel().isMerged()&&0<e){var t=this.getRenderedRow(e),i=this.cellMergeInfoSet[t];if(!i)return;for(var l,s,o=0,r=i.length;o<r;o++){(s=i[o]).rowspan<0&&(l=this.getCellDom(e+s.rowspan,o),h.removeClass(l,"L-grid-merged-cell-selected"),l=null)}s=null}},onCellClick:function(e){var t,i,l,s;this.scroller&&(t=e.row,this.dataSet.getRow()==t&&(t!=this.getDataCount()-1&&0!=t||(i=this.scroller,l=Rui.get(this.getRowDom(t,1)).getRegion(),!i||(s=i.getScrollRegion())&&(0==t?l.top<s.top&&i.goStart():l.bottom>s.bottom-i.getSpace("bottom")&&i.goEnd()),i=l=s=null)),-1<this.columnModel.freezeIndex&&this.columnModel.freezeIndex>=e.col&&this.scroller.setScrollLeft(0))},onCellSelect:function(e,t){var i,l=this.renderRange,s=this.getVisibleRow(e);(!1===this.isVirtualScroll||l&&l.start<=s&&l.end>=s)&&(this.addCellClass(e,t,n.CLASS_GRIDVIEW_CELL_SELECTED),!Rui.useAccessibility()||(i=this.getCellDom(e,t))&&i.setAttribute("aria-selected",!0))},onCellDeselect:function(e,t){var i,l=this.renderRange,s=this.getVisibleRow(e);(!1===this.isVirtualScroll||l&&l.start<=s&&l.end>=s)&&(this.removeCellClass(e,t,n.CLASS_GRIDVIEW_CELL_SELECTED),!Rui.useAccessibility()||(i=this.getCellDom(e,t))&&i.setAttribute("aria-selected",!1))},onMark:function(e){var t,i,l=this.renderRange,s=this.getVisibleRow(e);(!1===this.isVirtualScroll||l&&l.start<=s&&l.end>=s)&&(this.addRowClass(e,n.CLASS_GRIDVIEW_ROW_SELECT_MARK),this.headerSelectionMarkEvent&&(t=this.columnModel.getColumnById("selection"),this.dataSet.getCount()-1==this.dataSet.selectedData.length&&(i=this.columnModel.getIndex(t),this.getHeaderCellEl(i)),t=null))},onDemark:function(e){var t,i,l=this.renderRange,s=this.getVisibleRow(e);(!1===this.isVirtualScroll||l&&l.start<=s&&l.end>=s)&&(this.removeRowClass(e,n.CLASS_GRIDVIEW_ROW_SELECT_MARK),this.headerSelectionMarkEvent&&((t=this.columnModel.getColumnById("selection"))&&this.dataSet.selectedData.length<1&&(i=this.columnModel.getIndex(t),this.getHeaderCellEl(i)),t=null))},onCheckFocus:function(e){this.isFocus||(this.onFocus.call(this,e),this.isFocus=!0,Rui.util.LEvent.addListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur,this,!0))},onInvalid:function(e){var t,i=this.renderRange,l=this.getVisibleRow(e.row);(!1===this.isVirtualScroll||i&&i.start<=l&&i.end>=l)&&this.columnModel.getColumnById(e.colId)&&(t=this.columnModel.getIndexById(e.colId,!0),this.addCellClass(e.row,t,"L-invalid"),this.addCellAlt(e.row,t,e.message),Rui.useAccessibility()&&this.getCellDom(e.row,t).setAttribute("aria-invalid",!0))},onValid:function(e){var t,i=this.renderRange,l=this.getVisibleRow(e.row);(!1===this.isVirtualScroll||i&&i.start<=l&&i.end>=l)&&this.columnModel.getColumnById(e.colId)&&(t=this.columnModel.getIndexById(e.colId,!0),this.removeCellClass(e.row,t,"L-invalid"),this.removeCellAlt(e.row,t),Rui.useAccessibility()&&this.getCellDom(e.row,t).setAttribute("aria-invalid",!1))},onColumnResize:function(e){this.gridPanel.onColumnResize(e);var t=this.scroller?this.scroller.getScrollLeft():0;this.redoRender(!1,t)},onColumnMove:function(e){this.gridPanel.onColumnMove(e);var t=this.scroller?this.scroller.getScrollLeft():0;this.redoRender(!1,t)},onColumnsChanged:function(e){this.modifiedDate=new Date,this.redoRender(!0)},deferOnBlur:function(e){Rui.util.LFunction.defer(this.checkBlur,20,this,[e])},checkBlur:function(e){if(1!=e.deferCancelBubble&&!0===this.isFocus){var t=e.target;try{var i=Rui.get(t);if(i.hasClass("L-ignore-blur"))return;if(!(null==i&&Rui.browser.msie678)&&i.hasClass(n.CLASS_GRIDVIEW_CELL))return;if(this.el.isAncestor(t))e.deferCancelBubble=!0;else{if(!1===this.onCanBlur(e))return;this.onBlur.call(this,e)}}finally{t=e=null}}},onBlur:function(e){Rui.util.LEvent.removeListener(Rui.browser.msie?document.body:document,"mousedown",this.deferOnBlur),Rui.ui.grid.LBufferGridView.superclass.onBlur.call(this,e)}})}(),function(){var E=Rui.util.LDom,y=Rui.util.LEvent,L=Rui.ui.grid.LBufferGridView;Rui.ui.grid.LSelectionModel=function(e){e=e||{},Rui.applyObject(this,e,!0),Rui.ui.grid.LSelectionModel.superclass.constructor.call(this),this.createEvent("selectRow"),this.createEvent("deselectRow"),this.createEvent("selectCell"),this.createEvent("deselectCell"),e=null},Rui.extend(Rui.ui.grid.LSelectionModel,Rui.util.LEventProvider,{locked:!1,otype:"Rui.ui.grid.LSelectionModel",marked:!1,pageUpDownRow:10,oldRow:-1,oldCell:0,currentCol:0,tabToMove:!0,enterToMove:!0,selection:{},init:function(e){this.gridPanel=e,this.view=e.getView(),this.oldRow=e.getView().getDataSet().getRow(),this.initEvents()},initEvents:function(){var e=this.gridPanel.getView(),t=Rui.browser.msie||Rui.browser.chrome||Rui.browser.safari&&3==Rui.browser.version?"keydown":"keypress";this.gridPanel.unOn(t,this.onKeydown,this),this.gridPanel.on(t,this.onKeydown,this,!0,{system:!0}),this.gridPanel.unOn("headerClick",this.onHdMouseDown,this),this.gridPanel.on("headerClick",this.onHdMouseDown,this,!0,{system:!0}),this.gridPanel.unOn("cellClick",this.onBodyMouseDown,this),this.gridPanel.on("cellClick",this.onBodyMouseDown,this,!0,{system:!0});var i=e.columnModel.getColumnById("selection");i&&"radio"==i.selectionType&&(this.selectOne=!0),this.gridPanel.unOn("rowClick",this.onRowClick,this),this.gridPanel.on("rowClick",this.onRowClick,this,!0,{system:!0}),this.gridPanel.unOn("cellClick",this.onCellClick,this),this.gridPanel.on("cellClick",this.onCellClick,this,!0,{system:!0}),this.gridPanel.columnModel.unOn("columnMove",this.onRemoveSelectionAll,this),this.gridPanel.columnModel.on("columnMove",this.onRemoveSelectionAll,this,!0,{system:!0}),this.doSetSyncDataSet(!0),e=i=null},doSetSyncDataSet:function(e){e?this.unlock():this.lock();var t=this.gridPanel.getView().getDataSet();t.unOn("add",this.onAdd,this),t.unOn("rowPosChanged",this.onRowPosChanged,this),t.unOn("marked",this.onMarked,this),t.unOn("load",this.onLoad,this),t.unOn("dataChanged",this.onRemoveSelectionAll,this),t.unOn("remove",this.onRemoveSelectionAll,this),t.unOn("undo",this.onRemoveSelectionAll,this),t.unOn("commit",this.onRemoveSelectionAll,this),e&&(t.on("add",this.onAdd,this,!0,{system:!0}),t.on("rowPosChanged",this.onRowPosChanged,this,!0,{system:!0}),t.on("marked",this.onMarked,this,!0,{system:!0}),t.on("load",this.onLoad,this,!0,{system:!0}),t.on("dataChanged",this.onRemoveSelectionAll,this,!0,{system:!0}),t.on("remove",this.onRemoveSelectionAll,this,!0,{system:!0}),t.on("undo",this.onRemoveSelectionAll,this,!0,{system:!0}),t.on("commit",this.onRemoveSelectionAll,this,!0,{system:!0})),t=null},onLoad:function(e){e.add||(this.currentCol=0),this.onRemoveSelectionAll(e)},onRemoveSelectionAll:function(e){this.selection={},this.isSelectionData=!1},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},isLocked:function(){return this.locked},onRowClick:function(e){},onCellClick:function(e){var t=e.event?e.event:e;"click"!=t.type||!0!==t.ctrlKey&&!0!==t.shiftKey||this.selectCell(e.row,e.col),e=null},onAdd:function(e){this.onRemoveSelectionAll(e);var t=e.row,i=this.gridPanel.getSelectionModel(),l=this.gridPanel.dataSet,s=i.currentCol;l.getRow()<e.row?(this.deSelectRow(e.currentRow),this.doDeSelectCell(e.currentRow,s)):(this.deSelectRow(e.currentRow+1),this.doDeSelectCell(e.currentRow+1,s)),this.delayTask||(this.delayTask=new Rui.util.LDelayedTask(function(){this.doSelectCell(t,s),this.oldRow!=t&&(this.oldRow=t),this.view.focusRow(t,s),this.delayTask=null},this),this.delayTask.delay(250)),i=null},onRowPosChanged:function(e){this.doMoveSelectRow(e.oldRow,e.row)},doMoveSelectRow:function(e,t){var i;this.isMoveCell||(i=this.currentCol,!0!==this.isMultiCell&&-1<e&&(this.deSelectRow(e),this.doDeSelectCell(e,this.currentCol)),this.isMultiCell=!1,this.selectRow(t),!0!==this._processSelectCell&&this.doSelectCell(t,i),this.oldRow!=t&&(this.oldRow=t))},doFocusRow:function(e){},selectRow:function(e){this.view.onRowSelect(e),this.doFocusRow(e),this.currentRow=e,this.fireEvent("selectRow",{target:this,row:e})},deSelectRow:function(e){this.view.onRowDeselect(e),this.fireEvent("deselectRow",{target:this,row:e})},selectCell:function(e,t){var i=this.view.getDataSet();if(!(e<0||e>i.getCount()-1)){var l=this.doSelectCell(e,t);return l&&(this.currentRow=e,this.currentCol=t),i=null,l}},doSelectCell:function(e,t){if(this._selectCell)return!1;if(e<0)return!1;var i=this.gridPanel.columnModel,l=this.view;if(t<0||t>i.getColumnCount(!0)-1)return!1;var s=l.getDataSet();this._selectCell=!0,l.onCellSelect(e,t);var o,r,n=e,d=void 0;return-1<e&&(d=i.getColumnAt(t,!0).id,(o=s.getAt(e))&&(r=o.id,d&&(this.selection[r]||(this.selection[r]={},this.selection[r].cellCount=0),!0!==this.selection[r][d]&&(this.selection[r][d]=!0,this.selection[r].cellCount++,this.isSelectionData=!0)),n=!0===l.isVirtualView?s.indexOfKey(o.id):e),o=null),this.fireEvent("selectCell",{target:this,row:n,col:t,colId:d}),delete this._selectCell,!(i=s=null)},doDeSelectCell:function(e,t){var i,l,s,o,r,n,d,a=this.gridPanel.columnModel,h=this.view;t<0||t>a.getColumnCount(!0)-1||e<0||(h.onCellDeselect(e,t),i=h.getDataSet(),-1<(l=e)&&((s=h.getRowRecord(e))&&(o=s.id,n=(r=a.getColumnAt(t,!0)).id||r.field,(d=this.selection[o])&&!0===d[n]&&(delete d[n],d.cellCount--,0==d.cellCount&&delete this.selection[o]),l=!0===h.isVirtualView?i.indexOfKey(s.id):e,r=d=null)),this.fireEvent("deselectCell",{target:this,row:l,col:t}),a=h=i=null)},hasSelectedCell:function(e,t){var i=this.view,l=i.getDataSet(),s=i.columnModel;if(e<0||t<0||e>i.getDataCount()-1)return!1;var o=l.getAt(e).id,r=s.getColumnAt(t).id,n=this.selection[o];try{return n?!0===n[r]:!1}finally{l=n=null}},doRowSelectionCell:function(e,t){for(var i=this.gridPanel.columnModel,l=(this.view.getDataSet(),0),s=i.getColumnCount();l<s;l++){i.getColumnAt(l)&&(!0===t?this.doDeSelectCell(e,l):this.doSelectCell(e,l)),0}i=null},onTabMoveCell:function(e){if(!this.isLocked()){var t=this.gridPanel,i=Rui.util.LKey.NAVKEY,l=t.getView().getDataSet();try{var s=e.keyCode!==i.RIGHT&&!0===e.shiftKey?-1:1,o=this.currentCol;o=this.getVisibleColIndex(o,s);var r=l.getRow(),n=this.gridPanel.getSelectionModel(),d=n.getRow(),a=n.getCol();if(o<0){o=0<s?0:this.view.columnModel.getColumnCount(!0)-1;if((r+=s)<0||r>this.getDataCount())return}if(o<0)return;!0!==e.ctrlKey&&!0!==e.shiftKey&&this.clearSelection(),this.doDeSelectCell(d,a),t.doSelectCell(r,o)}finally{t=l=null}}},getVisibleColIndex:function(e,t){return e<0||e>this.view.columnModel.getColumnCount(!0)-1||null==this.view.columnModel.getColumnAt(e+t,!0)?-1:e+t},onKeydown:function(e){if((y.isNavKey(e)||1==e.ctrlKey||1==e.shiftKey||113===e.keyCode||46===e.keyCode)&&!this.isLocked()){var t=this.gridPanel;if(!0===t.useMultiCellDeletable||46!=e.keyCode){var i=t.columnModel,l=this.view,s=l.getDataSet();if(1!=t.isEdit){var o,r=Rui.util.LKey.NAVKEY,n=this.getRow(),d=this.getCol();switch(e.keyCode){case r.DOWN:(o=this.getMoveRow(n,1))<l.getDataCount()&&(!0!==e.ctrlKey&&!0!==e.shiftKey&&this.clearSelection(),t.doSelectCell(o,this.currentCol,!e.shiftKey&&void 0),t.systemSelect=!0),t.focusRow(),y.stopEvent(e);break;case r.UP:-1<(o=this.getMoveRow(n,-1))&&(!0!==e.ctrlKey&&!0!==e.shiftKey&&this.clearSelection(),t.doSelectCell(o,this.currentCol,!e.shiftKey&&void 0),t.systemSelect=!0),t.focusRow(),y.stopEvent(e);break;case r.PAGE_DOWN:this.onPageDown(e),t.focusRow(),y.stopEvent(e);break;case r.PAGE_UP:this.onPageUp(e),t.focusRow(),y.stopEvent(e);break;case r.HOME:e.ctrlKey&&t.doSelectCell(l.getVisibleRow(0),0),t.doSelectCell(s.getRow(),0);break;case r.END:if(e.ctrlKey)t.doSelectCell(l.getDataCount()-1,i.getColumnCount(!0)-1);else for(var a=i.getColumnCount(!0)-1;-1<a;a--){var h=i.getColumnAt(a,!0);if(!Rui.isUndefined(h)){t.doSelectCell(s.getRow(),a);break}}break;case r.LEFT:var u=e.keyCode==r.LEFT?-1:1,c=this.currentCol;if((c=this.getVisibleColIndex(c,u))<0)return;this.currentCol!==c&&!0!==e.ctrlKey&&!0!==e.shiftKey&&this.clearSelection(),t.doSelectCell(s.getRow(),c,!e.shiftKey&&void 0),t.focusRow();break;case r.RIGHT:this.onTabMoveCell(e),t.focusRow();break;case r.TAB:!0!==this.tabToMove||Rui.useAccessibility()||(this.onTabMoveCell(e),t.focusRow());break;case 113:case r.ENTER:1!=t.isEdit&&t.startEditor(n,d);break;case 70:t.showSearchDialog();break;case 46:t.multiCellDeletable()}if(!0===e.ctrlKey||!0===e.shiftKey)switch(y.getCharCode(e)){case 97:case 65:var g=l.dataSet,f=this.getDataCount();"scroll"===this.view.pagerMode&&f>this.view.pager.pageSize&&(f=this.view.pager.pageSize);for(var m=g.getAt(f-1).id,C=f-1,n=0;n<=C;n++){var R=l.getRowRecord(n),v=!0===l.isVirtualView?g.indexOfKey(R.id):n;if(this.doRowSelectionCell(v,e.shiftKey),R.id==m)break}}y.stopEvent(e),s=i=t=null}}}},onPageUp:function(e){var t=this.gridPanel.getView(),i=t.getDataSet(),l=t.getIrregularRowHeight?t.getIrregularRowHeight(!1):null,s=t.getVisibleRowCount?t.getVisibleRowCount(!0,l):this.pageUpDownRow,o=this.getMoveRow(i.getRow(),-s);(o=o<0?0:o)!==i.getRow()&&!0!==e.ctrlKey&&!0!==e.shiftKey&&this.clearSelection(),t.getDataSet().setRow(o),i=t=null},onPageDown:function(e){var t=this.gridPanel.getView(),i=t.getDataSet(),l=t.getIrregularRowHeight?t.getIrregularRowHeight(!1):null,s=t.getVisibleRowCount?t.getVisibleRowCount(!0,l):this.pageUpDownRow,o=this.getMoveRow(i.getRow(),s);(o=o>t.getDataCount()-1?t.getDataCount()-1:o)!==i.getRow()&&!0!==e.ctrlKey&&!0!==e.shiftKey&&this.clearSelection(),t.getDataSet().setRow(o),i=t=null},onHdMouseDown:function(e){if(!this.isLocked()){var t=e.event;if(E.hasClass(t.target,"L-grid-header-checkBox")){var i=this.view;if(0==i.isSyncDataSet())return;if(!i.findCellDom(t.target))return;var l=i.getDataSet();Rui.get(t.target).findParent(".L-grid-header-selection",3).hasClass("L-grid-header-checkBox-mark")?l.setMarkAll(!1):l.setMarkAll(!0),i=l=null}t=null}},onBodyMouseDown:function(e){if(!(this.isLocked()||e.target&&e.target.className&&-1<e.target.className.indexOf("L-ignore-event"))){var t=this.gridPanel;1==t.isEdit&&t.stopEditor(!0);var i=(e=e.event?e.event:e).target,l=e.pageX,s=e.pageY;if(!E.hasClass(i,"L-grid-row-select-ignore")){var o=this.view;if(0!=o.isSyncDataSet()){var r=o.getDataSet(),n=o.findRow(i,s),d=o.findCell(i,l);if((E.hasClass(i,"L-grid-row-checkBox")||E.hasClass(i,"L-grid-row-radio"))&&!E.hasClass(i,"L-grid-row-checkBox-disabled")&&!E.hasClass(i,"L-grid-row-radio-disabled"))if(!0===e.ctrlKey)-1<n&&(r.isMarked(n)?this.selectOne?r.setMarkOnly(n,!1):r.setMark(n,!1):this.selectOne?r.setMarkOnly(n,!0):r.setMark(n,!0));else if(!0===e.shiftKey){if(-1<n)for(var a=r.rowPosition,h=!r.isMarked(n),u=n;-1<u&&a<=u;u--)this.selectOne?r.setMarkOnly(u,h):r.setMark(u,h)}else r.isMarked(n)?this.selectOne?r.setMarkOnly(n,!1):r.setMark(n,!1):(-1<this.oldMark&&this.oldMark<this.view.getDataCount()&&(this.selectOne?r.setMarkOnly(this.oldMark,!1):r.setMark(this.oldMark,!1)),this.selectOne?r.setMarkOnly(n,!0):r.setMark(n,!0),E.hasClass(i,"L-grid-row-radio")&&(this.oldMark=n,this.doMoveRow(n)));!0!==e.ctrlKey&&!0!==e.shiftKey&&!E.hasClass(i,"L-grid-row-checkBox")&&!E.hasClass(i,"L-grid-row-radio")&&-1<n&&this.doMoveRow(n);try{if(n<0||d<0)return;var c=t.columnModel.getColumnAt(d,!0);if(c&&c.editor&&c.editable&&y.preventDefault(e),!0!==e.ctrlKey&&!0!==e.shiftKey)this.clearSelection();else if(!0===e.ctrlKey)!0===t.enableCtrlKey&&(Rui.get(o.getCellDom(n,d)).hasClass(L.CLASS_GRIDVIEW_CELL_SELECTED)?this.doDeSelectCell(n,d):this.doSelectCell(n,d));else if(!0===e.shiftKey&&(this.clearSelection(),!0===t.enableShiftKey)){var g=this.currentRow,f=this.currentCol;this.isMultiCell=!0;for(var m=o.dataSet,C=m.getAt(n).id,a=g,R=o.getDataCount();a<=R;a++){for(var v=o.getRowRecord(a),p=!0===o.isVirtualView?m.indexOfKey(v.id):a,S=f;S<=d;S++)this.doSelectCell(p,S);if(v.id==C)break;v=null}-1<this.oldRow&&this.deSelectRow(this.oldRow);try{E.setSelectionRange(document.body,0,0);var w=window.getSelection();w&&w.removeAllRanges()}catch(e){}}}catch(e){Rui.log(Rui.dump(e))}finally{t=o=r=null}}}}},clearSelection:function(){!0===this.isSelectionData&&this.view.getBodyEl().select("."+L.CLASS_GRIDVIEW_CELL_SELECTED).removeClass(L.CLASS_GRIDVIEW_CELL_SELECTED),this.selection={},this.isSelectionData=!1},doMoveRow:function(e){},onMarked:function(e){!0===e.isSelect?this.doMarked(e.row):this.deDemarked(e.row)},doMarked:function(e){this.view.onMark(e)},deDemarked:function(e){this.view.onDemark(e)},getRow:function(){return this.gridPanel.getView().getDataSet().getRow()},getDataCount:function(){return this.view.getDataCount()},getSelection:function(){return this.selection},getCol:function(){return this.currentCol},getColId:function(){var e=this.gridPanel.columnModel;if(this.currentCol<0)return null;var t=e.getColumnAt(this.currentCol,!0);return t?t.getId():null},getMoveRow:function(e,t){return e+t},destroy:function(){var e;this.gridPanel&&(e=Rui.browser.msie||Rui.browser.chrome||Rui.browser.safari&&3==Rui.browser.version?"keydown":"keypress",this.gridPanel.unOn(e,this.onKeydown,this),this.gridPanel.unOn("headerClick",this.onHdMouseDown,this),this.gridPanel.unOn("cellClick",this.onBodyMouseDown,this),this.gridPanel.unOn("rowClick",this.onRowClick,this),this.gridPanel.unOn("cellClick",this.onCellClick,this),this.gridPanel.columnModel.unOn("columnMove",this.onRemoveSelectionAll,this));var t,i=this.gridPanel.getView();i&&((t=i.getDataSet()).unOn("add",this.onAdd,this),t.unOn("rowPosChanged",this.onRowPosChanged,this),t.unOn("marked",this.onMarked,this),t.unOn("load",this.onRemoveSelectionAll,this),t.unOn("dataChanged",this.onRemoveSelectionAll,this),t.unOn("remove",this.onRemoveSelectionAll,this),t.unOn("undo",this.onRemoveSelectionAll,this),t.unOn("commit",this.onRemoveSelectionAll,this)),Rui.ui.grid.LSelectionModel.superclass.destroy.call(this)}})}(),function(){var v=Rui.util.LDom,p=Rui.util.LEvent;Rui.ui.grid.LGridPanel=function(e){var t=e||{};Rui.applyIf(t,{id:Rui.id(),visible:!0,draggable:!1,underlay:"",close:!1,width:0,height:0,viewConfig:{}}),!0===(t=Rui.applyIf(t,Rui.getConfig().getFirst("$.ext.gridPanel.defaultProperties"))).autoWidth&&delete t.width,Rui.applyObject(t.viewConfig,t,!0),Rui.applyObject(this,t,!0),this.createEvent("click"),this.createEvent("dblclick"),this.createEvent("mousedown"),this.createEvent("mouseup"),this.createEvent("mouseover"),this.createEvent("mouseout"),this.createEvent("cellMouseDown"),this.createEvent("rowMouseDown"),this.createEvent("headerMouseDown"),this.createEvent("cellClick"),this.createEvent("cellDblClick"),this.createEvent("rowClick"),this.createEvent("rowDblClick"),this.createEvent("headerClick"),this.createEvent("headerDblClick"),this.createEvent("copy"),this.createEvent("paste"),this.createEvent("keydown"),this.createEvent("keypress"),this.createEvent("widthResize"),this.createEvent("beforeEdit"),this.createEvent("popup"),this.createEvent("pasteCell"),this.createEvent("pasteCompleted"),Rui.ui.grid.LGridPanel.superclass.constructor.call(this,t),t=null},Rui.extend(Rui.ui.grid.LGridPanel,Rui.ui.LPanel,{otype:"Rui.ui.grid.LGridPanel",view:null,columnModel:null,rowModel:null,borderWidth:0,selectionModel:null,autoWidth:!1,autoHeight:!1,autoHeightParentId:null,rtrimWhiteSpace:!0,clickToEdit:!0,autoToEdit:!1,enterToEdit:!0,isEdit:!1,editable:null,skipRowCellEvent:!0,rendererConfig:!0,systemSelect:!0,tooltip:null,stopEventBubble:!1,mouseEvent:!1,virtualClipboard:!0,contentResizeWidth:-1,multiLineEditor:!1,useClipboard:!0,clipValue:null,useMultiCellDeletable:!1,usePasteCellEvent:!1,usePaste:!0,useRightActionMenu:!0,tabletMode:!0,tabletViewerUrl:null,enableCtrlKey:!0,enableShiftKey:!0,gridId:null,CLASS_GRID_ROW_EDITABLE:"L-grid-row-editable",CLASS_GRID_CELL_EDITABLE:"L-grid-cell-editable",initComponent:function(e){Rui.ui.grid.LGridPanel.superclass.initComponent.call(this),this.columnModel.gridPanel=this,e&&this.cfg.applyConfig(e,!0)},initEvents:function(){Rui.ui.grid.LGridPanel.superclass.initEvents.call(this),this.on("headerMouseDown",this.onApplyStopEditor,this,!0),this.on("headerClick",this.onApplyStopEditor,this,!0)},doRender:function(e){Rui.ui.grid.LGridPanel.superclass.doRender.call(this,e),this.fireEvent("beforeInit",{target:this}),v.addClass(this.element,"L-grid-panel"),this._insertBody("");var t=this.getView();this.getSelectionModel().init(this),this.initBodyEvent(),t.setPanel(this),t.on("focus",function(e){var t,i,l;e.target&&(Rui.get(e.target).hasClass("L-ignore-event")||(t=this.getView(),i=this.getSelectionModel(),(l=this.columnModel.getColumnAt(i.getCol(),!0))&&!1!==l.ignoreViewFocus||!1!==window.isRuiBlur?t.focusRow(i.getRow(),i.getCol()):t.cancelViewFocus(),p.addListener(Rui.getBody(!0),"selectstart",this.onSelectStart,this,!0)))},this,!0),this.editable=Rui.isNull(this.editable)?this.columnModel._isEditable:this.editable;var i,l=this.el?Rui.util.LDom.getHiddenParent(this.el):null;l&&(l=Rui.get(l)).addClass("L-block-display"),this.updateSizes(),this.footerBar&&this.footerBar.init(this),this.autoHeight&&(this.availableHeight(this.autoHeightParentId),this.fillHeight()),!0!==t.fitContentHeight&&(i=Rui.get(this.body).getHeight(),t.cfg.queueProperty("height",i),t.height=i),this.width&&(t.cfg.queueProperty("width",this.width),t.width=this.width),t.render(this.body),l&&l.removeClass("L-block-display");for(var s=this.columnModel,o=0,r=s.getColumnCount();o<r;o++){var n=s.getColumnAt(o);n.editor&&n.editor.gridFixed&&(n.editor.gridFieldId=n.id,n.editor.gridBindEvent(this))}this.reMon||!0!==this.autoWidth||(this.reMon=new Rui.util.LResizeMonitor,this.reMon.monitor(this.element),this.reMon.on("contentResized",this.onContentResized,this,!0)),!0===this.autoWidth&&Rui.browser.msie&&Rui.later(1e3,this,this._onContentResized),this.actionMenuGrid||(this.actionMenuGrid=Rui.ui.LActionMenuSupport.createActionMenu(this)),t=null},afterRender:function(e){Rui.ui.grid.LGridPanel.superclass.afterRender.call(this,e);var t=this.getView(),i=t.getDataSet();this.gridId=this.dom.parentNode.id,t.columnDD&&t.columnDD.on("startDragEvent",this.onApplyStopEditor,this,!0),!0!==this.skipRowCellEvent&&t.on("renderRow",function(e){e.css.push(this.CLASS_GRID_ROW_EDITABLE)},this,!0),t.on("blur",this.onViewBlur,this,!0),t.on("redoRender",this.onRedoRender,this,!0),this.onRedoRender(),this.on("cellClick",this.onCellclick,this,!0,{system:!0}),this.on("cellDblClick",this.onCelldblclick,this,!0,{system:!0}),i.on("canRowPosChange",this.onApplyStopEditor,this,!0,{system:!0}),this.initColumns(),Rui.devGuide(this,"LGridPanel_afterRender"),t=i=null},initBodyEvent:function(){this.bodyEl=Rui.get(this.body),this.bodyEl.on("mousedown",this.onMouseDown,this,!0,{system:!0}),this.mouseEvent&&(this.bodyEl.on("mouseup",this.onMouseUp,this,!0,{system:!0}),this.bodyEl.on("mouseover",this.onMouseOver,this,!0,{system:!0}),this.bodyEl.on("mouseout",this.onMouseOut,this,!0,{system:!0})),this.bodyEl.on("paste",this.onPaste,this,!0,{system:!0}),this.bodyEl.on("click",this.onClick,this,!0,{system:!0}),this.bodyEl.on("dblclick",this.onDblClick,this,!0,{system:!0}),this.bodyEl.on("contextMenu",this.onContextMenu,this,!0,{system:!0}),this.bodyEl.on("keydown",this.onCopyPaste,this,!0,{system:!0}),this.bodyEl.on("keydown",this.onKeyDown,this,!0,{system:!0}),this.bodyEl.on("keypress",this.onKeypress,this,!0,{system:!0})},onPaste:function(e){this.stopEditor(!1),this.clipboardToLoad(!1,e)},_onContentResized:function(){this.onContentResized()},onRedoRender:function(e){var t=this.getView();t.scroller&&(t.scroller.unOn("scrollX",this.onReStartEditor,this),t.scroller.on("scrollX",this.onReStartEditor,this,!0),t.scroller.unOn("scrollY",this.onReStartEditor,this),t.scroller.on("scrollY",this.onReStartEditor,this,!0)),this.fragmentToEditor(),t=null},onContentResized:function(e){var t,i;this.contentResizeCount=this.contentResizeCount||0,0==this.contentResizeCount&&(this.contentResizeModifiedTime=new Date),(new Date).getTime()-this.contentResizeModifiedTime.getTime()<1e3?this.contentResizeCount++:this.contentResizeCount=0,10<this.contentResizeCount?Rui.devGuide(this,"LGridPanel_onContentResized"):(this.reMon&&(this.reMon.resizeLock=!0),this.updateWidth(),t=this.getView(),this.width&&t._rendered&&(i=this.width,this.oldWidth!=i&&Math.abs(this.oldWidth-i)>this.contentResizeWidth&&t.setWidth(this.width),this.updateColumnsAutoWidth()),this.fillHeight(),this.fireEvent("widthResize",{target:this,event:e}),this.reMon&&(this.reMon.resizeLock=!1),t=null)},doRedoRender:function(){this.editorToFragment()},getSelectionModel:function(){return null==this.selectionModel&&(this.selectionModel=new Rui.ui.grid.LSelectionModel),this.selectionModel},invokeEvent:function(e,t){this.fireEvent(e.toLowerCase(),t);var i,l,s,o,r=this.view,n=r.findHeaderCell(t.target,t.pageX),d=e.charAt(0).toUpperCase()+e.substring(1);-1<n?this.fireEvent("header"+d,{target:this,col:n,event:t}):(i=r.findRow(t.target,p.getPageY(t)),l=r.findCell(t.target,p.getPageX(t)),-1<i&&(this.fireEvent("row"+d,{target:this,row:i,event:t}),-1<l&&(o=null,(s=r.columnModel.getColumnAt(l,!0))&&(o=s.id),!1===this.fireEvent("cell"+d,{target:this,row:i,col:l,colId:o,event:t})&&r.cancelViewFocus()))),this.stopEventBubble&&p.stopEvent(t),r=t=null},onClick:function(e){this.invokeEvent("click",e)},onMouseDown:function(e){this.invokeEvent("mouseDown",e)},onMouseUp:function(e){this.invokeEvent("mouseUp",e)},onMouseOver:function(e){this.invokeEvent("mouseOver",e)},onMouseOut:function(e){this.invokeEvent("mouseOut",e)},onContextMenu:function(e,t){this.invokeEvent("contextMenu",e)},onDblClick:function(e){this.invokeEvent("dblClick",e)},onKeyDown:function(e){if(!0===e.ctrlKey&&(67==e.keyCode||86==e.keyCode))return!1;1==e.ctrlKey&&70===e.keyCode?this.showSearchDialog(e):112===e.keyCode&&(window.open(Rui.getRootPath()+"/docs/guide/guide.html"),p.stopEvent(e)),this.invokeEvent("keydown",e)},onKeypress:function(e){this.invokeEvent("keypress",e)},onCellclick:function(e){var t,i,l=e.row,s=e.col,o=this.getView(),r=this.getSelectionModel();!0===e.event.shiftKey||!0===e.event.ctrlKey||r.isLocked()||(this.systemSelect&&this.doSelectCell(l,s),this.systemSelect=!0);var n=this.columnModel.getColumnAt(r.getCol(),!0);n&&!1!==n.ignoreViewFocus||!1!==window.isRuiBlur?o.focusRow(r.getRow(),r.getCol()):o.cancelViewFocus();try{if((t=o.getColumnModel().getColumnAt(s,!0))&&!r.isLocked()){var d=(i=Rui.get(e.event.target)).hasClass("L-popup-button-icon"),a=i.hasClass("L-popup-action");if(d||a){var h=i.findParent("td",5).hasClass(this.CLASS_GRID_CELL_EDITABLE);if(d&&0==h)return;return this.fireEvent("popup",{target:this,row:l,col:s,colId:t.getId(),buttonEl:i,editable:h}),p.stopPropagation(e),o.onBlur({target:o}),!1}}var u,c,g,f=Rui.getConfig();f.getFirst("$.base.guide.show")&&!1!==this.checkGuideGrid&&((c=(u=new Rui.webdb.LWebStorage).getInt("rui.ui.grid.guide.show",1))<=(g=f.getFirst("$.base.guide.limitGuideCount"))?this.toast('<a href="'+Rui.getRootPath()+'/docs/guide/guide.html" target="_new">RUI 사용법 보기 (F1)</a><p>이 메시지는 '+g+"번까지만 출력됩니다. ["+c+"]번째</p>"):this.checkGuideGrid=!1,u.set("rui.ui.grid.guide.show",++c))}finally{t=o=i=null}},setFooter:function(e){Rui.ui.grid.LGridPanel.superclass.setFooter.call(this,e),this._rendered&&this.footer&&this.updateViewHeight(this.cfg.getProperty("height")-this.footer.offsetHeight)},updateSizes:function(){this.stopEditor(!1);var e,t=Rui.get(this.element);!0===this.autoWidth?this.updateWidth():(e=this.cfg.getProperty("width"))&&(t.setWidth(e),e-=Rui.get(this.innerElement).getBorderWidth("lr"),this.header&&Rui.get(this.header).setWidth(e),this.footer&&Rui.get(this.footer).setWidth(e),this.body&&((l=Rui.get(this.body)).setWidth(e),Rui.browser.chrome||l.setStyle("overflow","hidden")),l=null);var i=this.cfg.getProperty("height");i&&(t.setHeight(i),Rui.get(this.innerElement).setHeight(i)),this.fillHeight();var l=Rui.get(this.body);this.width=l.getWidth();var s,o=this.getView();o._rendered&&(s=this.el.getBorderWidth("tb"),o.setWidth(this.width-s)),o=null},updateWidth:function(){this.oldWidth=this.width;var e,t,i=0;return!0===this.autoWidth&&(i=0,this.header&&Rui.get(this.header).setStyle("width","100%"),this.footer&&Rui.get(this.footer).setStyle("width","100%"),this.body&&((e=Rui.get(this.body)).setStyle("width","100%"),Rui.browser.chrome||e.setStyle("overflow","hidden"),(t=Rui.util.LDom.getHiddenParent(e))?((t=Rui.get(t)).addClass("L-block-display"),i=e.getWidth(),t.removeClass("L-block-display")):i=e.getWidth(),this.width=i),e=null),i},fillHeight:function(e){if(e=e||this.body){for(var t,i,l=this.element||this.innerElement,s=[this.header,this.body,this.footer],o=0,r=0,n=0,d=!1,a=0,h=s.length;a<h;a++)(t=s[a])&&(e!==t?r+=this._getPreciseHeight(t):d=!0);d&&(i=this.getView(),(Rui.browser.msie||Rui.browser.opera)&&!0!==i.fitContentHeight&&v.setStyle(e,"height","0px"),null===(o=this._getComputedHeight(l))&&(v.addClass(l,"L-override-padding"),o=l.clientHeight,v.removeClass(l,"L-override-padding")),n=(n=o-r)<0?0:n,!0!==i.fitContentHeight&&v.setStyle(e,"height",n+"px")),l=s=t=null}e=null},availableHeight:function(e,t){var i=Rui.get(this.element);e?i.setHeight(Rui.get(e).getHeight()):i.availableHeight(e,t),this.height=i.getHeight(),this.setHeight(this.height),this.cfg.queueProperty("height",this.height)},_setHeight:function(e,t,i){this._rendered&&this.height===t[0]||(Rui.ui.grid.LGridPanel.superclass._setHeight.apply(this,arguments),this._rendered&&this.updateSizes(),this.updateViewHeight(this.height))},_setWidth:function(e,t,i){this._rendered&&this.width===t[0]||(Rui.ui.grid.LGridPanel.superclass._setWidth.apply(this,arguments),this._rendered&&this.updateSizes())},setWidth:function(e){this.cfg.getProperty("width")!=e&&this.cfg.setProperty("width",e)},setHeight:function(e){this.cfg.getProperty("height")!=e&&this.cfg.setProperty("height",e)},updateViewHeight:function(e){var t,i=this.footer?this.footer.offsetHeight:0,l=this.getView();!0!==l.fitContentHeight&&(t=this.el.getBorderWidth("tb"),l.setHeight(e-t-i))},getBorderWidth:function(){return this.borderWidth},selectCell:function(e,t,i){!0===i&&(this.systemSelect=!0);var l=this.doSelectCell(e,t,i);return!0===l&&!0===i&&this.focusRow(),this.systemSelect=!1,l},doSelectCell:function(e,t,i){var l=this.getView();if(0!=l.isSyncDataSet()){var s=l.getDataSet(),o=this.getSelectionModel(),r=o.getRow(),n=o.getCol(),d=l.columnModel;"string"==typeof t&&(t=d.getIndexById(t,!0));var a=!0;e!=s.getRow()&&(e==r&&(o.isMoveCell=!0),o._processSelectCell=!0,a=s.setRow(e),delete o.isMoveCell,delete o._processSelectCell);var h,u,c=!1;return a&&(r==e&&n!=t&&o.doDeSelectCell(r,n),o.selectCell(e,t)),0!=a&&-1<a&&((i||!1!==i&&this.autoToEdit&&!Rui.useAccessibility())&&(!0===i&&this.stopEditor(!0),this.startEditor(e,t)),c=!0),a&&l.scroller&&(h=Rui.get(l.getHeaderCellEl(t)).getRight(),(u=l.getContainer().getRight())<h&&l.scroller.setScrollLeft(h-u+l.scroller.getScrollbarSize(!0))),l=o=s=null,c}},onCelldblclick:function(e){!0===e.event.shiftKey||!0===e.event.ctrlKey||this.getSelectionModel().isLocked()||(this.systemSelect&&!0===this.doSelectCell(e.row,e.col,!0)&&p.stopEvent(e),this.systemSelect=!0)},onColumnResize:function(e){this.stopEditor(!0),this.editorToFragment()},onColumnMove:function(e){this.stopEditor(!0),this.editorToFragment()},onColumnsChanged:function(e){this.stopEditor(!0),this.editorToFragment()},onEditorChanged:function(e){var t=this.getSelectionModel();this.isEdit&&this.applyValue(t.getRow(),t.getCol(),!0,!1),t=null},onEditorBlur:function(e){var t=e;0==this.stopEditor(!0)?t.focus():this.selectionModel.unlock(),t=null,delete this._applyValue},onDataSetChanged:function(e){var t,i;!0===this.isEdit&&this.editColId==e.colId&&this.beforeEditorValue!=e.value&&(t=this.getView(),e.row===t.dataSet.getRow()&&((i=t.getColumnModel().getColumnById(e.colId))&&i.getEditor().setValue(e.value,!0),t=i=null))},onCopyPaste:function(e){if(!0===e.ctrlKey&&(67==e.keyCode||86==e.keyCode))try{var t,i,l=new Rui.webdb.LWebStorage;Rui.browser.msie||0!=l.getBoolean("rui.ui.grid.clipboard.noti",!1)||(i="UI "+(t=Rui.getMessageManager()).get("$.base.msg128")+" : Ctrl + C, UI "+t.get("$.base.msg129")+" : Ctrl + V<br/>",i+="Excel "+t.get("$.base.msg128")+" : Ctrl + Shift + C, Excel "+t.get("$.base.msg129")+" : Ctrl + Shift + V",this.toast(i,{delay:1e4}),l.set("rui.ui.grid.clipboard.noti",!0)),67==e.keyCode?this.dataToClipboard(!1):86==e.keyCode&&this.clipboardToLoad(!1)}catch(e){}},dataToClipboard:function(e){var t=this.selectionModel.getSelection(),i=this.getView(),l=i.getDataSet();try{var s,o,r=[];if(this.virtualClipboard)for(s in t){if(o=l.get(s)){for(var n=t[s],d=[],a=l.indexOfKey(s),h={},u=0,c=l.fields.length;u<c;u++)h[l.fields[u].id]=l.fields[u];for(u=0,c=this.columnModel.getColumnCount(!0);u<c;u++){var g=this.columnModel.getColumnAt(u,!0),f="";if(n[g.id]){if(!g.clipboard){d.push("");continue}f=g.field?o.get(g.field):void 0,g instanceof Rui.ui.grid.LSelectionColumn||g instanceof Rui.ui.grid.LStateColumn?f="":!0!==g.clipboardVirtual&&g.field||(C={id:g.id,first_last:"",css:[],style:"",editable:g.editable,tooltip:!0,tooltipText:"",istyle:"",clipboard:!0},f=g.clipboardRenderer?g.clipboardRenderer(f,C,o,g,a,u)||"":i.getRendererValue(f,C,o,g,a,u)||"",!0===this.columnModel.skipTags&&f&&"string"==typeof f&&(f=Rui.util.LString.skipTags(f))),d.push(f)}}r.push(d),h=null}}else for(s in t){if(o=l.get(s)){for(var m,n=t[s],d=[],u=0;u<this.columnModel.getColumnCount(!0);u++){(g=this.columnModel.getColumnAt(u,!0)).clipboard&&n[g.id]&&(m=o.get(g.field),d.push(m||""))}r.push(d)}}var C={data:r};this.fireEvent("copy",C);for(var R=[],a=0;a<C.data.length;a++){var v=C.data[a];R.push(v.join("\t"))}e?Rui._clipboardData=R.join("\r\n"):Rui.browser.msie?0==Rui.util.LString.toClipboard(R.join("\r\n"))&&alert(Rui.getMessageManager().get("$.base.msg113")):1==this.useClipboard&&(document.addEventListener("copy",function e(t){t.clipboardData.setData("text/plain",R.join("\r\n")),p.stopEvent(t),document.removeEventListener("copy",e,!0)},!0),document.execCommand("copy"),document.clipGrid=this),this.toast(Rui.getMessageManager().get("$.base.msg141"),{delay:700}),R=C=null}catch(e){}finally{t=i=l=null}},pasteHandler:function(e){this.clipValue=e.clipboardData.getData("text"),p.stopEvent(e),this instanceof Rui.ui.grid.LGridPanel||document.removeEventListener("paste",this.clipGrid.pasteHandler,!0),document.clipGrid.setClipData(this.clipValue)},clipboardToLoad:function(e,t){var i;!1!==this.usePaste&&(i=null,e?Rui._clipboardData&&this.setClipData(Rui._clipboardData):Rui.browser.msie?(i=Rui.util.LString.getClipboard(),this.rtrimWhiteSpace&&(i=i.replace(/\s+$/g,"")),this.setClipData(i)):1==this.useClipboard&&(document.clipGrid=this,t?this.pasteHandler(t):document.addEventListener("paste",this.pasteHandler,!0)),this.toast(Rui.getMessageManager().get("$.base.msg140"),{delay:700}))},createClipboard:function(){var e,t,i,l=this.clipBoardEl;l||(i='<div class="L-clipboard" id="clipboard_'+(e=Rui.id())+'"><div class="L-clipboard-title">'+(t=Rui.getMessageManager()).get("$.base.msg125"),i+=' <span class="L-clipboard-title-copy">'+t.get("$.base.msg128")+'</span><span class="L-clipboard-title-paste">'+t.get("$.base.msg129")+"</span>",i+="</div>",i+='<textarea rows="30" cols="80"></textarea>',i+='<div class="L-clipboard-infomation">'+t.get("$.base.msg130")+"</div>",i+='<div class="L-buttons"><button class="L-apply">'+t.get("$.base.msg120")+'</button><button class="L-close">'+t.get("$.base.msg124")+"</button></div>",i+="</div>",Rui.getBody().appendChild(i),(l=Rui.get("clipboard_"+e)).select("button.L-apply").on("click",function(e){var t=l.select("textarea").getValue();this.setClipData(t)&&l.hide()},this,!0),l.select("button.L-close").on("click",function(e){l.hide()},this,!0),this.clipBoardEl=l)},setClipData:function(e){if(e){var t=this.getView(),i=t.getDataSet(),l=this.columnModel,s=i.getRow(),o=this.selectionModel.getCol();if(s<0||o<0)return;for(var r=(e=e.replace(/\r|\n?$/g,"")).split("\n"),n=[],d=i.readFieldFormater.date,a=i.getCount(),h=0;h<r.length&&h<a;h++)if(!(""==r[h]&&h<r.length-1)){for(var u=r[h].split("\t"),c=[],g=0;g<u.length;g++){var f=l.getColumnAt(g+o,!0);if(f){var m=f.field||f.id;if(m){e="";if(f.field){var C=i.getFieldById(f.field);if(e=u[g].trim(),"number"==C.type){var R=e;if(e=e.replace(/,/g,""),e=parseFloat(e),isNaN(e))return alert("Paste failed. : [rows:"+h+":"+f.label+"] => "+R+", "+Rui.getMessageManager().get("$.base.msg005")),!1}else if("date"==C.type)try{R=e;if(!1===(e=e?d(e):null)||!e.getFullYear())return alert("Paste failed. : [rows:"+h+":"+f.label+"] => "+R+", "+Rui.getMessageManager().get("$.base.msg016")),!1}catch(e){}}c.push({id:m,value:e,isSkip:!1}),f=null}}}n.push(c)}var v={data:n};this.fireEvent("paste",v);for(var p=this.selectionModel,S={},h=0,w=v.data.length;h<w&&h<a;h++){for(var E=(c=v.data[h]).length,g=0;g<E;g++)if(!0!==c[g].isSkip){var y=l.getColumnAt(p.getCol()+g,!0);if(y){var L=l.getCellConfig(h+s,y.id,"editable");if(Rui.isUndefined(L)&&(L=y.editable),!1!==L){for(var b=h;b<a;b++){var M=i.getAt(h+s);try{if(M){if(t.isShowDataPaste&&Rui.hasOwnProperty(M.attrData,"_show")&&!M.getAttribute("_show")){s++;continue}var D,I,x=!1,_=0===c[g].value?0:c[g].value||"";y&&y.editor&&(y.editor.autoMapping||y.editor.rendererField)&&(_&&S[_]?_=S[_]:(D=y.editor.findValueByDisplayValue(_))&&(_=S[_]=D),y.editor.rendererField&&(x=!0)),this.usePasteCellEvent&&(I={row:h+s,col:p.getCol()+g,colId:y.field||y.id,value:_},this.fireEvent("pasteCell",I),_=I.value!==_?I.value:_),M.set(c[g].id,_),x&&M.set(y.editor.rendererField,c[g].value);break}Rui.log("Can not find target row");break}catch(e){return void alert("Paste failed. : ["+h+":"+g+"] => "+e.message)}}y=M=null}}}c=null}this.fireEvent("pasteCompleted",v),t=i=fieldMap=v=l=null,document.clipGrid=null}return!0},setSyncDataSet:function(e){this.getView().setSyncDataSet(e)},setDataSet:function(e){var t=this.getView();t.setSyncDataSet(!1),t.dataSet=e,this.dataSet=e,t.setSyncDataSet(!0),this.getSelectionModel().init(this),t.setPanel(this),this.unOn("headerClick",this.onApplyStopEditor,this),this.on("headerClick",this.onApplyStopEditor,this,!0),this.unOn("cellClick",this.onCellclick,this),this.on("cellClick",this.onCellclick,this,!0,{system:!0}),this.footerBar&&this.footerBar.init(this),t=e=null},setCellConfig:function(e,t,i,l){this.columnModel.setCellConfig(e,t,i,l)},editorToFragment:function(){if(!this.fragmentEditorList){this.frag=document.createDocumentFragment();var e=this.columnModel;for(m in e.editors=e.editors||{},this.fragmentEditorList={},e.editors){var t=e.editors[m];t instanceof Rui.ui.grid.LEditorPanel&&(this.frag.appendChild(t.el.dom),this.fragmentEditorList[m]=t),t=null}e.editors={},e=null}},fragmentToEditor:function(){var e=this.getView(),t=this.columnModel;for(var i in t.editors=t.editors||{},this.fragmentEditorList){var l=this.fragmentEditorList[i];l instanceof Rui.ui.grid.LEditorPanel&&(e.getScrollerEl().appendChild(l.el.dom),t.editors[i]=l),l=null}delete this.fragmentEditorList,delete this.frag,e=t=null},createEditorTimer:function(e){this.dtStartEditor=Rui.later(50,this,this.doStartEditor,[e]),this.dtStartEditor.row=e.row,this.dtStartEditor.col=e.col},destroyEditorTimer:function(){this.dtStartEditor.cancel(),this.dtStartEditor=null,delete this.dtStartEditor},startEditor:function(e,t){Rui.platform.isMobile?this.doStartEditor({row:e,col:t}):(!this.dtStartEditor||this.dtStartEditor.row===e&&this.dtStartEditor.col===t||this.destroyEditorTimer(),this.dtStartEditor||this.createEditorTimer({row:e,col:t}))},doStartEditor:function(e){try{this.dtStartEditor&&this.destroyEditorTimer();var t=e.row,i=e.col;if(!0===this.isEdit||0==this.editable)return;if(!0===this.autoToEdit&&this.stopEditor(!1),t<0||i<0)return;var l=this.getView();if(0==l.isSyncDataSet())return;var s=l.getColumnModel(),o=s.getColumnAt(i,!0);if(!0!==this.skipRowCellEvent){var r=l.getRowDom(t,1);if(r&&0==v.hasClass(r,this.CLASS_GRID_ROW_EDITABLE))return void(r=null)}var n=l.getCellDom(t,i);if(!n)return;var d,a=(a=this.getCellRegion(t,i))||v.getRegion(n);if(-1<s.freezeIndex&&s.freezeIndex<i&&(d=l.getFirstLiEl().getRight(),a.left=a.left<d?d:a.left,a.right=a.right>l.scrollerEl.getRight()?l.scrollerEl.getRight():a.right),this.restartCount=this.restartCount||0,l.scroller){var h=l.scrollerEl.getRight()-l.scroller.getScrollbarSize(),u=l.scrollerEl.getBottom()-l.scroller.spaceBottom-l.scroller.getScrollbarSize(!0);a&&a.right;if(this.restartCount<2&&(!0!==this.isReStartEditor&&a&&h<a.right-2||a&&u<=a.bottom-2))return Rui.later(l.renderDataTime+10,this,this.restartEditor,[t,i]),this.isReStartEditor=!0,this.dtStartEditor&&this.destroyEditorTimer(),void this.restartCount++}if(this.isReStartEditor=!1,delete this.restartCount,!1===s.getCellConfig(t,o.id,"editable"))return;if(!0!==this.rendererConfig){if(!n||!o.isEditable())return}else if(n&&0==v.hasClass(n,this.CLASS_GRID_CELL_EDITABLE))return;s.editors=s.editors||{};var c=l.getDataSet(),g=c.getAt(t);if(g.state==Rui.data.LRecord.STATE_DELETE)return;var f,m=o.editor,C=m?m.editorId:null,R=null;if(this.fragmentEditorList&&this.fragmentToEditor(),R=s.editors[C],null!=g&&(f=g.get(o.field),this.systemSelect=!0),delete this.emptyValue,null!=f&&null!=f&&""!==f||(this.emptyValue=f,f=""),!R){if(null==m)return;(o.editor=m).gridFieldId=o.id,m.gridPanel=this,m.invalidBlur=!1,C=Rui.useFixedId()?"ep-"+this.gridId+"-"+o.id:"ep_"+Rui.id(),(R=new Rui.ui.grid.LEditorPanel({id:C,editor:m,column:o,view:l})).render(l.getScrollerEl().dom),s.editors[C]=R,m._rendered||(m.render(R.getContainer()),m.editorId=C),m.unOn("changed",this.onEditorChanged,this),m.on("changed",this.onEditorChanged,this,!0),m.unOn("blur",this.onEditorBlur,this),m.on("blur",this.onEditorBlur,this,!0),m.unOn("specialkey",this.onEditorKey,this),m.on("specialkey",this.onEditorKey,this,!0),m.on("keydown",this.onEditorKeyDown,this,!0),c.unOn("update",this.onDataSetChanged,this),c.on("update",this.onDataSetChanged,this,!0,{system:!0})}if(0==this.fireEvent("beforeEdit",{target:this,row:t,col:i,colId:o.getId()}))return;return p.removeListener(Rui.getBody(!0),"selectstart",this.onSelectStart,this),R.show(),this.multiLineEditor&&!0===m.multiLine&&(l.el.getBottom()>a.bottom+80?a.bottom+=50:a.top-=50),R.setRegion(a),m.valid(),m.lastValue=null,m.setValue(f,!0),m.focus(),this.editColId=o.getField(),this.currentCellEditor=R,l.reOnDeferOnBlur(),this.isEdit=!0,delete this._applyValue,this.beforeEditorValue=f,this.editRow=t,this.editCol=i,this.focusTime=new Date,!0}finally{l=s=o=a=c=m=R=m=null}},restartEditor:function(e,t){this.startEditor(e,t)},getCellRegion:function(e,t){try{var i=this.view,l=i.getColumnModel();if(l.isMerged()){var s,o=i.getRowDom(e,1);headerCells=i.getHeaderCellEls(),s=Rui.browser.msie?v.getRegion(o.cells[o.cells.length-1]):v.getRegion(o);var r=v.getRegion(headerCells.getAt(t).dom);return{0:r.left,left:r.left,1:s.top,top:s.top,right:r.right,bottom:s.bottom}}var n=i.getCellDom(e,t);return v.getRegion(n)}catch(e){}finally{i=l=o=null}},onEditorKey:function(e){var t=Rui.util.LKey.KEY;if(e.keyCode!=t.TAB&&e.keyCode!=t.ESCAPE&&e.keyCode!=t.ENTER||!this.currentCellEditor||0!=this.currentCellEditor.editor.onCanBlur.call(this.currentCellEditor.editor,e)){var i,l,s,o=this.getSelectionModel(),r=o.getRow(),n=o.getCol(),d=this.getView(),a=this.currentCellEditor?this.currentCellEditor.editor:null;switch(e.keyCode){case t.DOWN:case t.UP:a&&!0===a.multiLine||(i=e.keyCode==t.UP?-1:1,(l=o.getMoveRow(r,i))<d.getDataCount()&&0<=l&&(this.stopEditor(!0),this.systemSelect=!0,this.doSelectCell(l,n,!e.shiftKey&&void 0)),this.focusRow(),p.stopEvent(e));break;case t.PAGE_DOWN:a&&!0===a.multiLine||(this.stopEditor(!0),this.systemSelect=!0,o.onPageDown(e),this.focusRow(),p.stopEvent(e));break;case t.PAGE_UP:a&&!0===a.multiLine||(this.stopEditor(!0),this.systemSelect=!0,o.onPageUp(e),this.focusRow(),p.stopEvent(e));break;case t.TAB:this.stopEditor(!0),this.systemSelect=!0,o.onTabMoveCell(e),this.focusRow(),p.stopEvent(e);break;case t.ESCAPE:this.stopEditor(!1),d.focus(),p.stopEvent(e);break;case t.ENTER:this.isEdit&&(a&&!0===a.multiLine||(this.stopEditor(!0),!0===o.enterToMove&&s&&s.ignoreViewFocus&&o.onTabMoveCell(e),((s=d.getColumnModel().getColumnAt(n,!0))&&!1!==s.ignoreViewFocus||!1!==window.isRuiBlur)&&this.focusRow(),p.stopEvent(e)));break;case 70:1==e.ctrlKey&&(this.stopEditor(!1),this.showSearchDialog(e),p.stopEvent(e));break;case 86:if((!a||a&&!0!==a.multiLine)&&1==e.ctrlKey)if(0,Rui.browser.msie)value=Rui.util.LString.getClipboard(),value&&(-1<value.indexOf("\n")||-1<value.indexOf("\t"))&&(this.stopEditor(!1),this.rtrimWhiteSpace&&(value=value.replace(/\s+$/g,"")),this.setClipData(value),p.stopEvent(e));else if(1==this.useClipboard)return!1}o=d=null}},onEditorKeyDown:function(e){var t,i,l,s,o,r,n;112===e.keyCode?(window.open(Rui.getRootPath()+"/docs/guide/guide.html"),p.stopEvent(e)):229===e.keyCode&&!0===e.ctrlKey&&(t=this.editRow,i=this.editCol,l=this.columnModel,s=this.getView(),o=l.getColumnAt(i,!0),n=(r=s.getDataSet().getAt(t)).getOriginData()[o.field],r.set(o.field,n))},stopEditor:function(e){if(this.dtStartEditor&&this.destroyEditorTimer(),!1!==this.isEdit&&0!=this.editable){var t=this.editRow,i=this.editCol;if(Rui.isUndefined(t)||Rui.isUndefined(i))throw new Error("stopEditor position error!");if(Rui.platform.isMobile&&this.focusTime)if((new Date).getTime()-this.focusTime.getTime()<300)return;return this.applyValue(t,i,e,!0),delete this.editColId,delete this.editRow,delete this.editCol,this.isEdit=!1,p.addListener(Rui.getBody(!0),"selectstart",this.onSelectStart,this,!0),this.currentCellEditor&&this.currentCellEditor.hide(),!(this.currentCellEditor=null)}},onViewBlur:function(e){this.onApplyStopEditor(),p.removeListener(Rui.getBody(!0),"selectstart",this.onSelectStart,this)},onSelectStart:function(e){return!1},onApplyStopEditor:function(){this.stopEditor(!0)},onReStartEditor:function(){var e,t;this.dtStartEditor&&(e=this.getView(),t=this.getSelectionModel(),Rui.later(e.renderDataTime+10,this,this.restartEditor,[t.getRow(),t.getCol()])),this.stopEditor(!0)},applyValue:function(e,t,i,l){var s,o,r,n,d,a=this.getView(),h=a.getColumnModel(),u=h.getColumnAt(t,!0);u&&(h.editors=h.editors||{},s=a.getDataSet().getAt(e),r=(o=u.editor)?o.editorId:null,d=h.editors[r],Rui.isUndefined(d)||d.isShow()&&(!0===i&&!0===o.fieldObject&&null!=s&&(n=null,n=o.getValue(),this.beforeEditorValue!==n&&(Rui.isEmpty(n)&&!Rui.isUndefined(this.emptyValue)&&(n=this.emptyValue),"number"==u.type&&"string"==typeof n&&(n=""==n?0:parseFloat(n,10)),u.properties&&((u.properties[s.id]||{}).val=void 0),!Rui.isUndefined(this._applyValue)&&this.beforeEditorValue==n||(this._applyValue=n,s.set(u.field,n,{system:!0}),this.beforeEditorValue=n))),l&&(d.hide(),o.isFocus&&o.onBlur({target:o})))),a=h=u=s=null},focusRow:function(){var e=this.getSelectionModel(),t=this.getView();this.isEdit?this.currentCellEditor.focus():t.focusRow(e.getRow(),e.getCol()),t=e=null},setEditable:function(e){this.editable=e,this.view&&this.view.updateEditable(e)},isEditable:function(){return this.editable},getView:function(){var e,t;return null==this.view&&(e=this.getRowModel(),this.viewConfig=Rui.applyIf(this.viewConfig,{rowModel:e}),this.view=new Rui.ui.grid.LBufferGridView(this.viewConfig),(t=this).view.onCanBlur=function(e){if(1==t.isEdit)return t.currentCellEditor.editor.onCanBlur.call(t.currentCellEditor.editor,e)},e=null),this.view},getRowModel:function(){return null==this.rowModel&&(this.rowModel=new Rui.ui.grid.LRowModel({renderer:function(e,t,i){return e.push(Rui.ui.grid.LGridPanel.prototype.CLASS_GRID_ROW_EDITABLE),e}}),this.rowModel.bindEvent(this)),this.rowModel},getEditView:function(){return this.editViewEl||(this.rowEditorPanel?(this.editViewEl=Rui.get(this.rowEditorPanel),this.rowEditorPanelWidth=this.editViewEl.getWidth()-20):(this.editViewEl=Rui.createElements('<div class="L-grid-row-inline-editor"></div>').getAt(0),this.editViewEl.appendTo(this.body),this.rowEditorPanelWidth=this.element.offsetWidth),this.editViewEl.addClass("L-grid-row-editor"),Rui.createElements('<div class="L-grid-row-editor-inner"></div>').appendTo(this.editViewEl),this.editViewEl.hide(),this.editViewEl.on("click",function(e){p.stopEvent(e)})),this.editViewEl},initColumns:function(){for(var e=this.getView().getColumnModel(),t=0,i=e.getColumnCount();t<i;t++){var l=e.getColumnAt(t);l.unOn("hidden",this.onColumnHidden,this),l.on("hidden",this.onColumnHidden,this,!0),l=null}e.unOn("columnsChanged",this.onColumnsChanged,this),e.on("columnsChanged",this.onColumnsChanged,this,!0),e=null},onColumnHidden:function(e){this.editorToFragment()},showSearchDialog:function(e){var c,g,f,m,C;this.searchDialog||(c=this.dataSet,g=this.getSelectionModel(),f=this.columnModel,m=this.getView(),(C=this).searchDialog=new Rui.ui.LDialog({id:"LGrid-srch",defaultCss:"L-grid-search-dialog",width:300,header:"Search",body:'<div class="L-title">Find in column.</div></div><input type="text" name="searchText" class="L-search-text" value=""><div class="L-infomation">Enter: Next, Shift+Enter:Prev</div>',visible:!1,modal:!1,buttons:[{text:"Next",disableDbClick:!1,handler:function(){var e=this.searchInputEl.getValue();if(e){e=e.toLowerCase();for(var t=!1,i=0,l=g.getCol()+1,s=c.getRow(),o=c.getCount();s<o;s++){for(var r=c.getAt(s),n=l,d=f.getColumnCount(!0);n<d;n++){var a=f.getColumnAt(n,!0),h=a.field?r.get(a.field):"";if(!(a instanceof Rui.ui.grid.LSelectionColumn||a instanceof Rui.ui.grid.LStateColumn)){var u={id:a.id,first_last:"",css:[],style:"",editable:a.editable,tooltip:!0,tooltipText:"",istyle:"",clipboard:!0},h=m.getRendererValue(h,u,r,a,s,n)||"";if((h+="")&&-1<h.toLowerCase().indexOf(e))return t=!0,C.selectCell(s,a.id,!1),void this.searchInputEl.focus()}}l=0,s!=o-1||!t&&0!=i||(i++,t=!(s=-1))}}}},{text:"Previous",disableDbClick:!1,handler:function(){if(i=this.searchInputEl.getValue())for(var e=!1,t=0,i=i.toLowerCase(),l=f.getColumnCount(!0),s=g.getCol()-1,o=c.getRow();-1<o;o--){for(var r=c.getAt(o),n=s;0<=n;n--){var d=f.getColumnAt(n,!0),a=d.field?r.get(d.field):"";if(!(d instanceof Rui.ui.grid.LSelectionColumn||d instanceof Rui.ui.grid.LStateColumn)){var h={id:d.id,first_last:"",css:[],style:"",editable:d.editable,tooltip:!0,tooltipText:"",istyle:"",clipboard:!0},a=m.getRendererValue(a,h,r,d,o,n)||"";if((a+="")&&-1<a.toLowerCase().indexOf(i))return e=!0,C.selectCell(o,d.id,!1),void this.searchInputEl.focus()}}s=l-1,0!=o||!e&&0!=t||(o=c.getCount(),t++,e=!1)}}},{text:"Close",handler:function(){this.cancel(!1)}}]}),this.searchDialog.render(document.body),this.searchDialog.searchInputEl=this.searchDialog.getContainer().select(".L-grid-search-dialog .L-search-text").getAt(0),this.searchDialog.searchInputEl.on("keydown",this.onSearchDialogKeyDown,this,!0)),this.searchDialog.show(!1),this.searchDialog.getContainer().select(".L-search-text").getAt(0).focus()},onSearchDialogKeyDown:function(e){var t=Rui.util.LKey.KEY;e.shiftKey&&e.keyCode===t.ENTER?this.searchDialog.getButtons()[1].click():e.keyCode===t.ENTER?this.searchDialog.getButtons()[0].click():e.keyCode==t.ESCAPE&&this.searchDialog.hide(!1)},multiCellDeletable:function(){var e=this.getSelectionModel(),t=this.dataSet,i=e.getSelection(),l=this.columnModel,s=null;for(s in i){if(t.get(s)){var o=i[s],r=null;for(r in o){var n,d,a=columnModel.getColumnById(r);a&&a.field&&a.editor&&(n=t.indexOfKey(s),d=l.getCellConfig(n,a.id,"editable"),Rui.isUndefined(d)&&(d=a.editable),d&&-1<n&&(t.getFieldById(a.field),t.setNameValue(n,a.field,null)))}}}},updateColumnsAutoWidth:function(){var e,t,i,l=this.width,s=this.columnModel;s.isAutoWidth()&&this.oldWidth!=l&&Math.abs(this.oldWidth-l)>this.contentResizeWidth&&(e=s.getTotalWidth(!0),t=Rui.ui.LScroller.SCROLLBAR_SIZE,(e<(i=this.width-(this.scrollerConfig&&"n"===this.scrollerConfig.scrollbar?0:t))||!0===s.adjustAutoWidth)&&this.columnModel.updateColumnsAutoWidth(i))},destroy:function(){var e=this.getView();0==Rui.isUndefined(this.reMon)&&this.reMon.unOnAll(),this.bodyEl&&(this.bodyEl.remove(),delete this.bodyEl),this.excelDialog&&this.excelDialog.destroy();var t=e.isExcel;e.destroy(),this.selectionModel&&this.selectionModel.destroy(),this.rowModel&&this.rowModel.destroy();for(var i=this.columnModel,l=0,s=i.getColumnCount();l<s;l++){var o=i.getColumnAt(l);o.editor&&o.editor.gridFixed&&o.editor.gridUnBindEvent(this)}!0!==t&&i.destroy(),Rui.ui.grid.LGridPanel.superclass.destroy.call(this),e=null},focus:function(){var e=this.getView();e?e.focus():this.el.focus()},blur:function(){var e=this.getView();e?e.blur():this.el.blur()},showTabletViewer:function(){var l,e,t,s;!0===this.tabletMode&&(Rui._tabletData||(Rui._tabletData={gridPanel:this},document.body.scrollTop=0,l=Rui.getBody().getHeight(),e=this.tabletViewerUrl?this.tabletViewerUrl:Rui.getRootPath()+"/plugins/ui/tabletViewer.html",this.tabletViewerEl=Rui.createElements('<div class="L-ux-container"><iframe frameborder="0" src="'+e+'" width="100%" height="100%"></iframe></div>').getAt(0),Rui._tabletViewerEl=this.tabletViewerEl,(t=Rui.getBody()).appendChild(this.tabletViewerEl),this.oldOverflow=t.getStyle("overflow"),t.setStyle("overflow","hidden"),s=Rui.select(".L-ux-container").getAt(0),this.resizeTabletViewer=setInterval(function(){var e=s.select("iframe").getAt(0).dom.contentWindow.document,t=null;if(e.body){for(var i=0;i<e.body.childNodes.length;i++){if("LTabletViewport"==e.body.childNodes[i].id){t=e.body.childNodes[i];break}}t&&((l=Rui.get(t).getHeight())<self.innerHeight&&(l=self.innerHeight-12),s.setStyle("height",l+"px"))}},500)))},closeTabletViewer:function(){delete Rui._tabletData,this.tabletViewerEl.remove(),delete Rui._tabletViewerEl,Rui._tabletViewerEl=null,Rui.getBody().setStyle("overflow",this.oldOverflow),delete this.oldOverflow,clearInterval(this.resizeTabletViewer)},toString:function(){return"Rui.ui.grid.LGridPanel "+this.id}})}(),Rui.ui.grid.LEditorPanel=function(e){var t=e||{};Rui.ui.grid.LEditorPanel.superclass.constructor.call(this,t),t=null},Rui.extend(Rui.ui.grid.LEditorPanel,Rui.ui.LUIComponent,{otype:"Rui.ui.grid.LEditorPanel",editor:null,column:null,view:null,afterRender:function(e){var t=this.el;t.addClass("L-editor-panel"),t.addClass("L-hide-display");var i=this.column.getEditor();Rui.isUndefined(i.marginLeft)||(Rui.rightToLeft()?i.marginLeft=-1:i.marginLeft=-2),i.on("keydown",Rui.util.LEvent.stopPropagation),i.on("keypress",Rui.util.LEvent.stopPropagation),this.el=t,t=i=null},setRegion:function(e){var t=this.column.getEditor();this.el.setRegion(e);var i=e.right-e.left;this.el.setWidth(i);var l=this.el.getBorderWidth("lr");Rui.browser.msie67&&l++,t.setWidth(i-l);var s,o=e.bottom-e.top;this.el.setHeight(o),t.setHeight&&(s=this.el.getBorderWidth("tb"),Rui.browser.msie67&&s++,t.setHeight(o-s)),t=null}}),Rui.ui.grid.LGridScroller=function(e){e=e||{},e=Rui.applyIf(e,Rui.getConfig().getFirst("$.ext.gridScroller.defaultProperties")),Rui.ui.grid.LGridScroller.superclass.constructor.call(this,e)},Rui.extend(Rui.ui.grid.LGridScroller,Rui.ui.LScroller,{otype:"Rui.ui.grid.LGridScroller",manageSteps:!0,scrollStep:1,wheelStep:1,useVirtual:!0,scrollCount:0,initComponent:function(e){Rui.ui.grid.LGridScroller.superclass.initComponent.call(this,e),this.setSizes(this.scrollCount,this.scrollStep,this.wheelStep)},doRender:function(){this.scrollEl=Rui.get(this.createElement()),this.scrollEl.addClass("L-scroll"),Rui.get(this.el.dom.firstChild).insertBefore(this.scrollEl),this.scrollEl.appendChild(this.contentEl),this.setupSizes(),this.scrollTop=0},setupScrollbars:function(){Rui.ui.grid.LGridScroller.superclass.setupScrollbars.call(this);var e,t=Rui.util.LEvent;this.yScrollbarEl&&1==this.controlScrollbarDrag&&(t.removeListener(this.yScrollbarEl.dom,"mousedown",this.onYScrollbarMousedown),t.addListener(this.yScrollbarEl.dom,"mousedown",this.onYScrollbarMousedown,this,!0),Rui.browser.msie678?(t.removeListener(this.yScrollbarEl.dom,"mousemove",this.onYScrollbarMouseup),t.addListener(this.yScrollbarEl.dom,"mousemove",this.onYScrollbarMouseup,this,!0)):(t.removeListener(this.yScrollbarEl.dom,"mouseup",this.onYScrollbarMouseup),t.addListener(this.yScrollbarEl.dom,"mouseup",this.onYScrollbarMouseup,this,!0))),!this.manageSteps||Rui.platform.mac||Rui.browser.chrome||(this.yScrollbarEl?(this.yScrollbarPrevButtonEl||(this.yScrollbarPrevButtonEl=Rui.get(document.createElement("div")),this.el.appendChild(this.yScrollbarPrevButtonEl),this.yScrollbarPrevButtonEl.addClass("L-scrollbar-y-btn-prev"),t.addListener(this.yScrollbarPrevButtonEl.dom,"mousedown",this.onMousedownYPrev,this,!0),t.addListener(this.yScrollbarPrevButtonEl.dom,"mouseup",this.onMouseup,this,!0),t.addListener(this.yScrollbarPrevButtonEl.dom,"mouseout",this.onMouseup,this,!0),this.yScrollbarNextButtonEl=Rui.get(document.createElement("div")),this.el.appendChild(this.yScrollbarNextButtonEl),this.yScrollbarNextButtonEl.addClass("L-scrollbar-y-btn-next"),t.addListener(this.yScrollbarNextButtonEl.dom,"mousedown",this.onMousedownYNext,this,!0),t.addListener(this.yScrollbarNextButtonEl.dom,"mouseup",this.onMouseup,this,!0),t.addListener(this.yScrollbarNextButtonEl.dom,"mouseout",this.onMouseup,this,!0)),e=0,this.xScrollbarEl&&(e+=this.scrollbarSize),e+=this.getSpace("bottom"),this.yScrollbarNextButtonEl.setStyle("bottom",e+"px")):this.yScrollbarPrevButtonEl&&(t.removeListener(this.yScrollbarPrevButtonEl.dom,"mousedown",this.onMousedownYPrev),t.removeListener(this.yScrollbarPrevButtonEl.dom,"mouseup",this.onMouseup),t.removeListener(this.yScrollbarPrevButtonEl.dom,"mouseout",this.onMouseup),this.yScrollbarPrevButtonEl.remove(),this.yScrollbarPrevButtonEl=null,t.removeListener(this.yScrollbarNextButtonEl.dom,"mousedown",this.onMousedownYNext),t.removeListener(this.yScrollbarNextButtonEl.dom,"mouseup",this.onMouseup),t.removeListener(this.yScrollbarNextButtonEl.dom,"mouseout",this.onMouseup),this.yScrollbarNextButtonEl.remove(),this.yScrollbarNextButtonEl=null),this.xScrollbarEl?(this.xScrollbarPrevButtonEl||(this.xScrollbarPrevButtonEl=Rui.get(document.createElement("div")),this.el.appendChild(this.xScrollbarPrevButtonEl),this.xScrollbarPrevButtonEl.addClass("L-scrollbar-x-btn-prev"),t.addListener(this.xScrollbarPrevButtonEl.dom,"mousedown",this.onMousedownXPrev,this,!0),t.addListener(this.xScrollbarPrevButtonEl.dom,"mouseup",this.onMouseup,this,!0),t.addListener(this.xScrollbarPrevButtonEl.dom,"mouseout",this.onMouseup,this,!0),this.xScrollbarNextButtonEl=Rui.get(document.createElement("div")),this.el.appendChild(this.xScrollbarNextButtonEl),this.xScrollbarNextButtonEl.addClass("L-scrollbar-x-btn-next"),t.addListener(this.xScrollbarNextButtonEl.dom,"mousedown",this.onMousedownXNext,this,!0),t.addListener(this.xScrollbarNextButtonEl.dom,"mouseup",this.onMouseup,this,!0),t.addListener(this.xScrollbarNextButtonEl.dom,"mouseout",this.onMouseup,this,!0)),this.yScrollbarEl?this.xScrollbarNextButtonEl.setStyle("right",this.scrollbarSize+"px"):this.xScrollbarNextButtonEl.setStyle("right","0px")):this.xScrollbarPrevButtonEl&&(t.removeListener(this.xScrollbarPrevButtonEl.dom,"mousedown",this.onMousedownXPrev),t.removeListener(this.xScrollbarPrevButtonEl.dom,"mouseup",this.onMouseup),t.removeListener(this.xScrollbarPrevButtonEl.dom,"mouseout",this.onMouseup),this.xScrollbarPrevButtonEl.remove(),this.xScrollbarPrevButtonEl=null,t.removeListener(this.xScrollbarNextButtonEl.dom,"mousedown",this.onMousedownXNext),t.removeListener(this.xScrollbarNextButtonEl.dom,"mouseup",this.onMouseup),t.removeListener(this.xScrollbarNextButtonEl.dom,"mouseout",this.onMouseup),this.xScrollbarNextButtonEl.remove(),this.xScrollbarNextButtonEl=null))},setupSizes:function(){if(this.isWidthZero())return!1;Rui.ui.grid.LGridScroller.superclass.setupSizes.call(this),Rui.browser.msie10&&(this.yScrollbarPrevButtonEl&&(this.yScrollbarPrevButtonEl.setHeight(34),this.yScrollbarNextButtonEl.setHeight(34)),this.xScrollbarPrevButtonEl&&(this.xScrollbarPrevButtonEl.setWidth(34),this.xScrollbarNextButtonEl.setWidth(34)))},setSizes:function(e,t,i,l){this.scrollCount=e;var s=40;Rui.browser.msie&&(e<1&&(e=1),10<(s=1e6/e)&&(s=10)),this.virtualRowHeight=s,this.yScrollStep=this.virtualRowHeight*(t&&0<t?t:this.scrollStep),this.yWheelStep=this.virtualRowHeight*(i&&0<i?i:this.wheelStep),this.yTouchScrollStep=l&&0<l?l:3},getStartRow:function(){if(this.scrollCount<1)return 0;var e=this.getScrollTop();return e<1?0:Math.floor(e/this.virtualRowHeight)},getScrollRegion:function(){return this.scrollEl?this.scrollEl.getRegion():null},getContentHeight:function(){return this.scrollCount*this.virtualRowHeight+this.getScrollHeight()},getMaxScrollTop:function(e){return this.getContentHeight()-this.scrollEl.getHeight(!0)},getMaxScrollLeft:function(e){return this.getContentWidth()-this.scrollEl.getWidth(!0)},getScrollTop:function(e){return 1==this.virtualScrollRate||1!=e?this.yScrollbarEl?this.yScrollbarEl.dom.scrollTop:0:this.scrollTop},isStart:function(e){return e?0==this.getScrollLeft():this.getScrollTop()<this.virtualRowHeight},isEnd:function(e){return e?!this.xScrollbarEl||this.getScrollLeft()>=this.getMaxScrollLeft():!this.yScrollbarEl||this.getScrollTop()>this.getMaxScrollTop()-this.virtualRowHeight},go:function(e,t){var i=e*this.getStep();return Rui.ui.grid.LGridScroller.superclass.go.call(this,i,t)},getPrevious:function(e){if(e)return this.getScrollLeft()-this.getStep(!1,!0);var t=this.getMaxScrollTop();if(this.getScrollTop()!=t)return this.getScrollTop()-this.getStep();var i=t%this.getStep();return this.getScrollTop()-(i||this.getStep())},getScroll:function(){return{top:this.getScrollTop()/this.getStep(!1),left:this.getScrollLeft()/this.getStep(!1,!0)}},onYScrollbarMousedown:function(e){1==this.controlScrollbarDrag&&(this._dragging=!0)},onYScrollbarMouseup:function(e){var t,i;!0===this._dragging&&(i=e&&e.target?e.target.scrollTop:this.getScrollTop(),t=this.scrollTop,(i=this.virtualScrollRate*i)!==t&&(this.scrollTop=i,(t||i)&&this.fireEvent("scrollY",{target:this,beforeScrollTop:t,scrollTop:i,isFirst:0===i,isEnd:i>=this.getMaxScrollTop(),isUp:!(t<i)})),this._dragging=!1)},onMouseup:function(e){this.isDownClicked=!1,Rui.util.LEvent.stopEvent(e)},onMousedownYPrev:function(e){var t;1==this.needScroll.Y&&(this.goPrevious(),Rui.util.LEvent.stopEvent(e),(t=this).isDownClicked=!0,setTimeout(function(){var e;1==t.isDownClicked&&(e=Rui.later(50,t,function(){1!=this.isDownClicked||this.getScrollTop()<1?e.cancel():this.goPrevious()},null,!0))},250))},onMousedownYNext:function(e){var t;1==this.needScroll.Y&&(this.goNext(),Rui.util.LEvent.stopEvent(e),(t=this).isDownClicked=!0,setTimeout(function(){var e;1==t.isDownClicked&&(e=Rui.later(50,t,function(){1!=this.isDownClicked||this.getScrollTop()>=this.getMaxScrollTop()?e.cancel():this.goNext()},null,!0))},250))},onMousedownXPrev:function(e){var t;1==this.needScroll.X&&(this.goPrevious(!0),Rui.util.LEvent.stopEvent(e),(t=this).isDownClicked=!0,setTimeout(function(){var e;1==t.isDownClicked&&(e=Rui.later(50,t,function(){1!=this.isDownClicked||this.getScrollTop()<1?e.cancel():this.goPrevious(!0)},null,!0))},250))},onMousedownXNext:function(e){var t;1==this.needScroll.X&&(this.goNext(!0),Rui.util.LEvent.stopEvent(e),(t=this).isDownClicked=!0,setTimeout(function(){var e;1==t.isDownClicked&&(e=Rui.later(50,t,function(){1!=this.isDownClicked||this.getScrollTop()>=this.getMaxScrollTop()?e.cancel():this.goNext(!0)},null,!0))},250))},onScrollY:function(e){if(this.yScrollbarEl&&!0!==this._dragging){var t=e&&e.target?e.target.scrollTop:this.getScrollTop(),i=this.scrollTop;if((t=this.virtualScrollRate*t)!==i&&(this.scrollTop=t,i||t)){if(!0===this.ignoreEvent)return void delete this.ignoreEvent;this.fireEvent("scrollY",{target:this,beforeScrollTop:i,scrollTop:t,isFirst:0===t,isEnd:t>=this.getMaxScrollTop(),isUp:!(i<t)})}}},onScrollX:function(e){var t,i;this.xScrollbarEl&&(t=e&&e.target?e.target.scrollLeft:this.getScrollLeft(),i=this.scrollLeft,this.createScrollLeft&&(this.scrollLeft=this.createScrollLeft,this.setScrollLeft(this.scrollLeft),delete this.createScrollLeft),(i!==t||e&&e.isForce)&&(this.scrollEl.dom.scrollLeft=t,this.scrollLeft=t,(i||t)&&this.fireEvent("scrollX",{target:this,beforeScrollLeft:i,scrollLeft:t})))},onTouchMove:function(e){var t,i,l;!0===this.touchStart&&(t=e.targetTouches?e.targetTouches[0]:e,i=this.touchStartXY.x-t.pageX,0!=(l=this.touchStartXY.y-t.pageY)&&(this._touchMoveY=this._touchMoveY||0,this._touchMoveY+=l),0!=i&&(this._touchMoveX=this._touchMoveX||0,this._touchMoveX+=i),this.touchStartXY={x:t.pageX,y:t.pageY},Rui.util.LEvent.preventDefault(e))},onTouchEnd:function(e){var t,i;this._touchMoveY&&this._touchMoveX&&(Math.abs(this._touchMoveY)>=Math.abs(this._touchMoveX)?(t=this.getScroll(),this.go(t.top+(0<this._touchMoveY?this.yTouchScrollStep:-this.yTouchScrollStep))):(i=this.getScrollLeft(),this.setScrollLeft(i+this._touchMoveX))),this._touchMoveY=0,this._touchMoveX=0,Rui.ui.grid.LGridScroller.superclass.onTouchEnd.call(this,e)},destroy:function(){var e=Rui.util.LEvent;this.yScrollbarEl&&(e.removeListener(this.yScrollbarEl.dom,"mousedown",this.onYScrollbarMousedown),e.removeListener(this.yScrollbarEl.dom,"mouseup",this.onYScrollbarMouseup),e.removeListener(this.yScrollbarEl.dom,"mousemove",this.onYScrollbarMouseup)),this.xScrollbarPrevButtonEl&&(e.removeListener(this.xScrollbarPrevButtonEl.dom,"mousedown",this.onMousedownXPrev),e.removeListener(this.xScrollbarPrevButtonEl.dom,"mouseup",this.onMouseup),this.xScrollbarPrevButtonEl.remove(),this.xScrollbarPrevButtonEl=null),this.xScrollbarNextButtonEl&&(e.removeListener(this.xScrollbarNextButtonEl.dom,"mousedown",this.onMousedownXNext),e.removeListener(this.xScrollbarNextButtonEl.dom,"mouseup",this.onMouseup),this.xScrollbarNextButtonEl.remove(),this.xScrollbarNextButtonEl=null),this.yScrollbarPrevButtonEl&&(e.removeListener(this.yScrollbarPrevButtonEl.dom,"mousedown",this.onMousedownYPrev),e.removeListener(this.yScrollbarPrevButtonEl.dom,"mouseup",this.onMouseup),this.yScrollbarPrevButtonEl.remove(),this.yScrollbarPrevButtonEl=null),this.yScrollbarNextButtonEl&&(e.removeListener(this.yScrollbarNextButtonEl.dom,"mousedown",this.onMousedownYNext),e.removeListener(this.yScrollbarNextButtonEl.dom,"mouseup",this.onMouseup),this.yScrollbarNextButtonEl.remove(),this.yScrollbarNextButtonEl=null),Rui.ui.grid.LGridScroller.superclass.destroy.call(this)}}),function(){var v=Rui.util.LEvent;Rui.ui.grid.LActionMenuGrid=function(e){var t=e||{};t.event=Rui.applyIf(t.event||{},{event:{onCellClick:!0}}),Rui.ui.grid.LActionMenuGrid.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.grid.LActionMenuGrid,Rui.ui.LActionMenu,{CSS_BASE:"grid-action-menu",onDblClick:function(e){v.stopEvent(e);var t=this.gridPanel,i=t.columnModel,l=t.getSelectionModel(),s=l.getRow(),o=l.getCol(),r={target:t,event:e,row:s,col:o,colId:i.getColumnAt(o).id};!1===t.fireEvent("cellDblClick",r)&&t.getView().cancelViewFocus(),this.hideActionMenu()},onSumClick:function(e){v.stopEvent(e);var t,i=this.gridPanel,l=i.columnModel,s=i.getSelectionModel(),o=this.gridPanel.dataSet,r=s.getSelection(),n=0,d=0,a=0;for(t in r){var h=r[t],u=o.indexOfKey(t);if(!(u<0))for(var c=o.getAt(u),g=0,f=l.getColumnCount(!0);g<f;g++){var m=l.getColumnAt(g,!0);h[m.id]&&(m.field&&"number"===m.type?(n+=m.field?parseInt(c.get(m.field),10):0,d++):a++)}}this.hideActionMenu();var C=Rui.getMessageManager(),R=C.get("$.base.msg136")+" : "+d+", ";0<a&&(R+=C.get("$.base.msg137")+" : "+a+", "),R+=C.get("$.base.msg123")+" : "+n+", ",R+=C.get("$.base.msg138")+" : "+n/d,Rui.alert(R)},onClipboardCopy:function(e){this.gridPanel.dataToClipboard(),this.hideActionMenu()},onClipboardPaste:function(e){this.gridPanel.clipboardToLoad(),this.hideActionMenu()}})}();