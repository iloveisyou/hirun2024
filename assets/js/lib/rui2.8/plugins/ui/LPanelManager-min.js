/*
 * @(#) LPanelManager-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
!function(){Rui.ui.LPanelManager=function(e){this.init(e)};var l=Rui.ui.LPanel,s=Rui.util.LEvent,u=Rui.util.LDom,n=Rui.ui.LConfig,i=(Rui.util.LCustomEvent,Rui.ui.LPanelManager);i.CSS_FOCUSED="focused",i.prototype={constructor:i,overlays:null,initDefaultConfig:function(){this.cfg.addProperty("overlays",{suppressEvent:!0}),this.cfg.addProperty("focus",{value:"mousedown"})},init:function(e){this.cfg=new n(this),this.initDefaultConfig(),e&&this.cfg.applyConfig(e,!0),this.cfg.fireQueue();var r=null;this.getActive=function(){return r},this.focus=function(e){var t=this.find(e);t&&t.focus()},this.remove=function(e){var t,n,i=this.find(e);i&&(r==i&&(r=null),(n=null===i.element&&null===i.cfg)||(t=u.getStyle(i.element,"zIndex"),i.cfg.setProperty("zIndex",-1e3,!0)),this.overlays.sort(this.compareZIndexDesc),this.overlays=this.overlays.slice(0,this.overlays.length-1),i.unOn("hide",i.blur,i),i.unOn("destroy",this._onOverlayDestroy,i),i.unOn("focus",this._onOverlayFocusHandler,i),i.unOn("blue",this._onOverlayBlurHandler,i),n||(s.removeListener(i.element,this.cfg.getProperty("focus"),this._onOverlayElementFocus),i.cfg.setProperty("zIndex",t,!0),i.cfg.setProperty("manager",null)))},this.blurAll=function(){var e,t=this.overlays.length;if(0<t)for(e=t-1;this.overlays[e].blur(),e--;);},this._manageBlur=function(e){if(void 0!==e){var t=!1;return r==e&&(u.removeClass(r.element,i.CSS_FOCUSED),t=!(r=null)),t}},this._manageFocus=function(e){if(void 0!==e){var t=!1;return r!=e&&(r&&r.blur(),r=e,this.bringToTop(r),u.addClass(r.element,i.CSS_FOCUSED),t=!0),t}};var t=this.cfg.getProperty("overlays");this.overlays||(this.overlays=[]),t&&(this.register(t),this.overlays.sort(this.compareZIndexDesc))},_onOverlayElementFocus:function(e){var t=s.getTarget(e),n=this.close;n&&(t==n||u.isAncestor(n,t))?this.blur():this.focus()},_onOverlayDestroy:function(e,t,n){this.remove(n)},_onOverlayFocusHandler:function(e,t,n){this._manageFocus(n)},_onOverlayBlurHandler:function(e,t,n){this._manageBlur(n)},_bindFocus:function(e){var t=this;e.on("focus",t._onOverlayFocusHandler,this,!0),s.on(e.element,t.cfg.getProperty("focus"),t._onOverlayElementFocus,null,e),e.focus=function(){t._manageFocus(this)&&(this.cfg.getProperty("visible")&&this.focusFirst&&this.focusFirst(),this.fireEvent("focus",{target:this}))},e.focus._managed=!0},_bindBlur:function(e){var t=this;e.on("blur",t._onOverlayBlurHandler,this,!0),e.blur=function(){t._manageBlur(this)&&this.fireEvent("blur",{target:this})},e.blur._managed=!0,e.on("hide",e.blur,this,!0)},_bindDestroy:function(e){e.on("destroy",this._onOverlayDestroy,this,!0)},_syncZIndex:function(e){var t=u.getStyle(e.element,"zIndex");isNaN(t)?e.cfg.setProperty("zIndex",0):e.cfg.setProperty("zIndex",parseInt(t,10))},register:function(e){var t,n,i=!1;if(e instanceof l)e.cfg.addProperty("manager",{value:this}),this._bindFocus(e),this._bindBlur(e),this._bindDestroy(e),this._syncZIndex(e),this.overlays.push(e),this.bringToTop(e),i=!0;else if(e instanceof Array)for(t=0,n=e.length;t<n;t++)i=this.register(e[t])||i;return i},bringToTop:function(e){var t,n,i,r,s,o=this.find(e);o&&((s=this.overlays).sort(this.compareZIndexDesc),(t=s[0])&&(r=u.getStyle(t.element,"zIndex"),isNaN(r)||(n=!1,t!==o?n=!0:1<s.length&&(i=u.getStyle(s[1].element,"zIndex"),isNaN(i)||r!=i||(n=!0)),n&&o.cfg.setProperty("zindex",parseInt(r,10)+2)),s.sort(this.compareZIndexDesc)))},find:function(e){var t,n,i=e instanceof l,r=this.overlays,s=r.length,o=null;if(i||"string"==typeof e)for(n=s-1;0<=n;n--)if(t=r[n],i&&t===e||t.id==e){o=t;break}return o},compareZIndexDesc:function(e,t){var n=e.cfg?e.cfg.getProperty("zIndex"):null,i=t.cfg?t.cfg.getProperty("zIndex"):null;return null===n&&null===i?0:null===n?1:null===i||i<n?-1:n<i?1:0},showAll:function(){for(var e=this.overlays,t=e.length-1;0<=t;t--)e[t].show()},hideAll:function(){for(var e=this.overlays,t=e.length-1;0<=t;t--)e[t].hide()},toString:function(){return"LPanelManager"}}}();