/*
 * @(#) LFileUploadDialog-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.ui.LFileUploadDialog=function(e){e=e||{},this.uploadDelegate=Rui.util.LFunction.createDelegate(this.onUpload,this),e=Rui.applyIf(e,{postmethod:"async",visible:!1,hideaftersubmit:!1,callback:{upload:this.uploadDelegate},buttons:[{text:"Upload",handler:this.handleSubmit,isDefault:!0},{text:"Close",handler:this.handleCancel}]}),this.activeTaskDelegate=Rui.util.LFunction.createDelegate(this.activeTask,this),this.updateProgressDelegate=Rui.util.LFunction.createDelegate(this.updateProgress,this),e=Rui.applyIf(e,Rui.getConfig().getFirst("$.ext.fileupload.defaultProperties")),this.url=e.url,this.useProgressBar=!0===e.useProgressBar,Rui.ui.LFileUploadDialog.superclass.constructor.call(this,e),this.createEvent("success")},Rui.extend(Rui.ui.LFileUploadDialog,Rui.ui.LDialog,{isSecure:!1,url:null,name:null,emptyMsg:null,useProgressBar:!1,statusUrl:"fileUploadStatus.jsp",params:null,delayTime:500,onUpload:function(e){this.formEl.dom.reset(),this.useProgressBar&&this.setProgressValue(100),this.fireEvent("success",{target:this,conn:e,value:this.fileBox.getValue()}),this.createFile(!0),this.updateStatus(!1),this.hide()},handleSubmit:function(e){if(""!=this.fileBox.getValue()){if(this.updateStatus(!0),Rui.LConnect._isFormSubmit=!0,this.params){Rui.select(".L-upload-parameters").remove();var t='<div class="L-upload-parameters">';for(m in this.params){var s=this.params[m];t+='<input type="hidden" name="'+m+'" value="'+s+'">'}t+="</div>",this.formEl.appendChild(t)}this.submit(),this.useProgressBar&&this.startProgress()}else Rui.alert(this.emptyMsg||Rui.getMessageManager().get("$.ext.msg023"))},setParams:function(e){this.params=e},activeTask:function(){var e=this.statusUrl,e=Rui.util.LString.getTimeUrl(e);Rui.LConnect.asyncRequest("GET",e,{success:this.updateProgressDelegate,failure:Rui.util.LFunction.createDelegate(function(e){Rui.alert(Rui.getMessageManager().get("$.base.msg101")+" : "+e.statusText)},this)})},setProgressValue:function(e){this.progressMaskEl.setStyle("margin-left",e+"%")},updateProgress:function(e){try{var t=this.isUpdateStatus(),s=t?parseInt(e.responseText):100;this.setProgressValue(s),s<100&&t&&this.activeDelayedTask.delay(this.delayTime)}catch(e){}},updateStatus:function(e){var t=Rui.get(this.body);e?t.addClass("upload-status"):t.removeClass("upload-status")},isUpdateStatus:function(){return Rui.get(this.body).hasClass("upload-status")},startProgress:function(){this.activeDelayedTask||(this.activeDelayedTask=new Rui.util.LDelayedTask(this.activeTaskDelegate)),this.activeDelayedTask.delay(500)},handleCancel:function(e){this.hide()},afterRender:function(e){Rui.ui.LFileUploadDialog.superclass.afterRender.call(this,e),this.setHeader("File upload"),this.setBody(this.getBodyHtml()),this.createFile(!1);var t=Rui.get(this.body);this.formEl=t.select(".L-file-upload-form").getAt(0),this.progressMaskEl=t.select(".L-file-upload-progress-mask").getAt(0),this.formEl.dom.enctype="multipart/form-data",this.formEl.dom.encoding="multipart/form-data",this.on("show",this.onShow,this,!0)},onShow:function(e){this.fileBox.focus(),this.formEl.dom.reset()},createFile:function(e){e&&this.fileBox.destroy(),this.fileBox=new Rui.ui.form.LFileBox({id:this.id+"fileBox",width:400,name:this.name,renderTo:this.id+"fileBox"})},getBodyHtml:function(){this.templates=new Rui.LTemplate("<div class='L-file-upload-progress L-file-upload-active-{active}'><div class='L-file-upload-progress-mask'></div></div>","<form id='fileUploadFrm' name='fileUploadFrm' method='post' action='{url}' class='L-file-upload-form'>","    <div id='"+this.id+"fileBox'></div>","</form>");var e={url:this.url,active:this.useProgressBar,blockFileInput:"block"+this.id+"-input",blcokGridId:"block"+this.id+"-grid"};return this.templates.apply(e)},validate:function(){var e=Rui.ui.LFileUploadDialog.superclass.validate.call(this);return this.useProgressBar&&this.setProgressValue(0),this.updateStatus(!1),e},getFileBox:function(){return this.fileBox},getParams:function(){return this.params},destroy:function(){this.unOn("show",this.onShow,this),Rui.ui.LFileUploadDialog.superclass.destroy.call(this)}});