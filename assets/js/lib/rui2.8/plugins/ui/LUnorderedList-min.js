/*
 * @(#) LUnorderedList-min.js
 * 
 * DevOn RUI
 * Build Version : 2.8
 * 
 * Copyright ⓒ LG CNS, Inc. All rights reserved.
 *
 * DevOn RUI의 모든 저작물은 LG CNS 의 지적재산입니다.
 * LG CNS로 부터 허가 받지 않은 경우 사용, 열람, 복사, 수정, 재배포 할 수 없으며 외부로의 유출을 금지합니다.
 * 특히 소스 코드를 수정하는 경우 기술 지원의 대상이 되지 않을 수 있습니다.
 * 자세한 사항은 계약사항에 따릅니다. 기타 사항은 devon@lgcns.com 으로 문의 하십시오.
 *
 * Do Not Erase This Comment!!! (이 주석문을 지우지 말것)
 *
 * rui/license.txt를 반드시 읽어보고 사용하시기 바랍니다. License.txt파일은 절대로 삭제하시면 안됩니다. 
 *
 * 1. 사내 사용시 KAMS를 통해 요청하여 사용허가를 받으셔야 소프트웨어 라이센스 계약서에 동의하는 것으로 간주됩니다.
 * 2. DevOn RUI가 포함된 제품을 판매하실 경우에도 KAMS를 통해 요청하여 사용허가를 받으셔야 합니다.
 * 3. KAMS를 통해 사용허가를 받지 않은 경우 소프트웨어 라이센스 계약을 위반한 것으로 간주됩니다.
 * 4. 별도로 판매될 경우는 LGCNS의 소프트웨어 판매정책을 따릅니다.
 */
Rui.ui.LUnorderedList||(Rui.ui.LUnorderedList=function(t){t=t||{},t=Rui.applyIf(t,Rui.getConfig().getFirst("$.ext.unorderedList.defaultProperties")),Rui.platform.isMobile&&(t.useAnimation=!1),this.createEvent("nodeClick"),this.createEvent("dynamicLoadChild"),this.createEvent("focusChanged"),this.createEvent("collapse"),this.createEvent("expand"),this.renderDataEvent=this.createEvent("renderData",{isCE:!0}),this.createEvent("syncDataSet"),Rui.ui.LUnorderedList.superclass.constructor.call(this,t)},Rui.extend(Rui.ui.LUnorderedList,Rui.ui.LUIComponent,{otype:"Rui.ui.LUnorderedList",dataSet:null,renderer:null,endDepth:null,currentFocus:null,lastFocusId:void 0,focusLastest:!0,prevFocusNode:null,childDataSet:null,hasChildValue:1,defaultOpenDepth:-1,defaultOpenTopIndex:-1,onlyOneTopOpen:!1,useTooltip:!1,ulData:[],lastNodeInfos:void 0,useAnimation:!1,animDuration:.3,syncDataSet:!0,liWidth:null,container:null,autoMark:!0,contextMenu:null,useTempId:!1,DATASET_EVENT_LOCK:{ADD:!1,UPDATE:!1,REMOVE:!1,ROW_POS_CHANGED:!1,ROW_SELECT_MARK:!1},accessibilityELRole:null,NODE_CONSTRUCTOR:"Rui.ui.LUnorderedListNode",CSS_BASE:"L-ul",CLASS_UL_FIRST:"L-ul-first",CLASS_UL_DEPTH:"L-ul-depth",CLASS_UL_HAS_CHILD_CLOSE_MID:"L-ul-has-child-close-mid",CLASS_UL_HAS_CHILD_CLOSE_LAST:"L-ul-has-child-close-last",CLASS_UL_HAS_CHILD_OPEN_MID:"L-ul-has-child-open-mid",CLASS_UL_HAS_CHILD_OPEN_LAST:"L-ul-has-child-open-last",CLASS_UL_HAS_NO_CHILD_MID:"L-ul-has-no-child-mid",CLASS_UL_HAS_NO_CHILD_LAST:"L-ul-has-no-child-last",CLASS_UL_NODE:"L-ul-node",CLASS_UL_LI:"L-ul-li",CLASS_UL_LI_DEPTH:"L-ul-li-depth",CLASS_UL_LI_INDEX:"L-ul-li-index",CLASS_UL_LI_DIV_DEPTH:"L-ul-li-div-depth",CLASS_UL_LI_LINE:"L-ul-li-line",CLASS_UL_LI_SELECTED:"L-ul-li-selected",CLASS_UL_FOCUS_TOP_NODE:"L-ul-focus-top-node",CLASS_UL_FOCUS_PARENT_NODE:"L-ul-focus-parent-node",CLASS_UL_FOCUS_NODE:"L-ul-focus-node",CLASS_UL_MARKED_NODE:"L-ul-marked-node",_setSyncDataSet:function(t,e,i){var s=e[0];this.dataSet.unOn("beforeLoad",this.doBeforeLoad,this),this.dataSet.unOn("load",this.onLoadDataSet,this),this.dataSet.unOn("add",this.onAddData,this),this.dataSet.unOn("dataChanged",this.onChangeData,this),this.dataSet.unOn("update",this.onUpdateData,this),this.dataSet.unOn("remove",this.onRemoveData,this),this.dataSet.unOn("undo",this.onUndoData,this),this.dataSet.unOn("rowPosChanged",this.onRowPosChangedData,this),this.dataSet.unOn("marked",this.onMarked,this),!0===s&&(this.dataSet.on("beforeLoad",this.doBeforeLoad,this,!0,{system:!0}),this.dataSet.on("load",this.onLoadDataSet,this,!0,{system:!0}),this.dataSet.on("add",this.onAddData,this,!0,{system:!0}),this.dataSet.on("dataChanged",this.onChangeData,this,!0,{system:!0}),this.dataSet.on("update",this.onUpdateData,this,!0,{system:!0}),this.dataSet.on("remove",this.onRemoveData,this,!0,{system:!0}),this.dataSet.on("undo",this.onUndoData,this,!0,{system:!0}),this.dataSet.on("rowPosChanged",this.onRowPosChangedData,this,!0,{system:!0}),this.dataSet.on("marked",this.onMarked,this,!0,{system:!0})),this.syncDataSet=s,this.fireEvent("syncDataSet",{target:this,isSync:s})},setSyncDataSet:function(t){this.cfg.setProperty("syncDataSet",t),t&&this.doRenderData()},NODE_STATE:{HAS_CHILD:0,HAS_NO_CHILD:1,MID:2,LAST:3,OPEN:4,CLOSE:5,MARK:6,UNMARK:7,FOCUS:8,UNFOCUS:9,FOCUS_TOP:10,FOCUS_PARENT:11,UNFOCUS_PARENT:12},initEvents:function(){Rui.ui.LUnorderedList.superclass.initEvents.call(this),this._setSyncDataSet("syncDataSet",[this.syncDataSet]),null!=this.childDataSet&&this.childDataSet.on("load",this.onLoadChildDataSet,this,!0,{system:!0}),this.on("expand",this.onExpand,this,!0),this.contextMenu&&this.contextMenu.on("triggerContextMenu",this.onTriggerContextMenu,this,!0),this.on("dynamicLoadChild",this.onDynamicLoadChild,this,!0)},initDefaultConfig:function(){Rui.ui.LUnorderedList.superclass.initDefaultConfig.call(this),this.cfg.addProperty("syncDataSet",{handler:this._setSyncDataSet,value:this.syncDataSet,validator:Rui.isBoolean})},createTemplate:function(){var t=this.templates||{};t.master||(t.master=new Rui.LTemplate('<ul class="{cssUlFirst} {cssUlDepth}" {accRole}>{li}</ul>')),t.li||(t.li=new Rui.LTemplate('<li class="{cssUlLiIndex} {cssUlLiDepth} {cssUlLiOthers}" style="{style}" {accRole}>','<div class="{cssUlNode} {cssUlLiDivDepth} {cssNodeState} {cssUlNodeId} {cssMark}"'+(this.useTooltip?'title="{content}"':"")+">{content}</div>","{childUl}","</li>")),this.templates=t},getUlHtml:function(t,e,i){var s=this.templates||{},d="";if(null===this.endDepth||e<=this.endDepth){var o=(i=i||this.getChildNodeInfos(t))?i.length:0;if(e=Rui.isEmpty(e)?0:e+1,0<o){for(var n="",r=0;r<o;r++)n+=this.getLiHtml(i[r],e,o-1==r,r);var a=this.getAccessibilityUlRole(e),d=s.master.apply({cssUlFirst:0==e?this.CLASS_UL_FIRST:"",cssUlDepth:this.CLASS_UL_DEPTH+"-"+e,accRole:Rui.useAccessibility()&&a?'role="'+a+'"':"",li:n})}}return d},getLiHtml:function(t,e,i,s){var d;e=Rui.isEmpty(e)?0:e,Rui.isEmpty(s)&&(d=d||this.getChildNodeInfos(this.fields.rootValue),s=Rui.isEmpty(s)?d.length:s);var o,n=this.templates||{},r=this.getRecordByNodeInfo(t),a=t.hasChild,h=this.getNodeStateClass(a,i),l=this.defaultOpenDepth>=e&&!0!==i?this.CLASS_UL_LI_LINE:"",u=this.isMarked(r),c=u?" "+this.CLASS_UL_MARKED_NODE:"",f=(this.defaultOpenDepth>=e&&!0!==i&&this.CLASS_UL_LI_SELECTED,this.liWidth?"width:"+this.liWidth+"px;":""),S=cssUlLiOthers="";if(!0!==r.dataSet.remainRemoved&&r.state===Rui.data.LRecord.STATE_DELETE)return"";this.defaultOpenDepth>=e&&(o=this.getChildNodeInfos(r.get(this.fields.id)),S+=this.getUlHtml(r.get(this.fields.id),e,o,i),h=a?i?this.CLASS_UL_HAS_CHILD_OPEN_LAST:this.CLASS_UL_HAS_CHILD_OPEN_MID:this.CLASS_UL_HAS_NO_CHILD_LAST),cssUlLiOthers=i?this.CLASS_UL_LI+"-last":0==s?this.CLASS_UL_LI+"-first":"",r.state!=Rui.data.LRecord.STATE_NORMAL&&(cssUlLiOthers+=" L-node-state-"+this.getState(r));var g=this.getAccessibilityLiRole(),L=this.getContent(r,h,u);return n.li.apply({cssUlLiIndex:this.CLASS_UL_LI_INDEX+"-"+(void 0!==s?s:""),cssUlLiDepth:this.CLASS_UL_LI_DEPTH+"-"+e+(l?" "+l:""),cssUlLiOthers:cssUlLiOthers,style:f,cssUlNode:this.CLASS_UL_NODE,cssUlLiDivDepth:this.CLASS_UL_LI_DIV_DEPTH+"-"+e,cssNodeState:h,cssUlNodeId:this.CLASS_UL_NODE+"-"+r.id,cssMark:c,accRole:Rui.useAccessibility()&&g?'role="'+g+'"':"",content:L,title:L,childUl:S})},getAccessibilityUlRole:function(t){return null},getAccessibilityLiRole:function(){return null},getNodeStateClass:function(t,e){return t?e?this.CLASS_UL_HAS_CHILD_CLOSE_LAST:this.CLASS_UL_HAS_CHILD_CLOSE_MID:e?this.CLASS_UL_HAS_NO_CHILD_LAST:this.CLASS_UL_HAS_NO_CHILD_MID},getContent:function(t,e,i){return this.getLabel(t,e)},getLabel:function(t,e){var i=(i=t.get(this.fields.label))||"&nbsp;";return i=this.renderer?this.renderer(i,t,e):i},isMarked:function(t){return this.dataSet.isMarked(this.dataSet.indexOfKey(t.id))},getChildNodeInfos:function(t,e,i,s){var d;return void 0!==t&&0==(d=!s&&this.lastNodeInfos&&this.lastNodeInfos.parentId===t?this.lastNodeInfos.nodeInfos:[]).length&&(d=i?this.getChildNodeInfosByDom(i,s):this.getChildNodeInfosByDataSet(t,e),this.lastNodeInfos={parentId:t,nodeInfos:d}),d},getChildNodeInfosByDataSet:function(t,e){var i=new Array;t===this.fields.rootValue&&(this.ulData=[],i=this.ulData);var s=this.getChildRecords(t,e);!0===this.fields.setRootFirstChild&&!this.rootChanged&&t===this.fields.rootValue&&0<s.length&&(this.rootChanged=!0,this.tempRootValue=s[0].get(this.fields.id),s=this.getChildRecords(this.tempRootValue));for(var d=0;d<s.length;d++)i.push(this.getNodeInfoByRecord(s[d]));return i},getRootValue:function(){return!0===this.fields.setRootFirstChild?this.tempRootValue:this.fields.rootValue},getChildRecords:function(t,e){var i=new Array;if(void 0!==t){e=e||this.dataSet,t=void 0===t?this.fields.rootValue:t;for(var s=e.getCount(),d=null,o=0;o<s;o++)(d=e.getAt(o)).get(this.fields.parentId)===t&&i.push(d);i=this.fields.order?this.getSortedRecords(i):i}return i},getSortedRecords:function(t){for(var e,i=new Array,s=0;s<t.length;s++)e=t[s].get(this.fields.order),i.push((e||1e10)+"."+s.toString());i.sort(function(t,e){return t-e});for(var d=new Array,o=-1,n=-1,r=null,s=0;s<i.length;s++)r=i[s].split("."),o=parseInt(r[1]),n=parseInt(r[0]),d.push(t[o]),prev=n;return d},getChildNodeInfosByDom:function(t,e){var i=this.getNodeInfo(t);return i.children=i.hasChild&&0==i.children.length||e?this.findChildNodeInfos(i,t[0],e):i.children,e&&(i.hasChild=0<i.children.length&&this.hasChildValue),i.children},getNodeInfo:function(t){var e=!0,i=this.ulData;if(e=!!t)for(var s=t.length-1;0<=s;s--){if(nodeInfo=this.findNodeInfo(i,t[s]),!nodeInfo){e=!1;break}i=nodeInfo.children}return!!e&&nodeInfo},findNodeInfo:function(t,e){return t=0==t.length?this.getNodeInfos(this.getUL(e)):t,this.checkHasNode(t,e)},getNodeInfos:function(t){for(var e=new Array,i=t.childNodes.length,s=0;s<i;s++)e.push(this.getNodeInfoByDom(t.childNodes[s].firstChild,s));return 0<e.length&&e},findChildNodeInfos:function(t,e,i){var s,d=[],o=this.getChildUL(e);return o&&!i?d=this.getNodeInfos(o):(s=this.getRecordByNodeInfo(t))&&(d=this.getChildNodeInfosByDataSet(s.get(this.fields.id))),d},checkHasNode:function(t,e){var i=null;if(t)for(var s=this.getRecordId(e),d=0;d<t.length;d++)if(t[d].id==s){i=t[d];break}return i||!1},checkHasChild:function(t){var e=0;if(this.fields.hasChild)e=t.get(this.fields.hasChild);else{var i=t.get(this.fields.id);if(void 0!==i)for(var s=this.dataSet.getCount(),d=0;d<s;d++)if(this.dataSet.getAt(d).get(this.fields.parentId)===i){e=this.hasChildValue;break}}return e},checkHasChildByDom:function(t){return!!this.getChildUL(t)||this.checkHasChild(this.dataSet.get(this.getRecordId(t)))},getNodeInfoByRecord:function(t){return{id:t.id,hasChild:this.checkHasChild(t),order:t.get(this.fields.order),children:[]}},getNodeInfoByDom:function(t,e){return{id:this.getRecordId(t),hasChild:this.checkHasChildByDom(t),order:e,children:[]}},getRecordByNodeInfo:function(t){return this.dataSet.get(t.id)},htmlToDom:function(t){var e=document.createElement("div");return e.innerHTML=t,e.childNodes[0]},markChilds:function(t,e){if(this.autoMark)for(var i=this.getChildRecords(e.get(this.fields.id)),s=0;s<i.length;s++)i[s].treeType="child",this.markData(this.dataSet.indexOfKey(i[s].id),t);this.onRecordMarking=!1},markParents:function(t,e){if(this.autoMark&&e){var i=e.getParentNode();if(i){if(i.getRecord().treeType="parent",!i.isMarked()&&!t)return;if(!t)return void this.markData(this.dataSet.indexOfKey(i.getRecord().id),t);for(var s=0,d=i.getChildNodes(),o=d.length/2,n=d.length-1;o<=n;n--){if(!i.unorderList.findNode(d[n].id).isMarked())return;s++}for(n=0;n<o;n++){if(!i.unorderList.findNode(d[n].id).isMarked())return;s++}d.length==s&&this.markData(this.dataSet.indexOfKey(i.getRecord().id),t)}}},markData:function(t,e,i){var s;t<0||t>this.dataSet.getCount()||this.dataSet.isMarked(t)!=e&&(!i&&0==this.dataSet.isMarkable(t)||(s=this.dataSet.getAt(t),e?this.dataSet.selectedData.has(s.id)||this.dataSet.selectedData.add(s.id,s):this.dataSet.selectedData.remove(s.id),!0!==this.dataSet.isBatch&&this.onMark(t,e,s)))},doRender:function(t){this.createTemplate(),this.el.addClass(this.CSS_BASE),this.el.addClass("L-fixed"),Rui.util.LEvent.removeListener(this.el.dom,"mousedown",this.onCheckFocus),Rui.util.LEvent.addListener(this.el.dom,"mousedown",this.onCheckFocus,this,!0),Rui.useAccessibility()&&this.accessibilityELRole&&this.el.setAttribute("role",this.accessibilityELRole),this.doRenderData(),this.container=t,this._rendered=!0},afterRender:function(t){Rui.ui.LUnorderedList.superclass.afterRender.call(this,t),this.el.unOn("click",this.onNodeClick,this),this.el.on("click",this.onNodeClick,this,!0),this.unOn("dynamicLoadChild",this.onDynamicLoadChild,this,!0),this.on("dynamicLoadChild",this.onDynamicLoadChild,this,!0)},initDefaultFocus:function(){!this.lastFocusId&&-1<this.defaultOpenTopIndex?this.openFirstDepthNode(this.defaultOpenTopIndex):this.setFocusLastest()||this.refocusNode(this.dataSet.getRow())},doRenderData:function(){var t;this.el&&(this.prevFocusNode=void 0,this.currentFocus=void 0,this.lastNodeInfos=void 0,this.rootChanged=!1,this.el.html(this.getUlHtml(this.fields.rootValue)),(t=this.el.select("li.L-ul-li-depth-0"))&&t.length&&t.getAt(0).setAttribute("tabindex","0"),this.initDefaultFocus(),this.renderDataEvent.fire())},onNodeClick:function(t){var e=this.findNodeByDom(t.target);e&&!1!==this.fireEvent("nodeClick",{target:this,node:e,dom:t.target})&&(e!==this.currentFocus&&this.dataSet.setRow(e.getRow()),this.toggleChild(e))},toggleChild:function(t){t.toggleChild()},focusNode:function(t){if(!this.isPossibleNodeRecord(this.dataSet.getAt(t)))return!1;if(this.currentFocus&&this.currentFocus.getRow()===t)return!1;var e=!(e=0<=t&&this.findNode(this.dataSet.getAt(t).id))&&-1<t?this.buildNodes(t):e;return this.currentFocus&&this.currentFocus.unfocus(),this.prevFocusNode=this.currentFocus,this.currentFocus=e,this.lastFocusId=this.currentFocus?this.currentFocus.getIdValue():void 0,this.currentFocus&&(this.currentFocus.focus(),this.el.moveScroll(this.currentFocus.el,!1,!0)),this.fireEvent("focusChanged",{target:this,oldNode:this.prevFocusNode,newNode:this.currentFocus}),this.currentFocus},refocusNode:function(t,e){e=1==e,this.dataSet.getRow()==t?this.focusNode(t):this.dataSet.setRow(t,{ignoreCanRowPosChangeEvent:e})},isPossibleNodeRecord:function(t){return void 0!==t&&void 0!==t.get(this.fields.parentId)},getLastLi:function(t){return!!(t.childNodes&&0<t.childNodes.length)&&t.childNodes[t.childNodes.length-1]},getLi:function(t,e){return e<t.childNodes.length&&t.childNodes[e]},getUL:function(t){return t.parentNode.parentNode},getChildUL:function(t){var e=Rui.util.LDom.getNextSibling(t);return!(!e||1!=e.nodeType||"ul"!=e.tagName.toLowerCase())&&e},findNode:function(t,e,i){if(!i&&!this.isPossibleNodeRecord(this.dataSet.get(t)))return!1;var s=e?Rui.get(e):this.el,d=s.select("div."+this.CLASS_UL_NODE+"-"+t,!0);return!!((s=d.getAt(0))&&0<d.length)&&this.getNodeObject(s.dom)},buildNodes:function(t){var e=!1;if(-1<t&&this.isPossibleNodeRecord(this.dataSet.getAt(t)))for(var i=this.getParentRecords(t),s=this.el,d=i.length-1;0<=d&&((e=this.findNode(i[d].id,s))&&0!==d);d--)e.expand(),s=e.getChildUL();return e},findNodeByDom:function(t){var e=Rui.util.LDom.findParent(t,"div."+this.CLASS_UL_NODE,10);return this.getNodeObject(e)},getFirstDepthNode:function(t){var e=this.getRootUL();return!!e&&this.getNodeObject(this.getLi(e.dom,t))},openFirstDepthNode:function(t){var e;-1<t&&((e=this.getFirstDepthNode(t))&&(this.dataSet.setRow(e.getRow()),null!=this.currentFocus&&this.currentFocus.expand()))},getNode:function(t){return this.findNode(t.id)},getNodeById:function(t){var e=this.dataSet.findRow(this.fields.id,t);if(e<0)return null;var i=this.dataSet.getAt(e);return this.getNode(i)},getNodeObject:function(t){if(t){var e=this.getRecordId(t);return this.currentFocus&&this.currentFocus.getRecordId()==e?this.currentFocus:this.createNodeObject(t)}return null},createNodeObject:function(t){return new Rui.ui.LUnorderedListNode({unorderList:this,useAnimation:this.useAnimation,dom:t})},createNode:function(t){return t=Rui.applyIf(t||{},{unorderList:this,nodeConstructor:this.NODE_CONSTRUCTOR}),new eval(t.nodeConstructor+".prototype.constructor")(t)},getFocusNode:function(){return this.currentFocus},getFocusLastest:function(){return this.getFocusNode()},getRootUL:function(){var t=this.el.select("."+this.CLASS_UL_FIRST,!0);return 0<t.length&&t.getAt(0)},getParentRecord:function(t){if(!this.isPossibleNodeRecord(t))return!1;var e=this.dataSet.findRow(this.fields.id,t.get(this.fields.parentId));return-1<e&&this.dataSet.getAt(e)},getParentRecords:function(t){var e=new Array;if(-1<t){var i=this.dataSet.getAt(t);e.push(i);for(var s=0;s<1e3&&i.get(this.fields.parentId)!==this.fields.rootValue&&(i=this.getParentRecord(i));s++)e.push(i)}return e},getParentId:function(t){return this.dataSet.get(this.getRecordId(t)).get(this.fields.id)},getRecordId:function(t){return t="li"==t.tagName.toLowerCase()?t.firstChild:t,Rui.util.LDom.findStringInClassName(t,this.CLASS_UL_NODE+"-")},getNodeLabel:function(t){return(t=t||this.currentFocus)?this.dataSet.get(t.getRecordId()).get(this.fields.label):""},setFocusLastest:function(){return!(!this.focusLastest||void 0===this.lastFocusId||!this.dataSet)&&this.setFocusById(this.lastFocusId)},setFocusById:function(t){if(void 0!==t){var e=this.dataSet.findRow(this.fields.id,t);return e!==this.dataSet.getRow()&&(this.dataSet.setRow(e),!0)}},setRootValue:function(t){this.fields.rootValue=t,this.doRenderData()},doBeforeLoad:function(t){this.showLoadingMessage()},onLoadDataSet:function(t){this.doRenderData(),this.hideLoadingMessage()},showLoadingMessage:function(){this.el&&this.el.mask()},hideLoadingMessage:function(){this.el&&this.el.unmask()},onMarked:function(t){var e=!this.onRecordMarking&&this.findNode(t.record.id);this.checkCount=0,e?t.isSelect?(t.record.treeType="child",e.mark(),t.record.treeType="parent",e.mark()):(t.record.treeType="child",e.unmark(),t.record.treeType="parent",e.unmark()):(this.onRecordMarking=!0,this.markChilds(t.isSelect,t.record),this.markParents(t.isSelect,this.findNode(t.record.id)))},onMark:function(t,e,i){var s=!this.onRecordMarking&&this.findNode(i.id);s?e?s.mark():s.unmark():(this.onRecordMarking=!0,this.markChilds(e,i),this.markParents(e,this.findNode(i.id)))},onExpand:function(t){var e=t.node;e&&e.getParentId()==t.target.getIdValue()&&this.el.moveScroll(e.el,!1,!0)},setDataSet:function(t){this.setSyncDataSet(!1),this.dataSet=t,this.setSyncDataSet(!0)},getAllChildRecords:function(t,e,i){if(i=i||new Array,void 0!==t)for(var s=(e=e||this.dataSet).getCount(),d=null,o=0;o<s;o++)(d=e.getAt(o)).get(this.fields.parentId)===t&&(i.push(d),this.getAllChildRecords(d.get(this.fields.id),e,i));return i},getAllChildRecordsClone:function(t,e,i){return this.getCloneRecords(this.getAllChildRecords(t,e),i)},getCloneRecords:function(t,e){for(var i,s=new Array,d=0;d<t.length;d++)i=t[d].clone(),e&&this.initIdValue(i,{ignoreEvent:!0}),s.push(i);return s},onTriggerContextMenu:function(t){var e=this.findNodeByDom(this.contextMenu.contextEventTarget);e?this.refocusNode(e.getRow()):this.contextMenu.cancel(!1)},onDynamicLoadChild:function(t){},setNodeLabel:function(t,e){(e=e||this.currentFocus)&&this.dataSet.get(e.getRecordId()).set(this.fields.label,t)},initIdValue:function(t,e){var i=void 0;if(this.useTempId){var s=t.findField(this.fields.id),d=new Date,o=parseInt(Rui.util.LString.simpleReplace(t.id,"r",""),10);switch(s.type){case"number":i=d.getTime()+o;break;case"date":i=Rui.util.LDate.add(d,Rui.util.LDate.MILLISECOND,o);break;case"string":i=""+d.getTime()+o}}return t.set(this.fields.id,i,e),i},addTopNode:function(t,e){return this.addChildNode(t,!0,e)},addChildNode:function(t,e,i){var s,d=!0!==e&&this.currentFocus?this.currentFocus.getIdValue():this.getRootValue();return void 0!==d?(void 0===i&&(this.DATASET_EVENT_LOCK.ADD=!0,this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!0,i=this.dataSet.newRecord(),this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!1,this.DATASET_EVENT_LOCK.ADD=!1),s=this.dataSet.getAt(i),this.DATASET_EVENT_LOCK.UPDATE=!0,this.initIdValue(s),s.set(this.fields.label,t),this.DATASET_EVENT_LOCK.UPDATE=!1,s.set(this.fields.parentId,d),this.refocusNode(i)):alert("부모의 id가 없음.  신규 추가한 node에 id가 있어야 자식을 추가할 수 있음. \r\ntempId를 사용하려면 config.useTempId:true로 설정.  \r\n이 경우 create된 record는 id 또는 parentId가 temp값이므로 DB업데이트시 주의요망"),i},addChildNodeHtml:function(t,e,i){var s,d=[this.getNodeInfoByRecord(t)];i=i||this.currentFocus,!e&&i?i.open(!0):((s=this.getRootUL())?(this.getNodeObject(this.getLastLi(s.dom)).changeStateTo(this.NODE_STATE.MID),s.appendChild(this.htmlToDom(this.getLiHtml(d[0],null,!0)))):this.el.html(this.getUlHtml(void 0,null,d)),this.ulData.push(d[0]))},concatArray:function(t,e){for(var i=0;i<e.length;i++)t.push(e[i])},redrawParent:function(t,e,i){var s;i=1==i,void 0!==t&&(t!==this.getRootValue()?(s=this.dataSet.findRow(this.fields.id,t),this.focusNode(s),this.currentFocus&&this.currentFocus.open(!0),void 0===e?this.dataSet.setRow(s,{ignoreCanRowPosChangeEvent:i}):this.refocusNode(e,i)):this.doRenderData())},deleteRecord:function(t,e,i){var s=new Array;i||s.push(t),this.concatArray(s,this.getAllChildRecords(t.get(this.fields.id)));var d=e?this.getCloneRecords(s):void 0;this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!0;for(var o=s.length-1;-1<o;o--)this.DATASET_EVENT_LOCK.REMOVE=!0,this.dataSet.removeAt(this.dataSet.indexOfKey(s[o].id)),this.DATASET_EVENT_LOCK.REMOVE=!1;return this.DATASET_EVENT_LOCK.ROW_POS_CHANGED=!1,d},deleteNode:function(t,e,i,s){if(t=t||this.currentFocus){var d,o,n,r=t.getRecord();return r&&(s=r.get(this.fields.parentId),d=this.deleteRecord(r,e,i)),s!==this.getRootValue()?this.redrawParent(s,void 0,!0):(n=(o=(o=t.getPreviousLi())||t.getNextLi())?this.getNodeObject(o):null,this.removeNodeDom(t),n&&this.dataSet.setRow(n.getRow(),{ignoreCanRowPosChangeEvent:!0})),d}},cutNode:function(t){t=t||this.currentFocus,this.deletedRecords=t?this.deleteNode(t,!0):null},copyNode:function(t,e){e=e||this.currentFocus,this.copiedRecordId=e?e.getRecordId():null,this.copyWithChilds=!(null==t||null==t||!this.useTempId)&&t},pasteNode:function(t){if(t=t||this.currentFocus)if(this.copiedRecordId){var e=this.dataSet.get(this.copiedRecordId),i=this.getMaxOrder(t.getIdValue());if(this.copyWithChilds){var s=new Array;s.push(e.clone()),this.concatArray(s,this.getAllChildRecordsClone(e.get(this.fields.id)),!0),this.DATASET_EVENT_LOCK.ADD=!0;for(var d=0;d<s.length;d++)s[d].setState(Rui.data.LRecord.STATE_INSERT),this.dataSet.add(s[d]),this.initIdValue(s[0],{ignoreEvent:!0}),s[0].set(this.fields.parentId,t.getIdValue(),{ignoreEvent:!0}),this.fields.order&&s[0].set(this.fields.order,i+1,{ignoreEvent:!0});this.DATASET_EVENT_LOCK.ADD=!1}else{var o=e.clone();this.DATASET_EVENT_LOCK.ADD=!0,o.setState(Rui.data.LRecord.STATE_INSERT),this.dataSet.add(o),this.initIdValue(o,{ignoreEvent:!0}),o.set(this.fields.parentId,t.getIdValue(),{ignoreEvent:!0}),this.fields.hasChild&&o.set(this.fields.hasChild,null,{ignoreEvent:!0}),this.fields.order&&o.set(this.fields.order,i+1,{ignoreEvent:!0}),this.DATASET_EVENT_LOCK.ADD=!1}t.open(!0)}else if(this.deletedRecords){this.DATASET_EVENT_LOCK.ADD=!0;for(d=0;d<this.deletedRecords.length;d++)this.deletedRecords[d].setState(Rui.data.LRecord.STATE_INSERT),this.dataSet.add(this.deletedRecords[d]),this.deletedRecords[0].set(this.fields.parentId,t.getIdValue(),{ignoreEvent:!0});this.DATASET_EVENT_LOCK.ADD=!1,t.open(!0)}this.copiedRecordId=null,this.copyWithChilds=null,this.deletedRecords=null},getMaxOrder:function(t){var e=-1;if(this.fields.order)for(var i,s=this.dataSet.getCount(),d=0;d<s;d++)(i=this.dataSet.getAt(d)).get(this.fields.parentId)===t&&(e=e<i.get(this.fields.order)?i.get(this.fields.order):e);return e},removeNodeDom:function(t){var e,i,s,d,o;(t=t||this.currentFocus)&&(1==(i=(e=Rui.get(t.getUL())).select("> li").length)?(0<t.getDepth()&&this.getNodeObject(t.getParentLi()).changeStateTo(this.NODE_STATE.HAS_NO_CHILD),s=e.dom,t===this.currentFocus&&delete this.currentFocus,delete t,delete e,Rui.util.LDom.removeNode(s)):1<i&&(!t.isLast()||(d=this.getNodeObject(t.getPreviousLi()))&&d.changeStateTo(this.NODE_STATE.LAST),o=t.getLi(),t===this.currentFocus&&delete this.currentFocus,delete t,Rui.util.LDom.removeNode(o)))},onAddData:function(t){var e,i;!0!==this.DATASET_EVENT_LOCK.ADD&&(this.isPossibleNodeRecord(t.record)?t.record.get(this.fields.parentId)===this.getRootValue()?this.addChildNodeHtml(t.record,!0):!(e=this.getParentRecord(t.record))||(i=this.findNode(e.id))&&i.open(!0):this.addTopNode(t.record.get(this.fields.label),t.row))},onChangeData:function(t){this.doRenderData()},onUpdateData:function(t){var e,i,s,d;!0!==this.DATASET_EVENT_LOCK.UPDATE&&(e=this.findNode(t.record.id),i=this.dataSet.getRow(),t.colId==this.fields.parentId?(e&&this.removeNodeDom(e),t.value===this.getRootValue()?this.addChildNodeHtml(t.record,!0):(d=(s=this.getParentRecord(t.record))?this.findNode(s.id):void 0,this.addChildNodeHtml(t.record,!1,d)),t.row===i&&this.focusNode(i)):e&&t.colId==this.fields.label?e.syncLabel():this.fields.order&&t.colId==this.fields.order?this.redrawParent(t.record.get(this.fields.parentId),t.row):e&&t.colId==this.fields.id&&t.row===i&&(this.lastFocusId=t.value))},onRemoveData:function(t){var e;!0!==this.DATASET_EVENT_LOCK.REMOVE&&((e=this.findNode(t.record.id,void 0,!0))?this.deleteNode(e,!1,!0,t.record.get(this.fields.parentId)):this.deleteRecord(t.record,!1,!0))},onUndoData:function(t){this.doRenderData()},clearDataSet:function(){this.doRenderData()},onRowPosChangedData:function(t){!0!==this.DATASET_EVENT_LOCK.ROW_POS_CHANGED&&this.focusNode(t.row)},onLoadChildDataSet:function(t){var e,i,s,d=new Array,o=new Array,n=!1;if(this.currentFocus){if(this.autoMark&&(n=this.dataSet.isMarked(this.dataSet.indexOfKey(this.currentFocus.getRecordId()))),0<(d=this.getChildRecords(this.currentFocus.getIdValue(),this.childDataSet)).length){for(this.DATASET_EVENT_LOCK.ADD=!0,s=0;s<d.length;s++)e=d[s].clone(),i=this.dataSet.add(e),this.autoMark&&n&&this.dataSet.setMark(i,!0),o.push(this.getNodeInfoByRecord(e));this.DATASET_EVENT_LOCK.ADD=!1}this.currentFocus.renderChild(o)}},isRendered:function(){return!0===this._rendered},getState:function(t){switch(t.state){case Rui.data.LRecord.STATE_INSERT:return"I";case Rui.data.LRecord.STATE_UPDATE:return"U";case Rui.data.LRecord.STATE_DELETE:return"D"}return""},destroy:function(){this.prevFocusNode=null,this.currentFocus=null,this.childDataSet=null,this.dataSet=null,Rui.ui.LUnorderedList.superclass.destroy.call(this)}}));